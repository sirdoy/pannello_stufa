# Milestone v3.0: Design System Evolution

**Status:** âœ… SHIPPED 2026-01-30
**Phases:** 11-18
**Total Plans:** 52

## Overview

Establish a complete, consistent, and accessible UI component library based on evolved Ember Noir design system, then systematically apply it across all application pages for visual consistency and professional polish.

## Phases

### Phase 11: Foundation & Tooling

**Goal**: Establish infrastructure for type-safe, accessible component development
**Depends on**: Nothing (starts v3.0)
**Plans**: 3 plans

Plans:
- [x] 11-01: CVA + cn() utility (clsx, tailwind-merge)
- [x] 11-02: Radix UI + jest-axe accessibility testing
- [x] 11-03: ESLint token enforcement + semantic design tokens

**Details:**
- Installed class-variance-authority for type-safe component variants
- Created cn() utility combining clsx and tailwind-merge
- Installed Radix UI primitives (@radix-ui/react-*)
- Set up jest-axe for automated accessibility testing
- Configured ESLint tailwindcss plugin for design token enforcement
- Created semantic design tokens using Tailwind v4 @theme directive

### Phase 12: Core Interactive Components

**Goal**: Deliver missing table-stakes form controls with Radix UI accessibility
**Depends on**: Phase 11
**Plans**: 3 plans

Plans:
- [x] 12-01: Checkbox + Switch (Radix primitives with CVA)
- [x] 12-02: RadioGroup + Select (selection patterns)
- [x] 12-03: Input + Slider (value input controls)

**Details:**
- Created accessible Checkbox with Radix UI and CVA variants
- Created accessible Switch with smooth animation
- Created RadioGroup with full keyboard navigation
- Enhanced Input with error/success states and CVA variants
- Created Select with Radix UI primitive and search capability
- Created Slider with range support and accessibility

### Phase 13: Foundation Refactoring

**Goal**: Refactor existing foundation components to use CVA and consistent patterns
**Depends on**: Phase 11
**Plans**: 8 plans (7 original + 1 gap closure)

Plans:
- [x] 13-01: Button CVA refactor with namespace pattern
- [x] 13-02: Card CVA refactor with namespace pattern
- [x] 13-03: Label component (Radix primitive) + Divider CVA refactor
- [x] 13-04: Heading + Text CVA refactor with typography system
- [x] 13-05: Migrate legacy Button props across codebase
- [x] 13-06: Migrate legacy Card liquid prop across codebase
- [x] 13-07: Gap closure: migrate remaining scheduler Card liquid props
- [x] 13-08: Final gap closure: remaining Card liquid props

**Details:**
- Refactored Button with CVA variants (ember, subtle, success, danger, outline, ghost)
- Refactored Card with liquid glass variants and composition pattern
- Created Label component using Radix primitive for accessibility
- Created Divider with solid, dashed, gradient variants
- Enhanced Heading and Text with complete typography system
- Migrated all legacy Button and Card props across codebase

### Phase 14: Feedback & Layout Components

**Goal**: Deliver complete feedback and layout system for complex UI patterns
**Depends on**: Phase 12, Phase 13
**Plans**: 7 plans

Plans:
- [x] 14-01: Modal/Dialog with Radix Dialog + CVA sizes + mobile bottom sheet
- [x] 14-02: Tooltip with Radix Tooltip primitive
- [x] 14-03: Toast system with Radix Toast + provider pattern + stacking
- [x] 14-04: Spinner + Progress with Radix Progress
- [x] 14-05: EmptyState + Banner CVA standardization
- [x] 14-06: PageLayout + DashboardLayout with collapsible sidebar
- [x] 14-07: Section + Grid CVA enhancements

**Details:**
- Created Modal/Dialog with focus trap, ESC close, and accessible ARIA
- Created Tooltip with keyboard trigger support
- Refactored Toast system with dismiss, auto-dismiss, and stacking
- Created Spinner/Loading component with sizes and ember variant
- Created Progress component with linear and circular variants
- Created EmptyState component with icon, title, description, action
- Standardized Banner with info/warning/error/success variants
- Created PageLayout and DashboardLayout with consistent structure
- Enhanced Section and Grid with responsive behavior

### Phase 15: Smart Home Components Refactor

**Goal**: Standardize domain-specific smart home components with unified APIs
**Depends on**: Phase 13, Phase 14
**Plans**: 9 plans

Plans:
- [x] 15-01: useLongPress hook + ControlButton CVA refactor
- [x] 15-02: Badge component with CVA and pulse animation
- [x] 15-03: ConnectionStatus + HealthIndicator components
- [x] 15-04: SmartHomeCard base component with namespace pattern
- [x] 15-05: StatusCard extending SmartHomeCard
- [x] 15-06: DeviceCard refactor with backwards compatibility
- [x] 15-07: Gap closure: Fix home page Grid props
- [x] 15-08: Gap closure: Integrate ControlButton into LightsCard
- [x] 15-09: Gap closure: Add Phase 15 components to design system page

**Details:**
- Created useLongPress hook for increment/decrement controls
- Standardized ControlButton with CVA variants
- Created Badge component with status colors and pulse animation
- Created ConnectionStatus component (online/offline/connecting)
- Created HealthIndicator component (ok/warning/error/critical)
- Created SmartHomeCard base with namespace pattern
- Created StatusCard extending SmartHomeCard for device status
- Refactored DeviceCard with consistent structure

### Phase 16: Page Migration & Application

**Goal**: Apply design system to all application pages for visual consistency
**Depends on**: Phase 15
**Plans**: 11 plans

Plans:
- [x] 16-01: Dashboard page migration (audit and cleanup)
- [x] 16-02: Stove page migration (Button, Badge cleanup, preserve theming)
- [x] 16-03: Thermostat page mode buttons and Grid migration
- [x] 16-04: Lights page Slider, Badge, and styling migration
- [x] 16-05: Monitoring page layout migration (Section, Grid)
- [x] 16-06: Schedule page verification and cleanup
- [x] 16-07: Notifications settings Banner and Badge migration
- [x] 16-08: Design system page PageLayout wrapper
- [x] 16-09: Final verification and human review checkpoint
- [x] 16-10: Settings pages (devices, theme) migration
- [x] 16-11: Admin/Debug pages migration (main, logs, transitions)

**Details:**
- Migrated all major application pages to use design system components
- Verified consistent Ember Noir styling across all pages
- Applied PageLayout and Section components consistently
- Migrated all form controls to design system versions
- Updated all buttons, cards, badges to CVA variants

### Phase 17: Accessibility & Testing

**Goal**: Ensure WCAG AA compliance and comprehensive accessibility testing
**Depends on**: Phase 16
**Plans**: 7 plans

Plans:
- [x] 17-01: useReducedMotion hook + Spinner/Progress reduced motion tests
- [x] 17-02: Keyboard navigation tests for Button, Checkbox, Switch, RadioGroup
- [x] 17-03: Keyboard navigation tests for Select, Slider, Input
- [x] 17-04: Accessibility tests for Modal, Tooltip, Toast, Banner, EmptyState
- [x] 17-05: Accessibility tests for Card, Badge, Label, Divider, Heading, Text
- [x] 17-06: Accessibility tests for smart home components
- [x] 17-07: Comprehensive accessibility.test.js + verification checkpoint

**Details:**
- Created useReducedMotion hook for respecting user preferences
- Added comprehensive keyboard navigation tests (436 tests)
- Added jest-axe accessibility tests for all components (172 tests)
- Verified focus indicators (ember glow ring)
- Verified touch targets (44px minimum)
- Verified ARIA labels and associations

### Phase 18: Documentation & Polish

**Goal**: Complete component documentation with interactive examples and accessibility guide
**Depends on**: Phase 17
**Plans**: 4 plans

Plans:
- [x] 18-01: Documentation infrastructure (CodeBlock, PropTable, AccessibilitySection)
- [x] 18-02: Component metadata (component-docs.js with props, keyboard, ARIA)
- [x] 18-03: Integrate documentation into design-system page
- [x] 18-04: Update docs/design-system.md and create docs/accessibility.md

**Details:**
- Created CodeBlock component with syntax highlighting and copy-to-clipboard
- Created PropTable component for API documentation
- Created AccessibilitySection for documenting a11y features
- Created component-docs.js with metadata for 24 components
- Updated /debug/design-system page with interactive documentation
- Updated docs/design-system.md (572 lines)
- Created docs/accessibility.md (542 lines)

---

## Milestone Summary

**Key Decisions:**
- CVA for type-safe component variants (excellent DX with autocomplete)
- Radix UI for accessibility primitives (saves significant implementation effort)
- Semantic design tokens via @theme (enables future theming)
- Namespace pattern for component composition (Card.Header, Button.Icon)
- jest-axe for automated accessibility testing (catches regressions)

**Issues Resolved:**
- Inconsistent component APIs across codebase
- Missing accessibility features (keyboard navigation, ARIA)
- Hardcoded colors instead of design tokens
- No type-safe variant props
- Lacking component documentation

**Issues Deferred:**
- TypeScript conversion (JavaScript working well)
- Storybook integration (React 19 compatibility issues)
- Visual regression testing (manual testing sufficient for now)

**Technical Debt Incurred:**
- Label component not exported from barrel (low impact, used internally)
- Some pre-existing test failures in DuplicateDayModal, StatusBadge (unrelated to v3.0)

---

_For current project status, see .planning/PROJECT.md_
