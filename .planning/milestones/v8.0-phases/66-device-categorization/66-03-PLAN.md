---
phase: 66-device-categorization
plan: 03
type: execute
wave: 2
depends_on: ["66-01"]
files_modified:
  - app/network/components/DeviceCategoryBadge.tsx
  - app/network/components/DeviceListTable.tsx
  - app/network/__tests__/components/DeviceCategoryBadge.test.tsx
  - app/network/__tests__/components/DeviceListTable.test.tsx
  - app/components/devices/network/types.ts
autonomous: true

must_haves:
  truths:
    - "Each device in the list displays a color-coded category badge"
    - "Category badges use correct variant: IoT=ocean, Mobile=sage, PC=warning, Smart Home=ember, Unknown=neutral"
    - "User can click a category badge to open a dropdown for manual override"
    - "Category column is sortable and visible in the device table"
    - "DeviceData type includes optional category field"
  artifacts:
    - path: "app/network/components/DeviceCategoryBadge.tsx"
      provides: "Category badge display component"
      min_lines: 30
    - path: "app/network/components/DeviceListTable.tsx"
      provides: "Updated table with category column and inline edit"
      contains: "DeviceCategoryBadge"
    - path: "app/network/__tests__/components/DeviceCategoryBadge.test.tsx"
      provides: "Badge component tests"
      min_lines: 40
    - path: "app/network/__tests__/components/DeviceListTable.test.tsx"
      provides: "Updated table tests with category column"
      contains: "Categoria"
  key_links:
    - from: "app/network/components/DeviceCategoryBadge.tsx"
      to: "app/components/ui/Badge.tsx"
      via: "imports Badge component"
      pattern: "import.*Badge.*from.*@/app/components/ui"
    - from: "app/network/components/DeviceListTable.tsx"
      to: "app/network/components/DeviceCategoryBadge.tsx"
      via: "imports DeviceCategoryBadge"
      pattern: "import.*DeviceCategoryBadge"
    - from: "app/network/components/DeviceListTable.tsx"
      to: "types/firebase/network.ts"
      via: "imports DeviceCategory type"
      pattern: "import.*DeviceCategory"
---

<objective>
Create the DeviceCategoryBadge component and add a category column with inline edit capability to the DeviceListTable.

Purpose: Provides the visual layer (CAT-03) for device categorization with color-coded badges and click-to-edit manual override (CAT-02). Users can identify device types at a glance and correct auto-categorization mistakes.

Output: DeviceCategoryBadge component, updated DeviceListTable with category column, comprehensive tests.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/66-device-categorization/66-RESEARCH.md
@.planning/phases/66-device-categorization/66-01-SUMMARY.md

# Key existing files to modify
@app/network/components/DeviceListTable.tsx
@app/network/__tests__/components/DeviceListTable.test.tsx
@app/components/ui/Badge.tsx
@app/components/devices/network/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: DeviceCategoryBadge component with tests</name>
  <files>
    app/network/components/DeviceCategoryBadge.tsx
    app/network/__tests__/components/DeviceCategoryBadge.test.tsx
    app/components/devices/network/types.ts
  </files>
  <action>
**Step 1: Extend DeviceData type**

In `app/components/devices/network/types.ts`, add `category` field to `DeviceData`:
```typescript
import type { DeviceCategory } from '@/types/firebase/network';

export interface DeviceData {
  // ... existing fields unchanged
  category?: DeviceCategory;  // Add this field
}
```

**Step 2: Create DeviceCategoryBadge component**

Create `app/network/components/DeviceCategoryBadge.tsx`:

```typescript
'use client';

import { Badge } from '@/app/components/ui';
import type { DeviceCategory } from '@/types/firebase/network';

interface CategoryConfig {
  label: string;
  variant: 'ocean' | 'sage' | 'warning' | 'ember' | 'neutral';
}

const CATEGORY_CONFIG: Record<DeviceCategory, CategoryConfig> = {
  'iot': { label: 'IoT', variant: 'ocean' },
  'mobile': { label: 'Mobile', variant: 'sage' },
  'pc': { label: 'PC', variant: 'warning' },
  'smart-home': { label: 'Smart Home', variant: 'ember' },
  'unknown': { label: 'Sconosciuto', variant: 'neutral' },
};

interface DeviceCategoryBadgeProps {
  category: DeviceCategory;
  onClick?: () => void;
}

export function DeviceCategoryBadge({ category, onClick }: DeviceCategoryBadgeProps) {
  const config = CATEGORY_CONFIG[category] ?? CATEGORY_CONFIG['unknown'];

  return (
    <Badge
      variant={config.variant}
      size="sm"
      className={onClick ? 'cursor-pointer hover:opacity-80 transition-opacity' : ''}
      onClick={onClick}
      role={onClick ? 'button' : undefined}
      tabIndex={onClick ? 0 : undefined}
    >
      {config.label}
    </Badge>
  );
}

export default DeviceCategoryBadge;
```

Note: NO emoji icons in badges — research suggested them but the existing design system uses text-only badges. Keep consistent. Italian label for 'unknown' = 'Sconosciuto'.

**Step 3: Create DeviceCategoryBadge tests**

Create `app/network/__tests__/components/DeviceCategoryBadge.test.tsx`:

Tests (8 tests):
1. Renders IoT badge with ocean variant
2. Renders Mobile badge with sage variant
3. Renders PC badge with warning variant
4. Renders Smart Home badge with ember variant
5. Renders Sconosciuto badge with neutral variant for 'unknown'
6. Applies cursor-pointer and hover classes when onClick provided
7. Sets role="button" and tabIndex=0 when onClick provided
8. Does NOT set role/tabIndex when no onClick (non-interactive)

Mock Badge component with simple render (follow DeviceStatusBadge.test.tsx pattern). Use `@testing-library/react` `render` and `screen`.
  </action>
  <verify>
Run `npx jest app/network/__tests__/components/DeviceCategoryBadge.test.tsx` — all 8 tests pass. Run `npx tsc --noEmit` — no new TypeScript errors.
  </verify>
  <done>
DeviceCategoryBadge renders correct Badge variant for each of 5 categories. Component supports interactive mode (click-to-edit) with appropriate ARIA attributes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add category column with inline edit to DeviceListTable</name>
  <files>
    app/network/components/DeviceListTable.tsx
    app/network/__tests__/components/DeviceListTable.test.tsx
  </files>
  <action>
**Modify `app/network/components/DeviceListTable.tsx`:**

1. Add import for DeviceCategoryBadge and DeviceCategory type:
```typescript
import DeviceCategoryBadge from './DeviceCategoryBadge';
import type { DeviceCategory } from '@/types/firebase/network';
```

2. Add `onCategoryChange` callback prop to `DeviceListTableProps`:
```typescript
interface DeviceListTableProps {
  devices: DeviceData[];
  isStale: boolean;
  onCategoryChange?: (mac: string, category: DeviceCategory) => void;
}
```

3. Add local state for editing:
```typescript
const [editingMac, setEditingMac] = useState<string | null>(null);
```

4. Add category column AFTER the MAC column (before Status column), at position index 3 in the columns array:
```typescript
{
  accessorKey: 'category',
  header: 'Categoria',
  enableSorting: true,
  enableGlobalFilter: false,
  cell: ({ row }) => {
    const mac = row.original.mac;
    const category = row.original.category ?? 'unknown';

    if (editingMac === mac) {
      return (
        <select
          value={category}
          onChange={(e) => {
            const newCategory = e.target.value as DeviceCategory;
            onCategoryChange?.(mac, newCategory);
            setEditingMac(null);
          }}
          onBlur={() => setEditingMac(null)}
          autoFocus
          className="bg-slate-800 text-slate-200 text-xs rounded px-2 py-1 border border-white/10 focus:border-ember-400 focus:outline-none"
        >
          <option value="iot">IoT</option>
          <option value="mobile">Mobile</option>
          <option value="pc">PC</option>
          <option value="smart-home">Smart Home</option>
          <option value="unknown">Sconosciuto</option>
        </select>
      );
    }

    return (
      <DeviceCategoryBadge
        category={category}
        onClick={onCategoryChange ? () => setEditingMac(mac) : undefined}
      />
    );
  },
},
```

5. Add `editingMac` to the columns useMemo dependency array.

6. Destructure `onCategoryChange` from props in the function signature.

**Update `app/network/__tests__/components/DeviceListTable.test.tsx`:**

Add tests (5 new tests appended to existing suite):
1. Renders category column with header "Categoria"
2. Shows DeviceCategoryBadge for each device with correct category
3. Shows 'unknown' badge when device has no category
4. Clicking a badge opens category dropdown (when onCategoryChange provided)
5. Selecting a category from dropdown calls onCategoryChange with mac and new category

Also update existing test data to include `category` field on some test devices:
- Device 1: `category: 'mobile'`
- Device 2: `category: 'smart-home'`
- Device 3: no category (defaults to 'unknown')

Add mock for DeviceCategoryBadge in the test file (simple functional mock that renders the category text and accepts onClick).

Keep all existing 13 tests intact — the new column addition should not break them. The existing test data should still match since `category` is optional.
  </action>
  <verify>
Run `npx jest app/network/__tests__/components/DeviceListTable.test.tsx` — all tests pass (13 existing + 5 new = 18 total). Run `npx jest app/network/__tests__/components/` — all test suites pass. Run `npx tsc --noEmit` — no new errors.
  </verify>
  <done>
DeviceListTable now has 6 columns (Name, IP, MAC, Category, Status, Bandwidth). Category column shows color-coded badges. Clicking a badge opens an inline dropdown for manual override. onCategoryChange callback propagates changes to parent. All 18 tests pass.
  </done>
</task>

</tasks>

<verification>
1. `npx jest app/network/__tests__/components/ --verbose` — all tests pass (8 badge + 18 table = 26 total)
2. `npx tsc --noEmit` — no new TypeScript errors
3. DeviceData type includes optional `category` field
4. DeviceCategoryBadge maps 5 categories to 5 Badge variants
5. DeviceListTable renders 6 columns including Categoria
6. Inline edit dropdown appears on badge click and calls onCategoryChange
</verification>

<success_criteria>
- Category badges visible in device list with correct color coding
- Click-to-edit dropdown works for manual category override
- All 26 tests passing (8 badge + 18 table)
- DeviceData type backward compatible (category is optional)
- Italian label for unknown category ('Sconosciuto')
</success_criteria>

<output>
After completion, create `.planning/phases/66-device-categorization/66-03-SUMMARY.md`
</output>
