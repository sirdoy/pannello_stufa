---
phase: 09-schedule-management-ui
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - app/schedule/components/WeeklyTimeline.js
  - app/schedule/components/TimelineSlot.js
autonomous: true

must_haves:
  truths:
    - "User can see all 7 days of the week with temperature slots"
    - "Temperature is displayed with color gradient AND text label"
    - "Timeline scrolls horizontally on mobile without affecting page scroll"
  artifacts:
    - path: "app/schedule/components/WeeklyTimeline.js"
      provides: "Main timeline visualization component"
      exports: ["default"]
    - path: "app/schedule/components/TimelineSlot.js"
      provides: "Individual temperature slot with color and label"
      exports: ["default"]
  key_links:
    - from: "app/schedule/components/WeeklyTimeline.js"
      to: "lib/utils/scheduleHelpers.js"
      via: "import"
      pattern: "import.*parseTimelineSlots.*scheduleHelpers"
---

<objective>
Build the weekly timeline visualization component for displaying Netatmo thermostat schedules.

Purpose: Provide users with a visual overview of their heating schedule across all 7 days. The timeline uses color gradients to convey temperature at a glance while maintaining accessibility through text labels.

Output: WeeklyTimeline component that renders a horizontal-scrolling timeline with day rows and temperature slots.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-schedule-management-ui/09-CONTEXT.md
@.planning/phases/09-schedule-management-ui/09-RESEARCH.md

# Dependencies from Plan 01
@lib/utils/scheduleHelpers.js
@lib/hooks/useScheduleData.js

# UI patterns
@app/components/ui/Card.js
@app/components/ui/Text.js
@docs/design-system.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimelineSlot component</name>
  <files>app/schedule/components/TimelineSlot.js</files>
  <action>
Create the individual slot component for timeline visualization:

```javascript
'use client';
import { tempToColor } from '@/lib/utils/scheduleHelpers';

/**
 * TimelineSlot - Single temperature slot in timeline
 *
 * @param {number} temperature - Target temperature in °C
 * @param {string} startTime - Formatted start time (e.g., "08:00")
 * @param {string} endTime - Formatted end time
 * @param {number} widthPercent - Slot width as percentage of day (0-100)
 * @param {string} zoneName - Name of the temperature zone
 * @param {boolean} showTime - Show time labels (default: false, only on hover/focus)
 */
export default function TimelineSlot({
  temperature,
  startTime,
  endTime,
  widthPercent,
  zoneName,
  showTime = false,
}) {
  const bgColor = tempToColor(temperature);

  // Determine text color based on temperature (dark text for light backgrounds)
  // Hot temps (>20°C) use dark backgrounds, need white text
  // Cold temps (<18°C) use lighter backgrounds, need dark text
  const textColor = temperature >= 19 ? 'text-white' : 'text-slate-900';

  return (
    <div
      className={`
        h-12 flex items-center justify-center
        text-xs font-semibold
        ${textColor}
        transition-all duration-200
        hover:scale-y-110 hover:z-10
        group relative
        min-w-[40px]
      `}
      style={{
        width: `${widthPercent}%`,
        backgroundColor: bgColor,
      }}
      title={`${zoneName}: ${temperature}°C (${startTime}-${endTime})`}
    >
      {/* Always show temperature */}
      <span>{temperature}°</span>

      {/* Time tooltip on hover */}
      <div className="
        absolute -bottom-8 left-1/2 -translate-x-1/2
        bg-slate-900 text-white text-xs px-2 py-1 rounded
        opacity-0 group-hover:opacity-100
        transition-opacity pointer-events-none
        whitespace-nowrap z-20
        [html:not(.dark)_&]:bg-slate-800
      ">
        {startTime}-{endTime}
      </div>
    </div>
  );
}
```

Key requirements:
- Minimum 40px width for touch targets (WCAG)
- Temperature always visible as text (not just color)
- Hover reveals time range
- Dynamic text color for contrast against gradient
  </action>
  <verify>
Visual inspection: Create a test render with various temperatures (15, 18, 20, 23).
Verify text is readable against each background color.
  </verify>
  <done>TimelineSlot renders temperature with accessible color and text</done>
</task>

<task type="auto">
  <name>Task 2: Create WeeklyTimeline component</name>
  <files>app/schedule/components/WeeklyTimeline.js</files>
  <action>
Create the main timeline visualization:

```javascript
'use client';
import { useMemo } from 'react';
import { parseTimelineSlots, DAY_NAMES, formatTimeFromMinutes } from '@/lib/utils/scheduleHelpers';
import TimelineSlot from './TimelineSlot';
import { Text } from '@/app/components/ui';

/**
 * WeeklyTimeline - 7-day schedule visualization
 *
 * @param {Object} schedule - Schedule object with zones and timetable
 * @param {string} className - Additional CSS classes
 */
export default function WeeklyTimeline({ schedule, className = '' }) {
  // Parse schedule into day-grouped slots
  const slotsByDay = useMemo(() => {
    if (!schedule?.timetable || !schedule?.zones) {
      return Array(7).fill([]);
    }

    const allSlots = parseTimelineSlots(schedule);

    // Group by day (0-6)
    const grouped = Array(7).fill(null).map(() => []);
    allSlots.forEach(slot => {
      grouped[slot.day].push(slot);
    });

    return grouped;
  }, [schedule]);

  if (!schedule) {
    return (
      <div className="text-center py-8">
        <Text variant="secondary">Nessuna programmazione disponibile</Text>
      </div>
    );
  }

  return (
    <div className={`space-y-2 ${className}`}>
      {/* Time header (optional - shows hour markers) */}
      <div className="flex items-center">
        <div className="w-12 shrink-0" /> {/* Spacer for day labels */}
        <div className="flex-1 flex justify-between text-xs text-slate-500 px-1">
          <span>00:00</span>
          <span>06:00</span>
          <span>12:00</span>
          <span>18:00</span>
          <span>24:00</span>
        </div>
      </div>

      {/* Scrollable timeline container */}
      <div className="overflow-x-auto pb-4 -mx-4 px-4 scrollbar-thin scrollbar-thumb-slate-600">
        <div className="min-w-[600px]">
          {DAY_NAMES.map((dayName, dayIndex) => (
            <div key={dayName} className="flex items-center gap-2 mb-1">
              {/* Day label */}
              <Text
                variant="secondary"
                size="sm"
                weight="medium"
                className="w-12 shrink-0 text-right"
              >
                {dayName}
              </Text>

              {/* Day slots */}
              <div className="flex-1 flex rounded-lg overflow-hidden shadow-inner bg-slate-800/30">
                {slotsByDay[dayIndex].length > 0 ? (
                  slotsByDay[dayIndex].map((slot, slotIndex) => (
                    <TimelineSlot
                      key={`${dayIndex}-${slotIndex}`}
                      temperature={slot.temperature}
                      startTime={formatTimeFromMinutes(slot.startMinutes)}
                      endTime={formatTimeFromMinutes(slot.endMinutes)}
                      widthPercent={slot.durationPercent}
                      zoneName={slot.zoneName}
                    />
                  ))
                ) : (
                  <div className="flex-1 h-12 bg-slate-700/50 flex items-center justify-center">
                    <Text variant="tertiary" size="xs">Nessun dato</Text>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Scroll hint (mobile) */}
      <div className="md:hidden text-center">
        <Text variant="tertiary" size="xs">← Scorri per vedere l'intera giornata →</Text>
      </div>
    </div>
  );
}
```

Key behaviors:
- Horizontal scroll ONLY on timeline, not page
- min-width ensures timeline is always usable
- Day labels fixed while slots scroll
- Scroll hint for mobile users
- Empty state handled gracefully
  </action>
  <verify>
Create test page at app/debug/timeline-test/page.js (temporary):
- Render WeeklyTimeline with mock schedule data
- Verify horizontal scroll works on mobile viewport
- Verify all 7 days render
- Delete test page after verification
  </verify>
  <done>WeeklyTimeline renders 7-day view with scrollable timeline and temperature gradients</done>
</task>

</tasks>

<verification>
1. Visual test: Timeline renders all 7 days with Italian day names
2. Accessibility: Temperature text visible on all slot colors
3. Mobile: Horizontal scroll works, page doesn't scroll horizontally
4. Performance: No re-renders on scroll (memoized parsing)
</verification>

<success_criteria>
- WeeklyTimeline displays complete week from schedule data
- TimelineSlot shows temperature with readable text
- Color gradient follows accessible cyan-yellow-red pattern
- Horizontal scroll contained to timeline only
- Touch targets >= 40px (WCAG)
</success_criteria>

<output>
After completion, create `.planning/phases/09-schedule-management-ui/09-02-SUMMARY.md`
</output>
