---
phase: 10-monitoring-dashboard-&-alerts-ui
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - components/monitoring/ConnectionStatusCard.js
  - components/monitoring/DeadManSwitchPanel.js
  - __tests__/components/monitoring/StatusCards.test.js
autonomous: true

must_haves:
  truths:
    - "User can see stove connection status (online/offline/degraded) with uptime percentage"
    - "User can see dead man's switch status with stale detection"
    - "Status cards show loading state while fetching data"
  artifacts:
    - path: "components/monitoring/ConnectionStatusCard.js"
      provides: "Connection status display with uptime"
      min_lines: 50
    - path: "components/monitoring/DeadManSwitchPanel.js"
      provides: "Dead man's switch health panel"
      min_lines: 40
  key_links:
    - from: "components/monitoring/ConnectionStatusCard.js"
      to: "app/components/ui"
      via: "design system imports"
      pattern: "import.*Card.*Heading.*Text.*from.*components/ui"
    - from: "components/monitoring/DeadManSwitchPanel.js"
      to: "date-fns"
      via: "relative time formatting"
      pattern: "import.*formatDistanceToNow.*from.*date-fns"
---

<objective>
Create status card components for the monitoring dashboard header section.

Purpose: Display current stove connection status and cron health at a glance, above the fold.

Output: Two reusable card components that receive data via props (fetching handled by parent page).
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Design decisions (from 10-CONTEXT.md):
- Top section shows current stove connection status, dead man's switch status
- Color-coded badge system: green=online, yellow=degraded, red=offline
- Accompanied by metadata: last-seen timestamp, uptime percentage, current state
- Dead man's switch panel shows: missed runs count, next expected run, trend indicator
- Color + icon redundancy for accessibility (not color-only)

Reference patterns:
- app/components/ui (Card, Heading, Text, StatusBadge, Skeleton)
- docs/design-system.md - Ember Noir design system
</context>

<tasks>

<task type="auto">
  <name>Task 1: Connection Status Card Component</name>
  <files>components/monitoring/ConnectionStatusCard.js</files>
  <action>
Create client component showing stove connection health.

Props:
- `stats` - object from /api/health-monitoring/stats (or null while loading)

Display elements:
1. Card header with "Stove Connection" title and status badge
2. Uptime percentage (large, prominent): stats.successRate + "%"
3. Grid with check counts: successfulChecks, failedChecks
4. Warning text if mismatchCount > 0

Status badge logic:
- successRate >= 95: status="online", variant="success"
- successRate >= 80: status="degraded", variant="warning"
- else: status="offline", variant="danger"

Loading state:
- Show "Loading..." text when stats is null
- Consider Skeleton placeholders for better UX

Accessibility:
- Use both color AND icon (checkmark for good, warning for issues)
- Text labels accompany all status indicators

Use design system: Card (liquid), Heading (level=3, variant="subtle"), Text, StatusBadge
  </action>
  <verify>Component renders without errors, shows loading state when stats null</verify>
  <done>ConnectionStatusCard displays uptime, check counts, and status badge</done>
</task>

<task type="auto">
  <name>Task 2: Dead Man's Switch Panel Component</name>
  <files>components/monitoring/DeadManSwitchPanel.js</files>
  <action>
Create client component showing cron health status.

Props:
- `status` - object from /api/health-monitoring/dead-man-switch (or null while loading)

Display elements based on status.stale:

**Healthy (stale=false):**
1. Card header with "Cron Health" title and green "healthy" badge
2. Check icon + "Sistema attivo" (Italian)
3. Last check time: formatDistanceToNow(status.lastCheck, { addSuffix: true })

**Stale - never_run (stale=true, reason='never_run'):**
1. Card header with red "stale" badge (pulse animation)
2. Warning icon + "Cron mai eseguito"
3. Explanation text

**Stale - timeout (stale=true, reason='timeout'):**
1. Card header with red "stale" badge (pulse animation)
2. Warning icon + "Cron non risponde"
3. Elapsed time: Math.floor(status.elapsed / 60000) minutes
4. Last seen: formatDistanceToNow(status.lastCheck, { addSuffix: true })

**Stale - error:**
1. Card header with red badge
2. Error icon + error message

Loading state:
- Show "Loading..." when status is null

Use lucide-react icons: CheckCircle, AlertTriangle, XCircle
Use date-fns: formatDistanceToNow
  </action>
  <verify>Component handles all status cases, uses correct icons and colors</verify>
  <done>DeadManSwitchPanel displays cron health with appropriate status styling</done>
</task>

<task type="auto">
  <name>Task 3: Unit Tests for Status Cards</name>
  <files>__tests__/components/monitoring/StatusCards.test.js</files>
  <action>
Create unit tests for both status card components.

Test ConnectionStatusCard:
- Renders loading state when stats is null
- Displays uptime percentage from stats.successRate
- Shows "online" badge when successRate >= 95
- Shows "degraded" badge when successRate >= 80 but < 95
- Shows "offline" badge when successRate < 80
- Displays warning text when mismatchCount > 0

Test DeadManSwitchPanel:
- Renders loading state when status is null
- Shows "healthy" badge when stale is false
- Shows "stale" badge when stale is true
- Displays correct message for 'never_run' reason
- Displays elapsed time for 'timeout' reason

Use @testing-library/react for rendering
Mock date-fns if needed for consistent timestamps
  </action>
  <verify>npm test -- --testPathPattern="StatusCards" passes</verify>
  <done>Status card components have test coverage for all states</done>
</task>

</tasks>

<verification>
1. Components exist in components/monitoring/
2. Components use 'use client' directive
3. Components import from design system (Card, Heading, Text)
4. Components handle null/loading state
5. npm test passes for StatusCards tests
</verification>

<success_criteria>
- ConnectionStatusCard displays uptime, check counts, status badge
- DeadManSwitchPanel displays cron health with all status variations
- Both components handle loading states gracefully
- Color + icon redundancy for accessibility
- Unit tests cover all status cases
</success_criteria>

<output>
After completion, create `.planning/phases/10-monitoring-dashboard-&-alerts-ui/10-02-SUMMARY.md`
</output>
