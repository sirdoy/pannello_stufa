---
phase: 10-monitoring-dashboard-&-alerts-ui
plan: 04
type: execute
wave: 3
depends_on: ["10-02", "10-03"]
files_modified:
  - app/monitoring/page.js
  - app/components/Navigation.js
  - __tests__/app/monitoring/page.test.js
autonomous: false

must_haves:
  truths:
    - "User can access /monitoring page from navigation"
    - "Dashboard displays status cards and event timeline"
    - "Dead man's switch status refreshes every 30 seconds"
  artifacts:
    - path: "app/monitoring/page.js"
      provides: "Monitoring dashboard page"
      min_lines: 60
  key_links:
    - from: "app/monitoring/page.js"
      to: "components/monitoring"
      via: "component imports"
      pattern: "import.*(ConnectionStatusCard|DeadManSwitchPanel|MonitoringTimeline).*from"
    - from: "app/monitoring/page.js"
      to: "/api/health-monitoring"
      via: "API fetch calls"
      pattern: "fetch.*api/health-monitoring"
---

<objective>
Create the monitoring dashboard page and integrate with navigation.

Purpose: Provide unified view of stove health monitoring status accessible from main navigation.

Output: /monitoring page with status cards, event timeline, and navigation link.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Design decisions (from 10-CONTEXT.md):
- New dedicated /monitoring page (separate from /thermostat)
- Single-column timeline view
- Top section (above fold): connection status, dead man's switch, latest event
- Quick action buttons: manual health check, settings (defer to discretion)

Reference patterns:
- app/thermostat/page.js - page layout pattern
- app/schedule/page.js - back navigation pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Monitoring Dashboard Page</name>
  <files>app/monitoring/page.js</files>
  <action>
Create client component for /monitoring route.

State:
- stats: object from /api/health-monitoring/stats (null initially)
- dmsStatus: object from /api/health-monitoring/dead-man-switch (null initially)

Data fetching:
1. useEffect to fetch stats on mount:
   - fetch('/api/health-monitoring/stats?days=7')
   - setStats(data)

2. useEffect to fetch DMS status with interval:
   - Initial fetch
   - setInterval(fetchDMS, 30000) // Every 30 seconds
   - Cleanup: clearInterval

Layout structure:
```
<div className="space-y-6 p-4">
  {/* Header with back button */}
  <div className="flex items-center gap-4">
    <BackButton href="/" />
    <Heading level={1} variant="ember">Health Monitoring</Heading>
  </div>

  {/* Status cards grid (2 columns on md+) */}
  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
    <ConnectionStatusCard stats={stats} />
    <DeadManSwitchPanel status={dmsStatus} />
  </div>

  {/* Event timeline (full width) */}
  <section>
    <Heading level={2} variant="subtle" className="mb-4">
      Cronologia Eventi (7 giorni)
    </Heading>
    <MonitoringTimeline />
  </section>
</div>
```

Use 'use client' directive.
Import components from components/monitoring/
Import BackButton from app/components/ui
  </action>
  <verify>Page renders without errors, shows status cards and timeline</verify>
  <done>Monitoring dashboard page displays complete monitoring UI</done>
</task>

<task type="auto">
  <name>Task 2: Navigation Integration</name>
  <files>app/components/Navigation.js</files>
  <action>
Add monitoring link to existing navigation component.

Locate the navigation links array/section.

Add new link:
- href: "/monitoring"
- label: "Monitoring" or "Health"
- icon: Activity from lucide-react (or Heart for health metaphor)

Position: After existing main links, before settings/debug links.

Keep consistent with existing link styling.

If Navigation.js doesn't exist or uses different pattern:
- Check app/layout.js for navigation structure
- Check components/ for navigation component
- Add link in appropriate location following existing patterns
  </action>
  <verify>Navigation shows monitoring link, clicking navigates to /monitoring</verify>
  <done>Navigation includes link to monitoring dashboard</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete monitoring dashboard with status cards, event timeline, and navigation</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000
3. Click "Monitoring" or "Health" link in navigation
4. Verify /monitoring page loads
5. Check status cards show (may show loading/empty if no data)
6. Check event timeline section exists
7. Wait 30 seconds, verify DMS status refreshes (check network tab)
8. Test filters in event timeline (if events exist)
9. Test infinite scroll (if many events)
10. Test back button returns to home

Visual checklist:
- [ ] Page accessible from navigation
- [ ] Status cards display properly (green/yellow/red states)
- [ ] Dead man's switch shows health or warning
- [ ] Event timeline shows events or empty state
- [ ] Filters work (clear button appears when filtered)
- [ ] Mobile layout is single column
- [ ] Desktop layout shows 2-column status cards
  </how-to-verify>
  <resume-signal>Type "approved" if dashboard looks correct, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. app/monitoring/page.js exists with 'use client' directive
2. Page imports all monitoring components
3. DMS status fetches with 30-second interval
4. Navigation includes monitoring link
5. Page is accessible at /monitoring
</verification>

<success_criteria>
- User can navigate to /monitoring from main navigation
- Dashboard shows connection status card with uptime
- Dashboard shows dead man's switch panel with health status
- Dashboard shows event timeline with filters
- DMS status refreshes every 30 seconds
- Layout is responsive (mobile + desktop)
</success_criteria>

<output>
After completion, create `.planning/phases/10-monitoring-dashboard-&-alerts-ui/10-04-SUMMARY.md`
</output>
