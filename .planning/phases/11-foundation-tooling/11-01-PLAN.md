---
phase: 11-foundation-tooling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/utils/cn.js
  - package.json
autonomous: true

must_haves:
  truths:
    - "cn() function combines clsx + tailwind-merge for class merging"
    - "CVA library is installed and importable"
    - "Components can use cn() to merge classes without conflicts"
  artifacts:
    - path: "lib/utils/cn.js"
      provides: "cn() helper function"
      exports: ["cn"]
    - path: "package.json"
      contains: "class-variance-authority"
  key_links:
    - from: "lib/utils/cn.js"
      to: "clsx, tailwind-merge"
      via: "import"
      pattern: "import.*clsx|twMerge"
---

<objective>
Install CVA and create cn() utility function for type-safe class merging

Purpose: Establish the foundational utilities needed for CVA-based component variants. The cn() helper (clsx + tailwind-merge) is a prerequisite for all CVA components, and CVA itself enables type-safe variant APIs.

Output: Working cn() function in lib/utils/cn.js, CVA + clsx + tailwind-merge installed in package.json
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-foundation-tooling/11-RESEARCH.md

Reference files:
- package.json (current dependencies)
- lib/ directory structure (where utils go)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install CVA, clsx, and tailwind-merge</name>
  <files>package.json</files>
  <action>
Install the three packages needed for the cn() utility and CVA variants:

```bash
npm install class-variance-authority clsx tailwind-merge
```

Versions to install (from research):
- class-variance-authority: ^0.7.1
- clsx: ^2.1.0
- tailwind-merge: ^2.5.0

These go in `dependencies` (not devDependencies) because they're runtime utilities used in components.

Verify installation by checking package.json and node_modules.
  </action>
  <verify>
- `npm ls class-variance-authority` shows version ^0.7.1
- `npm ls clsx` shows version ^2.1.0
- `npm ls tailwind-merge` shows version ^2.5.0
- All three appear in package.json dependencies
  </verify>
  <done>
Three packages installed successfully in dependencies section of package.json
  </done>
</task>

<task type="auto">
  <name>Task 2: Create cn() helper function</name>
  <files>lib/utils/cn.js</files>
  <action>
Create `lib/utils/cn.js` with the shadcn-style cn() function:

```javascript
// lib/utils/cn.js
/**
 * Utility for merging class names with Tailwind conflict resolution.
 * Combines clsx for conditional classes and tailwind-merge for deduplication.
 *
 * @param  {...any} inputs - Class values (strings, objects, arrays, undefined)
 * @returns {string} Merged class string with conflicts resolved
 *
 * @example
 * // Conditional classes
 * cn("px-4 py-2", isActive && "bg-ember-500", className)
 *
 * // Object syntax
 * cn("text-sm", { "font-bold": isBold }, ["flex", "items-center"])
 *
 * // Tailwind conflict resolution (later wins)
 * cn("px-4 px-6") // => "px-6"
 * cn("bg-red-500 bg-blue-500") // => "bg-blue-500"
 */
import { clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs) {
  return twMerge(clsx(inputs));
}
```

Create the directory `lib/utils/` if it doesn't exist.

Key points:
1. Named export `cn` (not default) for better tree-shaking
2. JSDoc documentation with examples
3. Simple composition: clsx for conditional logic, twMerge for conflict resolution
  </action>
  <verify>
- File exists at lib/utils/cn.js
- Exports cn function
- Can be imported: `import { cn } from '@/lib/utils/cn'` or `import { cn } from '../../lib/utils/cn'`
  </verify>
  <done>
cn() helper function created with clsx + tailwind-merge composition, JSDoc documentation, and proper export
  </done>
</task>

<task type="auto">
  <name>Task 3: Add unit test for cn() function</name>
  <files>lib/utils/__tests__/cn.test.js</files>
  <action>
Create `lib/utils/__tests__/cn.test.js` to verify cn() behavior:

```javascript
// lib/utils/__tests__/cn.test.js
import { cn } from '../cn';

describe('cn() utility', () => {
  describe('basic functionality', () => {
    it('merges string classes', () => {
      expect(cn('px-4', 'py-2')).toBe('px-4 py-2');
    });

    it('handles undefined and null', () => {
      expect(cn('px-4', undefined, null, 'py-2')).toBe('px-4 py-2');
    });

    it('handles empty strings', () => {
      expect(cn('px-4', '', 'py-2')).toBe('px-4 py-2');
    });
  });

  describe('conditional classes (clsx)', () => {
    it('includes truthy conditional classes', () => {
      expect(cn('base', true && 'active')).toBe('base active');
    });

    it('excludes falsy conditional classes', () => {
      expect(cn('base', false && 'hidden')).toBe('base');
    });

    it('handles object syntax', () => {
      expect(cn('base', { active: true, disabled: false })).toBe('base active');
    });

    it('handles array syntax', () => {
      expect(cn('base', ['flex', 'items-center'])).toBe('base flex items-center');
    });
  });

  describe('Tailwind conflict resolution (tailwind-merge)', () => {
    it('resolves padding conflicts (later wins)', () => {
      expect(cn('px-4', 'px-6')).toBe('px-6');
    });

    it('resolves background color conflicts', () => {
      expect(cn('bg-red-500', 'bg-blue-500')).toBe('bg-blue-500');
    });

    it('resolves text color conflicts', () => {
      expect(cn('text-slate-200', 'text-white')).toBe('text-white');
    });

    it('keeps non-conflicting classes', () => {
      expect(cn('px-4 py-2', 'px-6')).toBe('py-2 px-6');
    });

    it('resolves complex variant conflicts', () => {
      // Base class + override from className prop (common CVA pattern)
      expect(cn('px-4 py-2 bg-ember-500', 'bg-slate-900')).toBe('px-4 py-2 bg-slate-900');
    });
  });

  describe('real-world usage patterns', () => {
    it('handles CVA + className pattern', () => {
      const cvaOutput = 'font-semibold px-4 py-2 bg-ember-500 text-white';
      const className = 'mt-4 bg-slate-900';
      expect(cn(cvaOutput, className)).toBe('font-semibold px-4 py-2 text-white mt-4 bg-slate-900');
    });

    it('handles conditional with className override', () => {
      const isActive = true;
      const className = 'text-lg';
      expect(cn(
        'text-sm',
        isActive && 'font-bold',
        className
      )).toBe('font-bold text-lg');
    });
  });
});
```

Run test to verify: `npm test -- lib/utils/__tests__/cn.test.js`
  </action>
  <verify>
- Test file exists at lib/utils/__tests__/cn.test.js
- All tests pass: `npm test -- lib/utils/__tests__/cn.test.js`
  </verify>
  <done>
Unit tests for cn() function pass, covering basic merging, conditional classes, and Tailwind conflict resolution
  </done>
</task>

</tasks>

<verification>
1. Package installation: `npm ls class-variance-authority clsx tailwind-merge`
2. cn() function: `node -e "const {cn} = require('./lib/utils/cn'); console.log(cn('px-4', 'px-6'));"`
3. Unit tests: `npm test -- lib/utils/__tests__/cn.test.js`
</verification>

<success_criteria>
- class-variance-authority, clsx, tailwind-merge installed in package.json dependencies
- lib/utils/cn.js exports cn() function
- cn() correctly merges classes and resolves Tailwind conflicts
- All unit tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-foundation-tooling/11-01-SUMMARY.md`
</output>
