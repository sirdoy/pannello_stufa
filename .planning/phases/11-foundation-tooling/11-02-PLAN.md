---
phase: 11-foundation-tooling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - jest.setup.js
autonomous: true

must_haves:
  truths:
    - "Radix UI primitives are installed and importable"
    - "jest-axe matchers are available in test environment"
    - "Component tests can use toHaveNoViolations() assertion"
  artifacts:
    - path: "package.json"
      contains: "radix-ui"
    - path: "package.json"
      contains: "jest-axe"
    - path: "jest.setup.js"
      contains: "toHaveNoViolations"
  key_links:
    - from: "jest.setup.js"
      to: "jest-axe"
      via: "expect.extend"
      pattern: "expect\\.extend\\(toHaveNoViolations\\)"
---

<objective>
Install Radix UI primitives and set up jest-axe for accessibility testing

Purpose: Radix UI provides accessible, unstyled primitives for complex interactive patterns (Dialog, Dropdown, Select, etc.). jest-axe enables automated accessibility testing in the existing Jest setup. Together, these form the accessibility foundation for v3.0.

Output: Radix UI primitives installed, jest-axe configured in jest.setup.js with toHaveNoViolations matcher
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-foundation-tooling/11-RESEARCH.md

Reference files:
- package.json (current dependencies, Jest 30.2.0)
- jest.setup.js (existing test setup with React 19 polyfills)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Radix UI primitives</name>
  <files>package.json</files>
  <action>
Install Radix UI as a single package (radix-ui provides all primitives):

```bash
npm install radix-ui
```

This installs all Radix primitives in one package. Individual components are imported as:
```javascript
import { Dialog, Dropdown, Select, Tooltip, Slider, Checkbox, Switch } from "radix-ui";
```

Version to install: ^1.4.3 (latest as of research)

Note: Radix UI goes in `dependencies` because it's runtime code used in components.
  </action>
  <verify>
- `npm ls radix-ui` shows version ^1.4.x
- Package appears in package.json dependencies
- Can import: `import { Dialog } from "radix-ui"` (test with node or in-editor)
  </verify>
  <done>
radix-ui package installed in dependencies section of package.json
  </done>
</task>

<task type="auto">
  <name>Task 2: Install jest-axe for accessibility testing</name>
  <files>package.json</files>
  <action>
Install jest-axe as a dev dependency:

```bash
npm install --save-dev jest-axe
```

Version to install: ^10.0.0 (latest, compatible with Jest 30.x)

Note: jest-axe is a devDependency because it's only used in tests.
  </action>
  <verify>
- `npm ls jest-axe` shows version ^10.0.x
- Package appears in package.json devDependencies
  </verify>
  <done>
jest-axe package installed in devDependencies section of package.json
  </done>
</task>

<task type="auto">
  <name>Task 3: Configure jest-axe in jest.setup.js</name>
  <files>jest.setup.js</files>
  <action>
Add jest-axe configuration to the existing jest.setup.js file. Add AFTER the existing setup code (after all the mocks):

```javascript
// ===== ACCESSIBILITY TESTING (jest-axe) =====
// Import and extend jest-axe matchers for a11y assertions
const { toHaveNoViolations, configureAxe } = require('jest-axe');
expect.extend(toHaveNoViolations);

// Configure axe for better test stability in JSDOM
// Note: Color contrast checks are disabled because JSDOM doesn't compute styles accurately
const configuredAxe = configureAxe({
  rules: {
    // Disable rules that have known issues in JSDOM
    'color-contrast': { enabled: false },
  },
});

// Export configured axe for test files that need custom configuration
global.axe = configuredAxe;

// Helper for jest-axe with fake timers (axe-core uses setTimeout internally)
// Usage: await runAxeWithRealTimers(container)
global.runAxeWithRealTimers = async (container) => {
  // If fake timers are active, temporarily switch to real timers
  const isUsingFakeTimers = typeof jest !== 'undefined' && jest.isFakeTimers && jest.isFakeTimers();

  if (isUsingFakeTimers) {
    jest.useRealTimers();
  }

  const { axe } = require('jest-axe');
  const results = await axe(container);

  if (isUsingFakeTimers) {
    jest.useFakeTimers();
  }

  return results;
};
```

Key points:
1. extend expect with toHaveNoViolations matcher
2. Configure axe to disable color-contrast (unreliable in JSDOM)
3. Export configuredAxe as global.axe for custom test configurations
4. Add runAxeWithRealTimers helper for tests using fake timers (common in this codebase)
  </action>
  <verify>
- jest.setup.js contains jest-axe import
- jest.setup.js contains expect.extend(toHaveNoViolations)
- jest.setup.js contains configuredAxe with color-contrast disabled
- jest.setup.js contains global.runAxeWithRealTimers helper
  </verify>
  <done>
jest-axe configured in jest.setup.js with toHaveNoViolations matcher, axe configuration for JSDOM, and fake timers helper
  </done>
</task>

<task type="auto">
  <name>Task 4: Create sample accessibility test</name>
  <files>app/components/ui/__tests__/accessibility.test.js</files>
  <action>
Create a sample accessibility test file that demonstrates jest-axe usage with existing components:

```javascript
// app/components/ui/__tests__/accessibility.test.js
/**
 * Accessibility Test Suite
 *
 * This file demonstrates jest-axe usage patterns for the design system.
 * Each component should add its own a11y tests following these patterns.
 *
 * Note: jest-axe catches ~30% of a11y issues automatically.
 * Color contrast and some ARIA patterns require manual testing or Lighthouse.
 */
import { render } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';

// Import existing components to test
import Button from '../Button';

expect.extend(toHaveNoViolations);

describe('Accessibility Tests', () => {
  describe('Button', () => {
    it('should have no accessibility violations in default state', async () => {
      const { container } = render(<Button>Click me</Button>);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should have no violations when disabled', async () => {
      const { container } = render(<Button disabled>Disabled</Button>);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should have no violations when loading', async () => {
      const { container } = render(<Button loading>Loading</Button>);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should have no violations for ember variant', async () => {
      const { container } = render(<Button variant="ember">Primary</Button>);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should have no violations for subtle variant', async () => {
      const { container } = render(<Button variant="subtle">Secondary</Button>);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    it('should have no violations for danger variant', async () => {
      const { container } = render(<Button variant="danger">Delete</Button>);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });
  });

  describe('IconButton (from Button)', () => {
    it('should require aria-label for icon-only buttons', async () => {
      // IconButton should have aria-label for accessibility
      const { IconButton } = await import('../Button');
      const { container } = render(<IconButton icon="X" label="Close" />);
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });
  });

  // Template for new component a11y tests:
  // describe('ComponentName', () => {
  //   it('should have no accessibility violations', async () => {
  //     const { container } = render(<ComponentName>Content</ComponentName>);
  //     const results = await axe(container);
  //     expect(results).toHaveNoViolations();
  //   });
  // });
});
```

Run test to verify jest-axe is working: `npm test -- app/components/ui/__tests__/accessibility.test.js`
  </action>
  <verify>
- Test file exists at app/components/ui/__tests__/accessibility.test.js
- All tests pass: `npm test -- app/components/ui/__tests__/accessibility.test.js`
- Tests use jest-axe's toHaveNoViolations matcher
  </verify>
  <done>
Sample accessibility test file created demonstrating jest-axe patterns, all tests pass for existing Button component
  </done>
</task>

</tasks>

<verification>
1. Package installation: `npm ls radix-ui jest-axe`
2. Radix import test: `node -e "require('radix-ui')"` (should not error)
3. Accessibility tests: `npm test -- app/components/ui/__tests__/accessibility.test.js`
</verification>

<success_criteria>
- radix-ui installed in package.json dependencies
- jest-axe installed in package.json devDependencies
- jest.setup.js has toHaveNoViolations matcher extended
- Sample accessibility test passes for Button component
- jest-axe ready for use in component tests
</success_criteria>

<output>
After completion, create `.planning/phases/11-foundation-tooling/11-02-SUMMARY.md`
</output>
