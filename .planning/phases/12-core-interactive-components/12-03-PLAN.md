---
phase: 12-core-interactive-components
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Input.js
  - app/components/ui/Slider.js
  - app/components/ui/__tests__/Input.test.js
  - app/components/ui/__tests__/Slider.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User can type in Input and see validation feedback in real-time"
    - "User can clear Input with clear button when clearable prop is set"
    - "User can see character count when showCount prop is set"
    - "User can adjust Slider value with Arrow keys"
    - "User can drag Slider thumb with mouse/touch"
    - "User sees tooltip with current value while dragging Slider"
    - "Focus ring shows ember glow on both components"
  artifacts:
    - path: "app/components/ui/Input.js"
      provides: "Enhanced Input with error states, clearable, showCount"
      contains: "aria-invalid"
    - path: "app/components/ui/Slider.js"
      provides: "Radix-based Slider with range support"
      contains: "@radix-ui/react-slider"
    - path: "app/components/ui/__tests__/Input.test.js"
      provides: "Input a11y tests"
      contains: "toHaveNoViolations"
    - path: "app/components/ui/__tests__/Slider.test.js"
      provides: "Slider a11y tests"
      contains: "toHaveNoViolations"
  key_links:
    - from: "Input.js"
      to: "@radix-ui/react-label"
      via: "Radix Label for proper label association"
    - from: "Slider.js"
      to: "@radix-ui/react-slider"
      via: "Radix Slider.Root + Slider.Track + Slider.Range + Slider.Thumb"
    - from: "both components"
      to: "cn() utility"
      via: "import { cn } from '@/lib/utils/cn'"
---

<objective>
Build enhanced Input component with validation and create accessible Slider component using Radix UI.

Purpose: Input needs error states and optional features (clear button, character count) per CONTEXT decisions. Slider enables temperature/brightness controls with range support.

Output: Two production-ready input controls (Input, Slider) with a11y tests.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-core-interactive-components/12-CONTEXT.md
@.planning/phases/12-core-interactive-components/12-RESEARCH.md
@app/components/ui/Input.js
@lib/utils/cn.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Input with Error States and Optional Features</name>
  <files>
    - app/components/ui/Input.js
    - app/components/ui/__tests__/Input.test.js
    - app/components/ui/index.js
  </files>
  <action>
Enhance existing Input with validation, error states, and optional features:

1. **Component structure** (Input.js):
   - Import `@radix-ui/react-label` (already installed) for proper label association
   - Create `inputVariants` with CVA for variant (default/error/success)
   - Use `forwardRef` pattern
   - Use `useId()` hook for unique id generation (label-input association)
   - Support controlled and uncontrolled modes

2. **New props to add**:
   - `error` (string): Error message to display, triggers error variant
   - `clearable` (boolean): Show clear button when input has value (opt-in per CONTEXT)
   - `showCount` (boolean): Show character count (opt-in per CONTEXT, separate from maxLength)
   - `validate` (function): Optional real-time validation function `(value) => errorString | null`

3. **Styling (Ember Noir with CVA)**:
   - Base variant: `border-slate-700/50 [html:not(.dark)_&]:border-slate-300/60`
   - Error variant: `border-danger-500 focus-visible:ring-danger-500/50`
   - Success variant: `border-sage-500 focus-visible:ring-sage-500/50`
   - Focus: `focus-visible:ring-2 focus-visible:ring-ember-500/50 focus-visible:border-ember-500/60`
   - Light mode: `[html:not(.dark)_&]:bg-white/80 [html:not(.dark)_&]:text-slate-900`
   - Disabled: `disabled:opacity-50 disabled:cursor-not-allowed`
   - Transition: `transition-all duration-200`

4. **Error display**:
   - Red border when `error` prop present
   - Error icon (AlertCircle from lucide-react) inline with error message
   - Error message below input with `aria-describedby` linking
   - `aria-invalid={!!error}` on input element

5. **Clear button** (when `clearable={true}`):
   - X icon from lucide-react
   - Positioned absolute right inside input
   - Only visible when input has value
   - `aria-label="Clear input"` for accessibility
   - Adds `pr-10` padding to input when clearable

6. **Character count** (when `showCount={true}`):
   - Display `{current}/{maxLength}` below input (right-aligned)
   - Only shows if `maxLength` prop is also set
   - Muted text color (`text-slate-500`)

7. **Real-time validation** (when `validate` prop provided):
   - Call validate function on every change (per CONTEXT decision)
   - Set local error state from validation result
   - External `error` prop takes precedence over local validation error

8. **API compatibility**:
   - Maintain all existing props: `type`, `label`, `icon`, `variant`, `className`, `containerClassName`
   - Maintain spread of remaining props to input element

9. **Tests** (Input.test.js):
   - Test default state has no a11y violations
   - Test with label has proper association (aria-labelledby or htmlFor)
   - Test with error has `aria-invalid="true"` and `aria-describedby`
   - Test clearable shows X button when has value
   - Test clearable X button clears value
   - Test showCount displays character count
   - Test disabled state

Do NOT use arbitrary values. Use cn() for class merging.
  </action>
  <verify>
npm test -- --testPathPattern="Input" --passWithNoTests
  </verify>
  <done>
Input shows error state with red border and error message, clear button appears when clearable and has value, character count shows when showCount is set, aria-invalid and aria-describedby properly set, passes jest-axe.
  </done>
</task>

<task type="auto">
  <name>Task 2: Slider with Radix Primitive</name>
  <files>
    - app/components/ui/Slider.js
    - app/components/ui/__tests__/Slider.test.js
    - app/components/ui/index.js
  </files>
  <action>
Create Slider component using Radix primitive:

1. **Component structure** (Slider.js):
   - Import `@radix-ui/react-slider` (already installed)
   - Create `sliderVariants` with CVA for variant (ember/ocean/sage)
   - Use `forwardRef` pattern
   - Compose Slider.Root, Slider.Track, Slider.Range, Slider.Thumb

2. **Props**:
   - `value` (number[]): Controlled value - MUST be array per Radix API
   - `defaultValue` (number[]): Uncontrolled default value
   - `onValueChange` (function): Called with number[] on change
   - `min` (number): Minimum value, default 0
   - `max` (number): Maximum value, default 100
   - `step` (number): Step increment, default 1 (per CONTEXT)
   - `range` (boolean): Enable dual-handle min/max selection (per CONTEXT)
   - `showTooltip` (boolean): Show value tooltip on thumb while dragging (per CONTEXT)
   - `disabled` (boolean): Disabled state
   - `variant` (string): Color variant (ember/ocean/sage)
   - `aria-label` or `aria-labelledby`: Required for accessibility

3. **Helper for simple API**:
   - Accept `value` as single number and convert to `[value]` internally
   - `onChange` wrapper: unwrap array for single-thumb mode `onChange(values[0])`
   - Range mode: keep array behavior

4. **Styling (Ember Noir)**:
   - Track: `h-2 w-full rounded-full bg-slate-700 [html:not(.dark)_&]:bg-slate-200`
   - Range fill (ember): `bg-gradient-to-r from-ember-500 to-flame-500`
   - Range fill (ocean): `bg-gradient-to-r from-ocean-500 to-ocean-600`
   - Range fill (sage): `bg-gradient-to-r from-sage-500 to-sage-600`
   - Thumb: `h-5 w-5 rounded-full border-2 border-ember-500 bg-white shadow-lg`
   - Thumb focus: `focus-visible:ring-2 focus-visible:ring-ember-500/50`
   - Thumb hover: `hover:scale-110`
   - Thumb active: `active:scale-95`
   - Disabled: `disabled:opacity-50 disabled:cursor-not-allowed`
   - Touch target: Thumb h-5 w-5 plus focus ring satisfies 44px

5. **Tooltip behavior** (when `showTooltip={true}`):
   - Track dragging state with `onPointerDown`/`onPointerUp`
   - Show tooltip only while dragging
   - Tooltip position: absolute above thumb (`-top-8`)
   - Tooltip content: current value
   - Tooltip styling: `bg-slate-800 px-2 py-1 rounded text-xs text-white`

6. **Range mode** (when `range={true}`):
   - Render two Thumb components
   - Initial value: `[min, max]` or `defaultValue`
   - Each thumb independently draggable
   - Range between thumbs highlighted

7. **Use cases** (per CONTEXT):
   - Temperature: `min={18} max={25} step={0.5}`
   - Brightness: `min={0} max={100} step={1}`

8. **Index update** (index.js):
   - Add `export { default as Slider } from './Slider';`

9. **Tests** (Slider.test.js):
   - Test default state has no a11y violations
   - Test with aria-label has no a11y violations
   - Test Arrow key increases/decreases value
   - Test disabled state cannot be interacted with
   - Test range mode renders two thumbs
   - Test tooltip shows on pointer down (if testable in JSDOM)

IMPORTANT: Radix Slider expects array values `value={[50]}` not `value={50}`. Handle this internally.

Do NOT use arbitrary values. Use cn() for class merging.
  </action>
  <verify>
npm test -- --testPathPattern="Slider" --passWithNoTests
  </verify>
  <done>
Slider renders with track and thumb, adjusts with Arrow keys, shows tooltip while dragging (if showTooltip), supports range mode with two thumbs, passes jest-axe.
  </done>
</task>

</tasks>

<verification>
```bash
# All tests pass
npm test -- --testPathPattern="(Input|Slider)" --passWithNoTests
```
</verification>

<success_criteria>
1. Input shows error state with red border and error message
2. Input clears value when clear button clicked (clearable mode)
3. Input shows character count when showCount is set
4. Input validates in real-time when validate function provided
5. Input has proper aria-invalid and aria-describedby for errors
6. Slider adjusts value with Arrow Left/Right/Up/Down keys
7. Slider shows tooltip with current value while dragging
8. Slider supports range mode with two thumbs
9. Both components show ember glow focus ring
10. Both components pass jest-axe accessibility tests
11. All styling uses design tokens (no arbitrary values)
</success_criteria>

<output>
After completion, create `.planning/phases/12-core-interactive-components/12-03-SUMMARY.md`
</output>
