---
phase: 13-foundation-refactoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Button.js
  - app/components/ui/__tests__/Button.test.js
autonomous: true

must_haves:
  truths:
    - "Button renders with CVA variants (ember, subtle, ghost, success, danger, outline)"
    - "Button supports size variants (sm, md, lg) with correct touch targets"
    - "Button supports iconOnly with compound variants for size-dependent padding"
    - "Button.Icon and Button.Group available via namespace pattern"
    - "All Button variants pass jest-axe accessibility tests"
    - "Legacy props (liquid, primary, secondary) removed - no backwards compatibility"
  artifacts:
    - path: "app/components/ui/Button.js"
      provides: "CVA Button with namespace pattern"
      exports: ["default", "Button", "buttonVariants"]
    - path: "app/components/ui/__tests__/Button.test.js"
      provides: "Comprehensive CVA + a11y tests"
      contains: "toHaveNoViolations"
  key_links:
    - from: "Button.js"
      to: "@/lib/utils/cn"
      via: "cn() import"
      pattern: "import.*cn.*from.*@/lib/utils/cn"
    - from: "Button.js"
      to: "class-variance-authority"
      via: "cva import"
      pattern: "import.*cva.*from.*class-variance-authority"
---

<objective>
Refactor Button component to use CVA pattern with namespace compound components.

Purpose: Establish consistent, type-safe Button API matching Phase 12 patterns.
Output: CVA-powered Button with Button.Icon and Button.Group sub-components.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-foundation-refactoring/13-CONTEXT.md
@.planning/phases/13-foundation-refactoring/13-RESEARCH.md

# Reference Phase 12 CVA pattern
@app/components/ui/Checkbox.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor Button with CVA variants</name>
  <files>app/components/ui/Button.js</files>
  <action>
Rewrite Button.js using CVA pattern established in Phase 12. Key changes:

1. Add 'use client' directive and forwardRef wrapper
2. Import CVA from 'class-variance-authority' and cn from '@/lib/utils/cn'
3. Create buttonVariants with cva():
   - Base classes: font-display, rounded-xl, transition-all, flex items-center justify-center, focus-visible:ring-2 focus-visible:ring-ember-500/50, disabled:opacity-50
   - variants.variant: ember (gradient), subtle (glass), ghost (transparent), success (sage), danger (red), outline (border)
   - variants.size: sm (min-h-[44px]), md (min-h-[48px]), lg (min-h-[56px])
   - variants.fullWidth: true -> w-full
   - variants.iconOnly: true -> rounded-full
   - compoundVariants: size + iconOnly interactions for padding (e.g., sm + iconOnly -> p-2.5 min-w-[44px])
   - defaultVariants: variant='ember', size='md'

4. REMOVE legacy prop handling (no mapping for 'primary', 'secondary', 'liquid')
5. Keep loading spinner overlay with invisible content pattern
6. Preserve icon + iconPosition logic

7. Create namespace sub-components:
   - Button.Icon: Wrapper for iconOnly buttons with aria-label requirement
   - Button.Group: Flex container with gap-2 and role="group"

8. Export both named exports AND namespace pattern:
   ```js
   export { Button, buttonVariants };
   export default Button;
   ```
  </action>
  <verify>File exists with CVA imports, buttonVariants definition, forwardRef wrapper, and namespace exports</verify>
  <done>Button component uses CVA for all variants with compound variants for iconOnly sizing</done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive Button tests with jest-axe</name>
  <files>app/components/ui/__tests__/Button.test.js</files>
  <action>
REPLACE existing Button.test.js with new Phase 12-style tests. Structure:

1. Import jest-axe and extend matchers
2. Accessibility tests:
   - Test each variant (ember, subtle, ghost, success, danger, outline) with axe
   - Test disabled state
   - Test loading state
   - Test iconOnly with aria-label

3. CVA Variants tests:
   - Default variant is ember (check gradient classes)
   - All 6 variants render correctly
   - Size variants (sm, md, lg) apply correct min-h classes
   - fullWidth applies w-full
   - iconOnly applies rounded-full

4. Compound Variants tests:
   - iconOnly + size combinations have correct padding
   - sm + iconOnly -> min-w-[44px]
   - md + iconOnly -> min-w-[48px]
   - lg + iconOnly -> min-w-[56px]

5. States tests:
   - Disabled renders correctly with opacity
   - Loading shows spinner and disables button
   - Click handlers fire correctly

6. Focus Ring tests:
   - Has focus-visible:ring-2 class
   - Has focus-visible:ring-ember-500/50 class

7. Namespace tests:
   - Button.Icon renders with iconOnly and aria-label
   - Button.Group renders with role="group"

Do NOT test legacy props - they should not exist.
  </action>
  <verify>npm test -- --testPathPattern="Button.test.js" passes with no failures</verify>
  <done>Button tests cover all CVA variants, accessibility, and namespace components</done>
</task>

</tasks>

<verification>
1. Run `npm test -- --testPathPattern="Button.test.js"` - all tests pass
2. Verify Button.js exports buttonVariants
3. Check no legacy prop handling exists (no 'primary' -> 'ember' mapping)
</verification>

<success_criteria>
- Button component uses CVA with 6 variants and 3 sizes
- Compound variants handle iconOnly + size interactions
- Button.Icon and Button.Group available via namespace
- All jest-axe tests pass with no a11y violations
- Focus ring uses ember glow consistently
</success_criteria>

<output>
After completion, create `.planning/phases/13-foundation-refactoring/13-01-SUMMARY.md`
</output>
