---
phase: 13-foundation-refactoring
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Card.js
  - app/components/ui/__tests__/Card.test.js
autonomous: true

must_haves:
  truths:
    - "Card renders with CVA variants (default, elevated, subtle, outlined, glass)"
    - "Card supports hover and glow as CVA boolean variants"
    - "Card.Header, Card.Title, Card.Content, Card.Footer, Card.Divider available via namespace"
    - "All Card variants pass jest-axe accessibility tests"
    - "Legacy props (liquid, glass, elevation) removed - no backwards compatibility"
  artifacts:
    - path: "app/components/ui/Card.js"
      provides: "CVA Card with namespace compound components"
      exports: ["default", "Card", "CardHeader", "CardTitle", "CardContent", "CardFooter", "CardDivider", "cardVariants"]
    - path: "app/components/ui/__tests__/Card.test.js"
      provides: "Comprehensive CVA + a11y tests"
      contains: "toHaveNoViolations"
  key_links:
    - from: "Card.js"
      to: "@/lib/utils/cn"
      via: "cn() import"
      pattern: "import.*cn.*from.*@/lib/utils/cn"
    - from: "Card.js"
      to: "class-variance-authority"
      via: "cva import"
      pattern: "import.*cva.*from.*class-variance-authority"
---

<objective>
Refactor Card component to use CVA pattern with namespace compound components.

Purpose: Consistent Card API with proper composition pattern (Card.Header, Card.Title, etc.)
Output: CVA-powered Card with all sub-components accessible via namespace.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-foundation-refactoring/13-CONTEXT.md
@.planning/phases/13-foundation-refactoring/13-RESEARCH.md

# Reference Phase 12 CVA pattern
@app/components/ui/Checkbox.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor Card with CVA variants and namespace pattern</name>
  <files>app/components/ui/Card.js</files>
  <action>
Rewrite Card.js using CVA pattern. Key changes:

1. Add 'use client' directive (needed for forwardRef)
2. Import forwardRef from 'react', cva from 'class-variance-authority', cn from '@/lib/utils/cn'
3. Create cardVariants with cva():
   - Base classes: rounded-2xl, transition-all duration-300, relative, overflow-hidden
   - variants.variant:
     - default: bg-slate-900/80, border border-white/[0.06], shadow-card, backdrop-blur-xl + light mode
     - elevated: bg-slate-850/90, stronger shadow + light mode
     - subtle: bg-white/[0.03], minimal border + light mode
     - outlined: bg-transparent, visible border + light mode
     - glass: backdrop-blur-2xl, backdrop-saturate-150 + light mode
   - variants.hover (boolean): hover:shadow-card-hover, hover:-translate-y-0.5, cursor-pointer
   - variants.glow (boolean): shadow-ember-glow, border-ember-500/20
   - variants.padding (boolean): p-5 sm:p-6 (default true)
   - defaultVariants: variant='default', hover=false, glow=false, padding=true

4. REMOVE legacy prop handling (no mapping for 'liquid', 'glass' boolean, 'elevation')
5. REMOVE data-liquid-glass attribute (no longer needed)

6. Create sub-components with forwardRef:
   - CardHeader: flex items-center justify-between mb-4
   - CardTitle: flex items-center gap-3, renders icon + Heading
   - CardContent: space-y-4
   - CardFooter: mt-5 pt-4 border-t + light mode
   - CardDivider: h-px my-4 gradient line + light mode

7. Attach namespace properties:
   ```js
   Card.Header = CardHeader;
   Card.Title = CardTitle;
   Card.Content = CardContent;
   Card.Footer = CardFooter;
   Card.Divider = CardDivider;
   ```

8. Export both named and namespace:
   ```js
   export { Card, CardHeader, CardTitle, CardContent, CardFooter, CardDivider, cardVariants };
   export default Card;
   ```
  </action>
  <verify>File exists with CVA imports, cardVariants definition, all sub-components with forwardRef, namespace attachments</verify>
  <done>Card component uses CVA for all variants with namespace pattern for sub-components</done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive Card tests with jest-axe</name>
  <files>app/components/ui/__tests__/Card.test.js</files>
  <action>
REPLACE existing Card.test.js with new Phase 12-style tests. Structure:

1. Import jest-axe and extend matchers
2. Accessibility tests:
   - Test each variant (default, elevated, subtle, outlined, glass) with axe
   - Test with hover=true
   - Test with glow=true
   - Test with all sub-components (Card.Header, Card.Title, etc.)

3. CVA Variants tests:
   - Default variant applies correct classes
   - All 5 variants render correctly
   - hover=true applies hover classes
   - glow=true applies ember glow classes
   - padding=false removes padding

4. Compound Components tests:
   - Card.Header renders with flex layout
   - Card.Title renders with icon + Heading
   - Card.Content renders with spacing
   - Card.Footer renders with border-t
   - Card.Divider renders gradient line

5. Namespace Pattern tests:
   - Components accessible via Card.Header, Card.Title, etc.
   - Named exports work for tree-shaking

6. forwardRef tests:
   - Refs forwarded correctly to all components

Do NOT test legacy props - they should not exist.
  </action>
  <verify>npm test -- --testPathPattern="Card.test.js" passes with no failures</verify>
  <done>Card tests cover all CVA variants, accessibility, and namespace components</done>
</task>

</tasks>

<verification>
1. Run `npm test -- --testPathPattern="Card.test.js"` - all tests pass
2. Verify Card.js exports cardVariants and all sub-components
3. Check no legacy prop handling exists (no 'liquid' boolean mapping)
</verification>

<success_criteria>
- Card component uses CVA with 5 variants
- hover and glow work as boolean CVA variants
- All sub-components available via namespace (Card.Header, etc.)
- Named exports available for tree-shaking
- All jest-axe tests pass with no a11y violations
</success_criteria>

<output>
After completion, create `.planning/phases/13-foundation-refactoring/13-02-SUMMARY.md`
</output>
