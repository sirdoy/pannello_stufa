---
phase: 13-foundation-refactoring
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Heading.js
  - app/components/ui/Text.js
  - app/components/ui/__tests__/Heading.test.js
  - app/components/ui/__tests__/Text.test.js
autonomous: true

must_haves:
  truths:
    - "Heading component uses CVA for all variants with level-to-size auto-calculation"
    - "Text component uses CVA for all variants with proper typography hierarchy"
    - "Both components support all existing variants (default, gradient, subtle, ember, ocean, sage, etc.)"
    - "Both components pass jest-axe accessibility tests"
    - "Explicit size prop overrides auto-calculated size"
  artifacts:
    - path: "app/components/ui/Heading.js"
      provides: "CVA Heading with typography variants"
      exports: ["default", "Heading", "headingVariants"]
    - path: "app/components/ui/Text.js"
      provides: "CVA Text with typography variants"
      exports: ["default", "Text", "textVariants"]
    - path: "app/components/ui/__tests__/Heading.test.js"
      provides: "Heading a11y and variant tests"
      contains: "toHaveNoViolations"
    - path: "app/components/ui/__tests__/Text.test.js"
      provides: "Text a11y and variant tests"
      contains: "toHaveNoViolations"
  key_links:
    - from: "Heading.js"
      to: "class-variance-authority"
      via: "cva import"
      pattern: "import.*cva.*from.*class-variance-authority"
    - from: "Text.js"
      to: "class-variance-authority"
      via: "cva import"
      pattern: "import.*cva.*from.*class-variance-authority"
---

<objective>
Refactor Heading (COMP-11) and Text (COMP-12) components with CVA patterns for complete typography system.

Purpose: Consistent, type-safe typography API matching Phase 12 patterns.
Output: CVA-powered Heading and Text with all existing variants preserved.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-foundation-refactoring/13-CONTEXT.md
@.planning/phases/13-foundation-refactoring/13-RESEARCH.md

# Current implementations for reference
@app/components/ui/Heading.js
@app/components/ui/Text.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor Heading with CVA variants</name>
  <files>app/components/ui/Heading.js</files>
  <action>
Refactor Heading.js to use CVA pattern:

1. Add 'use client' directive
2. Import forwardRef, cva, cn
3. Create headingVariants with cva():
   - Base classes: font-bold font-display
   - variants.size:
     - sm: text-sm
     - md: text-base
     - lg: text-lg
     - xl: text-xl sm:text-2xl
     - 2xl: text-2xl sm:text-3xl
     - 3xl: text-3xl sm:text-4xl
   - variants.variant:
     - default: text-slate-100 + light mode text-slate-900
     - gradient: bg-gradient-to-r from-ember-500 to-flame-600 bg-clip-text text-transparent
     - subtle: text-slate-400 + light mode text-slate-600
     - ember: text-ember-400 + light mode text-ember-700
     - ocean: text-ocean-300 + light mode text-ocean-700
     - sage: text-sage-400 + light mode text-sage-700
     - warning: text-warning-400 + light mode text-warning-700
     - danger: text-danger-400 + light mode text-danger-700
     - info: text-ocean-300 + light mode text-ocean-800 (alias for ocean)
   - defaultVariants: size='2xl', variant='default'

4. Keep level-to-size auto-calculation:
   ```js
   const sizeMapping = { 1: '3xl', 2: '2xl', 3: 'xl', 4: 'lg', 5: 'md', 6: 'sm' };
   const finalSize = size || sizeMapping[level] || 'md';
   ```

5. Create component with forwardRef:
   ```js
   const Heading = forwardRef(({ level = 2, size, variant, className, children, ...props }, ref) => {
     const Tag = `h${level}`;
     const finalSize = size || sizeMapping[level] || 'md';
     return <Tag ref={ref} className={cn(headingVariants({ size: finalSize, variant }), className)} {...props}>{children}</Tag>;
   });
   ```

6. Export both named and default:
   ```js
   export { Heading, headingVariants };
   export default Heading;
   ```
  </action>
  <verify>File exists with CVA imports, headingVariants definition, level-to-size mapping preserved</verify>
  <done>Heading component uses CVA with all 9 variants and auto-size calculation</done>
</task>

<task type="auto">
  <name>Task 2: Refactor Text with CVA variants</name>
  <files>app/components/ui/Text.js</files>
  <action>
Refactor Text.js to use CVA pattern:

1. Add 'use client' directive
2. Import forwardRef, cva, cn
3. Create textVariants with cva():
   - Base classes: (minimal)
   - variants.variant:
     - body: text-slate-100 + light mode text-slate-900
     - secondary: text-slate-300 + light mode text-slate-600
     - tertiary: text-slate-400 + light mode text-slate-500
     - ember: text-ember-400 + light mode text-ember-600
     - ocean: text-ocean-400 + light mode text-ocean-600
     - sage: text-sage-400 + light mode text-sage-600
     - warning: text-warning-400 + light mode text-warning-600
     - danger: text-danger-400 + light mode text-danger-600
     - info: text-ocean-400 + light mode text-ocean-600
     - label: text-slate-400 uppercase tracking-wider + light mode text-slate-500
   - variants.size:
     - xs: text-xs
     - sm: text-sm
     - base: text-base
     - lg: text-lg
     - xl: text-xl
   - variants.weight:
     - normal: font-normal
     - medium: font-medium
     - semibold: font-semibold
     - bold: font-bold
     - black: font-black
   - defaultVariants: variant='body', size='base'

4. Keep default sizes per variant:
   ```js
   const defaultSizes = { body: 'base', secondary: 'base', tertiary: 'sm', label: 'xs', ... };
   const finalSize = size || defaultSizes[variant] || 'base';
   ```

5. Keep utility props: uppercase, tracking, mono
6. Keep 'as' prop for element selection (p, span, label, div)

7. Create component with forwardRef:
   ```js
   const Text = forwardRef(({ variant, size, weight, uppercase, tracking, mono, as = 'p', className, children, ...props }, ref) => {
     const Tag = as;
     const finalSize = size || defaultSizes[variant] || 'base';
     // Build additional classes for uppercase, tracking, mono
     return <Tag ref={ref} className={cn(textVariants({ variant, size: finalSize, weight }), extraClasses, className)} {...props}>{children}</Tag>;
   });
   ```

8. Export both named and default:
   ```js
   export { Text, textVariants };
   export default Text;
   ```
  </action>
  <verify>File exists with CVA imports, textVariants definition, all utility props preserved</verify>
  <done>Text component uses CVA with all 10 variants and utility props</done>
</task>

<task type="auto">
  <name>Task 3: Create Heading and Text tests</name>
  <files>app/components/ui/__tests__/Heading.test.js, app/components/ui/__tests__/Text.test.js</files>
  <action>
Create test files following Phase 12 patterns:

**Heading.test.js:**
1. Accessibility tests:
   - Each level (h1-h6) passes axe
   - Each variant passes axe

2. CVA Variants tests:
   - Default variant applies slate colors
   - gradient variant applies gradient classes
   - All 9 variants render correctly

3. Size tests:
   - Explicit size overrides auto-calculation
   - Auto-calculation: level 1 -> 3xl, level 2 -> 2xl, etc.
   - All 6 sizes render correctly

4. Semantic HTML tests:
   - level=1 renders h1
   - level=3 renders h3
   - etc.

**Text.test.js:**
1. Accessibility tests:
   - Each variant passes axe
   - 'as' prop with different elements passes axe

2. CVA Variants tests:
   - body variant applies slate-100/900
   - secondary variant applies slate-300/600
   - All 10 variants render correctly

3. Size tests:
   - Default sizes per variant work
   - Explicit size overrides default

4. Utility props tests:
   - uppercase applies uppercase class
   - tracking applies tracking-wider
   - mono applies font-mono

5. 'as' prop tests:
   - as='span' renders span
   - as='div' renders div
   - as='label' renders label
  </action>
  <verify>npm test -- --testPathPattern="(Heading|Text).test.js" passes</verify>
  <done>Heading and Text have comprehensive tests covering all variants, sizes, and utility props</done>
</task>

</tasks>

<verification>
1. Run `npm test -- --testPathPattern="(Heading|Text).test.js"` - all tests pass
2. Verify Heading.js exports headingVariants
3. Verify Text.js exports textVariants
4. Verify level-to-size auto-calculation still works
</verification>

<success_criteria>
- Heading component uses CVA with 9 variants and 6 sizes
- Heading preserves level-to-size auto-calculation with explicit override
- Text component uses CVA with 10 variants and 5 sizes
- Text preserves utility props (uppercase, tracking, mono) and 'as' prop
- All jest-axe tests pass with no a11y violations
</success_criteria>

<output>
After completion, create `.planning/phases/13-foundation-refactoring/13-04-SUMMARY.md`
</output>
