---
phase: 14-feedback-layout-components
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Spinner.js
  - app/components/ui/Progress.js
  - app/components/ui/__tests__/Spinner.test.js
  - app/components/ui/__tests__/Progress.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User sees animated Spinner during loading"
    - "User sees Progress bar with percentage"
    - "User sees indeterminate Progress when percentage unknown"
    - "Spinner comes in multiple sizes (sm, md, lg, xl)"
  artifacts:
    - path: "app/components/ui/Spinner.js"
      provides: "Spinner component with CVA size/variant"
      exports: ["default", "Spinner", "spinnerVariants"]
    - path: "app/components/ui/Progress.js"
      provides: "Progress component with Radix primitive"
      exports: ["default", "Progress", "progressVariants"]
  key_links:
    - from: "app/components/ui/Progress.js"
      to: "@radix-ui/react-progress"
      via: "Radix Progress primitive"
      pattern: "ProgressPrimitive"
---

<objective>
Create Spinner component and enhance Progress with Radix Progress primitive.

Purpose: Provide consistent loading indicators - Spinner for inline/button loading, Progress for determinate/indeterminate bars.
Output: Spinner with sizes/variants, Progress with Radix accessibility and indeterminate support.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-feedback-layout-components/14-RESEARCH.md
@app/components/ui/ProgressBar.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Spinner component</name>
  <files>app/components/ui/Spinner.js, app/components/ui/__tests__/Spinner.test.js</files>
  <action>
**Spinner.js:**

1. Import dependencies:
   ```javascript
   'use client';

   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   ```

2. Create CVA variants:
   ```javascript
   export const spinnerVariants = cva(
     'animate-spin',
     {
       variants: {
         size: {
           xs: 'h-3 w-3',
           sm: 'h-4 w-4',
           md: 'h-6 w-6',
           lg: 'h-8 w-8',
           xl: 'h-12 w-12',
         },
         variant: {
           ember: 'text-ember-500',
           white: 'text-white',
           current: 'text-current',
           muted: 'text-slate-400 [html:not(.dark)_&]:text-slate-500',
         },
       },
       defaultVariants: {
         size: 'md',
         variant: 'ember',
       },
     }
   );
   ```

3. Create Spinner component:
   ```javascript
   /**
    * Spinner - Animated loading indicator
    *
    * @example
    * <Spinner size="lg" variant="ember" />
    * <Button disabled><Spinner size="sm" variant="current" /> Loading...</Button>
    */
   export default function Spinner({ size, variant, className, label = 'Loading', ...props }) {
     return (
       <svg
         className={cn(spinnerVariants({ size, variant }), className)}
         viewBox="0 0 24 24"
         fill="none"
         role="status"
         aria-label={label}
         {...props}
       >
         {/* Background circle */}
         <circle
           className="opacity-25"
           cx="12"
           cy="12"
           r="10"
           stroke="currentColor"
           strokeWidth="3"
         />
         {/* Spinning arc */}
         <path
           className="opacity-90"
           fill="currentColor"
           d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
         />
       </svg>
     );
   }

   export { Spinner };
   ```

**Spinner.test.js:**

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import Spinner from '../Spinner';

describe('Spinner', () => {
  it('renders with default props', () => {
    render(<Spinner />);
    expect(screen.getByRole('status')).toBeInTheDocument();
  });

  it('applies size variants', () => {
    const { rerender, container } = render(<Spinner size="sm" />);
    expect(container.querySelector('svg')).toHaveClass('h-4', 'w-4');

    rerender(<Spinner size="xl" />);
    expect(container.querySelector('svg')).toHaveClass('h-12', 'w-12');
  });

  it('applies variant colors', () => {
    const { container, rerender } = render(<Spinner variant="ember" />);
    expect(container.querySelector('svg')).toHaveClass('text-ember-500');

    rerender(<Spinner variant="white" />);
    expect(container.querySelector('svg')).toHaveClass('text-white');
  });

  it('has accessible label', () => {
    render(<Spinner label="Saving..." />);
    expect(screen.getByRole('status')).toHaveAttribute('aria-label', 'Saving...');
  });

  it('has no accessibility violations', async () => {
    const { container } = render(<Spinner />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('accepts custom className', () => {
    const { container } = render(<Spinner className="custom-class" />);
    expect(container.querySelector('svg')).toHaveClass('custom-class');
  });
});
```
  </action>
  <verify>npm test -- Spinner.test.js --watchAll=false</verify>
  <done>Spinner component with size/variant CVA, accessible, tested</done>
</task>

<task type="auto">
  <name>Task 2: Create Progress component with Radix primitive</name>
  <files>app/components/ui/Progress.js, app/components/ui/__tests__/Progress.test.js</files>
  <action>
**Progress.js:**

Create new Progress component (ProgressBar.js remains for backwards compat):

1. Import dependencies:
   ```javascript
   'use client';

   import * as ProgressPrimitive from '@radix-ui/react-progress';
   import { forwardRef } from 'react';
   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   ```

2. Create CVA variants:
   ```javascript
   export const progressVariants = cva(
     [
       'relative overflow-hidden rounded-full',
       'bg-slate-700/50 [html:not(.dark)_&]:bg-slate-200/60',
     ],
     {
       variants: {
         size: {
           sm: 'h-1.5',
           md: 'h-2.5',
           lg: 'h-4',
         },
       },
       defaultVariants: { size: 'md' },
     }
   );

   const indicatorVariants = cva(
     [
       'h-full rounded-full transition-all duration-500',
       'bg-gradient-to-r',
     ],
     {
       variants: {
         variant: {
           ember: 'from-ember-400 via-ember-500 to-flame-600',
           ocean: 'from-ocean-400 via-ocean-500 to-ocean-600',
           sage: 'from-sage-400 via-sage-500 to-sage-600',
           warning: 'from-warning-400 via-warning-500 to-warning-600',
           danger: 'from-danger-400 via-danger-500 to-danger-600',
         },
         indeterminate: {
           true: 'animate-progress-indeterminate w-1/3',
           false: '',
         },
       },
       defaultVariants: {
         variant: 'ember',
         indeterminate: false,
       },
     }
   );
   ```

3. Create Progress component:
   ```javascript
   /**
    * Progress - Accessible progress bar with Radix
    *
    * @example
    * <Progress value={75} variant="ember" />
    * <Progress indeterminate variant="ocean" />
    */
   const Progress = forwardRef(({
     value,
     max = 100,
     size,
     variant,
     indeterminate = false,
     className,
     indicatorClassName,
     ...props
   }, ref) => {
     // If value is undefined or null, treat as indeterminate
     const isIndeterminate = indeterminate || value === undefined || value === null;
     const percentage = isIndeterminate ? null : Math.min(Math.max(value, 0), max);

     return (
       <ProgressPrimitive.Root
         ref={ref}
         value={isIndeterminate ? null : percentage}
         max={max}
         className={cn(progressVariants({ size }), className)}
         {...props}
       >
         <ProgressPrimitive.Indicator
           className={cn(
             indicatorVariants({ variant, indeterminate: isIndeterminate }),
             indicatorClassName
           )}
           style={isIndeterminate ? undefined : { width: `${(percentage / max) * 100}%` }}
         />
       </ProgressPrimitive.Root>
     );
   });
   Progress.displayName = 'Progress';

   export default Progress;
   export { Progress };
   ```

4. Add animation keyframes to globals.css (note for executor):
   ```css
   /* Add to globals.css if not present */
   @keyframes progress-indeterminate {
     0% { transform: translateX(-100%); }
     100% { transform: translateX(400%); }
   }
   .animate-progress-indeterminate {
     animation: progress-indeterminate 1.5s ease-in-out infinite;
   }
   ```

**Progress.test.js:**

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import Progress from '../Progress';

describe('Progress', () => {
  it('renders with value', () => {
    render(<Progress value={50} />);
    expect(screen.getByRole('progressbar')).toHaveAttribute('aria-valuenow', '50');
  });

  it('renders indeterminate when value is undefined', () => {
    render(<Progress />);
    const progress = screen.getByRole('progressbar');
    expect(progress).not.toHaveAttribute('aria-valuenow');
  });

  it('renders indeterminate when prop is true', () => {
    render(<Progress indeterminate />);
    const progress = screen.getByRole('progressbar');
    expect(progress).not.toHaveAttribute('aria-valuenow');
  });

  it('clamps value between 0 and max', () => {
    const { rerender } = render(<Progress value={150} max={100} />);
    expect(screen.getByRole('progressbar')).toHaveAttribute('aria-valuenow', '100');

    rerender(<Progress value={-10} max={100} />);
    expect(screen.getByRole('progressbar')).toHaveAttribute('aria-valuenow', '0');
  });

  it('applies size variants', () => {
    const { container, rerender } = render(<Progress value={50} size="sm" />);
    expect(container.firstChild).toHaveClass('h-1.5');

    rerender(<Progress value={50} size="lg" />);
    expect(container.firstChild).toHaveClass('h-4');
  });

  it('has no accessibility violations', async () => {
    const { container } = render(<Progress value={50} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('has correct ARIA attributes', () => {
    render(<Progress value={75} max={100} />);
    const progress = screen.getByRole('progressbar');
    expect(progress).toHaveAttribute('aria-valuemax', '100');
    expect(progress).toHaveAttribute('aria-valuemin', '0');
    expect(progress).toHaveAttribute('aria-valuenow', '75');
  });
});
```
  </action>
  <verify>npm test -- Progress.test.js --watchAll=false</verify>
  <done>Progress component with Radix primitive, indeterminate support, accessible</done>
</task>

<task type="auto">
  <name>Task 3: Update exports</name>
  <files>app/components/ui/index.js</files>
  <action>
Add new exports to index.js:

```javascript
// Add to exports
export { default as Spinner, spinnerVariants } from './Spinner';
export { default as Progress, progressVariants } from './Progress';
```

Keep existing ProgressBar export for backwards compatibility:
```javascript
export { default as ProgressBar } from './ProgressBar';
```
  </action>
  <verify>All components export correctly from index.js</verify>
  <done>Spinner and Progress exported, ProgressBar still available for compatibility</done>
</task>

</tasks>

<verification>
- [ ] `npm test -- Spinner.test.js --watchAll=false` passes
- [ ] `npm test -- Progress.test.js --watchAll=false` passes
- [ ] Spinner animates with spin animation
- [ ] Spinner has 5 sizes (xs, sm, md, lg, xl)
- [ ] Progress shows determinate value
- [ ] Progress shows indeterminate animation when value undefined
- [ ] Both exported from index.js
</verification>

<success_criteria>
Spinner and Progress components created with CVA variants. Spinner has sizes and color variants. Progress uses Radix primitive for proper ARIA. Indeterminate animation works when value is undefined.
</success_criteria>

<output>
After completion, create `.planning/phases/14-feedback-layout-components/14-04-SUMMARY.md`
</output>
