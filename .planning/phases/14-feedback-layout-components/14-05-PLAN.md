---
phase: 14-feedback-layout-components
plan: 05
type: execute
wave: 2
depends_on:
  - 14-04
files_modified:
  - app/components/ui/EmptyState.js
  - app/components/ui/Banner.js
  - app/components/ui/__tests__/EmptyState.test.js
  - app/components/ui/__tests__/Banner.test.js
autonomous: true

must_haves:
  truths:
    - "User sees EmptyState with icon, title, description, and action"
    - "User sees Banner in 4 variants (info, warning, error, success)"
    - "User can dismiss Banner if dismissible prop is true"
    - "EmptyState and Banner use CVA for consistent variant styling"
  artifacts:
    - path: "app/components/ui/EmptyState.js"
      provides: "EmptyState with CVA size variants"
      exports: ["default", "EmptyState", "emptyStateVariants"]
    - path: "app/components/ui/Banner.js"
      provides: "Banner with CVA variants"
      exports: ["default", "Banner", "bannerVariants"]
  key_links:
    - from: "app/components/ui/EmptyState.js"
      to: "app/components/ui/Heading.js"
      via: "uses Heading for title"
      pattern: "import.*Heading"
    - from: "app/components/ui/Banner.js"
      to: "class-variance-authority"
      via: "CVA for variants"
      pattern: "import.*cva"
---

<objective>
Standardize EmptyState and Banner components with CVA variants.

Purpose: Ensure consistent variant styling across EmptyState and Banner, add size variants to EmptyState, and ensure Banner accessibility.
Output: EmptyState with size variants, Banner with CVA and improved accessibility.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-feedback-layout-components/14-RESEARCH.md
@app/components/ui/EmptyState.js
@app/components/ui/Banner.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance EmptyState with CVA</name>
  <files>app/components/ui/EmptyState.js, app/components/ui/__tests__/EmptyState.test.js</files>
  <action>
**EmptyState.js:**

Enhance with CVA size variants:

1. Import dependencies:
   ```javascript
   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   import Heading from './Heading';
   import Text from './Text';
   ```

2. Create CVA variants:
   ```javascript
   export const emptyStateVariants = cva(
     'text-center flex flex-col items-center',
     {
       variants: {
         size: {
           sm: 'py-4 gap-2',
           md: 'py-8 gap-3',
           lg: 'py-12 gap-4',
         },
       },
       defaultVariants: { size: 'md' },
     }
   );

   const iconSizeMap = {
     sm: 'text-4xl',
     md: 'text-6xl',
     lg: 'text-7xl',
   };

   const headingSizeMap = {
     sm: 'base',
     md: 'lg',
     lg: 'xl',
   };
   ```

3. Update component:
   ```javascript
   /**
    * EmptyState Component
    *
    * Consistent empty state display with icon, title, description, and optional action.
    *
    * @example
    * <EmptyState
    *   icon="ðŸ "
    *   title="Nessun dispositivo"
    *   description="Aggiungi dispositivi per iniziare"
    *   action={<Button>Aggiungi</Button>}
    * />
    */
   export default function EmptyState({
     icon,
     title,
     description,
     action,
     size = 'md',
     className = '',
   }) {
     return (
       <div className={cn(emptyStateVariants({ size }), className)}>
         {/* Icon */}
         {icon && (
           <div className={iconSizeMap[size]} aria-hidden="true">
             {typeof icon === 'string' ? icon : icon}
           </div>
         )}

         {/* Title */}
         {title && (
           <Heading level={3} size={headingSizeMap[size]}>
             {title}
           </Heading>
         )}

         {/* Description */}
         {description && (
           <Text variant="secondary" size={size === 'sm' ? 'sm' : 'base'} className="max-w-sm">
             {description}
           </Text>
         )}

         {/* Action */}
         {action && <div className="mt-2">{action}</div>}
       </div>
     );
   }

   export { EmptyState };
   ```

**EmptyState.test.js:**

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import EmptyState from '../EmptyState';
import Button from '../Button';

describe('EmptyState', () => {
  it('renders with all props', () => {
    render(
      <EmptyState
        icon="ðŸ "
        title="No devices"
        description="Add devices to get started"
        action={<Button>Add Device</Button>}
      />
    );

    expect(screen.getByText('ðŸ ')).toBeInTheDocument();
    expect(screen.getByRole('heading', { name: 'No devices' })).toBeInTheDocument();
    expect(screen.getByText('Add devices to get started')).toBeInTheDocument();
    expect(screen.getByRole('button', { name: 'Add Device' })).toBeInTheDocument();
  });

  it('renders without optional props', () => {
    render(<EmptyState title="Empty" />);
    expect(screen.getByRole('heading', { name: 'Empty' })).toBeInTheDocument();
  });

  it('applies size variants', () => {
    const { container, rerender } = render(<EmptyState title="Test" size="sm" />);
    expect(container.firstChild).toHaveClass('py-4');

    rerender(<EmptyState title="Test" size="lg" />);
    expect(container.firstChild).toHaveClass('py-12');
  });

  it('marks icon as decorative', () => {
    render(<EmptyState icon="ðŸ " title="Test" />);
    expect(screen.getByText('ðŸ ').parentElement).toHaveAttribute('aria-hidden', 'true');
  });

  it('has no accessibility violations', async () => {
    const { container } = render(
      <EmptyState
        icon="ðŸ "
        title="No items"
        description="Nothing to show"
        action={<Button>Action</Button>}
      />
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```
  </action>
  <verify>npm test -- EmptyState.test.js --watchAll=false</verify>
  <done>EmptyState with CVA size variants, icon marked decorative, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Enhance Banner with CVA</name>
  <files>app/components/ui/Banner.js, app/components/ui/__tests__/Banner.test.js</files>
  <action>
**Banner.js:**

Refactor with CVA variants (keep backwards compat):

1. Import dependencies:
   ```javascript
   'use client';

   import { useState, useEffect } from 'react';
   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   import { X, Info, AlertTriangle, AlertCircle, CheckCircle, Flame } from 'lucide-react';
   import Heading from './Heading';
   import Text from './Text';
   ```

2. Create CVA variants:
   ```javascript
   export const bannerVariants = cva(
     [
       'rounded-xl backdrop-blur-lg',
       'transition-all duration-300',
       'animate-fade-in-up',
       'border',
     ],
     {
       variants: {
         variant: {
           info: [
             'bg-ocean-500/[0.15] [html:not(.dark)_&]:bg-ocean-500/[0.08]',
             'border-ocean-500/25 [html:not(.dark)_&]:border-ocean-400/25',
           ],
           warning: [
             'bg-warning-500/[0.15] [html:not(.dark)_&]:bg-warning-500/[0.08]',
             'border-warning-500/25 [html:not(.dark)_&]:border-warning-400/25',
           ],
           error: [
             'bg-danger-500/[0.15] [html:not(.dark)_&]:bg-danger-500/[0.08]',
             'border-danger-500/25 [html:not(.dark)_&]:border-danger-400/25',
           ],
           success: [
             'bg-sage-500/[0.15] [html:not(.dark)_&]:bg-sage-500/[0.08]',
             'border-sage-500/25 [html:not(.dark)_&]:border-sage-400/25',
           ],
           ember: [
             'bg-ember-500/[0.15] [html:not(.dark)_&]:bg-ember-500/[0.08]',
             'border-ember-500/25 [html:not(.dark)_&]:border-ember-400/25',
             'shadow-ember-glow-sm [html:not(.dark)_&]:shadow-none',
           ],
         },
         compact: {
           true: 'p-3',
           false: 'p-4 sm:p-5',
         },
       },
       defaultVariants: {
         variant: 'info',
         compact: false,
       },
     }
   );

   const textVariants = {
     info: {
       title: 'text-ocean-200 [html:not(.dark)_&]:text-ocean-800',
       description: 'text-ocean-300 [html:not(.dark)_&]:text-ocean-700',
     },
     warning: {
       title: 'text-warning-200 [html:not(.dark)_&]:text-warning-800',
       description: 'text-warning-300 [html:not(.dark)_&]:text-warning-700',
     },
     error: {
       title: 'text-danger-200 [html:not(.dark)_&]:text-danger-800',
       description: 'text-danger-300 [html:not(.dark)_&]:text-danger-700',
     },
     success: {
       title: 'text-sage-200 [html:not(.dark)_&]:text-sage-800',
       description: 'text-sage-300 [html:not(.dark)_&]:text-sage-700',
     },
     ember: {
       title: 'text-ember-200 [html:not(.dark)_&]:text-ember-800',
       description: 'text-ember-300 [html:not(.dark)_&]:text-ember-700',
     },
   };

   const iconMap = {
     info: Info,
     warning: AlertTriangle,
     error: AlertCircle,
     success: CheckCircle,
     ember: Flame,
   };
   ```

3. Update component to use CVA:
   ```javascript
   export default function Banner({
     variant = 'info',
     icon,
     title,
     description,
     actions,
     dismissible = false,
     onDismiss,
     dismissKey,
     compact = false,
     className = '',
     children,
   }) {
     const [isDismissed, setIsDismissed] = useState(false);

     // Check persistent dismissal
     useEffect(() => {
       if (dismissKey && typeof window !== 'undefined') {
         const dismissed = localStorage.getItem(`banner-dismissed-${dismissKey}`);
         if (dismissed === 'true') {
           setIsDismissed(true);
         }
       }
     }, [dismissKey]);

     const handleDismiss = () => {
       setIsDismissed(true);
       if (dismissKey && typeof window !== 'undefined') {
         localStorage.setItem(`banner-dismissed-${dismissKey}`, 'true');
       }
       onDismiss?.();
     };

     if (isDismissed) return null;

     const IconComponent = icon || iconMap[variant];
     const textColors = textVariants[variant] || textVariants.info;

     return (
       <div
         className={cn(bannerVariants({ variant, compact }), className)}
         role="alert"
       >
         <div className="flex items-start gap-3">
           {/* Icon */}
           {IconComponent && (
             <div className="flex-shrink-0" aria-hidden="true">
               {typeof IconComponent === 'string' ? (
                 <span className={compact ? 'text-xl' : 'text-2xl'}>{IconComponent}</span>
               ) : (
                 <IconComponent className={compact ? 'h-5 w-5' : 'h-6 w-6'} />
               )}
             </div>
           )}

           {/* Content */}
           <div className="flex-1 min-w-0">
             {title && (
               <Heading
                 level={3}
                 size={compact ? 'sm' : 'base'}
                 className={cn(textColors.title, (description || children || actions) && 'mb-1')}
               >
                 {title}
               </Heading>
             )}

             {description && (
               <Text
                 size={compact ? 'xs' : 'sm'}
                 className={cn(textColors.description, (actions || children) && 'mb-3')}
               >
                 {description}
               </Text>
             )}

             {children}

             {actions && (
               <div className="flex flex-wrap gap-2 mt-2">
                 {actions}
               </div>
             )}
           </div>

           {/* Dismiss button */}
           {dismissible && (
             <button
               onClick={handleDismiss}
               className="flex-shrink-0 p-1.5 rounded-lg
                 text-slate-400 hover:text-slate-200
                 hover:bg-white/[0.06]
                 transition-all duration-200
                 [html:not(.dark)_&]:text-slate-500
                 [html:not(.dark)_&]:hover:text-slate-700
                 [html:not(.dark)_&]:hover:bg-black/[0.04]"
               aria-label="Dismiss"
             >
               <X className="w-4 h-4" aria-hidden="true" />
             </button>
           )}
         </div>
       </div>
     );
   }

   export { Banner };
   ```

**Update Banner.test.js:**

Ensure existing tests still pass and add:

```javascript
import { render, screen, fireEvent } from '@testing-library/react';
import { axe } from 'jest-axe';
import Banner from '../Banner';

describe('Banner', () => {
  beforeEach(() => {
    localStorage.clear();
  });

  it('renders with variant icons', () => {
    const { rerender } = render(<Banner variant="success" title="Success" />);
    expect(screen.getByRole('alert')).toBeInTheDocument();

    rerender(<Banner variant="error" title="Error" />);
    expect(screen.getByRole('alert')).toBeInTheDocument();
  });

  it('applies CVA variant classes', () => {
    const { container } = render(<Banner variant="warning" title="Warning" />);
    expect(container.firstChild).toHaveClass('border-warning-500/25');
  });

  it('handles dismissible', () => {
    const onDismiss = jest.fn();
    render(<Banner title="Test" dismissible onDismiss={onDismiss} />);

    fireEvent.click(screen.getByRole('button', { name: 'Dismiss' }));
    expect(onDismiss).toHaveBeenCalled();
    expect(screen.queryByRole('alert')).not.toBeInTheDocument();
  });

  it('persists dismissal with dismissKey', () => {
    const { rerender } = render(<Banner title="Test" dismissible dismissKey="test-key" />);

    fireEvent.click(screen.getByRole('button', { name: 'Dismiss' }));
    expect(localStorage.getItem('banner-dismissed-test-key')).toBe('true');

    // Re-render should not show banner
    rerender(<Banner title="Test" dismissible dismissKey="test-key" />);
    expect(screen.queryByRole('alert')).not.toBeInTheDocument();
  });

  it('renders compact variant', () => {
    const { container } = render(<Banner title="Test" compact />);
    expect(container.firstChild).toHaveClass('p-3');
  });

  it('has no accessibility violations', async () => {
    const { container } = render(<Banner variant="info" title="Info" description="Details" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```
  </action>
  <verify>npm test -- Banner.test.js --watchAll=false</verify>
  <done>Banner with CVA variants, lucide icons, dismiss functionality, tests pass</done>
</task>

</tasks>

<verification>
- [ ] `npm test -- EmptyState.test.js --watchAll=false` passes
- [ ] `npm test -- Banner.test.js --watchAll=false` passes
- [ ] EmptyState has 3 sizes (sm, md, lg)
- [ ] Banner has 5 variants (info, warning, error, success, ember)
- [ ] Banner dismiss persists to localStorage
- [ ] Both have no accessibility violations
</verification>

<success_criteria>
EmptyState and Banner use CVA for consistent variant styling. EmptyState has size variants. Banner uses lucide icons and maintains dismissible functionality with localStorage persistence.
</success_criteria>

<output>
After completion, create `.planning/phases/14-feedback-layout-components/14-05-SUMMARY.md`
</output>
