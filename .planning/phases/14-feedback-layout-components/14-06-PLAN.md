---
phase: 14-feedback-layout-components
plan: 06
type: execute
wave: 2
depends_on:
  - 14-01
files_modified:
  - app/components/ui/PageLayout.js
  - app/components/ui/DashboardLayout.js
  - app/components/ui/__tests__/PageLayout.test.js
  - app/components/ui/__tests__/DashboardLayout.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User sees consistent page structure with PageLayout (header, content, footer)"
    - "User can toggle sidebar collapsed/expanded in DashboardLayout"
    - "Sidebar is hidden on mobile (< lg breakpoint)"
    - "Main content area adjusts margin based on sidebar state"
  artifacts:
    - path: "app/components/ui/PageLayout.js"
      provides: "PageLayout with header/content/footer slots"
      exports: ["default", "PageLayout"]
    - path: "app/components/ui/DashboardLayout.js"
      provides: "DashboardLayout with collapsible sidebar"
      exports: ["default", "DashboardLayout", "useSidebar"]
  key_links:
    - from: "app/components/ui/DashboardLayout.js"
      to: "React context"
      via: "SidebarContext for collapse state"
      pattern: "createContext.*SidebarContext"
---

<objective>
Create PageLayout and DashboardLayout components for consistent page structure.

Purpose: Provide reusable layout patterns - PageLayout for standard pages with header/content/footer, DashboardLayout for admin pages with collapsible sidebar.
Output: Two layout components with responsive behavior and consistent structure.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-feedback-layout-components/14-RESEARCH.md
@.planning/phases/14-feedback-layout-components/14-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PageLayout component</name>
  <files>app/components/ui/PageLayout.js, app/components/ui/__tests__/PageLayout.test.js</files>
  <action>
**PageLayout.js:**

1. Import dependencies:
   ```javascript
   import { cn } from '@/lib/utils/cn';
   import Heading from './Heading';
   import Text from './Text';
   ```

2. Create PageLayout component:
   ```javascript
   /**
    * PageLayout - Consistent page structure with header, content, and footer
    *
    * @example
    * <PageLayout
    *   title="Dashboard"
    *   description="Overview of your devices"
    *   actions={<Button>Add Device</Button>}
    * >
    *   {children}
    * </PageLayout>
    */
   export default function PageLayout({
     title,
     description,
     actions,
     children,
     footer,
     maxWidth = 'max-w-7xl',
     padding = 'px-4 sm:px-6 lg:px-8',
     className = '',
   }) {
     return (
       <div className={cn('min-h-screen flex flex-col', className)}>
         {/* Header */}
         {(title || description || actions) && (
           <header className={cn('py-6 sm:py-8', padding)}>
             <div className={cn('mx-auto', maxWidth)}>
               {/* Category indicator */}
               <div className="flex items-center gap-3 mb-2">
                 <div className="h-1 w-12 bg-gradient-to-r from-ember-500 to-flame-600 rounded-full" />
                 <Text variant="tertiary" size="sm" weight="medium" uppercase tracking as="span">
                   Dashboard
                 </Text>
               </div>

               {/* Title + Actions row */}
               <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-3">
                 {title && (
                   <Heading level={1} size="3xl">
                     {title}
                   </Heading>
                 )}
                 {actions && <div className="flex gap-3">{actions}</div>}
               </div>

               {/* Description */}
               {description && (
                 <Text variant="secondary" className="max-w-2xl">
                   {description}
                 </Text>
               )}
             </div>
           </header>
         )}

         {/* Main Content */}
         <main className={cn('flex-1', padding)}>
           <div className={cn('mx-auto', maxWidth)}>
             {children}
           </div>
         </main>

         {/* Footer */}
         {footer && (
           <footer className={cn('py-6', padding)}>
             <div className={cn('mx-auto', maxWidth)}>
               {footer}
             </div>
           </footer>
         )}
       </div>
     );
   }

   export { PageLayout };
   ```

**PageLayout.test.js:**

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import PageLayout from '../PageLayout';
import Button from '../Button';

describe('PageLayout', () => {
  it('renders title and description', () => {
    render(
      <PageLayout title="Dashboard" description="Overview">
        <div>Content</div>
      </PageLayout>
    );

    expect(screen.getByRole('heading', { name: 'Dashboard' })).toBeInTheDocument();
    expect(screen.getByText('Overview')).toBeInTheDocument();
  });

  it('renders actions', () => {
    render(
      <PageLayout title="Test" actions={<Button>Add</Button>}>
        <div>Content</div>
      </PageLayout>
    );

    expect(screen.getByRole('button', { name: 'Add' })).toBeInTheDocument();
  });

  it('renders main content', () => {
    render(
      <PageLayout>
        <div>Main content here</div>
      </PageLayout>
    );

    expect(screen.getByText('Main content here')).toBeInTheDocument();
  });

  it('renders footer', () => {
    render(
      <PageLayout footer={<div>Footer content</div>}>
        <div>Content</div>
      </PageLayout>
    );

    expect(screen.getByText('Footer content')).toBeInTheDocument();
  });

  it('applies maxWidth and padding classes', () => {
    const { container } = render(
      <PageLayout maxWidth="max-w-5xl" padding="px-8">
        <div>Content</div>
      </PageLayout>
    );

    expect(container.querySelector('main > div')).toHaveClass('max-w-5xl');
  });

  it('has no accessibility violations', async () => {
    const { container } = render(
      <PageLayout title="Test Page" description="Description">
        <div>Content</div>
      </PageLayout>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('renders without header when no title/description/actions', () => {
    render(
      <PageLayout>
        <div>Content only</div>
      </PageLayout>
    );

    expect(screen.queryByRole('banner')).not.toBeInTheDocument();
    expect(screen.getByText('Content only')).toBeInTheDocument();
  });
});
```
  </action>
  <verify>npm test -- PageLayout.test.js --watchAll=false</verify>
  <done>PageLayout with header, content, footer slots, responsive, accessible</done>
</task>

<task type="auto">
  <name>Task 2: Create DashboardLayout with collapsible sidebar</name>
  <files>app/components/ui/DashboardLayout.js, app/components/ui/__tests__/DashboardLayout.test.js</files>
  <action>
**DashboardLayout.js:**

1. Import dependencies:
   ```javascript
   'use client';

   import { useState, createContext, useContext } from 'react';
   import { cn } from '@/lib/utils/cn';
   import { ChevronLeft, ChevronRight, Menu, X } from 'lucide-react';
   ```

2. Create sidebar context:
   ```javascript
   const SidebarContext = createContext(null);

   export function useSidebar() {
     const context = useContext(SidebarContext);
     if (!context) {
       throw new Error('useSidebar must be used within DashboardLayout');
     }
     return context;
   }
   ```

3. Create DashboardLayout:
   ```javascript
   /**
    * DashboardLayout - Layout with collapsible sidebar
    *
    * @example
    * <DashboardLayout
    *   sidebar={<Sidebar />}
    *   defaultCollapsed={false}
    * >
    *   {children}
    * </DashboardLayout>
    */
   export default function DashboardLayout({
     children,
     sidebar,
     defaultCollapsed = false,
     className = '',
   }) {
     const [collapsed, setCollapsed] = useState(defaultCollapsed);
     const [mobileOpen, setMobileOpen] = useState(false);

     const toggle = () => setCollapsed(!collapsed);
     const toggleMobile = () => setMobileOpen(!mobileOpen);

     return (
       <SidebarContext.Provider value={{ collapsed, toggle, mobileOpen, toggleMobile }}>
         <div className={cn('flex min-h-screen', className)}>
           {/* Mobile overlay */}
           {mobileOpen && (
             <div
               className="fixed inset-0 z-40 bg-slate-950/50 backdrop-blur-sm lg:hidden"
               onClick={() => setMobileOpen(false)}
               aria-hidden="true"
             />
           )}

           {/* Sidebar */}
           <aside
             className={cn(
               'fixed left-0 top-0 h-full z-50',
               'bg-slate-900/95 [html:not(.dark)_&]:bg-white/95',
               'backdrop-blur-xl',
               'border-r border-slate-700/50 [html:not(.dark)_&]:border-slate-200',
               'transition-all duration-300 ease-out',
               // Desktop width
               collapsed ? 'w-16' : 'w-64',
               // Mobile: slide in/out
               'lg:translate-x-0',
               mobileOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0',
             )}
           >
             {sidebar}

             {/* Desktop collapse toggle */}
             <button
               onClick={toggle}
               className="hidden lg:flex absolute -right-3 top-6 p-1.5
                 rounded-full bg-slate-800 border border-slate-700 shadow-md
                 text-slate-300 hover:text-white transition-colors
                 [html:not(.dark)_&]:bg-white [html:not(.dark)_&]:border-slate-200
                 [html:not(.dark)_&]:text-slate-600 [html:not(.dark)_&]:hover:text-slate-900"
               aria-label={collapsed ? 'Expand sidebar' : 'Collapse sidebar'}
             >
               {collapsed ? <ChevronRight size={14} /> : <ChevronLeft size={14} />}
             </button>

             {/* Mobile close button */}
             <button
               onClick={() => setMobileOpen(false)}
               className="lg:hidden absolute top-4 right-4 p-2
                 rounded-lg hover:bg-white/10 transition-colors
                 text-slate-300 [html:not(.dark)_&]:text-slate-600"
               aria-label="Close sidebar"
             >
               <X size={20} />
             </button>
           </aside>

           {/* Mobile menu button */}
           <button
             onClick={() => setMobileOpen(true)}
             className="lg:hidden fixed top-4 left-4 z-40 p-2
               rounded-lg bg-slate-800/90 border border-slate-700/50
               text-slate-300 hover:text-white transition-colors
               [html:not(.dark)_&]:bg-white/90 [html:not(.dark)_&]:border-slate-200
               [html:not(.dark)_&]:text-slate-600 [html:not(.dark)_&]:hover:text-slate-900"
             aria-label="Open sidebar"
           >
             <Menu size={20} />
           </button>

           {/* Main content */}
           <main
             className={cn(
               'flex-1 transition-all duration-300',
               // Desktop margin based on sidebar state
               collapsed ? 'lg:ml-16' : 'lg:ml-64',
               // Mobile: no margin (sidebar overlays)
               'ml-0'
             )}
           >
             {children}
           </main>
         </div>
       </SidebarContext.Provider>
     );
   }

   export { DashboardLayout };
   ```

**DashboardLayout.test.js:**

```javascript
import { render, screen, fireEvent } from '@testing-library/react';
import { axe } from 'jest-axe';
import DashboardLayout, { useSidebar } from '../DashboardLayout';

// Test component to access sidebar context
function SidebarConsumer() {
  const { collapsed, toggle } = useSidebar();
  return (
    <div>
      <span data-testid="collapsed-state">{collapsed ? 'collapsed' : 'expanded'}</span>
      <button onClick={toggle}>Toggle</button>
    </div>
  );
}

describe('DashboardLayout', () => {
  it('renders sidebar and content', () => {
    render(
      <DashboardLayout sidebar={<nav>Sidebar</nav>}>
        <div>Main content</div>
      </DashboardLayout>
    );

    expect(screen.getByText('Sidebar')).toBeInTheDocument();
    expect(screen.getByText('Main content')).toBeInTheDocument();
  });

  it('starts expanded by default', () => {
    render(
      <DashboardLayout sidebar={<SidebarConsumer />}>
        <div>Content</div>
      </DashboardLayout>
    );

    expect(screen.getByTestId('collapsed-state')).toHaveTextContent('expanded');
  });

  it('starts collapsed when defaultCollapsed is true', () => {
    render(
      <DashboardLayout sidebar={<SidebarConsumer />} defaultCollapsed>
        <div>Content</div>
      </DashboardLayout>
    );

    expect(screen.getByTestId('collapsed-state')).toHaveTextContent('collapsed');
  });

  it('toggles collapsed state', () => {
    render(
      <DashboardLayout sidebar={<SidebarConsumer />}>
        <div>Content</div>
      </DashboardLayout>
    );

    expect(screen.getByTestId('collapsed-state')).toHaveTextContent('expanded');

    fireEvent.click(screen.getByRole('button', { name: 'Toggle' }));
    expect(screen.getByTestId('collapsed-state')).toHaveTextContent('collapsed');

    fireEvent.click(screen.getByRole('button', { name: 'Toggle' }));
    expect(screen.getByTestId('collapsed-state')).toHaveTextContent('expanded');
  });

  it('has collapse toggle button', () => {
    render(
      <DashboardLayout sidebar={<nav>Nav</nav>}>
        <div>Content</div>
      </DashboardLayout>
    );

    expect(screen.getByRole('button', { name: 'Collapse sidebar' })).toBeInTheDocument();
  });

  it('changes toggle label when collapsed', () => {
    render(
      <DashboardLayout sidebar={<nav>Nav</nav>} defaultCollapsed>
        <div>Content</div>
      </DashboardLayout>
    );

    expect(screen.getByRole('button', { name: 'Expand sidebar' })).toBeInTheDocument();
  });

  it('has no accessibility violations', async () => {
    const { container } = render(
      <DashboardLayout sidebar={<nav aria-label="Main navigation">Nav</nav>}>
        <div>Content</div>
      </DashboardLayout>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('throws when useSidebar is used outside provider', () => {
    const consoleError = jest.spyOn(console, 'error').mockImplementation(() => {});

    expect(() => {
      render(<SidebarConsumer />);
    }).toThrow('useSidebar must be used within DashboardLayout');

    consoleError.mockRestore();
  });
});
```
  </action>
  <verify>npm test -- DashboardLayout.test.js --watchAll=false</verify>
  <done>DashboardLayout with collapsible sidebar, mobile drawer, context hook, accessible</done>
</task>

<task type="auto">
  <name>Task 3: Export layout components</name>
  <files>app/components/ui/index.js</files>
  <action>
Add to index.js exports:

```javascript
// Layout components
export { default as PageLayout } from './PageLayout';
export { default as DashboardLayout, useSidebar } from './DashboardLayout';
```
  </action>
  <verify>Components export from index.js without errors</verify>
  <done>PageLayout and DashboardLayout exported from index.js</done>
</task>

</tasks>

<verification>
- [ ] `npm test -- PageLayout.test.js --watchAll=false` passes
- [ ] `npm test -- DashboardLayout.test.js --watchAll=false` passes
- [ ] PageLayout renders header with title, description, actions
- [ ] DashboardLayout sidebar collapses on toggle
- [ ] DashboardLayout sidebar hidden on mobile by default
- [ ] useSidebar hook provides collapse state
- [ ] Both exported from index.js
</verification>

<success_criteria>
PageLayout provides consistent header/content/footer structure. DashboardLayout provides collapsible sidebar with mobile drawer. Both are accessible and responsive.
</success_criteria>

<output>
After completion, create `.planning/phases/14-feedback-layout-components/14-06-SUMMARY.md`
</output>
