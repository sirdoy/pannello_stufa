---
phase: 14-feedback-layout-components
plan: 07
type: execute
wave: 2
depends_on:
  - 14-01
files_modified:
  - app/components/ui/Section.js
  - app/components/ui/Grid.js
  - app/components/ui/__tests__/Section.test.js
  - app/components/ui/__tests__/Grid.test.js
autonomous: true

must_haves:
  truths:
    - "User sees Section with consistent spacing (sm, md, lg sizes)"
    - "User sees Grid with responsive column counts"
    - "Grid adapts to all Tailwind breakpoints (sm, md, lg, xl, 2xl)"
    - "Section title has consistent styling with ember accent"
  artifacts:
    - path: "app/components/ui/Section.js"
      provides: "Section with CVA spacing variants"
      exports: ["default", "Section", "sectionVariants"]
    - path: "app/components/ui/Grid.js"
      provides: "Grid with CVA gap variants"
      exports: ["default", "Grid", "gridVariants"]
  key_links:
    - from: "app/components/ui/Section.js"
      to: "class-variance-authority"
      via: "CVA for spacing variants"
      pattern: "import.*cva"
    - from: "app/components/ui/Grid.js"
      to: "class-variance-authority"
      via: "CVA for gap variants"
      pattern: "import.*cva"
---

<objective>
Enhance Section and Grid components with CVA variants for consistent spacing and responsive behavior.

Purpose: Standardize Section spacing with predefined sizes and fix Grid responsive column handling with proper CVA patterns.
Output: Section with sm/md/lg spacing, Grid with responsive columns and gap variants.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-feedback-layout-components/14-CONTEXT.md
@app/components/ui/Section.js
@app/components/ui/Grid.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Section with CVA spacing variants</name>
  <files>app/components/ui/Section.js, app/components/ui/__tests__/Section.test.js</files>
  <action>
**Section.js:**

Refactor with CVA spacing variants:

1. Import dependencies:
   ```javascript
   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   import Heading from './Heading';
   import Text from './Text';
   ```

2. Create CVA variants:
   ```javascript
   export const sectionVariants = cva(
     '',
     {
       variants: {
         spacing: {
           none: '',
           sm: 'py-4 sm:py-6',
           md: 'py-6 sm:py-8 lg:py-10',
           lg: 'py-8 sm:py-12 lg:py-16',
         },
       },
       defaultVariants: { spacing: 'md' },
     }
   );

   const headerSpacingMap = {
     none: 'mb-2',
     sm: 'mb-3 sm:mb-4',
     md: 'mb-4 sm:mb-6',
     lg: 'mb-6 sm:mb-8',
   };
   ```

3. Update component:
   ```javascript
   /**
    * Section Component - Ember Noir Design System
    *
    * Semantic wrapper for page sections with optional title, description, and action.
    *
    * @example
    * <Section
    *   title="I tuoi dispositivi"
    *   description="Controlla e monitora tutti i dispositivi"
    *   spacing="lg"
    *   action={<Button>Azione</Button>}
    * >
    *   {children}
    * </Section>
    */
   export default function Section({
     title,
     subtitle,
     description,
     spacing = 'md',
     action,
     children,
     as: Component = 'section',
     className = '',
   }) {
     const hasHeader = title || subtitle || description || action;

     return (
       <Component className={cn(sectionVariants({ spacing }), className)}>
         {/* Header with title, description, action */}
         {hasHeader && (
           <div className={headerSpacingMap[spacing]}>
             {/* Category indicator + subtitle */}
             {(subtitle || title) && (
               <div className="flex items-center gap-3 mb-2">
                 <div className="h-1 w-12 bg-gradient-to-r from-ember-500 to-flame-600 rounded-full" />
                 {subtitle && (
                   <Text variant="tertiary" size="sm" weight="medium" uppercase tracking as="span">
                     {subtitle}
                   </Text>
                 )}
               </div>
             )}

             {/* Title + Actions row */}
             {(title || action) && (
               <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-2">
                 {title && (
                   <Heading level={2} size="2xl">
                     {title}
                   </Heading>
                 )}
                 {action && <div className="flex-shrink-0">{action}</div>}
               </div>
             )}

             {/* Description */}
             {description && (
               <Text variant="secondary" className="max-w-2xl">
                 {description}
               </Text>
             )}
           </div>
         )}

         {/* Content */}
         {children}
       </Component>
     );
   }

   export { Section };
   ```

**Section.test.js:**

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import Section from '../Section';
import Button from '../Button';

describe('Section', () => {
  it('renders children', () => {
    render(
      <Section>
        <div>Content</div>
      </Section>
    );
    expect(screen.getByText('Content')).toBeInTheDocument();
  });

  it('renders title and description', () => {
    render(
      <Section title="Section Title" description="Section description">
        <div>Content</div>
      </Section>
    );
    expect(screen.getByRole('heading', { name: 'Section Title' })).toBeInTheDocument();
    expect(screen.getByText('Section description')).toBeInTheDocument();
  });

  it('renders subtitle', () => {
    render(
      <Section subtitle="Category" title="Title">
        <div>Content</div>
      </Section>
    );
    expect(screen.getByText('Category')).toBeInTheDocument();
  });

  it('renders action', () => {
    render(
      <Section title="Title" action={<Button>Action</Button>}>
        <div>Content</div>
      </Section>
    );
    expect(screen.getByRole('button', { name: 'Action' })).toBeInTheDocument();
  });

  it('applies spacing variants', () => {
    const { container, rerender } = render(
      <Section spacing="sm">
        <div>Content</div>
      </Section>
    );
    expect(container.firstChild).toHaveClass('py-4');

    rerender(
      <Section spacing="lg">
        <div>Content</div>
      </Section>
    );
    expect(container.firstChild).toHaveClass('py-8');
  });

  it('renders as different element', () => {
    render(
      <Section as="div" data-testid="section">
        <div>Content</div>
      </Section>
    );
    expect(screen.getByTestId('section').tagName).toBe('DIV');
  });

  it('renders ember accent bar', () => {
    const { container } = render(
      <Section title="Title">
        <div>Content</div>
      </Section>
    );
    expect(container.querySelector('.from-ember-500')).toBeInTheDocument();
  });

  it('has no accessibility violations', async () => {
    const { container } = render(
      <Section title="Accessible Section" description="Description">
        <div>Content</div>
      </Section>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('does not render header when no title/description/action', () => {
    const { container } = render(
      <Section>
        <div>Content only</div>
      </Section>
    );
    // No header elements
    expect(container.querySelector('.from-ember-500')).not.toBeInTheDocument();
  });
});
```
  </action>
  <verify>npm test -- Section.test.js --watchAll=false</verify>
  <done>Section with CVA spacing variants (sm, md, lg), ember accent, subtitle support</done>
</task>

<task type="auto">
  <name>Task 2: Enhance Grid with CVA and proper responsive columns</name>
  <files>app/components/ui/Grid.js, app/components/ui/__tests__/Grid.test.js</files>
  <action>
**Grid.js:**

Refactor with CVA and fix responsive column handling:

1. Import dependencies:
   ```javascript
   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   ```

2. Create CVA variants:
   ```javascript
   export const gridVariants = cva(
     'grid',
     {
       variants: {
         gap: {
           none: 'gap-0',
           sm: 'gap-3 sm:gap-4',
           md: 'gap-4 sm:gap-5 lg:gap-6',
           lg: 'gap-6 sm:gap-8 lg:gap-10',
         },
         cols: {
           1: 'grid-cols-1',
           2: 'grid-cols-1 sm:grid-cols-2',
           3: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
           4: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4',
           5: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5',
           6: 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6',
         },
       },
       defaultVariants: {
         gap: 'md',
         cols: 3,
       },
     }
   );
   ```

3. Update component:
   ```javascript
   /**
    * Grid Component - Responsive grid system
    *
    * Simplified API with predefined responsive column patterns.
    * Use cols prop for auto-responsive, or pass custom className for full control.
    *
    * @example
    * // Simple: auto-responsive 3 columns
    * <Grid cols={3}>{items}</Grid>
    *
    * // Custom: manual breakpoint control
    * <Grid className="grid-cols-1 md:grid-cols-2 xl:grid-cols-4">{items}</Grid>
    */
   export default function Grid({
     cols = 3,
     gap = 'md',
     children,
     className = '',
     as: Component = 'div',
   }) {
     return (
       <Component className={cn(gridVariants({ cols, gap }), className)}>
         {children}
       </Component>
     );
   }

   export { Grid };
   ```

**Grid.test.js:**

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import Grid from '../Grid';

describe('Grid', () => {
  it('renders children', () => {
    render(
      <Grid>
        <div>Item 1</div>
        <div>Item 2</div>
      </Grid>
    );
    expect(screen.getByText('Item 1')).toBeInTheDocument();
    expect(screen.getByText('Item 2')).toBeInTheDocument();
  });

  it('applies cols variants', () => {
    const { container, rerender } = render(
      <Grid cols={2}>
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('sm:grid-cols-2');

    rerender(
      <Grid cols={4}>
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('xl:grid-cols-4');
  });

  it('applies gap variants', () => {
    const { container, rerender } = render(
      <Grid gap="sm">
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('gap-3');

    rerender(
      <Grid gap="lg">
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('gap-6');
  });

  it('allows custom className to override', () => {
    const { container } = render(
      <Grid className="grid-cols-5">
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('grid-cols-5');
  });

  it('renders as different element', () => {
    render(
      <Grid as="ul" data-testid="grid">
        <li>Item 1</li>
        <li>Item 2</li>
      </Grid>
    );
    expect(screen.getByTestId('grid').tagName).toBe('UL');
  });

  it('has grid class', () => {
    const { container } = render(
      <Grid>
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('grid');
  });

  it('has no accessibility violations', async () => {
    const { container } = render(
      <Grid>
        <div>Item 1</div>
        <div>Item 2</div>
        <div>Item 3</div>
      </Grid>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('defaults to 3 cols and md gap', () => {
    const { container } = render(
      <Grid>
        <div>Item</div>
      </Grid>
    );
    expect(container.firstChild).toHaveClass('lg:grid-cols-3');
    expect(container.firstChild).toHaveClass('gap-4');
  });
});
```
  </action>
  <verify>npm test -- Grid.test.js --watchAll=false</verify>
  <done>Grid with CVA cols/gap variants, proper responsive breakpoints, accessible</done>
</task>

</tasks>

<verification>
- [ ] `npm test -- Section.test.js --watchAll=false` passes
- [ ] `npm test -- Grid.test.js --watchAll=false` passes
- [ ] Section has 3 spacing sizes (sm, md, lg)
- [ ] Section shows ember accent bar with title
- [ ] Grid has 6 column options (1-6)
- [ ] Grid has responsive breakpoints (sm, md, lg, xl, 2xl)
- [ ] Grid has 4 gap options (none, sm, md, lg)
</verification>

<success_criteria>
Section uses CVA for consistent spacing with ember accent styling. Grid uses CVA with predefined responsive column patterns. Both components are flexible and accessible.
</success_criteria>

<output>
After completion, create `.planning/phases/14-feedback-layout-components/14-07-SUMMARY.md`
</output>
