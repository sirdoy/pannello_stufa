---
phase: 15-smart-home-components
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/ConnectionStatus.js
  - app/components/ui/__tests__/ConnectionStatus.test.js
  - app/components/ui/HealthIndicator.js
  - app/components/ui/__tests__/HealthIndicator.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User sees device connection state with icon and text label"
    - "User sees health status with appropriate severity icon and color"
    - "Screen readers announce status changes via aria-live regions"
  artifacts:
    - path: "app/components/ui/ConnectionStatus.js"
      provides: "Connection state display (online/offline/connecting/unknown)"
      exports: ["ConnectionStatus", "connectionStatusVariants"]
    - path: "app/components/ui/HealthIndicator.js"
      provides: "Health status display (ok/warning/error/critical)"
      exports: ["HealthIndicator", "healthIndicatorVariants"]
  key_links:
    - from: "app/components/ui/HealthIndicator.js"
      to: "lucide-react"
      via: "status icons"
      pattern: "lucide-react"
---

<objective>
Create ConnectionStatus and HealthIndicator components for unified device state display.

Purpose: Provide consistent status visualization components that can be used across all smart home devices for connection state and health monitoring.
Output: ConnectionStatus and HealthIndicator components with CVA variants, proper accessibility, and lucide-react icons.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-smart-home-components/15-CONTEXT.md
@.planning/phases/15-smart-home-components/15-RESEARCH.md
@lib/utils/cn.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConnectionStatus component</name>
  <files>
    app/components/ui/ConnectionStatus.js
    app/components/ui/__tests__/ConnectionStatus.test.js
  </files>
  <action>
Create `app/components/ui/ConnectionStatus.js`:

1. CVA configuration (`connectionStatusVariants`):
   - Base: inline-flex items-center gap-2, font-display font-medium
   - Variants:
     - `status`: online (sage), offline (slate), connecting (warning), unknown (slate muted)
     - `size`: sm (text-xs), md (text-sm), lg (text-base)

2. Separate CVA for dot (`dotVariants`):
   - Base: rounded-full
   - Variants:
     - `status`: online (bg-sage-500), offline (bg-slate-500), connecting (bg-warning-500 animate-pulse), unknown (bg-slate-400)
     - `size`: sm (w-1.5 h-1.5), md (w-2 h-2), lg (w-2.5 h-2.5)

3. Status labels (Italian):
   - online: "Online"
   - offline: "Offline"
   - connecting: "Connessione..."
   - unknown: "Sconosciuto"

4. Props:
   - `status`: 'online' | 'offline' | 'connecting' | 'unknown' (default: 'unknown')
   - `size`: 'sm' | 'md' | 'lg' (default: 'md')
   - `label`: Override default label text
   - `showDot`: Show status dot (default: true)
   - `className`: Additional classes
   - Forward ref support

5. Accessibility:
   - `role="status"` for live region
   - `aria-live="polite"` to announce changes to screen readers
   - Dot has `aria-hidden="true"`

6. Light mode support: Each color with `[html:not(.dark)_&]:` override

7. Exports: `ConnectionStatus`, `connectionStatusVariants`

Create `app/components/ui/__tests__/ConnectionStatus.test.js`:
- Accessibility: no a11y violations
- Renders correct label for each status
- Shows dot by default
- Hides dot when showDot=false
- Applies connecting animation class (animate-pulse)
- Supports custom label override
- Has role="status" and aria-live="polite"
  </action>
  <verify>npm test -- --testPathPattern="ConnectionStatus" --passWithNoTests</verify>
  <done>ConnectionStatus component created with 4 states, accessibility attributes, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Create HealthIndicator component</name>
  <files>
    app/components/ui/HealthIndicator.js
    app/components/ui/__tests__/HealthIndicator.test.js
  </files>
  <action>
Create `app/components/ui/HealthIndicator.js`:

1. CVA configuration (`healthIndicatorVariants`):
   - Base: inline-flex items-center gap-2, font-display font-medium
   - Variants:
     - `status`: ok (sage), warning (warning), error (danger), critical (danger darker)
     - `size`: sm (text-xs), md (text-sm), lg (text-base)

2. Icon mapping (lucide-react):
   - ok: CheckCircle2
   - warning: AlertTriangle
   - error: XCircle
   - critical: AlertOctagon

3. Icon sizes:
   - sm: 14
   - md: 16
   - lg: 20

4. Status labels (Italian):
   - ok: "OK"
   - warning: "Attenzione"
   - error: "Errore"
   - critical: "Critico"

5. Props:
   - `status`: 'ok' | 'warning' | 'error' | 'critical' (default: 'ok')
   - `size`: 'sm' | 'md' | 'lg' (default: 'md')
   - `label`: Override default label text
   - `showIcon`: Show status icon (default: true)
   - `pulse`: Enable pulse animation for critical states (default: false)
   - `className`: Additional classes
   - Forward ref support

6. Accessibility:
   - `role="status"` for live region
   - `aria-live="polite"` to announce changes
   - Icon has `aria-hidden="true"`

7. Colors (Ember Noir):
   - ok: text-sage-400, light mode: text-sage-600
   - warning: text-warning-400, light mode: text-warning-600
   - error: text-danger-400, light mode: text-danger-600
   - critical: text-danger-500, light mode: text-danger-700

8. Exports: `HealthIndicator`, `healthIndicatorVariants`

Create `app/components/ui/__tests__/HealthIndicator.test.js`:
- Accessibility: no a11y violations
- Renders correct label for each status
- Shows correct icon for each status
- Hides icon when showIcon=false
- Applies pulse animation when pulse=true
- Supports custom label override
- Has role="status" and aria-live="polite"
  </action>
  <verify>npm test -- --testPathPattern="HealthIndicator" --passWithNoTests</verify>
  <done>HealthIndicator component created with 4 states, lucide icons, tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Export components from UI index</name>
  <files>
    app/components/ui/index.js
  </files>
  <action>
Update `app/components/ui/index.js` to export new components:

1. Add imports:
   ```javascript
   import ConnectionStatus, { connectionStatusVariants } from './ConnectionStatus';
   import HealthIndicator, { healthIndicatorVariants } from './HealthIndicator';
   ```

2. Add to exports object:
   ```javascript
   ConnectionStatus,
   connectionStatusVariants,
   HealthIndicator,
   healthIndicatorVariants,
   ```

This makes both components available via `@/app/components/ui` imports.
  </action>
  <verify>grep -q "ConnectionStatus" app/components/ui/index.js && grep -q "HealthIndicator" app/components/ui/index.js && echo "Both exported"</verify>
  <done>ConnectionStatus and HealthIndicator exported from index.js</done>
</task>

</tasks>

<verification>
1. Run tests: `npm test -- --testPathPattern="(ConnectionStatus|HealthIndicator)"`
2. Verify CVA exports: Check that variants are exported from both files
3. Verify index exports: Check both components in index.js
</verification>

<success_criteria>
- ConnectionStatus has 4 status states (online/offline/connecting/unknown)
- HealthIndicator has 4 status states (ok/warning/error/critical)
- Both use CVA with exported variants
- Both have proper accessibility (role="status", aria-live="polite")
- HealthIndicator uses lucide-react icons
- ConnectionStatus shows dot + text label
- All tests pass including accessibility
- Both exported from index.js
</success_criteria>

<output>
After completion, create `.planning/phases/15-smart-home-components/15-03-SUMMARY.md`
</output>
