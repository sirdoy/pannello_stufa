---
phase: 15-smart-home-components
plan: 04
type: execute
wave: 2
depends_on: ["15-02", "15-03"]
files_modified:
  - app/components/ui/SmartHomeCard.js
  - app/components/ui/__tests__/SmartHomeCard.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "Smart home cards have consistent structure with header, status, and controls areas"
    - "Cards support compact and default size variants for dashboard vs full view"
    - "Cards display loading, error, and disabled states uniformly"
  artifacts:
    - path: "app/components/ui/SmartHomeCard.js"
      provides: "Base component for smart home device cards"
      exports: ["SmartHomeCard", "smartHomeCardVariants", "SmartHomeCardHeader", "SmartHomeCardStatus", "SmartHomeCardControls"]
  key_links:
    - from: "app/components/ui/SmartHomeCard.js"
      to: "app/components/ui/Card.js"
      via: "composition (uses Card internally)"
      pattern: "import Card"
    - from: "app/components/ui/SmartHomeCard.js"
      to: "app/components/ui/CardAccentBar.js"
      via: "accent bar for theming"
      pattern: "CardAccentBar"
---

<objective>
Create SmartHomeCard base component that StatusCard and DeviceCard will extend.

Purpose: Establish a shared foundation for all smart home device cards with consistent structure, styling, and state handling. This reduces code duplication and ensures uniform UX.
Output: SmartHomeCard.js with namespace sub-components (Header, Status, Controls) and CVA variants.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-smart-home-components/15-CONTEXT.md
@.planning/phases/15-smart-home-components/15-RESEARCH.md
@app/components/ui/Card.js
@app/components/ui/CardAccentBar.js
@app/components/ui/DeviceCard.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SmartHomeCard base component with CVA</name>
  <files>
    app/components/ui/SmartHomeCard.js
    app/components/ui/__tests__/SmartHomeCard.test.js
  </files>
  <action>
Create `app/components/ui/SmartHomeCard.js`:

1. CVA configuration (`smartHomeCardVariants`):
   - Base: overflow-visible, transition-all duration-500, relative
   - Variants:
     - `size`: compact (p-3 sm:p-4), default (p-5 sm:p-6) - as per CONTEXT decision
     - `colorTheme`: ember, ocean, sage, warning, danger (for CardAccentBar)

2. Main component props:
   - `children`: Main content
   - `className`: Additional classes
   - `icon`: Device icon (ReactNode, e.g., emoji or lucide icon)
   - `title`: Card title string
   - `size`: 'compact' | 'default' (default: 'default')
   - `colorTheme`: Color for accent bar (default: 'ember')
   - `isLoading`: Show loading state (default: false)
   - `error`: Show error state (default: false)
   - `errorMessage`: Error message to display
   - `disabled`: Disabled state with opacity (default: false)
   - Forward ref support

3. Component structure:
   ```jsx
   <Card variant="elevated" padding={false} className={cn(variants, disabled && 'opacity-50 pointer-events-none', className)}>
     <CardAccentBar colorTheme={colorTheme} animated={!disabled} size="md" />
     <div className={cn(size === 'compact' ? 'p-3 sm:p-4' : 'p-5 sm:p-6')}>
       {/* Header with icon + title (only if provided) */}
       {(icon || title) && (
         <SmartHomeCard.Header>
           {icon && <span className="text-2xl sm:text-3xl">{icon}</span>}
           {title && <Heading level={2} size={size === 'compact' ? 'md' : 'xl'}>{title}</Heading>}
         </SmartHomeCard.Header>
       )}
       {/* Error state */}
       {error && errorMessage && (
         <Banner variant="error" className="mb-4">{errorMessage}</Banner>
       )}
       {/* Loading overlay */}
       {isLoading && <div className="absolute inset-0 bg-slate-900/50 flex items-center justify-center rounded-2xl z-10">
         <Spinner />
       </div>}
       {/* Children */}
       {children}
     </div>
   </Card>
   ```

4. Sub-components (namespace pattern):
   - `SmartHomeCardHeader`: flex items-center gap-3 mb-4
   - `SmartHomeCardStatus`: mb-4 (for badges, connection status)
   - `SmartHomeCardControls`: space-y-3 (for buttons, sliders)

5. Attach namespace:
   ```javascript
   SmartHomeCard.Header = SmartHomeCardHeader;
   SmartHomeCard.Status = SmartHomeCardStatus;
   SmartHomeCard.Controls = SmartHomeCardControls;
   ```

6. Exports:
   - Named: SmartHomeCard, smartHomeCardVariants, SmartHomeCardHeader, SmartHomeCardStatus, SmartHomeCardControls
   - Default: SmartHomeCard

Create `app/components/ui/__tests__/SmartHomeCard.test.js`:
- Accessibility: no a11y violations
- Renders children content
- Renders icon and title in header when provided
- Applies compact size classes (p-3)
- Applies default size classes (p-5)
- Shows error banner when error=true and errorMessage provided
- Applies disabled opacity when disabled=true
- Renders loading spinner when isLoading=true
- Sub-components render correctly (Header, Status, Controls)
- Forwards ref to Card
  </action>
  <verify>npm test -- --testPathPattern="SmartHomeCard" --passWithNoTests</verify>
  <done>SmartHomeCard base component created with namespace pattern, CVA variants, and state handling</done>
</task>

<task type="auto">
  <name>Task 2: Export SmartHomeCard from UI index</name>
  <files>
    app/components/ui/index.js
  </files>
  <action>
Update `app/components/ui/index.js` to export SmartHomeCard:

1. Add import:
   ```javascript
   import SmartHomeCard, { smartHomeCardVariants, SmartHomeCardHeader, SmartHomeCardStatus, SmartHomeCardControls } from './SmartHomeCard';
   ```

2. Add to exports object:
   ```javascript
   SmartHomeCard,
   smartHomeCardVariants,
   SmartHomeCardHeader,
   SmartHomeCardStatus,
   SmartHomeCardControls,
   ```

This makes SmartHomeCard and sub-components available via `@/app/components/ui` imports.
  </action>
  <verify>grep -q "SmartHomeCard" app/components/ui/index.js && echo "SmartHomeCard exported"</verify>
  <done>SmartHomeCard and sub-components exported from index.js</done>
</task>

</tasks>

<verification>
1. Run tests: `npm test -- --testPathPattern="SmartHomeCard"`
2. Verify CVA exports: Check smartHomeCardVariants is exported
3. Verify namespace: Check SmartHomeCard.Header, .Status, .Controls exist
4. Verify index exports: Check all exports in index.js
</verification>

<success_criteria>
- SmartHomeCard uses Card internally (composition pattern)
- CVA with size (compact/default) and colorTheme variants
- Namespace sub-components: Header, Status, Controls
- Unified state handling: isLoading, error, errorMessage, disabled
- CardAccentBar for theming
- All tests pass including accessibility
- Exported from index.js
</success_criteria>

<output>
After completion, create `.planning/phases/15-smart-home-components/15-04-SUMMARY.md`
</output>
