---
phase: 15-smart-home-components
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/devices/lights/LightsCard.js
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Brightness +/- buttons support long-press for continuous adjustment"
    - "Long-press triggers haptic feedback during value changes"
    - "Brightness changes incrementally while button is held"
  artifacts:
    - path: "app/components/devices/lights/LightsCard.js"
      provides: "Lights control card with ControlButton"
      contains: "ControlButton"
  key_links:
    - from: "app/components/devices/lights/LightsCard.js"
      to: "app/components/ui/ControlButton.js"
      via: "ControlButton import"
      pattern: "import.*ControlButton"
---

<objective>
Replace brightness Button controls with ControlButton for long-press support.

Purpose: LightsCard currently uses Button with onClick for brightness +/- controls, but ControlButton (created in 15-01) provides long-press continuous adjustment with haptic feedback. This is the intended UX for increment/decrement controls.

Output: Brightness controls support long-press for continuous value adjustment.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-smart-home-components/15-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import ControlButton in LightsCard</name>
  <files>app/components/devices/lights/LightsCard.js</files>
  <action>
  Add ControlButton import at top of file with other UI imports.

  Find existing imports like:
  ```jsx
  import { Button, Card, ... } from '@/app/components/ui';
  ```

  Add ControlButton to the import statement:
  ```jsx
  import { Button, Card, ControlButton, ... } from '@/app/components/ui';
  ```
  </action>
  <verify>File saves without import errors</verify>
  <done>ControlButton is imported from ui components</done>
</task>

<task type="auto">
  <name>Task 2: Replace brightness +/- Buttons with ControlButtons</name>
  <files>app/components/devices/lights/LightsCard.js</files>
  <action>
  Find the brightness +/- buttons (around lines 1095-1121).

  Current code:
  ```jsx
  <div className="flex items-center gap-2">
    <Button
      variant={adaptive.buttonVariant || 'subtle'}
      size="sm"
      icon="➖"
      onClick={() => {
        const newValue = Math.max(1, avgBrightness - 5);
        handleBrightnessChange(selectedRoomGroupedLightId, newValue.toString());
      }}
      disabled={refreshing || avgBrightness <= 1 || !selectedRoomGroupedLightId}
      className={`flex-1 font-display ${adaptive.buttonClass}`}
    >
      -5%
    </Button>
    <Button
      variant={adaptive.buttonVariant || 'subtle'}
      size="sm"
      icon="➕"
      onClick={() => {
        const newValue = Math.min(100, avgBrightness + 5);
        handleBrightnessChange(selectedRoomGroupedLightId, newValue.toString());
      }}
      disabled={refreshing || avgBrightness >= 100 || !selectedRoomGroupedLightId}
      className={`flex-1 font-display ${adaptive.buttonClass}`}
    >
      +5%
    </Button>
  </div>
  ```

  Replace with:
  ```jsx
  <div className="flex items-center gap-2">
    <ControlButton
      type="decrement"
      variant={adaptive.buttonVariant || 'subtle'}
      size="sm"
      step={5}
      onChange={(delta) => {
        const newValue = Math.max(1, avgBrightness + delta);
        handleBrightnessChange(selectedRoomGroupedLightId, newValue.toString());
      }}
      disabled={refreshing || avgBrightness <= 1 || !selectedRoomGroupedLightId}
      className={`flex-1 ${adaptive.buttonClass}`}
    />
    <ControlButton
      type="increment"
      variant={adaptive.buttonVariant || 'subtle'}
      size="sm"
      step={5}
      onChange={(delta) => {
        const newValue = Math.min(100, avgBrightness + delta);
        handleBrightnessChange(selectedRoomGroupedLightId, newValue.toString());
      }}
      disabled={refreshing || avgBrightness >= 100 || !selectedRoomGroupedLightId}
      className={`flex-1 ${adaptive.buttonClass}`}
    />
  </div>
  ```

  Key changes:
  - ControlButton instead of Button
  - type="decrement" / type="increment" instead of icon prop
  - onChange(delta) instead of onClick (delta is -5 or +5)
  - step={5} matches original 5% increment
  - Remove children text (ControlButton displays + or - symbol)
  - Remove icon prop (ControlButton has built-in symbols)
  - Remove font-display from className (ControlButton has it built-in via CVA)
  </action>
  <verify>
  Run `npm run dev` and navigate to lights page or home with lights card.
  Test:
  1. Single tap changes brightness by 5%
  2. Long-press continuously changes brightness
  3. Disabled state works correctly at min/max values
  </verify>
  <done>
  Brightness controls use ControlButton with long-press support and haptic feedback
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. LightsCard renders brightness controls
3. Single tap on +/- changes brightness by 5%
4. Long-press on +/- continuously adjusts brightness
5. Controls respect disabled state at boundaries (1% min, 100% max)
</verification>

<success_criteria>
- ControlButton imported and used for brightness controls
- Long-press triggers continuous brightness adjustment
- Haptic feedback on value changes (mobile)
- Disabled state works at min/max brightness
</success_criteria>

<rollback>
If ControlButton causes issues, revert to original Button implementation.
Keep ControlButton import for future use.
</rollback>

<output>
After completion, create `.planning/phases/15-smart-home-components/15-08-SUMMARY.md`
</output>
