---
phase: 16-page-migration
plan: 03
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - app/thermostat/page.js
autonomous: true

must_haves:
  truths:
    - "Thermostat page renders with design system components"
    - "Mode buttons use Button component with appropriate variants"
    - "Layout uses Grid component for responsive behavior"
    - "Page passes jest-axe accessibility tests"
  artifacts:
    - path: "app/thermostat/page.js"
      provides: "Thermostat control page with design system"
      contains: "Button variant"
  key_links:
    - from: "app/thermostat/page.js"
      to: "app/components/ui"
      via: "imports"
      pattern: "from.*components/ui"
---

<objective>
Migrate Thermostat page mode buttons and layout to design system

Purpose: Replace custom mode button styling with Button variants for consistent interaction patterns
Output: Thermostat page using Button variants for mode selection, Grid for layouts
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-page-migration/16-CONTEXT.md
@.planning/phases/16-page-migration/16-RESEARCH.md
@app/thermostat/page.js
@app/components/ui/Button.js
@app/components/ui/Grid.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate mode buttons to Button component</name>
  <files>app/thermostat/page.js</files>
  <action>
Replace custom getModeButtonClasses function with Button component variants.

**Current implementation (lines ~316-330):**
```javascript
const getModeButtonClasses = (currentMode, targetMode) => {
  const baseClasses = 'px-4 py-2.5 rounded-xl text-sm font-semibold...';
  const activeStyles = {
    schedule: 'bg-sage-500/20 text-sage-300 border border-sage-500/40...',
    away: 'bg-warning-500/20 text-warning-300 border border-warning-500/40...',
    hg: 'bg-ocean-500/20 text-ocean-300 border border-ocean-500/40...',
    off: 'bg-slate-500/20 text-slate-300 border border-slate-500/40...',
  };
  // ...
};
```

**New implementation:**
```javascript
// Map mode to Button variant
const modeVariants = {
  schedule: 'sage',
  away: 'warning',
  hg: 'ocean',
  off: 'subtle',
};

const modeLabels = {
  schedule: 'Programmato',
  away: 'Assenza',
  hg: 'Antigelo',
  off: 'Off',
};

const modeIcons = {
  schedule: '‚è∞',
  away: 'üèÉ',
  hg: '‚ùÑÔ∏è',
  off: '‚è∏Ô∏è',
};

// In render:
<div className="flex flex-wrap gap-2">
  {['schedule', 'away', 'hg', 'off'].map((targetMode) => (
    <Button
      key={targetMode}
      variant={mode === targetMode ? modeVariants[targetMode] : 'ghost'}
      onClick={() => handleModeChange(targetMode)}
      size="sm"
    >
      <span>{modeIcons[targetMode]}</span>
      <span>{modeLabels[targetMode]}</span>
    </Button>
  ))}
</div>
```

**Note:** Check if Button supports 'warning' and 'sage' variants. If not, use closest available:
- sage -> 'success' or custom
- warning -> 'warning' if exists, else 'subtle'
- ocean -> 'ocean' if exists, else 'outline'

Verify Button variants in app/components/ui/Button.js first.

Remove getModeButtonClasses function after migration.
  </action>
  <verify>
- Manually test mode switching at localhost:3000/thermostat
- Verify active/inactive states visually
- Test keyboard navigation (Tab between buttons)
  </verify>
  <done>Mode buttons use Button component with appropriate variants, getModeButtonClasses removed</done>
</task>

<task type="auto">
  <name>Task 2: Migrate layout classes to Grid component</name>
  <files>app/thermostat/page.js</files>
  <action>
Replace manual grid classes with Grid component:

**Lines to update:**

1. **Topology info grid (line ~445):**
   ```javascript
   // BEFORE
   <div className="grid grid-cols-1 md:grid-cols-3 gap-4">

   // AFTER
   <Grid cols={3} gap="md">
   ```

2. **Rooms grid (line ~486):**
   ```javascript
   // BEFORE
   <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

   // AFTER
   <Grid cols={3} gap="lg">
   ```

**Add import:**
```javascript
import { Grid } from '@/app/components/ui';
```

**Verify Grid behavior:**
- cols={3} should auto-respond (1 col mobile, 2 col md, 3 col lg)
- gap="md" = gap-4, gap="lg" = gap-6
  </action>
  <verify>
- Test responsive behavior at different viewport sizes
- Verify grid items align correctly
  </verify>
  <done>Layout uses Grid component for consistent responsive behavior</done>
</task>

<task type="auto">
  <name>Task 3: Clean up remaining inline styles</name>
  <files>app/thermostat/page.js</files>
  <action>
Review and clean up any remaining inline styles:

1. **Page wrapper (line ~333):**
   ```javascript
   // BEFORE
   <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

   // CONSIDER: Could use PageLayout if it provides this pattern
   // For now, leave as-is if PageLayout doesn't fit thermostat's structure
   ```

2. **Info boxes in topology card (lines ~446-463):**
   ```javascript
   // BEFORE
   <div className="p-3 rounded-xl bg-slate-800/40 backdrop-blur-sm [html:not(.dark)_&]:bg-slate-100/60">

   // These are styled info boxes - could become a small component
   // For now, verify they use design tokens (slate-800/40 is valid)
   ```

3. **Verify all Text components:**
   - Replace any `<p className="text-slate-400">` with `<Text variant="secondary">`
   - Replace any `<span className="text-xs font-bold">` with `<Text size="xs" weight="bold">`

4. **Ensure consistent Card usage:**
   - All card-like containers use Card component
   - Card variant="glass" for transparent/blur effect
  </action>
  <verify>
- npm test -- --testPathPattern="thermostat" --passWithNoTests
- Manual visual inspection for consistency
  </verify>
  <done>Thermostat page uses design system components consistently, minimal inline styles</done>
</task>

</tasks>

<verification>
1. Thermostat page loads at localhost:3000/thermostat
2. Mode buttons switch correctly and show active state
3. Responsive grid works at all breakpoints
4. RoomCard components display correctly in grid
5. No console errors
6. Keyboard navigation works for mode buttons
</verification>

<success_criteria>
- getModeButtonClasses function removed
- Mode buttons use Button component
- Grid component used for layouts
- Consistent Card, Heading, Text usage
- Page passes manual a11y check (keyboard navigation)
</success_criteria>

<output>
After completion, create `.planning/phases/16-page-migration/16-03-SUMMARY.md`
</output>
