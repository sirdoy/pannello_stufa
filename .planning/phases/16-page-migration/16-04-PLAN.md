---
phase: 16-page-migration
plan: 04
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - app/lights/page.js
autonomous: true

must_haves:
  truths:
    - "Lights page renders with design system components"
    - "Native range inputs replaced with Slider component"
    - "Room cards use Card component consistently"
    - "Status indicators use Badge component"
  artifacts:
    - path: "app/lights/page.js"
      provides: "Lights control page with design system"
      contains: "Slider"
  key_links:
    - from: "app/lights/page.js"
      to: "app/components/ui/Slider"
      via: "imports"
      pattern: "import.*Slider"
---

<objective>
Migrate Lights page controls and styling to design system

Purpose: Replace custom form inputs and styling with design system components for consistent interaction
Output: Lights page using Slider, Badge, Card, Button with proper accessibility
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-page-migration/16-CONTEXT.md
@.planning/phases/16-page-migration/16-RESEARCH.md
@app/lights/page.js
@app/components/ui/Slider.js
@app/components/ui/Badge.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace native range inputs with Slider component</name>
  <files>app/lights/page.js</files>
  <action>
Replace all native range inputs with Slider component:

**Room brightness slider (lines ~1000-1008):**
```javascript
// BEFORE
<input
  type="range"
  min="1"
  max="100"
  value={avgBrightness}
  onChange={(e) => handleBrightnessChange(groupedLightId, e.target.value)}
  disabled={refreshing || !groupedLightId}
  className="w-full h-2 bg-slate-200 [html:not(.dark)_&]:bg-slate-200 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-warning-500"
/>

// AFTER
<Slider
  value={avgBrightness}
  min={1}
  max={100}
  step={1}
  onChange={(value) => handleBrightnessChange(groupedLightId, value)}
  disabled={refreshing || !groupedLightId}
  aria-label={`Luminosita stanza ${room.metadata?.name}`}
/>
```

**Light brightness slider (lines ~1090-1098):**
```javascript
// BEFORE
<input
  type="range"
  min="1"
  max="100"
  value={lightBrightness}
  onChange={(e) => handleLightBrightnessChange(light.id, e.target.value)}
  disabled={refreshing}
  className="w-full h-1 bg-slate-200 [html:not(.dark)_&]:bg-slate-200 bg-slate-700 rounded appearance-none cursor-pointer accent-warning-500"
/>

// AFTER
<Slider
  value={lightBrightness}
  min={1}
  max={100}
  step={1}
  onChange={(value) => handleLightBrightnessChange(light.id, value)}
  disabled={refreshing}
  aria-label={`Luminosita ${light.metadata?.name}`}
/>
```

**Note on Slider API:**
- Slider accepts number, converts to array internally (per STATE.md decision 12-03)
- onChange receives number value (unwrapped from array)
- Include aria-label for accessibility

**Add import:**
```javascript
import { Slider } from '@/app/components/ui';
```
  </action>
  <verify>
- Test brightness adjustment at localhost:3000/lights
- Verify slider thumb is draggable
- Test keyboard accessibility (arrow keys)
  </verify>
  <done>All brightness controls use Slider component with proper accessibility labels</done>
</task>

<task type="auto">
  <name>Task 2: Replace status indicators with Badge component</name>
  <files>app/lights/page.js</files>
  <action>
Replace inline status badges with Badge component:

**Room "ACCESO" badge (lines ~929-932):**
```javascript
// BEFORE
{isOn && (
  <div className="px-3 py-1 bg-warning-500 text-white text-xs font-bold rounded-full">
    ACCESO
  </div>
)}

// AFTER
{isOn && (
  <Badge variant="ember" pulse>ACCESO</Badge>
)}
```

**Light "ON" indicator (line ~1052):**
```javascript
// BEFORE
{lightOn && <span className="text-xs text-warning-400 [html:not(.dark)_&]:text-warning-600">ON</span>}

// AFTER
{lightOn && <Badge variant="ember" size="sm">ON</Badge>}
```

**Add import:**
```javascript
import { Badge } from '@/app/components/ui';
```

**Badge variants to use:**
- ACCESO/ON: variant="ember" with pulse for active state
- Stats display: variant="neutral" for counts
  </action>
  <verify>
- Visual inspection of badge styling
- Verify pulse animation on active badges
  </verify>
  <done>Status indicators use Badge component with appropriate variants</done>
</task>

<task type="auto">
  <name>Task 3: Clean up room card styling</name>
  <files>app/lights/page.js</files>
  <action>
Standardize room card styling using Card and design tokens:

**Room card container (line ~917):**
Currently uses Card component - verify it's using correct variant.

**Light card styling (lines ~1038-1046):**
```javascript
// BEFORE
<div
  className={`p-4 rounded-xl border-2 ${
    lightOn
      ? 'border-warning-300 [html:not(.dark)_&]:border-warning-300 border-warning-600 bg-warning-50 [html:not(.dark)_&]:bg-warning-50 bg-warning-900/10'
      : 'border-slate-200 [html:not(.dark)_&]:border-slate-200 border-slate-700 bg-white [html:not(.dark)_&]:bg-white bg-slate-800'
  }`}
>

// AFTER - Consider using Card with conditional variant
// Option A: Keep inline for dynamic styling (acceptable)
// Option B: Create cn() conditional:
<div
  className={cn(
    "p-4 rounded-xl border-2",
    lightOn
      ? "border-warning-500/50 bg-warning-500/10"
      : "border-default bg-surface"
  )}
>
```

**Scene button styling (lines ~1143-1149):**
```javascript
// BEFORE
<button className={`relative p-4 rounded-xl border-2 transition-all active:scale-95 ${
  activatingScene === scene.id ? '...' : '...'
}`}>

// CONSIDER: Button component if it fits
// Or keep as button with cleaner conditional styling
```

**Color picker buttons (lines ~1107-1122):**
Keep custom styling for color swatches - these are visual color pickers, not standard buttons.

**Focus on:**
1. Consistent border tokens
2. Consistent background tokens
3. Remove redundant [html:not(.dark)_&] where possible (if already handled by token)
  </action>
  <verify>
- Visual inspection of all card states (on/off)
- Test color picker interaction
- Test scene activation
  </verify>
  <done>Room and light cards use consistent styling with design tokens</done>
</task>

</tasks>

<verification>
1. Lights page loads at localhost:3000/lights
2. Slider controls work for room and individual light brightness
3. Badge shows "ACCESO" with pulse for on state
4. Room expand/collapse works correctly
5. Scene activation works
6. Color picker works (kept custom styling)
7. No console errors
</verification>

<success_criteria>
- Native range inputs replaced with Slider component
- Status badges use Badge component
- Slider has proper aria-labels for accessibility
- Consistent Card and styling patterns
- Pairing flow preserved (complex UI kept as-is)
</success_criteria>

<output>
After completion, create `.planning/phases/16-page-migration/16-04-SUMMARY.md`
</output>
