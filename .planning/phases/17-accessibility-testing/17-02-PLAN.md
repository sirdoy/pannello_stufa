---
phase: 17-accessibility-testing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/__tests__/Button.test.js
  - app/components/ui/__tests__/Checkbox.test.js
  - app/components/ui/__tests__/Switch.test.js
  - app/components/ui/__tests__/RadioGroup.test.js
autonomous: true

must_haves:
  truths:
    - "Button can be activated via Tab, Enter, and Space keys"
    - "Checkbox can be toggled via Tab and Space keys"
    - "Switch can be toggled via Tab and Space keys"
    - "RadioGroup supports Arrow key navigation between options"
    - "All components skip disabled elements in tab order"
  artifacts:
    - path: "app/components/ui/__tests__/Button.test.js"
      provides: "Full keyboard navigation tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/Checkbox.test.js"
      provides: "Full keyboard navigation tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/Switch.test.js"
      provides: "Full keyboard navigation tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/RadioGroup.test.js"
      provides: "Arrow key navigation tests"
      contains: "Arrow"
  key_links:
    - from: "Button.test.js"
      to: "userEvent.keyboard"
      via: "Keyboard simulation"
      pattern: "userEvent\\.keyboard"
    - from: "RadioGroup.test.js"
      to: "userEvent.keyboard"
      via: "Arrow key navigation"
      pattern: "ArrowDown|ArrowUp"
---

<objective>
Add comprehensive keyboard navigation tests to Button, Checkbox, Switch, and RadioGroup components.

Purpose: Ensure all form controls meet A11Y-01 requirement for full keyboard navigation (Tab, Enter, Space, Arrows). This is critical for users who cannot use a mouse.

Output: Comprehensive keyboard navigation test suites added to existing test files for 4 core form control components.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-accessibility-testing/17-RESEARCH.md

# Existing test files to update
@app/components/ui/__tests__/Button.test.js
@app/components/ui/__tests__/Checkbox.test.js
@app/components/ui/__tests__/Switch.test.js
@app/components/ui/__tests__/RadioGroup.test.js

# Components being tested
@app/components/ui/Button.js
@app/components/ui/Checkbox.js
@app/components/ui/Switch.js
@app/components/ui/RadioGroup.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard navigation tests to Button</name>
  <files>app/components/ui/__tests__/Button.test.js</files>
  <action>
Add a comprehensive keyboard navigation test section to Button.test.js. Insert after the existing "Accessibility" describe block or extend it:

```javascript
describe('Keyboard Navigation', () => {
  test('receives focus via Tab', async () => {
    render(<Button>Click me</Button>);
    await userEvent.tab();
    expect(screen.getByRole('button')).toHaveFocus();
  });

  test('triggers onClick via Enter key', async () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    const button = screen.getByRole('button');
    button.focus();
    await userEvent.keyboard('{Enter}');
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  test('triggers onClick via Space key', async () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    const button = screen.getByRole('button');
    button.focus();
    await userEvent.keyboard(' ');
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  test('skips disabled button in tab order', async () => {
    render(
      <>
        <Button data-testid="first">First</Button>
        <Button disabled data-testid="disabled">Disabled</Button>
        <Button data-testid="last">Last</Button>
      </>
    );
    await userEvent.tab();
    expect(screen.getByTestId('first')).toHaveFocus();
    await userEvent.tab();
    expect(screen.getByTestId('last')).toHaveFocus();
  });

  test('does not trigger onClick when disabled via Enter', async () => {
    const handleClick = jest.fn();
    render(<Button disabled onClick={handleClick}>Disabled</Button>);
    const button = screen.getByRole('button');
    // Force focus for test (disabled buttons cannot receive focus naturally)
    button.focus();
    await userEvent.keyboard('{Enter}');
    expect(handleClick).not.toHaveBeenCalled();
  });

  test('does not trigger onClick when loading', async () => {
    const handleClick = jest.fn();
    render(<Button loading onClick={handleClick}>Loading</Button>);
    const button = screen.getByRole('button');
    button.focus();
    await userEvent.keyboard('{Enter}');
    // Loading state should prevent interaction
    expect(handleClick).not.toHaveBeenCalled();
  });
});
```

Ensure userEvent is imported at the top of the file if not already.
  </action>
  <verify>npm test -- app/components/ui/__tests__/Button.test.js --watchAll=false</verify>
  <done>Button has keyboard navigation tests for Tab, Enter, Space, and disabled state handling</done>
</task>

<task type="auto">
  <name>Task 2: Add keyboard navigation tests to Checkbox, Switch, and RadioGroup</name>
  <files>
    app/components/ui/__tests__/Checkbox.test.js
    app/components/ui/__tests__/Switch.test.js
    app/components/ui/__tests__/RadioGroup.test.js
  </files>
  <action>
**Checkbox.test.js** - Add/update keyboard navigation section:

```javascript
describe('Keyboard Navigation', () => {
  test('receives focus via Tab', async () => {
    render(<Checkbox aria-label="Test checkbox" />);
    await userEvent.tab();
    expect(screen.getByRole('checkbox')).toHaveFocus();
  });

  test('toggles via Space key', async () => {
    const handleChange = jest.fn();
    render(<Checkbox aria-label="Test checkbox" onCheckedChange={handleChange} />);
    const checkbox = screen.getByRole('checkbox');
    checkbox.focus();
    await userEvent.keyboard(' ');
    expect(handleChange).toHaveBeenCalledWith(true);
  });

  test('skips disabled checkbox in tab order', async () => {
    render(
      <>
        <Checkbox data-testid="first" aria-label="First" />
        <Checkbox disabled data-testid="disabled" aria-label="Disabled" />
        <Checkbox data-testid="last" aria-label="Last" />
      </>
    );
    await userEvent.tab();
    expect(screen.getByTestId('first')).toHaveFocus();
    await userEvent.tab();
    expect(screen.getByTestId('last')).toHaveFocus();
  });

  test('does not toggle disabled checkbox via Space', async () => {
    const handleChange = jest.fn();
    render(<Checkbox disabled aria-label="Test checkbox" onCheckedChange={handleChange} />);
    const checkbox = screen.getByRole('checkbox');
    checkbox.focus();
    await userEvent.keyboard(' ');
    expect(handleChange).not.toHaveBeenCalled();
  });
});
```

**Switch.test.js** - Add/update keyboard navigation section:

```javascript
describe('Keyboard Navigation', () => {
  test('receives focus via Tab', async () => {
    render(<Switch aria-label="Test switch" />);
    await userEvent.tab();
    expect(screen.getByRole('switch')).toHaveFocus();
  });

  test('toggles via Space key', async () => {
    const handleChange = jest.fn();
    render(<Switch aria-label="Test switch" onCheckedChange={handleChange} />);
    const switchEl = screen.getByRole('switch');
    switchEl.focus();
    await userEvent.keyboard(' ');
    expect(handleChange).toHaveBeenCalledWith(true);
  });

  test('skips disabled switch in tab order', async () => {
    render(
      <>
        <Switch data-testid="first" aria-label="First" />
        <Switch disabled data-testid="disabled" aria-label="Disabled" />
        <Switch data-testid="last" aria-label="Last" />
      </>
    );
    await userEvent.tab();
    expect(screen.getByTestId('first')).toHaveFocus();
    await userEvent.tab();
    expect(screen.getByTestId('last')).toHaveFocus();
  });

  test('does not toggle disabled switch via Space', async () => {
    const handleChange = jest.fn();
    render(<Switch disabled aria-label="Test switch" onCheckedChange={handleChange} />);
    const switchEl = screen.getByRole('switch');
    switchEl.focus();
    await userEvent.keyboard(' ');
    expect(handleChange).not.toHaveBeenCalled();
  });
});
```

**RadioGroup.test.js** - Add/update keyboard navigation section for arrow keys:

```javascript
describe('Keyboard Navigation', () => {
  test('receives focus via Tab', async () => {
    render(
      <RadioGroup defaultValue="a" aria-label="Options">
        <RadioGroup.Item value="a">Option A</RadioGroup.Item>
        <RadioGroup.Item value="b">Option B</RadioGroup.Item>
      </RadioGroup>
    );
    await userEvent.tab();
    expect(screen.getByRole('radio', { name: 'Option A' })).toHaveFocus();
  });

  test('ArrowDown moves focus to next option', async () => {
    render(
      <RadioGroup defaultValue="a" aria-label="Options">
        <RadioGroup.Item value="a">Option A</RadioGroup.Item>
        <RadioGroup.Item value="b">Option B</RadioGroup.Item>
        <RadioGroup.Item value="c">Option C</RadioGroup.Item>
      </RadioGroup>
    );
    await userEvent.tab();
    expect(screen.getByRole('radio', { name: 'Option A' })).toHaveFocus();
    await userEvent.keyboard('{ArrowDown}');
    expect(screen.getByRole('radio', { name: 'Option B' })).toHaveFocus();
  });

  test('ArrowUp moves focus to previous option', async () => {
    render(
      <RadioGroup defaultValue="b" aria-label="Options">
        <RadioGroup.Item value="a">Option A</RadioGroup.Item>
        <RadioGroup.Item value="b">Option B</RadioGroup.Item>
        <RadioGroup.Item value="c">Option C</RadioGroup.Item>
      </RadioGroup>
    );
    await userEvent.tab();
    // Focus goes to checked item first
    expect(screen.getByRole('radio', { name: 'Option B' })).toHaveFocus();
    await userEvent.keyboard('{ArrowUp}');
    expect(screen.getByRole('radio', { name: 'Option A' })).toHaveFocus();
  });

  test('ArrowDown wraps from last to first', async () => {
    render(
      <RadioGroup defaultValue="c" aria-label="Options">
        <RadioGroup.Item value="a">Option A</RadioGroup.Item>
        <RadioGroup.Item value="b">Option B</RadioGroup.Item>
        <RadioGroup.Item value="c">Option C</RadioGroup.Item>
      </RadioGroup>
    );
    await userEvent.tab();
    await userEvent.keyboard('{ArrowDown}');
    expect(screen.getByRole('radio', { name: 'Option A' })).toHaveFocus();
  });

  test('Space selects focused option', async () => {
    const handleChange = jest.fn();
    render(
      <RadioGroup defaultValue="a" onValueChange={handleChange} aria-label="Options">
        <RadioGroup.Item value="a">Option A</RadioGroup.Item>
        <RadioGroup.Item value="b">Option B</RadioGroup.Item>
      </RadioGroup>
    );
    await userEvent.tab();
    await userEvent.keyboard('{ArrowDown}');
    // Arrow keys in RadioGroup auto-select in Radix, verify selection
    expect(handleChange).toHaveBeenCalledWith('b');
  });

  test('skips disabled options with arrow keys', async () => {
    render(
      <RadioGroup defaultValue="a" aria-label="Options">
        <RadioGroup.Item value="a">Option A</RadioGroup.Item>
        <RadioGroup.Item value="b" disabled>Option B</RadioGroup.Item>
        <RadioGroup.Item value="c">Option C</RadioGroup.Item>
      </RadioGroup>
    );
    await userEvent.tab();
    await userEvent.keyboard('{ArrowDown}');
    // Should skip disabled 'b' and go to 'c'
    expect(screen.getByRole('radio', { name: 'Option C' })).toHaveFocus();
  });
});
```

Note: Radix RadioGroup auto-selects on arrow key navigation, which is standard WAI-ARIA behavior.
  </action>
  <verify>
npm test -- app/components/ui/__tests__/Checkbox.test.js app/components/ui/__tests__/Switch.test.js app/components/ui/__tests__/RadioGroup.test.js --watchAll=false
  </verify>
  <done>Checkbox, Switch, and RadioGroup have comprehensive keyboard navigation tests including arrow keys for RadioGroup</done>
</task>

</tasks>

<verification>
1. `npm test -- app/components/ui/__tests__/Button.test.js --watchAll=false` - All tests pass including keyboard navigation
2. `npm test -- app/components/ui/__tests__/Checkbox.test.js --watchAll=false` - All tests pass
3. `npm test -- app/components/ui/__tests__/Switch.test.js --watchAll=false` - All tests pass
4. `npm test -- app/components/ui/__tests__/RadioGroup.test.js --watchAll=false` - All tests pass
</verification>

<success_criteria>
- Button has Tab, Enter, Space, and disabled handling tests
- Checkbox has Tab, Space, and disabled handling tests
- Switch has Tab, Space, and disabled handling tests
- RadioGroup has Tab, ArrowUp, ArrowDown, wrapping, and disabled skip tests
- All keyboard navigation tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/17-accessibility-testing/17-02-SUMMARY.md`
</output>
