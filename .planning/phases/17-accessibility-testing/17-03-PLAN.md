---
phase: 17-accessibility-testing
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/__tests__/Select.test.js
  - app/components/ui/__tests__/Slider.test.js
  - app/components/ui/__tests__/Input.test.js
autonomous: true

must_haves:
  truths:
    - "Select opens via Enter/Space and supports arrow key navigation"
    - "Select closes via Escape key"
    - "Slider adjusts value via Arrow keys"
    - "Input receives focus via Tab and supports standard text input"
    - "All components skip disabled elements in tab order"
  artifacts:
    - path: "app/components/ui/__tests__/Select.test.js"
      provides: "Full keyboard navigation tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/Slider.test.js"
      provides: "Arrow key tests"
      contains: "ArrowRight"
    - path: "app/components/ui/__tests__/Input.test.js"
      provides: "Focus and typing tests"
      contains: "Keyboard Navigation"
  key_links:
    - from: "Select.test.js"
      to: "userEvent.keyboard"
      via: "Dropdown navigation"
      pattern: "Escape|ArrowDown"
    - from: "Slider.test.js"
      to: "userEvent.keyboard"
      via: "Value adjustment"
      pattern: "ArrowRight|ArrowLeft"
---

<objective>
Add comprehensive keyboard navigation tests to Select, Slider, and Input components.

Purpose: Complete A11Y-01 coverage for remaining form controls. These components have more complex keyboard patterns (Select opens dropdown, Slider uses arrows for values, Input is standard text input).

Output: Comprehensive keyboard navigation test suites added to existing test files for 3 additional form control components.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-accessibility-testing/17-RESEARCH.md

# Existing test files to update
@app/components/ui/__tests__/Select.test.js
@app/components/ui/__tests__/Slider.test.js
@app/components/ui/__tests__/Input.test.js

# Components being tested
@app/components/ui/Select.js
@app/components/ui/Slider.js
@app/components/ui/Input.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard navigation tests to Select</name>
  <files>app/components/ui/__tests__/Select.test.js</files>
  <action>
Add a comprehensive keyboard navigation test section to Select.test.js:

```javascript
describe('Keyboard Navigation', () => {
  const options = [
    { value: 'a', label: 'Option A' },
    { value: 'b', label: 'Option B' },
    { value: 'c', label: 'Option C' },
  ];

  test('trigger receives focus via Tab', async () => {
    render(<Select options={options} aria-label="Test select" />);
    await userEvent.tab();
    expect(screen.getByRole('combobox')).toHaveFocus();
  });

  test('opens dropdown via Enter key', async () => {
    render(<Select options={options} aria-label="Test select" />);
    const trigger = screen.getByRole('combobox');
    trigger.focus();
    await userEvent.keyboard('{Enter}');
    expect(screen.getByRole('listbox')).toBeInTheDocument();
  });

  test('opens dropdown via Space key', async () => {
    render(<Select options={options} aria-label="Test select" />);
    const trigger = screen.getByRole('combobox');
    trigger.focus();
    await userEvent.keyboard(' ');
    expect(screen.getByRole('listbox')).toBeInTheDocument();
  });

  test('closes dropdown via Escape key', async () => {
    render(<Select options={options} aria-label="Test select" />);
    const trigger = screen.getByRole('combobox');
    trigger.focus();
    await userEvent.keyboard('{Enter}');
    expect(screen.getByRole('listbox')).toBeInTheDocument();
    await userEvent.keyboard('{Escape}');
    expect(screen.queryByRole('listbox')).not.toBeInTheDocument();
  });

  test('ArrowDown navigates through options', async () => {
    render(<Select options={options} aria-label="Test select" />);
    const trigger = screen.getByRole('combobox');
    trigger.focus();
    await userEvent.keyboard('{Enter}');
    // First option should be highlighted by default
    await userEvent.keyboard('{ArrowDown}');
    // Navigate to second option - verify highlight (Radix adds data-highlighted)
    const optionB = screen.getByRole('option', { name: 'Option B' });
    expect(optionB).toHaveAttribute('data-highlighted');
  });

  test('ArrowUp navigates through options', async () => {
    render(<Select options={options} value="c" aria-label="Test select" />);
    const trigger = screen.getByRole('combobox');
    trigger.focus();
    await userEvent.keyboard('{Enter}');
    await userEvent.keyboard('{ArrowUp}');
    const optionB = screen.getByRole('option', { name: 'Option B' });
    expect(optionB).toHaveAttribute('data-highlighted');
  });

  test('Enter selects highlighted option', async () => {
    const handleChange = jest.fn();
    render(<Select options={options} onChange={handleChange} aria-label="Test select" />);
    const trigger = screen.getByRole('combobox');
    trigger.focus();
    await userEvent.keyboard('{Enter}');
    await userEvent.keyboard('{ArrowDown}');
    await userEvent.keyboard('{Enter}');
    // onChange receives synthetic event with target.value
    expect(handleChange).toHaveBeenCalled();
  });

  test('skips disabled select in tab order', async () => {
    render(
      <>
        <Select options={options} data-testid="first" aria-label="First" />
        <Select options={options} disabled data-testid="disabled" aria-label="Disabled" />
        <Select options={options} data-testid="last" aria-label="Last" />
      </>
    );
    await userEvent.tab();
    expect(screen.getAllByRole('combobox')[0]).toHaveFocus();
    await userEvent.tab();
    expect(screen.getAllByRole('combobox')[2]).toHaveFocus();
  });
});
```

Note: Some tests may need adjustment based on Radix Select's exact behavior with data-highlighted. Check existing tests for patterns used.
  </action>
  <verify>npm test -- app/components/ui/__tests__/Select.test.js --watchAll=false</verify>
  <done>Select has keyboard navigation tests for open/close, arrow navigation, and selection</done>
</task>

<task type="auto">
  <name>Task 2: Add keyboard navigation tests to Slider and Input</name>
  <files>
    app/components/ui/__tests__/Slider.test.js
    app/components/ui/__tests__/Input.test.js
  </files>
  <action>
**Slider.test.js** - Add keyboard navigation section:

```javascript
describe('Keyboard Navigation', () => {
  test('thumb receives focus via Tab', async () => {
    render(<Slider defaultValue={50} aria-label="Volume" />);
    await userEvent.tab();
    // Slider thumb should receive focus
    const thumb = document.querySelector('[role="slider"]');
    expect(thumb).toHaveFocus();
  });

  test('ArrowRight increases value', async () => {
    const handleChange = jest.fn();
    render(<Slider defaultValue={50} onValueChange={handleChange} aria-label="Volume" />);
    const thumb = document.querySelector('[role="slider"]');
    thumb.focus();
    await userEvent.keyboard('{ArrowRight}');
    expect(handleChange).toHaveBeenCalled();
    // Radix Slider increases by step (default 1)
    const lastCall = handleChange.mock.calls[handleChange.mock.calls.length - 1];
    expect(lastCall[0]).toBeGreaterThan(50);
  });

  test('ArrowLeft decreases value', async () => {
    const handleChange = jest.fn();
    render(<Slider defaultValue={50} onValueChange={handleChange} aria-label="Volume" />);
    const thumb = document.querySelector('[role="slider"]');
    thumb.focus();
    await userEvent.keyboard('{ArrowLeft}');
    expect(handleChange).toHaveBeenCalled();
    const lastCall = handleChange.mock.calls[handleChange.mock.calls.length - 1];
    expect(lastCall[0]).toBeLessThan(50);
  });

  test('ArrowUp increases value (alternative)', async () => {
    const handleChange = jest.fn();
    render(<Slider defaultValue={50} onValueChange={handleChange} aria-label="Volume" />);
    const thumb = document.querySelector('[role="slider"]');
    thumb.focus();
    await userEvent.keyboard('{ArrowUp}');
    expect(handleChange).toHaveBeenCalled();
    const lastCall = handleChange.mock.calls[handleChange.mock.calls.length - 1];
    expect(lastCall[0]).toBeGreaterThan(50);
  });

  test('ArrowDown decreases value (alternative)', async () => {
    const handleChange = jest.fn();
    render(<Slider defaultValue={50} onValueChange={handleChange} aria-label="Volume" />);
    const thumb = document.querySelector('[role="slider"]');
    thumb.focus();
    await userEvent.keyboard('{ArrowDown}');
    expect(handleChange).toHaveBeenCalled();
    const lastCall = handleChange.mock.calls[handleChange.mock.calls.length - 1];
    expect(lastCall[0]).toBeLessThan(50);
  });

  test('Home sets to minimum value', async () => {
    const handleChange = jest.fn();
    render(<Slider defaultValue={50} min={0} max={100} onValueChange={handleChange} aria-label="Volume" />);
    const thumb = document.querySelector('[role="slider"]');
    thumb.focus();
    await userEvent.keyboard('{Home}');
    expect(handleChange).toHaveBeenCalled();
    const lastCall = handleChange.mock.calls[handleChange.mock.calls.length - 1];
    expect(lastCall[0]).toBe(0);
  });

  test('End sets to maximum value', async () => {
    const handleChange = jest.fn();
    render(<Slider defaultValue={50} min={0} max={100} onValueChange={handleChange} aria-label="Volume" />);
    const thumb = document.querySelector('[role="slider"]');
    thumb.focus();
    await userEvent.keyboard('{End}');
    expect(handleChange).toHaveBeenCalled();
    const lastCall = handleChange.mock.calls[handleChange.mock.calls.length - 1];
    expect(lastCall[0]).toBe(100);
  });

  test('skips disabled slider in tab order', async () => {
    render(
      <>
        <Slider data-testid="first" defaultValue={30} aria-label="First" />
        <Slider disabled data-testid="disabled" defaultValue={50} aria-label="Disabled" />
        <Slider data-testid="last" defaultValue={70} aria-label="Last" />
      </>
    );
    await userEvent.tab();
    // First slider thumb focused
    const thumbs = document.querySelectorAll('[role="slider"]');
    expect(thumbs[0]).toHaveFocus();
    await userEvent.tab();
    // Skip disabled, go to last
    expect(thumbs[2]).toHaveFocus();
  });
});
```

**Input.test.js** - Add keyboard navigation section:

```javascript
describe('Keyboard Navigation', () => {
  test('receives focus via Tab', async () => {
    render(<Input placeholder="Enter text" />);
    await userEvent.tab();
    expect(screen.getByRole('textbox')).toHaveFocus();
  });

  test('accepts text input while focused', async () => {
    render(<Input placeholder="Enter text" />);
    const input = screen.getByRole('textbox');
    input.focus();
    await userEvent.type(input, 'Hello World');
    expect(input).toHaveValue('Hello World');
  });

  test('skips disabled input in tab order', async () => {
    render(
      <>
        <Input data-testid="first" placeholder="First" />
        <Input disabled data-testid="disabled" placeholder="Disabled" />
        <Input data-testid="last" placeholder="Last" />
      </>
    );
    await userEvent.tab();
    expect(screen.getByTestId('first')).toHaveFocus();
    await userEvent.tab();
    expect(screen.getByTestId('last')).toHaveFocus();
  });

  test('Tab moves to next element', async () => {
    render(
      <>
        <Input data-testid="input" placeholder="Input" />
        <button data-testid="button">Button</button>
      </>
    );
    await userEvent.tab();
    expect(screen.getByTestId('input')).toHaveFocus();
    await userEvent.tab();
    expect(screen.getByTestId('button')).toHaveFocus();
  });

  test('Shift+Tab moves to previous element', async () => {
    render(
      <>
        <button data-testid="button">Button</button>
        <Input data-testid="input" placeholder="Input" />
      </>
    );
    await userEvent.tab(); // Focus button
    await userEvent.tab(); // Focus input
    expect(screen.getByTestId('input')).toHaveFocus();
    await userEvent.tab({ shift: true }); // Shift+Tab back to button
    expect(screen.getByTestId('button')).toHaveFocus();
  });

  test('readonly input receives focus but cannot be edited', async () => {
    render(<Input readOnly defaultValue="Read only" />);
    const input = screen.getByRole('textbox');
    await userEvent.tab();
    expect(input).toHaveFocus();
    await userEvent.type(input, 'New text');
    expect(input).toHaveValue('Read only');
  });
});
```

Note: Some tests may need adjustment based on Slider's exact API (defaultValue vs value). Check existing Slider tests for the correct prop pattern.
  </action>
  <verify>
npm test -- app/components/ui/__tests__/Slider.test.js app/components/ui/__tests__/Input.test.js --watchAll=false
  </verify>
  <done>Slider has arrow key and Home/End tests, Input has focus and typing tests</done>
</task>

</tasks>

<verification>
1. `npm test -- app/components/ui/__tests__/Select.test.js --watchAll=false` - All tests pass
2. `npm test -- app/components/ui/__tests__/Slider.test.js --watchAll=false` - All tests pass
3. `npm test -- app/components/ui/__tests__/Input.test.js --watchAll=false` - All tests pass
</verification>

<success_criteria>
- Select has Enter/Space open, Escape close, arrow navigation, and selection tests
- Slider has ArrowRight/Left/Up/Down, Home/End, and disabled handling tests
- Input has Tab focus, text input, and readonly handling tests
- All keyboard navigation tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/17-accessibility-testing/17-03-SUMMARY.md`
</output>
