---
phase: 17-accessibility-testing
plan: 06
type: execute
wave: 2
depends_on: ["17-02"]
files_modified:
  - app/components/ui/__tests__/ControlButton.test.js
  - app/components/ui/__tests__/ConnectionStatus.test.js
  - app/components/ui/__tests__/HealthIndicator.test.js
  - app/components/ui/__tests__/SmartHomeCard.test.js
  - app/components/ui/__tests__/DeviceCard.test.js
  - app/components/ui/__tests__/StatusCard.test.js
autonomous: true

must_haves:
  truths:
    - "ControlButton supports keyboard navigation for increment/decrement"
    - "ConnectionStatus has role=status for screen reader announcements"
    - "HealthIndicator has role=status with aria-live for status updates"
    - "SmartHomeCard interactive elements are keyboard accessible"
    - "DeviceCard actions are keyboard accessible"
    - "StatusCard status badge is announced to screen readers"
  artifacts:
    - path: "app/components/ui/__tests__/ControlButton.test.js"
      provides: "Keyboard navigation tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/ConnectionStatus.test.js"
      provides: "Status role tests"
      contains: "role.*status"
    - path: "app/components/ui/__tests__/HealthIndicator.test.js"
      provides: "ARIA live region tests"
      contains: "aria-live"
    - path: "app/components/ui/__tests__/SmartHomeCard.test.js"
      provides: "Interactive element tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/DeviceCard.test.js"
      provides: "Action button keyboard tests"
      contains: "Keyboard Navigation"
    - path: "app/components/ui/__tests__/StatusCard.test.js"
      provides: "Screen reader announcement tests"
      contains: "Accessibility"
  key_links:
    - from: "ControlButton.test.js"
      to: "userEvent.keyboard"
      via: "Increment/decrement via keyboard"
      pattern: "Enter|Space"
    - from: "ConnectionStatus.test.js"
      to: "role=status"
      via: "Screen reader status"
      pattern: "role.*status"
---

<objective>
Add comprehensive accessibility tests to smart home components: ControlButton, ConnectionStatus, HealthIndicator, SmartHomeCard, DeviceCard, and StatusCard.

Purpose: Ensure domain-specific smart home components meet accessibility requirements including keyboard operation (A11Y-01), status announcements (A11Y-07), and focus indicators (A11Y-02).

Output: Accessibility test suites added to existing test files for 6 smart home components.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-accessibility-testing/17-RESEARCH.md

# Existing test files to update
@app/components/ui/__tests__/ControlButton.test.js
@app/components/ui/__tests__/ConnectionStatus.test.js
@app/components/ui/__tests__/HealthIndicator.test.js
@app/components/ui/__tests__/SmartHomeCard.test.js
@app/components/ui/__tests__/DeviceCard.test.js
@app/components/ui/__tests__/StatusCard.test.js

# Components being tested
@app/components/ui/ControlButton.js
@app/components/ui/ConnectionStatus.js
@app/components/ui/HealthIndicator.js
@app/components/ui/SmartHomeCard.js
@app/components/ui/DeviceCard.js
@app/components/ui/StatusCard.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add accessibility tests to ControlButton, ConnectionStatus, and HealthIndicator</name>
  <files>
    app/components/ui/__tests__/ControlButton.test.js
    app/components/ui/__tests__/ConnectionStatus.test.js
    app/components/ui/__tests__/HealthIndicator.test.js
  </files>
  <action>
**ControlButton.test.js** - Add/enhance keyboard navigation section:

```javascript
describe('Keyboard Navigation', () => {
  test('receives focus via Tab', async () => {
    render(<ControlButton onClick={() => {}} aria-label="Increase" />);
    await userEvent.tab();
    expect(screen.getByRole('button')).toHaveFocus();
  });

  test('triggers onClick via Enter key', async () => {
    const handleClick = jest.fn();
    render(<ControlButton onClick={handleClick} aria-label="Increase" />);
    const button = screen.getByRole('button');
    button.focus();
    await userEvent.keyboard('{Enter}');
    expect(handleClick).toHaveBeenCalled();
  });

  test('triggers onClick via Space key', async () => {
    const handleClick = jest.fn();
    render(<ControlButton onClick={handleClick} aria-label="Decrease" />);
    const button = screen.getByRole('button');
    button.focus();
    await userEvent.keyboard(' ');
    expect(handleClick).toHaveBeenCalled();
  });

  test('skips disabled button in tab order', async () => {
    render(
      <>
        <ControlButton data-testid="first" onClick={() => {}} aria-label="First" />
        <ControlButton disabled data-testid="disabled" onClick={() => {}} aria-label="Disabled" />
        <ControlButton data-testid="last" onClick={() => {}} aria-label="Last" />
      </>
    );
    await userEvent.tab();
    expect(screen.getByTestId('first')).toHaveFocus();
    await userEvent.tab();
    expect(screen.getByTestId('last')).toHaveFocus();
  });

  test('has aria-label for screen readers', () => {
    render(<ControlButton onClick={() => {}} aria-label="Increase brightness" />);
    expect(screen.getByRole('button')).toHaveAttribute('aria-label', 'Increase brightness');
  });
});
```

**ConnectionStatus.test.js** - Add accessibility section:

```javascript
describe('Accessibility', () => {
  test('has role="status" for screen reader announcements', () => {
    render(<ConnectionStatus status="online" />);
    expect(screen.getByRole('status')).toBeInTheDocument();
  });

  test('has aria-live="polite" for non-interrupting updates', () => {
    render(<ConnectionStatus status="online" />);
    const status = screen.getByRole('status');
    expect(status).toHaveAttribute('aria-live', 'polite');
  });

  test('online status has no accessibility violations', async () => {
    const { container } = render(<ConnectionStatus status="online" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('offline status has no accessibility violations', async () => {
    const { container } = render(<ConnectionStatus status="offline" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('connecting status has no accessibility violations', async () => {
    const { container } = render(<ConnectionStatus status="connecting" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('status text is accessible (not just color indicator)', () => {
    render(<ConnectionStatus status="online" />);
    // Should have text label, not just colored dot
    expect(screen.getByText(/online|connesso/i)).toBeInTheDocument();
  });
});
```

**HealthIndicator.test.js** - Add/enhance accessibility section:

```javascript
describe('Accessibility', () => {
  test('has role="status" for screen reader announcements', () => {
    render(<HealthIndicator status="ok" />);
    expect(screen.getByRole('status')).toBeInTheDocument();
  });

  test('has aria-live="polite" for status updates', () => {
    render(<HealthIndicator status="ok" />);
    const status = screen.getByRole('status');
    expect(status).toHaveAttribute('aria-live', 'polite');
  });

  test('ok status has no accessibility violations', async () => {
    const { container } = render(<HealthIndicator status="ok" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('warning status has no accessibility violations', async () => {
    const { container } = render(<HealthIndicator status="warning" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('error status has no accessibility violations', async () => {
    const { container } = render(<HealthIndicator status="error" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('critical status has no accessibility violations', async () => {
    const { container } = render(<HealthIndicator status="critical" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('icon has aria-hidden (decorative)', () => {
    const { container } = render(<HealthIndicator status="ok" />);
    const icon = container.querySelector('svg');
    if (icon) {
      expect(icon).toHaveAttribute('aria-hidden', 'true');
    }
  });

  test('status text is accessible (not just icon)', () => {
    render(<HealthIndicator status="warning" />);
    // Should have text label, not just icon
    expect(screen.getByText(/warning|attenzione/i)).toBeInTheDocument();
  });
});
```

Note: Check existing test files for correct component APIs (status prop values, etc.) and adjust status text assertions for Italian translations if needed.
  </action>
  <verify>
npm test -- app/components/ui/__tests__/ControlButton.test.js app/components/ui/__tests__/ConnectionStatus.test.js app/components/ui/__tests__/HealthIndicator.test.js --watchAll=false
  </verify>
  <done>ControlButton has keyboard tests, ConnectionStatus and HealthIndicator have status role and aria-live tests</done>
</task>

<task type="auto">
  <name>Task 2: Add accessibility tests to SmartHomeCard, DeviceCard, and StatusCard</name>
  <files>
    app/components/ui/__tests__/SmartHomeCard.test.js
    app/components/ui/__tests__/DeviceCard.test.js
    app/components/ui/__tests__/StatusCard.test.js
  </files>
  <action>
**SmartHomeCard.test.js** - Add accessibility section:

```javascript
describe('Accessibility', () => {
  test('default card has no accessibility violations', async () => {
    const { container } = render(
      <SmartHomeCard>
        <SmartHomeCard.Header>
          <SmartHomeCard.Title>Device</SmartHomeCard.Title>
        </SmartHomeCard.Header>
        <SmartHomeCard.Content>Content</SmartHomeCard.Content>
      </SmartHomeCard>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('card with status has no violations', async () => {
    const { container } = render(
      <SmartHomeCard>
        <SmartHomeCard.Header>
          <SmartHomeCard.Title>Device</SmartHomeCard.Title>
          <SmartHomeCard.Status>Active</SmartHomeCard.Status>
        </SmartHomeCard.Header>
        <SmartHomeCard.Content>Content</SmartHomeCard.Content>
      </SmartHomeCard>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('interactive controls within card are keyboard accessible', async () => {
    const handleAction = jest.fn();
    render(
      <SmartHomeCard>
        <SmartHomeCard.Header>
          <SmartHomeCard.Title>Device</SmartHomeCard.Title>
        </SmartHomeCard.Header>
        <SmartHomeCard.Controls>
          <button onClick={handleAction}>Action</button>
        </SmartHomeCard.Controls>
      </SmartHomeCard>
    );

    await userEvent.tab();
    expect(screen.getByRole('button')).toHaveFocus();
    await userEvent.keyboard('{Enter}');
    expect(handleAction).toHaveBeenCalled();
  });

  test('loading state has no accessibility violations', async () => {
    const { container } = render(
      <SmartHomeCard isLoading>
        <SmartHomeCard.Header>
          <SmartHomeCard.Title>Loading</SmartHomeCard.Title>
        </SmartHomeCard.Header>
      </SmartHomeCard>
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('icon has aria-hidden (decorative)', () => {
    const { container } = render(
      <SmartHomeCard icon={<svg data-testid="icon" />}>
        <SmartHomeCard.Header>
          <SmartHomeCard.Title>Device</SmartHomeCard.Title>
        </SmartHomeCard.Header>
      </SmartHomeCard>
    );
    // Check icon wrapper or icon for aria-hidden
    expect(container.querySelector('[aria-hidden="true"]')).toBeInTheDocument();
  });
});
```

**DeviceCard.test.js** - Add/enhance keyboard navigation section:

```javascript
describe('Keyboard Navigation', () => {
  test('action buttons are focusable via Tab', async () => {
    render(
      <DeviceCard
        title="Test Device"
        actions={[
          { label: 'Toggle', onClick: () => {} },
          { label: 'Settings', onClick: () => {} },
        ]}
      />
    );

    await userEvent.tab();
    // First action should be focused
    expect(screen.getByRole('button', { name: /toggle/i })).toHaveFocus();

    await userEvent.tab();
    expect(screen.getByRole('button', { name: /settings/i })).toHaveFocus();
  });

  test('action can be triggered via Enter key', async () => {
    const handleToggle = jest.fn();
    render(
      <DeviceCard
        title="Test Device"
        actions={[{ label: 'Toggle', onClick: handleToggle }]}
      />
    );

    const button = screen.getByRole('button', { name: /toggle/i });
    button.focus();
    await userEvent.keyboard('{Enter}');
    expect(handleToggle).toHaveBeenCalled();
  });

  test('action can be triggered via Space key', async () => {
    const handleToggle = jest.fn();
    render(
      <DeviceCard
        title="Test Device"
        actions={[{ label: 'Toggle', onClick: handleToggle }]}
      />
    );

    const button = screen.getByRole('button', { name: /toggle/i });
    button.focus();
    await userEvent.keyboard(' ');
    expect(handleToggle).toHaveBeenCalled();
  });
});

describe('Accessibility', () => {
  test('card with all props has no violations', async () => {
    const { container } = render(
      <DeviceCard
        title="Test Device"
        subtitle="Living Room"
        status="online"
        statusBadge={{ label: 'Active', variant: 'sage' }}
      />
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('status badge is announced to screen readers', () => {
    render(
      <DeviceCard
        title="Test Device"
        statusBadge={{ label: 'Active', variant: 'sage' }}
      />
    );
    // Badge should be visible and contain accessible text
    expect(screen.getByText('Active')).toBeInTheDocument();
  });

  test('disabled card has no accessibility violations', async () => {
    const { container } = render(
      <DeviceCard
        title="Disabled Device"
        disabled
      />
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

**StatusCard.test.js** - Add/enhance accessibility section:

```javascript
describe('Accessibility', () => {
  test('card has no accessibility violations', async () => {
    const { container } = render(
      <StatusCard
        title="Temperature"
        value="21°C"
        status="normal"
      />
    );
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  test('status badge is visible and accessible', () => {
    render(
      <StatusCard
        title="Temperature"
        value="21°C"
        status="warning"
      />
    );
    // Status should be conveyed via text, not just color
    expect(screen.getByText(/warning|attenzione/i)).toBeInTheDocument();
  });

  test('all status variants pass axe checks', async () => {
    const statuses = ['normal', 'warning', 'error'];
    for (const status of statuses) {
      const { container } = render(
        <StatusCard
          title="Test"
          value="Value"
          status={status}
        />
      );
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    }
  });

  test('value is announced to screen readers', () => {
    render(
      <StatusCard
        title="Temperature"
        value="21°C"
      />
    );
    // Value should be accessible text
    expect(screen.getByText('21°C')).toBeInTheDocument();
  });

  test('icon has aria-hidden (decorative)', () => {
    const { container } = render(
      <StatusCard
        title="Temperature"
        value="21°C"
        icon={<svg />}
      />
    );
    const icon = container.querySelector('svg');
    if (icon) {
      expect(icon).toHaveAttribute('aria-hidden', 'true');
    }
  });
});
```

Note: Check existing test files for correct component APIs (DeviceCard actions prop shape, StatusCard status values, etc.) and adjust assertions accordingly.
  </action>
  <verify>
npm test -- app/components/ui/__tests__/SmartHomeCard.test.js app/components/ui/__tests__/DeviceCard.test.js app/components/ui/__tests__/StatusCard.test.js --watchAll=false
  </verify>
  <done>SmartHomeCard, DeviceCard, and StatusCard have comprehensive accessibility tests</done>
</task>

</tasks>

<verification>
1. `npm test -- app/components/ui/__tests__/ControlButton.test.js --watchAll=false` - All tests pass
2. `npm test -- app/components/ui/__tests__/ConnectionStatus.test.js --watchAll=false` - All tests pass
3. `npm test -- app/components/ui/__tests__/HealthIndicator.test.js --watchAll=false` - All tests pass
4. `npm test -- app/components/ui/__tests__/SmartHomeCard.test.js --watchAll=false` - All tests pass
5. `npm test -- app/components/ui/__tests__/DeviceCard.test.js --watchAll=false` - All tests pass
6. `npm test -- app/components/ui/__tests__/StatusCard.test.js --watchAll=false` - All tests pass
</verification>

<success_criteria>
- ControlButton has Tab, Enter, Space keyboard tests
- ConnectionStatus has role=status and aria-live tests
- HealthIndicator has role=status, aria-live, and icon aria-hidden tests
- SmartHomeCard has axe checks and interactive element keyboard tests
- DeviceCard has action button keyboard navigation tests
- StatusCard has axe checks and accessible value/status tests
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/17-accessibility-testing/17-06-SUMMARY.md`
</output>
