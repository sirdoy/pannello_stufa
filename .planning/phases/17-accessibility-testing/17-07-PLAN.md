---
phase: 17-accessibility-testing
plan: 07
type: execute
wave: 3
depends_on: ["17-01", "17-02", "17-03", "17-04", "17-05", "17-06"]
files_modified:
  - app/components/ui/__tests__/accessibility.test.js
  - app/components/ui/Button.js
  - app/components/ui/Badge.js
autonomous: false

must_haves:
  truths:
    - "All design system components pass jest-axe tests"
    - "All interactive components have focus-visible:ring-ember-500/50 class"
    - "All touch targets meet 44px minimum (verified via class check)"
    - "Phase 17 verification checklist passes"
  artifacts:
    - path: "app/components/ui/__tests__/accessibility.test.js"
      provides: "Comprehensive axe test suite for all components"
      min_lines: 200
    - path: "app/components/ui/Button.js"
      provides: "Verified 44px touch targets"
      contains: "min-h-"
    - path: "app/components/ui/Badge.js"
      provides: "Verified pulse animation respects reduced motion"
  key_links:
    - from: "accessibility.test.js"
      to: "all UI components"
      via: "axe automated checks"
      pattern: "axe"
---

<objective>
Consolidate all accessibility work with a comprehensive test suite and final verification checkpoint.

Purpose: Ensure all A11Y requirements are met by running a complete axe check across all components, verifying touch targets, and confirming focus indicator consistency.

Output: Comprehensive accessibility.test.js covering all components, verified touch targets, and human verification checkpoint.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-accessibility-testing/17-RESEARCH.md

# Prior plan summaries for context
@.planning/phases/17-accessibility-testing/17-01-SUMMARY.md
@.planning/phases/17-accessibility-testing/17-02-SUMMARY.md
@.planning/phases/17-accessibility-testing/17-03-SUMMARY.md
@.planning/phases/17-accessibility-testing/17-04-SUMMARY.md
@.planning/phases/17-accessibility-testing/17-05-SUMMARY.md
@.planning/phases/17-accessibility-testing/17-06-SUMMARY.md

# Test file to expand
@app/components/ui/__tests__/accessibility.test.js

# Components to verify
@app/components/ui/Button.js
@app/components/ui/Badge.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand comprehensive accessibility.test.js</name>
  <files>app/components/ui/__tests__/accessibility.test.js</files>
  <action>
Replace the existing accessibility.test.js with a comprehensive test suite that covers ALL design system components with axe checks. This serves as the canonical accessibility test file.

```javascript
// app/components/ui/__tests__/accessibility.test.js
/**
 * Comprehensive Accessibility Test Suite
 *
 * Tests ALL design system components for WCAG AA compliance using jest-axe.
 * This file serves as the canonical accessibility verification for Phase 17.
 *
 * Note: Color contrast is verified via design token system (JSDOM limitation).
 * Focus indicators verified via class checks in individual component tests.
 */
import { render, screen } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import React from 'react';

// Form Controls
import Button from '../Button';
import Checkbox from '../Checkbox';
import Switch from '../Switch';
import RadioGroup from '../RadioGroup';
import Select from '../Select';
import Slider from '../Slider';
import Input from '../Input';
import Label from '../Label';

// Feedback Components
import Modal from '../Modal';
import Tooltip from '../Tooltip';
import Toast, { ToastProvider } from '../Toast';
import Spinner from '../Spinner';
import Progress from '../Progress';
import Banner from '../Banner';
import EmptyState from '../EmptyState';

// Layout & Display
import Card from '../Card';
import Badge from '../Badge';
import Divider from '../Divider';
import Heading from '../Heading';
import Text from '../Text';
import Grid from '../Grid';
import Section from '../Section';

// Smart Home Components
import ControlButton from '../ControlButton';
import ConnectionStatus from '../ConnectionStatus';
import HealthIndicator from '../HealthIndicator';
import SmartHomeCard from '../SmartHomeCard';
import DeviceCard from '../DeviceCard';
import StatusCard from '../StatusCard';

expect.extend(toHaveNoViolations);

describe('Accessibility Test Suite - All Components', () => {
  // ==================== FORM CONTROLS ====================
  describe('Form Controls', () => {
    describe('Button', () => {
      test.each(['ember', 'subtle', 'ghost', 'success', 'danger', 'outline'])(
        '%s variant has no a11y violations',
        async (variant) => {
          const { container } = render(<Button variant={variant}>Button</Button>);
          const results = await axe(container);
          expect(results).toHaveNoViolations();
        }
      );

      test('disabled state has no violations', async () => {
        const { container } = render(<Button disabled>Disabled</Button>);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });

      test('loading state has no violations', async () => {
        const { container } = render(<Button loading>Loading</Button>);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });

      test('iconOnly with aria-label has no violations', async () => {
        const { container } = render(<Button iconOnly icon="X" aria-label="Close" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Checkbox', () => {
      test('default state has no violations', async () => {
        const { container } = render(<Checkbox aria-label="Accept terms" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });

      test('with label has no violations', async () => {
        const { container } = render(
          <div>
            <Checkbox id="check" />
            <Label htmlFor="check">Accept terms</Label>
          </div>
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Switch', () => {
      test('default state has no violations', async () => {
        const { container } = render(<Switch aria-label="Enable notifications" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('RadioGroup', () => {
      test('with options has no violations', async () => {
        const { container } = render(
          <RadioGroup defaultValue="a" aria-label="Options">
            <RadioGroup.Item value="a">Option A</RadioGroup.Item>
            <RadioGroup.Item value="b">Option B</RadioGroup.Item>
          </RadioGroup>
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Select', () => {
      test('with options has no violations', async () => {
        const options = [
          { value: 'a', label: 'Option A' },
          { value: 'b', label: 'Option B' },
        ];
        const { container } = render(<Select options={options} aria-label="Select option" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Slider', () => {
      test('default state has no violations', async () => {
        const { container } = render(<Slider defaultValue={50} aria-label="Volume" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Input', () => {
      test.each(['default', 'error', 'success'])('%s state has no violations', async (state) => {
        const { container } = render(
          <Input
            placeholder="Enter text"
            aria-label="Text input"
            state={state === 'default' ? undefined : state}
          />
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });
  });

  // ==================== FEEDBACK COMPONENTS ====================
  describe('Feedback Components', () => {
    describe('Spinner', () => {
      test('has no violations', async () => {
        const { container } = render(<Spinner />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Progress', () => {
      test('determinate has no violations', async () => {
        const { container } = render(<Progress value={50} aria-label="Loading progress" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });

      test('indeterminate has no violations', async () => {
        const { container } = render(<Progress aria-label="Loading" />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Banner', () => {
      test.each(['info', 'success', 'warning', 'error'])(
        '%s variant has no violations',
        async (variant) => {
          const { container } = render(<Banner variant={variant}>Message</Banner>);
          const results = await axe(container);
          expect(results).toHaveNoViolations();
        }
      );
    });

    describe('EmptyState', () => {
      test('has no violations', async () => {
        const { container } = render(
          <EmptyState title="No items" description="Add your first item" />
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });
  });

  // ==================== LAYOUT & DISPLAY ====================
  describe('Layout & Display', () => {
    describe('Card', () => {
      test.each(['default', 'glass'])('%s variant has no violations', async (variant) => {
        const { container } = render(<Card variant={variant}>Content</Card>);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Badge', () => {
      test.each(['neutral', 'ember', 'sage', 'ocean', 'warning', 'danger'])(
        '%s variant has no violations',
        async (variant) => {
          const { container } = render(<Badge variant={variant}>Status</Badge>);
          const results = await axe(container);
          expect(results).toHaveNoViolations();
        }
      );
    });

    describe('Divider', () => {
      test('has role=separator', () => {
        render(<Divider />);
        expect(screen.getByRole('separator')).toBeInTheDocument();
      });

      test('has no violations', async () => {
        const { container } = render(<Divider />);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Heading', () => {
      test.each([1, 2, 3, 4, 5, 6])('level %s has no violations', async (level) => {
        const { container } = render(<Heading level={level}>Heading</Heading>);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Text', () => {
      test('has no violations', async () => {
        const { container } = render(<Text>Body text</Text>);
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Grid', () => {
      test('has no violations', async () => {
        const { container } = render(
          <Grid cols={2}>
            <div>Item 1</div>
            <div>Item 2</div>
          </Grid>
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('Section', () => {
      test('has no violations', async () => {
        const { container } = render(
          <Section title="Section Title">Content</Section>
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });
  });

  // ==================== SMART HOME COMPONENTS ====================
  describe('Smart Home Components', () => {
    describe('ControlButton', () => {
      test('has no violations', async () => {
        const { container } = render(
          <ControlButton onClick={() => {}} aria-label="Increase" />
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('ConnectionStatus', () => {
      test.each(['online', 'offline', 'connecting'])(
        '%s status has no violations',
        async (status) => {
          const { container } = render(<ConnectionStatus status={status} />);
          const results = await axe(container);
          expect(results).toHaveNoViolations();
        }
      );
    });

    describe('HealthIndicator', () => {
      test.each(['ok', 'warning', 'error', 'critical'])(
        '%s status has no violations',
        async (status) => {
          const { container } = render(<HealthIndicator status={status} />);
          const results = await axe(container);
          expect(results).toHaveNoViolations();
        }
      );
    });

    describe('SmartHomeCard', () => {
      test('has no violations', async () => {
        const { container } = render(
          <SmartHomeCard>
            <SmartHomeCard.Header>
              <SmartHomeCard.Title>Device</SmartHomeCard.Title>
            </SmartHomeCard.Header>
            <SmartHomeCard.Content>Content</SmartHomeCard.Content>
          </SmartHomeCard>
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('DeviceCard', () => {
      test('has no violations', async () => {
        const { container } = render(
          <DeviceCard title="Test Device" />
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });

    describe('StatusCard', () => {
      test('has no violations', async () => {
        const { container } = render(
          <StatusCard title="Temperature" value="21Â°C" />
        );
        const results = await axe(container);
        expect(results).toHaveNoViolations();
      });
    });
  });

  // ==================== FOCUS INDICATOR VERIFICATION ====================
  describe('Focus Indicator Verification', () => {
    test('Button has ember glow focus ring', () => {
      render(<Button>Click</Button>);
      const button = screen.getByRole('button');
      expect(button).toHaveClass('focus-visible:ring-2');
      expect(button).toHaveClass('focus-visible:ring-ember-500/50');
      expect(button).toHaveClass('focus-visible:ring-offset-2');
    });

    test('Checkbox has ember glow focus ring', () => {
      render(<Checkbox aria-label="Test" />);
      const checkbox = screen.getByRole('checkbox');
      expect(checkbox).toHaveClass('focus-visible:ring-2');
      expect(checkbox).toHaveClass('focus-visible:ring-ember-500/50');
    });

    test('Switch has ember glow focus ring', () => {
      render(<Switch aria-label="Test" />);
      const switchEl = screen.getByRole('switch');
      expect(switchEl).toHaveClass('focus-visible:ring-2');
      expect(switchEl).toHaveClass('focus-visible:ring-ember-500/50');
    });

    test('ControlButton has ember glow focus ring', () => {
      render(<ControlButton onClick={() => {}} aria-label="Test" />);
      const button = screen.getByRole('button');
      expect(button).toHaveClass('focus-visible:ring-2');
      expect(button).toHaveClass('focus-visible:ring-ember-500/50');
    });
  });

  // ==================== TOUCH TARGET VERIFICATION ====================
  describe('Touch Target Verification', () => {
    test('Button sm size meets 44px minimum', () => {
      render(<Button size="sm">Small</Button>);
      const button = screen.getByRole('button');
      // Button uses min-h-[44px] for sm size
      expect(button).toHaveClass('min-h-[44px]');
    });

    test('ControlButton meets 44px minimum', () => {
      render(<ControlButton onClick={() => {}} aria-label="Test" />);
      const button = screen.getByRole('button');
      // ControlButton should have minimum touch target
      const classes = button.className;
      // Check for min-h or h- classes that ensure 44px+
      expect(classes).toMatch(/min-h-\[44px\]|h-11|h-12/);
    });
  });
});
```

Note: Adjust imports and component APIs based on actual exports. Some components may need Provider wrappers (Toast needs ToastProvider) or different prop structures. Check existing test files for patterns.
  </action>
  <verify>npm test -- app/components/ui/__tests__/accessibility.test.js --watchAll=false</verify>
  <done>Comprehensive accessibility.test.js covers all components with axe checks, focus ring verification, and touch target checks</done>
</task>

<task type="auto">
  <name>Task 2: Verify touch targets in Button and Badge</name>
  <files>
    app/components/ui/Button.js
    app/components/ui/Badge.js
  </files>
  <action>
Verify that Button.js has 44px minimum touch targets for all sizes. Check the CVA size variants and ensure sm/md/lg all have appropriate minimum heights.

Open Button.js and verify the size variants include min-h-[44px] or equivalent:

```javascript
// Expected in Button.js CVA variants:
size: {
  sm: ['px-4 py-2 text-sm min-h-[44px]', ...],  // 44px minimum
  md: ['px-5 py-2.5 text-base min-h-[48px]', ...],
  lg: ['px-6 py-3 text-lg min-h-[56px]', ...],
}
```

If sm size does NOT have min-h-[44px], add it.

For Badge.js, badges are typically display-only and don't need 44px touch targets. However, verify that pulse animation works correctly and respects reduced motion (CSS handles via globals.css).

Read Badge.js and verify:
1. Pulse uses animate-glow-pulse class (CSS handles reduced motion)
2. No interactive badges need touch target enforcement

If any changes are needed to Button.js, update the size variants to ensure 44px minimum.
  </action>
  <verify>
grep -n "min-h-" app/components/ui/Button.js
npm test -- app/components/ui/__tests__/Button.test.js --watchAll=false
  </verify>
  <done>Button has verified 44px minimum touch targets, Badge pulse respects reduced motion via CSS</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 17 accessibility implementation:
- useReducedMotion hook for motion preference detection
- Comprehensive keyboard navigation tests for all form controls
- ARIA role and live region tests for feedback/status components
- Focus indicator verification (ember glow ring)
- Touch target verification (44px minimum)
- Comprehensive accessibility.test.js covering all components
  </what-built>
  <how-to-verify>
1. Run full accessibility test suite:
   `npm test -- app/components/ui/__tests__/accessibility.test.js --watchAll=false`

2. Run all component tests to verify keyboard navigation:
   `npm test -- app/components/ui/__tests__ --watchAll=false`

3. Manual keyboard navigation test:
   - Open http://localhost:3000/debug/design-system
   - Tab through all interactive components
   - Verify ember glow focus ring appears on each
   - Press Enter/Space to activate buttons
   - Use Arrow keys in RadioGroup

4. Manual reduced motion test:
   - Open browser dev tools
   - Enable "Reduce motion" in Rendering settings
   - Verify Spinner, Progress, Badge pulse animations are reduced

5. Verify touch targets on mobile (or responsive mode):
   - All buttons should be easily tappable (44px+ hit area)

Expected: All tests pass, focus indicators visible, animations respect user preferences
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 17, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm test -- app/components/ui/__tests__/accessibility.test.js --watchAll=false` - All axe checks pass
2. `npm test -- app/components/ui/__tests__ --watchAll=false` - All component tests pass including keyboard navigation
3. Manual verification of focus indicators, keyboard navigation, and reduced motion
</verification>

<success_criteria>
- All components pass jest-axe automated checks
- All interactive components have focus-visible:ring-ember-500/50 class
- All touch targets meet 44px minimum (Button sm verified)
- Human verification confirms keyboard navigation and reduced motion work
- Phase 17 accessibility requirements (A11Y-01 through A11Y-08) are met
</success_criteria>

<output>
After completion, create `.planning/phases/17-accessibility-testing/17-07-SUMMARY.md`
</output>
