---
phase: 20-thermostatcard-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/devices/thermostat/ThermostatCard.js
autonomous: true

must_haves:
  truths:
    - "User sees mode selection grid with 4 buttons (Auto/Away/Gelo/Off) rendered using Button component"
    - "User sees calibrate valves button rendered using Button component with loading state"
    - "Mode buttons have aria-pressed attribute for accessibility"
    - "Active mode buttons display correct color-coded styling via className overrides"
  artifacts:
    - path: "app/components/devices/thermostat/ThermostatCard.js"
      provides: "Button-based mode grid and calibrate button"
      contains: "<Button"
  key_links:
    - from: "app/components/devices/thermostat/ThermostatCard.js"
      to: "app/components/ui/Button.js"
      via: "import and usage"
      pattern: "import.*Button.*from.*ui"
---

<objective>
Replace raw `<button>` elements in ThermostatCard with design system Button component.

Purpose: Achieve design system compliance for ThermostatCard button elements (THERM-01, THERM-02, THERM-03)
Output: ThermostatCard using Button component for mode grid and calibrate action with proper accessibility and loading states
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-thermostatcard-compliance/20-RESEARCH.md
@app/components/devices/thermostat/ThermostatCard.js
@app/components/ui/Button.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace mode grid raw buttons with Button component</name>
  <files>app/components/devices/thermostat/ThermostatCard.js</files>
  <action>
Replace the raw `<button>` elements in the mode selection grid (lines 531-582) with the Button component.

Current pattern to replace:
```jsx
<button
  key={id}
  onClick={() => handleModeChange(id)}
  disabled={refreshing}
  className={`flex flex-col items-center ... ${colorStyles[color]}`}
>
  <span className="text-3xl sm:text-4xl mb-1.5">{icon}</span>
  <span className="text-xs sm:text-sm font-bold font-display">{label}</span>
</button>
```

Replace with:
```jsx
<Button
  key={id}
  variant="subtle"
  onClick={() => handleModeChange(id)}
  disabled={refreshing}
  aria-pressed={isActive}
  className={cn(
    "flex-col min-h-[80px] sm:min-h-[90px]",
    isActive && colorStyles[color]
  )}
>
  <span className="text-3xl sm:text-4xl mb-1.5">{icon}</span>
  <span className={`text-xs sm:text-sm font-bold font-display ${
    isActive
      ? 'text-white [html:not(.dark)_&]:text-slate-900'
      : 'text-slate-400 [html:not(.dark)_&]:text-slate-600'
  }`}>
    {label}
  </span>
</Button>
```

Key changes:
1. Replace `<button>` with `<Button>` (already imported from ui)
2. Add `variant="subtle"` for base styling
3. Add `aria-pressed={isActive}` for accessibility
4. Import `cn` from '@/lib/utils/cn' if not already imported
5. Use `cn()` to conditionally apply colorStyles
6. Keep colorStyles object unchanged (preserves color-coded active states)
7. Remove duplicate base classes now handled by Button (disabled:opacity-50, disabled:cursor-not-allowed, transition-all, etc.)
8. Keep flex-col override and min-h classes

Button component handles:
- disabled state styling
- transition animations
- active:scale-[0.97]
- focus-visible ring
- rounded-xl
  </action>
  <verify>
1. Run `npm test -- --testPathPattern="ThermostatCard" --passWithNoTests` - no test failures
2. Check file for `<button` raw elements in mode grid section - should find none
3. Grep for Button import: `grep -n "import.*Button.*from.*ui" app/components/devices/thermostat/ThermostatCard.js`
  </verify>
  <done>
Mode grid section (lines ~531-582) uses Button component instead of raw button elements. Each mode button has aria-pressed attribute. Color-coded active states preserved via className overrides.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace calibrate button with Button component</name>
  <files>app/components/devices/thermostat/ThermostatCard.js</files>
  <action>
Replace the raw `<button>` element for calibrate valves action (lines 602-620) with the Button component.

Current pattern to replace:
```jsx
<button
  onClick={handleCalibrateValves}
  disabled={calibrating}
  className="w-full flex items-center justify-center gap-2.5 px-4 py-3.5 rounded-xl bg-ocean-900/40 border border-ocean-500/40 hover:bg-ocean-900/60 hover:border-ocean-400/50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 [html:not(.dark)_&]:bg-ocean-50/80 [html:not(.dark)_&]:border-ocean-200 [html:not(.dark)_&]:hover:bg-ocean-100/90 [html:not(.dark)_&]:hover:border-ocean-300"
>
  <span className="text-xl">{calibrating ? '‚è≥' : 'üîß'}</span>
  <span className="text-sm font-bold font-display text-ocean-300 [html:not(.dark)_&]:text-ocean-700">
    {calibrating ? 'Calibrazione...' : 'Tara Valvole'}
  </span>
</button>
```

Replace with:
```jsx
<Button
  variant="subtle"
  onClick={handleCalibrateValves}
  loading={calibrating}
  fullWidth
  size="md"
  icon={calibrating ? undefined : 'üîß'}
  className="bg-ocean-900/40 border-ocean-500/40 hover:bg-ocean-900/60 hover:border-ocean-400/50 [html:not(.dark)_&]:bg-ocean-50/80 [html:not(.dark)_&]:border-ocean-200 [html:not(.dark)_&]:hover:bg-ocean-100/90 [html:not(.dark)_&]:hover:border-ocean-300 text-ocean-300 [html:not(.dark)_&]:text-ocean-700"
>
  {calibrating ? 'Calibrazione...' : 'Tara Valvole'}
</Button>
```

Key changes:
1. Replace `<button>` with `<Button>`
2. Add `variant="subtle"` for base styling
3. Add `loading={calibrating}` - Button shows spinner automatically
4. Add `fullWidth` for w-full
5. Add `size="md"` for consistent sizing
6. Add `icon="üîß"` but only when not calibrating (Button handles icon display)
7. Move ocean theming to className override (preserves visual style)
8. Remove manual disabled handling (Button loading prop handles this)
9. Remove gap-2.5, rounded-xl, transition classes (Button handles these)
  </action>
  <verify>
1. Check for raw `<button` in calibrate section - should find none
2. Check that Button has loading prop: `grep -n "loading={calibrating}" app/components/devices/thermostat/ThermostatCard.js`
3. Visual check: start dev server, navigate to homepage, verify calibrate button shows spinner when clicked
  </verify>
  <done>
Calibrate button uses Button component with loading={calibrating} prop. Ocean theming preserved via className override. Button shows spinner during calibration instead of disabled state with hourglass emoji.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify no raw button elements remain in ThermostatCard</name>
  <files>app/components/devices/thermostat/ThermostatCard.js</files>
  <action>
Run verification to ensure all raw `<button>` elements have been replaced with Button component.

Steps:
1. Search for any remaining raw `<button` elements (excluding existing Button usage at lines 494-515 which are already compliant - temperature controls)
2. Count total Button component usages - should be 7:
   - 2 temperature control buttons (lines 494-515, already Button)
   - 4 mode grid buttons (newly migrated)
   - 1 calibrate button (newly migrated)
   - 1 "Vedi Tutte le Stanze" button (line 627, already Button)
3. Ensure cn import is present if not already

Note: The temperature control buttons (lines 494-515) already use Button component - no changes needed there.
  </action>
  <verify>
1. `grep -n "<button" app/components/devices/thermostat/ThermostatCard.js` - should return empty (no raw buttons)
2. `grep -c "<Button" app/components/devices/thermostat/ThermostatCard.js` - should return 8 (all Button usages)
3. `npm test -- --testPathPattern="ThermostatCard" --passWithNoTests` - passes
  </verify>
  <done>
Zero raw `<button>` elements in ThermostatCard. All interactive buttons use Button component from design system. cn utility imported if needed.
  </done>
</task>

</tasks>

<verification>
1. File contains no raw `<button>` elements
2. All mode buttons have aria-pressed attribute
3. Calibrate button uses loading prop
4. Color-coded active states preserved
5. No test regressions
</verification>

<success_criteria>
- Zero raw `<button>` elements in ThermostatCard.js
- 8 total Button component usages (temperature controls + mode grid + calibrate + view all rooms)
- Mode buttons accessible with aria-pressed
- Loading state works correctly on calibrate button
- Visual appearance unchanged (color-coded modes, ocean-themed calibrate)
</success_criteria>

<output>
After completion, create `.planning/phases/20-thermostatcard-compliance/20-01-SUMMARY.md`
</output>
