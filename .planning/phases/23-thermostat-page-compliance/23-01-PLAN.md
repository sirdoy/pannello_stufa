---
phase: 23-thermostat-page-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Button.js
  - app/components/ui/__tests__/Button.test.js
  - app/thermostat/page.js
autonomous: true

must_haves:
  truths:
    - "Button component accepts colorScheme prop without breaking existing usage"
    - "Mode buttons on thermostat page use colorScheme prop instead of activeClassName"
    - "All existing Button tests continue to pass"
  artifacts:
    - path: "app/components/ui/Button.js"
      provides: "colorScheme prop with CVA compound variants"
      exports: ["Button", "buttonVariants", "ButtonIcon", "ButtonGroup"]
    - path: "app/components/ui/__tests__/Button.test.js"
      provides: "colorScheme compound variant tests"
      contains: "colorScheme"
    - path: "app/thermostat/page.js"
      provides: "Mode buttons using colorScheme prop"
      pattern: "colorScheme="
  key_links:
    - from: "app/thermostat/page.js"
      to: "app/components/ui/Button.js"
      via: "colorScheme prop"
      pattern: "colorScheme=['\"]?(sage|ocean|warning|slate)"
---

<objective>
Add colorScheme prop to Button component using CVA compound variants, then migrate thermostat page mode buttons to use colorScheme instead of custom activeClassName overrides.

Purpose: Replace hard-coded Tailwind class strings with declarative, type-safe colorScheme API for consistent button tinting across the application.

Output: Button component with colorScheme support, thermostat page mode buttons using the new API.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-thermostat-page-compliance/23-CONTEXT.md
@.planning/phases/23-thermostat-page-compliance/23-RESEARCH.md

Key reference files:
@app/components/ui/Button.js - Current Button implementation with CVA
@app/components/ui/__tests__/Button.test.js - Existing Button tests
@app/thermostat/page.js - Thermostat page with mode buttons (lines 322-410)
@app/components/ui/Badge.js - Reference for variant pattern (sage, ocean, warning, etc.)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add colorScheme prop to Button component</name>
  <files>app/components/ui/Button.js</files>
  <action>
Add colorScheme variant to buttonVariants CVA configuration with compound variants pattern:

1. Add colorScheme variant with empty arrays (styling in compoundVariants):
   ```javascript
   colorScheme: {
     sage: [],
     ocean: [],
     warning: [],
     slate: [],
   },
   ```

2. Add compound variants for subtle + colorScheme combinations:
   - subtle + sage: bg-sage-500/20 text-sage-300 border border-sage-500/40 shadow-sm + light mode
   - subtle + ocean: bg-ocean-500/20 text-ocean-300 border border-ocean-500/40 shadow-sm + light mode
   - subtle + warning: bg-warning-500/20 text-warning-300 border border-warning-500/40 shadow-sm + light mode
   - subtle + slate: bg-slate-500/20 text-slate-300 border border-slate-500/40 shadow-sm + light mode

3. Add compound variants for ghost + colorScheme combinations:
   - ghost + sage: text-sage-300 hover:bg-sage-500/10 + light mode
   - ghost + ocean: text-ocean-300 hover:bg-ocean-500/10 + light mode
   - ghost + warning: text-warning-300 hover:bg-warning-500/10 + light mode
   - ghost + slate: text-slate-300 hover:bg-slate-500/10 + light mode

4. Update Button component signature to accept colorScheme prop (optional, no default)

5. Pass colorScheme to buttonVariants() call in className

IMPORTANT:
- Do NOT add colorScheme to defaultVariants (it should be undefined by default)
- colorScheme has NO effect on ember, success, danger, outline variants (only subtle and ghost)
- Every compound variant MUST include light mode overrides using [html:not(.dark)_&]:...
  </action>
  <verify>
Run `npm test -- --testPathPattern="Button.test"` - all existing tests must pass.
Manually inspect Button.js to confirm colorScheme is optional and doesn't change default behavior.
  </verify>
  <done>
Button component accepts colorScheme prop. Existing Button usage unchanged. subtle and ghost variants can be tinted with sage, ocean, warning, or slate colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add colorScheme tests to Button.test.js</name>
  <files>app/components/ui/__tests__/Button.test.js</files>
  <action>
Add new test describe block "colorScheme Compound Variants" with tests:

1. Test subtle + sage applies tinted background:
   - Render `<Button variant="subtle" colorScheme="sage">Test</Button>`
   - Verify button has `bg-sage-500/20` and `text-sage-300` classes

2. Test subtle + ocean applies ocean tinting:
   - Render `<Button variant="subtle" colorScheme="ocean">Test</Button>`
   - Verify button has `bg-ocean-500/20` and `text-ocean-300` classes

3. Test subtle + warning applies warning tinting:
   - Render `<Button variant="subtle" colorScheme="warning">Test</Button>`
   - Verify button has `bg-warning-500/20` and `text-warning-300` classes

4. Test subtle + slate applies slate tinting:
   - Render `<Button variant="subtle" colorScheme="slate">Test</Button>`
   - Verify button has `bg-slate-500/20` and `text-slate-300` classes

5. Test ghost + colorScheme applies text color:
   - Render `<Button variant="ghost" colorScheme="sage">Test</Button>`
   - Verify button has `text-sage-300` class

6. Test colorScheme without variant uses default (ember) - colorScheme ignored:
   - Render `<Button colorScheme="sage">Test</Button>`
   - Verify button has `bg-gradient-to-br` (ember gradient, not sage)

7. Test colorScheme has no effect on ember variant:
   - Render `<Button variant="ember" colorScheme="sage">Test</Button>`
   - Verify button still has `from-ember-500` class

8. Test accessibility for subtle+colorScheme combination:
   - Render `<Button variant="subtle" colorScheme="sage">Test</Button>`
   - Run axe, expect no violations
  </action>
  <verify>
Run `npm test -- --testPathPattern="Button.test"` - all tests including new colorScheme tests must pass.
  </verify>
  <done>
colorScheme prop has test coverage for all 4 colors with subtle and ghost variants, plus edge cases for default variant and ember ignoring colorScheme.
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate thermostat page mode buttons to use colorScheme</name>
  <files>app/thermostat/page.js</files>
  <action>
Refactor mode buttons (lines 322-410) to use colorScheme prop instead of activeClassName:

1. Update modeConfig object (lines 322-348) to use colorScheme key instead of activeClassName:
   ```javascript
   const modeConfig = {
     schedule: {
       label: 'Programmato',
       icon: '\u23F0',
       colorScheme: 'sage',
     },
     away: {
       label: 'Assenza',
       icon: '\uD83C\uDFC3',
       colorScheme: 'warning',
     },
     hg: {
       label: 'Antigelo',
       icon: '\u2744\uFE0F',
       colorScheme: 'ocean',
     },
     off: {
       label: 'Off',
       icon: '\u23F8\uFE0F',
       colorScheme: 'slate',
     },
   };
   ```

2. Update Button rendering (lines 399-409) to use colorScheme:
   ```jsx
   <Button
     key={targetMode}
     variant={isActive ? 'subtle' : 'ghost'}
     colorScheme={config.colorScheme}
     onClick={() => handleModeChange(targetMode)}
     size="sm"
   >
     <span>{config.icon}</span>
     <span>{config.label}</span>
   </Button>
   ```

REMOVE the `className={isActive ? config.activeClassName : undefined}` line - colorScheme now handles this declaratively.

Note: colorScheme is applied regardless of active state. The visual difference comes from variant (subtle when active = filled background, ghost when inactive = transparent).
  </action>
  <verify>
1. Run `npm run dev` and visit http://localhost:3000/thermostat
2. Verify mode buttons render correctly:
   - Active mode button has colored background (sage/warning/ocean/slate tinted)
   - Inactive mode buttons are ghost style with tinted text on hover
3. Click different modes and verify visual feedback is correct
  </verify>
  <done>
Thermostat page mode buttons use colorScheme prop. No hard-coded activeClassName overrides. Visual appearance matches previous implementation but with declarative API.
  </done>
</task>

</tasks>

<verification>
1. `npm test -- --testPathPattern="Button.test"` - All tests pass including new colorScheme tests
2. Thermostat page mode buttons work correctly with colorScheme prop
3. No regressions in other Button usages across the app (colorScheme is optional, defaults to undefined)
</verification>

<success_criteria>
- Button component has colorScheme prop with CVA compound variants for subtle and ghost
- 8+ new tests for colorScheme behavior
- Thermostat page mode buttons use colorScheme instead of activeClassName
- All existing tests pass
- Visual appearance unchanged (same sage/warning/ocean/slate tinting)
</success_criteria>

<output>
After completion, create `.planning/phases/23-thermostat-page-compliance/23-01-SUMMARY.md`
</output>
