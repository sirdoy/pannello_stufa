---
phase: 23-thermostat-page-compliance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/InfoBox.js
  - app/components/ui/__tests__/InfoBox.test.js
  - app/thermostat/page.js
autonomous: true

must_haves:
  truths:
    - "InfoBox component uses variant prop (renamed from valueColor) matching Badge palette"
    - "Thermostat page stat boxes use InfoBox component instead of raw divs"
    - "Thermostat page wrapped in PageLayout with proper header"
  artifacts:
    - path: "app/components/ui/InfoBox.js"
      provides: "InfoBox with variant prop matching Badge pattern"
      exports: ["InfoBox"]
    - path: "app/components/ui/__tests__/InfoBox.test.js"
      provides: "InfoBox variant and accessibility tests"
      contains: "variant"
    - path: "app/thermostat/page.js"
      provides: "PageLayout wrapper and InfoBox stat boxes"
      pattern: "PageLayout"
  key_links:
    - from: "app/thermostat/page.js"
      to: "app/components/ui/InfoBox.js"
      via: "InfoBox component import"
      pattern: "InfoBox"
    - from: "app/thermostat/page.js"
      to: "app/components/ui/PageLayout.js"
      via: "PageLayout wrapper"
      pattern: "PageLayout"
---

<objective>
Update InfoBox component to use variant prop (consistent with Badge), migrate thermostat page stat boxes to use InfoBox, and wrap the page in PageLayout with proper header.

Purpose: Complete design system compliance for thermostat page by replacing raw HTML elements with standardized components.

Output: InfoBox with variant prop, thermostat page using InfoBox for stat boxes and PageLayout for page structure.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-thermostat-page-compliance/23-CONTEXT.md
@.planning/phases/23-thermostat-page-compliance/23-RESEARCH.md

Key reference files:
@app/components/ui/InfoBox.js - Current InfoBox with valueColor prop
@app/components/ui/PageLayout.js - PageLayout component ready to use
@app/components/ui/Badge.js - Reference for variant naming (ember, sage, ocean, warning, danger, neutral)
@app/thermostat/page.js - Thermostat page (lines 350-510, stat boxes at 452-470)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update InfoBox to use variant prop</name>
  <files>app/components/ui/InfoBox.js</files>
  <action>
Rename valueColor prop to variant for consistency with Badge component:

1. Change prop name from `valueColor` to `variant` with default 'neutral':
   ```javascript
   export default function InfoBox({
     icon,
     label,
     value,
     variant = 'neutral',  // Renamed from valueColor
     layout = 'horizontal',
     className = '',
   })
   ```

2. Rename internal mapping from `valueColors` to `variantClasses` (already matches Badge palette):
   ```javascript
   const variantClasses = {
     neutral: 'text-slate-100 [html:not(.dark)_&]:text-slate-900',
     ember: 'text-ember-400 [html:not(.dark)_&]:text-ember-600',
     ocean: 'text-ocean-400 [html:not(.dark)_&]:text-ocean-600',
     sage: 'text-sage-400 [html:not(.dark)_&]:text-sage-600',
     warning: 'text-warning-400 [html:not(.dark)_&]:text-warning-600',
     danger: 'text-danger-400 [html:not(.dark)_&]:text-danger-600',
   };
   ```

3. Remove legacy mappings (primary, success, info) - they're not used anywhere:
   - Delete: `primary: 'text-ember-400...'`
   - Delete: `success: 'text-sage-400...'`
   - Delete: `info: 'text-ocean-400...'`

4. Update the value span to use variant:
   ```javascript
   <span className={`... ${variantClasses[variant]}`}>
   ```

5. Update JSDoc comment to reflect new prop name:
   ```javascript
   * @param {'neutral'|'ember'|'ocean'|'sage'|'warning'|'danger'} props.variant - Color variant for value text
   ```

Note: InfoBox already has the correct styling (liquid glass backdrop-blur). Just renaming for API consistency.
  </action>
  <verify>
Inspect InfoBox.js to confirm:
- Prop renamed from valueColor to variant
- Legacy mappings removed
- JSDoc updated
  </verify>
  <done>
InfoBox uses variant prop consistent with Badge component. API matches design system conventions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create InfoBox tests</name>
  <files>app/components/ui/__tests__/InfoBox.test.js</files>
  <action>
Create new test file for InfoBox component:

```javascript
import { render, screen } from '@testing-library/react';
import { axe } from 'jest-axe';
import InfoBox from '../InfoBox';

describe('InfoBox Component', () => {
  describe('Rendering', () => {
    test('renders with label and value', () => {
      render(<InfoBox label="Test Label" value="Test Value" />);
      expect(screen.getByText('Test Label')).toBeInTheDocument();
      expect(screen.getByText('Test Value')).toBeInTheDocument();
    });

    test('renders with icon', () => {
      render(<InfoBox icon="üè†" label="Casa" value="Home" />);
      expect(screen.getByText('üè†')).toBeInTheDocument();
    });
  });

  describe('Variants', () => {
    test('neutral variant applies slate text color', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" variant="neutral" />
      );
      const valueEl = container.querySelector('.text-slate-100');
      expect(valueEl).toBeInTheDocument();
    });

    test('ember variant applies ember text color', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" variant="ember" />
      );
      const valueEl = container.querySelector('.text-ember-400');
      expect(valueEl).toBeInTheDocument();
    });

    test('sage variant applies sage text color', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" variant="sage" />
      );
      const valueEl = container.querySelector('.text-sage-400');
      expect(valueEl).toBeInTheDocument();
    });

    test('ocean variant applies ocean text color', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" variant="ocean" />
      );
      const valueEl = container.querySelector('.text-ocean-400');
      expect(valueEl).toBeInTheDocument();
    });

    test('warning variant applies warning text color', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" variant="warning" />
      );
      const valueEl = container.querySelector('.text-warning-400');
      expect(valueEl).toBeInTheDocument();
    });

    test('danger variant applies danger text color', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" variant="danger" />
      );
      const valueEl = container.querySelector('.text-danger-400');
      expect(valueEl).toBeInTheDocument();
    });

    test('default variant is neutral', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" />
      );
      const valueEl = container.querySelector('.text-slate-100');
      expect(valueEl).toBeInTheDocument();
    });
  });

  describe('Accessibility', () => {
    test('has no accessibility violations', async () => {
      const { container } = render(
        <InfoBox icon="üè†" label="Casa" value="My Home" variant="neutral" />
      );
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });

    test('ember variant has no accessibility violations', async () => {
      const { container } = render(
        <InfoBox label="Status" value="Active" variant="ember" />
      );
      const results = await axe(container);
      expect(results).toHaveNoViolations();
    });
  });

  describe('Custom className', () => {
    test('applies custom className', () => {
      const { container } = render(
        <InfoBox label="Test" value="Value" className="custom-class" />
      );
      expect(container.firstChild).toHaveClass('custom-class');
    });
  });
});
```
  </action>
  <verify>
Run `npm test -- --testPathPattern="InfoBox.test"` - all tests must pass.
  </verify>
  <done>
InfoBox has comprehensive test coverage for all variants and accessibility.
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate thermostat page to PageLayout and InfoBox</name>
  <files>app/thermostat/page.js</files>
  <action>
Refactor thermostat page to use PageLayout wrapper and InfoBox for stat boxes:

1. Update imports at top of file:
   ```javascript
   import { Card, Button, Skeleton, ErrorAlert, Banner, Heading, Text, Grid, InfoBox, PageLayout } from '@/app/components/ui';
   ```

2. Replace outer wrapper div (line 351) with PageLayout:

   BEFORE (lines 350-360):
   ```jsx
   return (
     <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
       {/* Header */}
       <div className="mb-8">
         <Heading level={1} size="3xl" className="mb-2">
           Controllo Netatmo
         </Heading>
         <Text variant="secondary">
           Gestisci temperature e riscaldamento di tutte le stanze
         </Text>
       </div>
   ```

   AFTER:
   ```jsx
   return (
     <PageLayout
       maxWidth="7xl"
       header={
         <PageLayout.Header
           title="Controllo Netatmo"
           description="Gestisci temperature e riscaldamento di tutte le stanze"
         />
       }
     >
   ```

3. Replace raw stat box divs (lines 452-470) with InfoBox components:

   BEFORE:
   ```jsx
   <Grid cols={3} gap="sm" className="md:grid-cols-3">
     <div className="p-3 rounded-xl bg-slate-800/40 backdrop-blur-sm [html:not(.dark)_&]:bg-slate-100/60">
       <Text variant="label" size="xs" className="mb-1">Casa</Text>
       <Text variant="body" size="lg" weight="bold">
         {topology.home_name}
       </Text>
     </div>
     <div className="p-3 rounded-xl bg-slate-800/40 backdrop-blur-sm [html:not(.dark)_&]:bg-slate-100/60">
       <Text variant="label" size="xs" className="mb-1">Stanze</Text>
       <Text variant="body" size="lg" weight="bold">
         {rooms.length}
       </Text>
     </div>
     <div className="p-3 rounded-xl bg-slate-800/40 backdrop-blur-sm [html:not(.dark)_&]:bg-slate-100/60">
       <Text variant="label" size="xs" className="mb-1">Moduli</Text>
       <Text variant="body" size="lg" weight="bold">
         {modulesWithBattery?.length || 0}
       </Text>
     </div>
   </Grid>
   ```

   AFTER:
   ```jsx
   <Grid cols={3} gap="sm" className="md:grid-cols-3">
     <InfoBox
       icon="üè†"
       label="Casa"
       value={topology.home_name}
       variant="neutral"
     />
     <InfoBox
       icon="üö™"
       label="Stanze"
       value={rooms.length}
       variant="neutral"
     />
     <InfoBox
       icon="üì°"
       label="Moduli"
       value={modulesWithBattery?.length || 0}
       variant="neutral"
     />
   </Grid>
   ```

4. Close PageLayout at end of component:

   BEFORE:
   ```jsx
       </div>
     );
   ```

   AFTER:
   ```jsx
     </PageLayout>
   );
   ```

5. Also update the error state wrapper (lines 200-238) to use PageLayout:
   - Replace `<div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">` with `<PageLayout maxWidth="7xl">`
   - Remove manual header, use page structure naturally

Note: PageLayout.Header uses level={1} and size="2xl" by default. The original used size="3xl", but this is acceptable as PageLayout provides consistent page headers.
  </action>
  <verify>
1. Run `npm run dev` and visit http://localhost:3000/thermostat
2. Verify:
   - Page header shows "Controllo Netatmo" with description
   - Stat boxes (Casa, Stanze, Moduli) render with InfoBox liquid glass styling
   - Icons (üè†, üö™, üì°) appear in stat boxes
   - Layout spacing is consistent
3. Test responsiveness at mobile and desktop widths
  </verify>
  <done>
Thermostat page uses PageLayout wrapper with proper header. Stat boxes use InfoBox component. No raw HTML divs with manual styling remain for these elements.
  </done>
</task>

</tasks>

<verification>
1. `npm test -- --testPathPattern="InfoBox.test"` - All InfoBox tests pass
2. Thermostat page renders correctly with PageLayout and InfoBox
3. Visual appearance is consistent with design system
4. No hard-coded styling for stat boxes or page wrapper
</verification>

<success_criteria>
- InfoBox uses variant prop (renamed from valueColor)
- InfoBox has test coverage for all variants and accessibility
- Thermostat page wrapped in PageLayout with PageLayout.Header
- Stat boxes use InfoBox component with icons
- No raw div elements with manual styling for these UI patterns
</success_criteria>

<output>
After completion, create `.planning/phases/23-thermostat-page-compliance/23-02-SUMMARY.md`
</output>
