---
phase: 26-weather-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/weather/WeatherIcon.jsx
  - app/components/weather/weatherHelpers.js
autonomous: true

must_haves:
  truths:
    - "WeatherIcon renders correct Lucide icon for any WMO code 0-99"
    - "WeatherIcon renders filled/solid style icons (not outlined)"
    - "WeatherIcon renders day/night variants based on isNight prop"
    - "Temperature formatting returns one decimal precision (e.g., 18.5)"
    - "Temperature comparison returns descriptive Italian text"
  artifacts:
    - path: "app/components/weather/WeatherIcon.jsx"
      provides: "WMO code to Lucide icon mapping with day/night variants"
      min_lines: 80
      exports: ["WeatherIcon", "getWeatherLabel"]
    - path: "app/components/weather/weatherHelpers.js"
      provides: "Temperature formatting and comparison utilities"
      min_lines: 40
      exports: ["formatTemperature", "getTemperatureComparison"]
  key_links:
    - from: "app/components/weather/WeatherIcon.jsx"
      to: "lucide-react"
      via: "import weather icons"
      pattern: "import.*from.*lucide-react"
    - from: "app/components/weather/weatherHelpers.js"
      to: "lib/openMeteo.js"
      via: "reuses WMO_CODES for consistency"
      pattern: "WMO_CODES"
---

<objective>
Create the foundational WeatherIcon component and helper utilities for the weather card.

Purpose: These utilities are used by all weather components (CurrentConditions, ForecastRow, ForecastDaySheet). Creating them first enables parallel development of Plan 02 and Plan 03.

Output:
- WeatherIcon component that maps WMO weather codes to Lucide icons with day/night variants
- weatherHelpers.js with temperature formatting and indoor/outdoor comparison functions
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-weather-foundation/25-01-SUMMARY.md

# Existing WMO codes mapping (Italian descriptions)
@lib/openMeteo.js

# Design system patterns
@app/components/ui/SmartHomeCard.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WeatherIcon component</name>
  <files>app/components/weather/WeatherIcon.jsx</files>
  <action>
Create the WeatherIcon component that maps Open-Meteo WMO weather codes (0-99) to Lucide icons.

**Structure:**
```jsx
// app/components/weather/WeatherIcon.jsx
'use client';

import { Sun, Moon, Cloud, CloudSun, CloudMoon, Cloudy, CloudRain, CloudDrizzle, CloudSnow, CloudFog, CloudLightning, Droplets, Wind } from 'lucide-react';
```

**WMO_TO_LUCIDE mapping:**
- 0 (Clear sky): day=Sun, night=Moon
- 1 (Mainly clear): day=Sun, night=Moon
- 2 (Partly cloudy): day=CloudSun, night=CloudMoon
- 3 (Overcast): day=Cloudy, night=Cloudy
- 45, 48 (Fog): CloudFog for both
- 51, 53, 55, 56, 57 (Drizzle): CloudDrizzle for both
- 61, 63, 65, 66, 67 (Rain): CloudRain for both
- 71, 73, 75, 77 (Snow): CloudSnow for both
- 80, 81, 82 (Showers): CloudRain for both
- 85, 86 (Snow showers): CloudSnow for both
- 95, 96, 99 (Thunderstorm): CloudLightning for both

**Component props:**
- `code` (number): WMO weather code
- `isNight` (boolean, default false): Use night variant icons
- `className` (string): Additional CSS classes
- `size` (number, default 24): Icon size in pixels

**Critical styling requirements:**
- Use `fill="currentColor"` and `strokeWidth={0}` for filled/solid style (NOT outlined)
- Pass through className for color customization
- Include aria-label with weather description

**Export:**
- Default export: WeatherIcon component
- Named export: getWeatherLabel(code) function that returns Italian description

**Why NOT use lib/openMeteo.js WMO_CODES directly:**
- openMeteo.js returns `{ description, icon }` where icon is standard codes like '01', '09'
- We need Lucide React components directly
- Keep icon mapping in UI layer, weather descriptions in API layer
  </action>
  <verify>
- File exists at app/components/weather/WeatherIcon.jsx
- WeatherIcon renders Sun for code 0 with isNight=false
- WeatherIcon renders Moon for code 0 with isNight=true
- Icons are filled style (strokeWidth={0}, fill="currentColor")
- getWeatherLabel(0) returns 'Sereno'
  </verify>
  <done>
WeatherIcon component renders correct Lucide icon for any WMO code with filled style and day/night variants
  </done>
</task>

<task type="auto">
  <name>Task 2: Create weatherHelpers utilities</name>
  <files>app/components/weather/weatherHelpers.js</files>
  <action>
Create utility functions for weather data formatting and comparison.

**Functions to implement:**

1. `formatTemperature(temp)`:
   - Returns temperature with exactly one decimal precision
   - Example: formatTemperature(18.456) -> "18.5"
   - Example: formatTemperature(20) -> "20.0"
   - Returns string (NOT number) for consistent display

2. `getTemperatureComparison(outdoorTemp, indoorTemp)`:
   - Returns Italian text describing the difference
   - If diff < 1: "Stessa temperatura di casa"
   - If outdoor > indoor: "{diff}° piu caldo di casa"
   - If outdoor < indoor: "{diff}° piu freddo di casa"
   - Use toFixed(1) for difference value
   - Note: "piu" not "più" to avoid encoding issues

3. `formatWindSpeed(speed)`:
   - Returns formatted wind speed with unit
   - Example: formatWindSpeed(15.3) -> "15 km/h"
   - Round to integer for cleaner display

4. `getUVIndexLabel(uvIndex)`:
   - Returns Italian severity label
   - 0-2: "Basso"
   - 3-5: "Moderato"
   - 6-7: "Alto"
   - 8-10: "Molto alto"
   - 11+: "Estremo"

5. `getPrecipitationLabel(percent)`:
   - Returns precipitation chance description
   - 0-10: null (don't show)
   - 11-40: "Possibile pioggia"
   - 41-70: "Probabile pioggia"
   - 71+: "Pioggia prevista"

**Export all functions as named exports.**
  </action>
  <verify>
- File exists at app/components/weather/weatherHelpers.js
- formatTemperature(18.456) === "18.5"
- formatTemperature(20) === "20.0"
- getTemperatureComparison(25, 20) includes "piu caldo"
- getTemperatureComparison(15, 20) includes "piu freddo"
- getTemperatureComparison(20.3, 20.5) === "Stessa temperatura di casa"
  </verify>
  <done>
Weather helper utilities provide consistent temperature formatting and Italian comparison text
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Both files exist in app/components/weather/
2. WeatherIcon can be imported and renders icons
3. weatherHelpers functions return expected formats
4. No TypeScript/ESLint errors
</verification>

<success_criteria>
- WeatherIcon renders filled Lucide icons for all WMO codes (0-99)
- Day/night variants work correctly
- Temperature formatting produces consistent one-decimal output
- Temperature comparison returns proper Italian text
- All exports are named exports for tree-shaking
</success_criteria>

<output>
After completion, create `.planning/phases/26-weather-component/26-01-SUMMARY.md`
</output>
