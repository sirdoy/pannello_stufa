---
phase: 26-weather-component
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - app/components/weather/WeatherCard.jsx
  - app/components/weather/CurrentConditions.jsx
  - app/components/ui/Skeleton.js
autonomous: true

must_haves:
  truths:
    - "User sees current temperature prominently displayed"
    - "User sees 'feels like' temperature in the details grid"
    - "User sees humidity, wind, UV, pressure, visibility in details grid"
    - "User sees 'Updated X minutes ago' timestamp"
    - "User sees skeleton loading state while weather fetches"
    - "User sees error state with retry button when fetch fails"
    - "User sees indoor/outdoor temperature comparison text"
  artifacts:
    - path: "app/components/weather/WeatherCard.jsx"
      provides: "Main weather card component with SmartHomeCard structure"
      min_lines: 80
      exports: ["WeatherCard"]
    - path: "app/components/weather/CurrentConditions.jsx"
      provides: "Current weather display with temperature and details grid"
      min_lines: 100
      exports: ["CurrentConditions"]
    - path: "app/components/ui/Skeleton.js"
      provides: "Skeleton.WeatherCard loading state"
      contains: "Skeleton.WeatherCard"
  key_links:
    - from: "app/components/weather/WeatherCard.jsx"
      to: "app/components/ui/SmartHomeCard.js"
      via: "SmartHomeCard base component"
      pattern: "import.*SmartHomeCard"
    - from: "app/components/weather/CurrentConditions.jsx"
      to: "app/components/weather/WeatherIcon.jsx"
      via: "weather icon display"
      pattern: "import.*WeatherIcon"
    - from: "app/components/weather/CurrentConditions.jsx"
      to: "app/components/weather/weatherHelpers.js"
      via: "temperature formatting"
      pattern: "import.*formatTemperature"
---

<objective>
Create the main WeatherCard component with current conditions display and skeleton loading state.

Purpose: This is the container component that uses SmartHomeCard for consistent design. CurrentConditions displays the prominent temperature and weather details grid. Skeleton.WeatherCard provides loading UI that matches the final card structure.

Output:
- WeatherCard.jsx - Main container with loading/error/data states
- CurrentConditions.jsx - Temperature display and details grid
- Skeleton.WeatherCard - Loading skeleton matching card structure
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-weather-component/26-CONTEXT.md
@.planning/phases/26-weather-component/26-RESEARCH.md
@.planning/phases/25-weather-foundation/25-01-SUMMARY.md

# Design system components
@app/components/ui/SmartHomeCard.js
@app/components/ui/Skeleton.js
@app/components/ui/Badge.js
@app/components/ui/Text.js

# Weather API response shape
@app/api/weather/forecast/route.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WeatherCard container component</name>
  <files>app/components/weather/WeatherCard.jsx</files>
  <action>
Create the main WeatherCard component that wraps everything in SmartHomeCard.

**Component structure:**
```jsx
'use client';

import { SmartHomeCard, Badge, Button, Text } from '@/app/components/ui';
import { CloudSun, CloudOff, RefreshCw } from 'lucide-react';
import { formatDistanceToNow } from 'date-fns';
import { it } from 'date-fns/locale';
import Skeleton from '@/app/components/ui/Skeleton';
import { CurrentConditions } from './CurrentConditions';
```

**Props:**
- `weatherData` (object|null): Weather response from API with { current, forecast, cachedAt, stale }
- `indoorTemp` (number|null): Optional indoor temperature for comparison
- `isLoading` (boolean): Show skeleton state
- `error` (Error|null): Error object for error state
- `onRetry` (function): Callback when retry button clicked
- `onForecastDayClick` (function): Callback when forecast day is clicked - passes day data to parent

**States:**
1. **Loading (isLoading=true):** Render `<Skeleton.WeatherCard />`
2. **Error (error truthy):** Render SmartHomeCard with error state and retry button
3. **Data (weatherData exists):** Render full weather card

**Error state UI:**
```jsx
<SmartHomeCard
  icon={<CloudOff className="w-6 h-6 sm:w-8 sm:h-8" />}
  title="Meteo"
  colorTheme="ocean"
>
  <SmartHomeCard.Controls>
    <div className="text-center py-8">
      <Text variant="secondary" className="mb-4">
        {error.message || 'Impossibile caricare il meteo'}
      </Text>
      <Button
        variant="outline"
        size="sm"
        onClick={onRetry}
        leftIcon={<RefreshCw className="w-4 h-4" />}
      >
        Riprova
      </Button>
    </div>
  </SmartHomeCard.Controls>
</SmartHomeCard>
```

**Data state UI:**
```jsx
<SmartHomeCard
  icon={<CloudSun className="w-6 h-6 sm:w-8 sm:h-8" />}
  title="Meteo"
  colorTheme="ocean"
>
  <SmartHomeCard.Status>
    <Badge variant="ocean" size="sm">
      Aggiornato {formatDistanceToNow(new Date(cachedAt), { addSuffix: true, locale: it })}
    </Badge>
    {stale && (
      <Badge variant="warning" size="sm" className="ml-2">
        Aggiornamento in corso...
      </Badge>
    )}
  </SmartHomeCard.Status>

  <SmartHomeCard.Controls>
    <CurrentConditions
      current={weatherData.current}
      indoorTemp={indoorTemp}
    />
    {/* ForecastRow will be added by Plan 03 */}
    {children}
  </SmartHomeCard.Controls>
</SmartHomeCard>
```

**Export as named export and default export.**
  </action>
  <verify>
- File exists at app/components/weather/WeatherCard.jsx
- WeatherCard renders Skeleton.WeatherCard when isLoading=true
- WeatherCard renders error message and retry button when error is set
- WeatherCard renders SmartHomeCard with ocean theme when data exists
- "Aggiornato X minuti fa" appears with Italian locale
  </verify>
  <done>
WeatherCard container handles loading, error, and data states with SmartHomeCard structure
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CurrentConditions component</name>
  <files>app/components/weather/CurrentConditions.jsx</files>
  <action>
Create the current weather conditions display with prominent temperature and details grid.

**Component structure:**
```jsx
'use client';

import { Text } from '@/app/components/ui';
import { Droplets, Wind, Sun, Thermometer, Gauge, Eye } from 'lucide-react';
import { WeatherIcon, getWeatherLabel } from './WeatherIcon';
import { formatTemperature, getTemperatureComparison, formatWindSpeed, getUVIndexLabel } from './weatherHelpers';
```

**Props:**
- `current` (object): Current weather data from API
  - `temperature` (number)
  - `feelsLike` (number)
  - `humidity` (number)
  - `windSpeed` (number)
  - `condition` (object) with `{ description, icon }`
  - `units` (object) with temperature/wind units
- `indoorTemp` (number|null): Optional indoor temperature for comparison

**Layout structure (Apple Weather widget style):**

1. **Main display (top):**
   - Large weather icon (64px) on left
   - Temperature (large, e.g., "18.5°")
   - Condition description below temp ("Parzialmente nuvoloso")
   - Indoor comparison text below condition (if indoorTemp provided)

2. **Details grid (responsive):**
   - Mobile: 2 columns
   - Tablet (sm): 3 columns
   - Desktop (lg): 6 columns
   - Each cell: Icon, label, value

**Details grid items (in order):**
1. Humidity: Droplets icon, "Umidita", "{value}%"
2. Wind: Wind icon, "Vento", "{value} km/h"
3. UV Index: Sun icon (filled), "UV", "{value} - {label}"
4. Feels Like: Thermometer icon, "Percepita", "{value}°"
5. Pressure: Gauge icon, "Pressione", "{value} hPa" (if available)
6. Visibility: Eye icon, "Visibilita", "{value} km" (if available)

**Note:** UV, Pressure, and Visibility may not be in Phase 25 API response.
Check weatherData.current for available fields. Only render items that have data.

**Styling:**
- Grid cells: `flex flex-col items-center p-3 bg-slate-800/40 rounded-xl`
- Icons: `w-5 h-5 text-ocean-400` (use ocean theme to match card)
- Labels: `Text variant="tertiary" size="xs"`
- Values: `Text size="sm" weight="medium"`

**Indoor comparison (if indoorTemp provided):**
```jsx
<Text variant="secondary" size="sm" className="mt-1">
  {getTemperatureComparison(current.temperature, indoorTemp)}
</Text>
```

**Export as named export and default export.**
  </action>
  <verify>
- File exists at app/components/weather/CurrentConditions.jsx
- Large temperature displays with one decimal precision
- Weather icon displays matching the condition code
- Details grid shows humidity, wind, feels like at minimum
- Indoor/outdoor comparison text shows when indoorTemp provided
- Grid is responsive (2 cols mobile, 3 cols tablet, 6 cols desktop)
  </verify>
  <done>
CurrentConditions displays prominent temperature and weather details grid matching Apple Weather style
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Skeleton.WeatherCard to Skeleton.js</name>
  <files>app/components/ui/Skeleton.js</files>
  <action>
Add Skeleton.WeatherCard following the existing namespace pattern (like Skeleton.ThermostatCard).

**Add after Skeleton.LightsCard (around line 313):**

```jsx
/**
 * Skeleton.WeatherCard - Skeleton for WeatherCard component - Ember Noir
 */
Skeleton.WeatherCard = function SkeletonWeatherCard() {
  return (
    <div className="space-y-4 sm:space-y-6 animate-spring-in">
      <Skeleton.Card className="overflow-visible transition-all duration-500">
        <div className="relative">
          <div className="p-6 sm:p-8">
            {/* Header */}
            <div className="flex items-center gap-3 mb-6">
              <Skeleton className="h-8 w-8 rounded-full" />
              <Skeleton className="h-8 w-20" />
            </div>

            {/* Status badge */}
            <div className="mb-4">
              <Skeleton className="h-6 w-40 rounded-full" />
            </div>

            {/* Current conditions - main display */}
            <div className="mb-6">
              <div className="flex items-start gap-4 mb-4">
                {/* Weather icon */}
                <Skeleton className="h-16 w-16 rounded-full flex-shrink-0" />
                {/* Temperature + condition */}
                <div className="flex-1">
                  <Skeleton className="h-12 w-24 mb-2" />
                  <Skeleton className="h-5 w-40 mb-1" />
                  <Skeleton className="h-4 w-32" />
                </div>
              </div>

              {/* Weather details grid */}
              <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
                {[...Array(6)].map((_, i) => (
                  <div key={i} className="flex flex-col items-center p-3 bg-slate-800/40 rounded-xl [html:not(.dark)_&]:bg-slate-100/80">
                    <Skeleton className="h-5 w-5 rounded-full mb-2" />
                    <Skeleton className="h-3 w-12 mb-1" />
                    <Skeleton className="h-4 w-10" />
                  </div>
                ))}
              </div>
            </div>

            {/* Forecast row */}
            <div className="flex gap-3 overflow-x-hidden pb-2">
              {[...Array(5)].map((_, i) => (
                <div
                  key={i}
                  className="flex-shrink-0 w-20 p-3 rounded-xl bg-slate-800/40 [html:not(.dark)_&]:bg-slate-100/80"
                >
                  <Skeleton className="h-3 w-10 mx-auto mb-2" />
                  <Skeleton className="h-8 w-8 rounded-full mx-auto mb-2" />
                  <Skeleton className="h-4 w-12 mx-auto mb-1" />
                  <Skeleton className="h-3 w-8 mx-auto" />
                </div>
              ))}
            </div>
          </div>
        </div>
      </Skeleton.Card>
    </div>
  );
};
```

**Important:**
- Match the structure of the final WeatherCard layout
- Include both current conditions AND forecast row skeleton
- Use existing Skeleton.Card wrapper for consistent styling
- Follow light mode pattern: `[html:not(.dark)_&]:bg-slate-100/80`
  </action>
  <verify>
- Skeleton.WeatherCard exists in app/components/ui/Skeleton.js
- Skeleton matches WeatherCard layout (header, status, current, details grid, forecast)
- Uses existing Skeleton.Card wrapper
- Light mode styles included
  </verify>
  <done>
Skeleton.WeatherCard provides loading state that matches WeatherCard structure
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. WeatherCard.jsx handles loading/error/data states
2. CurrentConditions.jsx displays temperature and details grid
3. Skeleton.WeatherCard matches card structure
4. Components integrate with design system (SmartHomeCard, Badge, Text)
5. Italian text used for labels and comparison
6. No TypeScript/ESLint errors
</verification>

<success_criteria>
- WeatherCard renders skeleton when loading
- WeatherCard renders error state with retry when error occurs
- WeatherCard renders current conditions when data available
- CurrentConditions shows prominent temperature with weather icon
- CurrentConditions shows responsive details grid
- Indoor/outdoor comparison text displays when indoorTemp provided
- "Updated X minutes ago" badge shows with Italian locale
</success_criteria>

<output>
After completion, create `.planning/phases/26-weather-component/26-02-SUMMARY.md`
</output>
