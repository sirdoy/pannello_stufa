---
phase: 26-weather-component
plan: 04
type: execute
wave: 3
depends_on: ["26-02", "26-03"]
files_modified:
  - app/components/weather/index.js
autonomous: false

must_haves:
  truths:
    - "All weather components can be imported from single barrel file"
    - "WeatherCard integrates ForecastRow and ForecastDaySheet"
    - "User can visually verify weather card looks correct"
  artifacts:
    - path: "app/components/weather/index.js"
      provides: "Barrel export for all weather components"
      exports: ["WeatherCard", "CurrentConditions", "ForecastRow", "ForecastDayCard", "ForecastDaySheet", "WeatherIcon"]
  key_links:
    - from: "app/components/weather/index.js"
      to: "app/components/weather/*.jsx"
      via: "re-exports all components"
      pattern: "export.*from"
---

<objective>
Integrate all weather components, create barrel export, and verify visual appearance.

Purpose: Connects WeatherCard with ForecastRow and ForecastDaySheet, creates clean import path, and allows human verification of the complete weather card UI.

Output:
- index.js barrel file for clean imports
- Fully integrated WeatherCard
- Human verification of visual appearance
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-weather-component/26-CONTEXT.md

# All weather components from prior plans
@app/components/weather/WeatherCard.jsx
@app/components/weather/CurrentConditions.jsx
@app/components/weather/ForecastRow.jsx
@app/components/weather/ForecastDayCard.jsx
@app/components/weather/ForecastDaySheet.jsx
@app/components/weather/WeatherIcon.jsx
@app/components/weather/weatherHelpers.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create barrel export file</name>
  <files>app/components/weather/index.js</files>
  <action>
Create the barrel export file for all weather components.

```js
// app/components/weather/index.js

// Main card component
export { WeatherCard } from './WeatherCard';
export { default as WeatherCardDefault } from './WeatherCard';

// Current conditions
export { CurrentConditions } from './CurrentConditions';

// Forecast components
export { ForecastRow } from './ForecastRow';
export { ForecastDayCard } from './ForecastDayCard';
export { ForecastDaySheet } from './ForecastDaySheet';

// Icon and utilities
export { WeatherIcon, getWeatherLabel } from './WeatherIcon';
export {
  formatTemperature,
  getTemperatureComparison,
  formatWindSpeed,
  getUVIndexLabel,
  getPrecipitationLabel
} from './weatherHelpers';
```

This allows importing as:
```js
import { WeatherCard, WeatherIcon } from '@/app/components/weather';
```
  </action>
  <verify>
- File exists at app/components/weather/index.js
- All components are exported (WeatherCard, CurrentConditions, ForecastRow, etc.)
- Both named and default exports work for WeatherCard
- Helper functions are exported
  </verify>
  <done>
Barrel export file provides clean import path for all weather components
  </done>
</task>

<task type="auto">
  <name>Task 2: Update WeatherCard to integrate ForecastRow</name>
  <files>app/components/weather/WeatherCard.jsx</files>
  <action>
Update WeatherCard.jsx to integrate ForecastRow and manage ForecastDaySheet state.

**Add imports:**
```jsx
import { useState } from 'react';
import { ForecastRow } from './ForecastRow';
import { ForecastDaySheet } from './ForecastDaySheet';
```

**Add state for selected day:**
```jsx
const [selectedDay, setSelectedDay] = useState(null);
```

**Update data state section to include ForecastRow:**
Replace the placeholder comment `{/* ForecastRow will be added by Plan 03 */}` with:

```jsx
{/* Current conditions */}
<CurrentConditions
  current={weatherData.current}
  indoorTemp={indoorTemp}
/>

{/* Forecast row */}
{weatherData.forecast && weatherData.forecast.length > 0 && (
  <div className="mt-6 pt-6 border-t border-slate-700/30 [html:not(.dark)_&]:border-slate-200/50">
    <ForecastRow
      forecast={weatherData.forecast}
      onDayClick={setSelectedDay}
    />
  </div>
)}

{/* Forecast day detail sheet */}
<ForecastDaySheet
  day={selectedDay}
  isOpen={!!selectedDay}
  onClose={() => setSelectedDay(null)}
/>
```

**Also remove the `{children}` prop** - the WeatherCard is now self-contained.

**Updated component signature:**
Remove children from destructuring:
```jsx
export function WeatherCard({
  weatherData,
  indoorTemp,
  isLoading,
  error,
  onRetry,
}) {
```
  </action>
  <verify>
- WeatherCard includes ForecastRow
- ForecastRow is separated with border and padding
- Clicking forecast day opens ForecastDaySheet
- Sheet closes when setSelectedDay(null) called
- No children prop in component
  </verify>
  <done>
WeatherCard fully integrates CurrentConditions, ForecastRow, and ForecastDaySheet
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify weather card visual appearance</name>
  <what-built>
Complete WeatherCard component with:
- Current conditions display (temperature, icon, details grid)
- 5-day forecast horizontal scroll
- Bottom sheet for day details
- Loading skeleton and error states
  </what-built>
  <how-to-verify>
1. Create a test page to render WeatherCard with mock data:

**Create test file at `app/debug/weather-test/page.js`:**
```jsx
'use client';

import { useState } from 'react';
import { WeatherCard } from '@/app/components/weather';
import { PageLayout } from '@/app/components/ui';
import { Button } from '@/app/components/ui';

// Mock weather data matching API response shape
const mockWeatherData = {
  current: {
    temperature: 18.5,
    feelsLike: 16.2,
    humidity: 65,
    windSpeed: 12,
    condition: { description: 'Parzialmente nuvoloso', icon: '03' },
  },
  forecast: [
    { date: '2026-02-02', tempMax: 19.5, tempMin: 12.3, condition: { description: 'Sereno', icon: '01' }, weatherCode: 0, precipChance: 5 },
    { date: '2026-02-03', tempMax: 21.0, tempMin: 14.5, condition: { description: 'Parzialmente nuvoloso', icon: '03' }, weatherCode: 2, precipChance: 15 },
    { date: '2026-02-04', tempMax: 18.2, tempMin: 11.8, condition: { description: 'Pioggia leggera', icon: '10' }, weatherCode: 61, precipChance: 70 },
    { date: '2026-02-05', tempMax: 15.0, tempMin: 9.5, condition: { description: 'Pioggia moderata', icon: '10' }, weatherCode: 63, precipChance: 85 },
    { date: '2026-02-06', tempMax: 17.5, tempMin: 10.2, condition: { description: 'Nuvoloso', icon: '04' }, weatherCode: 3, precipChance: 20 },
  ],
  cachedAt: Date.now() - 5 * 60 * 1000, // 5 minutes ago
  stale: false,
};

export default function WeatherTestPage() {
  const [state, setState] = useState('data'); // 'loading', 'error', 'data'

  return (
    <PageLayout title="Weather Card Test">
      <div className="max-w-2xl mx-auto p-4 space-y-4">
        <div className="flex gap-2 mb-4">
          <Button
            variant={state === 'loading' ? 'ember' : 'outline'}
            onClick={() => setState('loading')}
          >
            Loading
          </Button>
          <Button
            variant={state === 'error' ? 'ember' : 'outline'}
            onClick={() => setState('error')}
          >
            Error
          </Button>
          <Button
            variant={state === 'data' ? 'ember' : 'outline'}
            onClick={() => setState('data')}
          >
            Data
          </Button>
        </div>

        <WeatherCard
          weatherData={state === 'data' ? mockWeatherData : null}
          indoorTemp={20.5}
          isLoading={state === 'loading'}
          error={state === 'error' ? new Error('Connessione non riuscita') : null}
          onRetry={() => setState('loading')}
        />
      </div>
    </PageLayout>
  );
}
```

2. Run `npm run dev` and navigate to `http://localhost:3000/debug/weather-test`

3. **Verify Loading State:**
   - Click "Loading" button
   - Skeleton matches card structure (header, current, details grid, forecast row)
   - Shimmer animation visible

4. **Verify Error State:**
   - Click "Error" button
   - Error message displays in Italian
   - Retry button is visible and styled

5. **Verify Data State:**
   - Click "Data" button
   - Temperature displays as "18.5°" (one decimal)
   - Weather icon is filled/solid (NOT outlined)
   - "Aggiornato 5 minuti fa" badge visible
   - Details grid shows humidity, wind, feels like
   - Indoor comparison text: "2.0° piu freddo di casa"
   - 5-day forecast row is horizontally scrollable
   - First day shows "Oggi"
   - Precipitation badges visible on days with > 10%
   - Tap forecast day opens bottom sheet with details

6. **Verify Responsive Behavior:**
   - Test on mobile viewport (details grid: 2 columns)
   - Test on tablet viewport (details grid: 3 columns)
   - Test on desktop viewport (details grid: 6 columns)

7. **Verify Bottom Sheet:**
   - Tap any forecast day
   - Sheet opens with day name and date
   - Shows temperature range (max in ember, min in ocean)
   - Shows extended stats grid
   - Sheet closes on backdrop click
   - Sheet closes on X button
  </how-to-verify>
  <resume-signal>
Type "approved" if all visual checks pass, or describe specific issues that need fixing
  </resume-signal>
</task>

</tasks>

<verification>
After completing all tasks:
1. All components exported from barrel file
2. WeatherCard integrates all subcomponents
3. Human verified visual appearance matches requirements
4. Loading, error, and data states work correctly
5. Bottom sheet opens/closes properly
6. Responsive behavior verified
</verification>

<success_criteria>
- Barrel export allows: `import { WeatherCard } from '@/app/components/weather'`
- WeatherCard displays current conditions and 5-day forecast
- Tapping forecast day opens bottom sheet
- All states (loading, error, data) render correctly
- Visual appearance matches Apple Weather widget style
- Human approves visual appearance
</success_criteria>

<output>
After completion, create `.planning/phases/26-weather-component/26-04-SUMMARY.md`
</output>
