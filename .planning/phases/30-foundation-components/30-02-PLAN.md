---
phase: 30-foundation-components
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Tabs.js
  - app/components/ui/__tests__/Tabs.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User can switch between tabs by clicking"
    - "User can navigate tabs with arrow keys (left/right for horizontal, up/down for vertical)"
    - "Active tab has underline indicator that slides smoothly"
    - "Screen reader announces tab role and selection state"
    - "Tabs support both horizontal and vertical orientations"
  artifacts:
    - path: "app/components/ui/Tabs.js"
      provides: "Tabs compound component with sliding indicator"
      exports: ["Tabs", "TabsList", "TabsTrigger", "TabsContent"]
    - path: "app/components/ui/__tests__/Tabs.test.js"
      provides: "Unit tests for Tabs component"
      min_lines: 100
  key_links:
    - from: "app/components/ui/Tabs.js"
      to: "@radix-ui/react-tabs"
      via: "Radix primitive wrapper"
      pattern: "TabsPrimitive"
    - from: "app/components/ui/Tabs.js"
      to: "useLayoutEffect"
      via: "DOM measurement for indicator"
      pattern: "useLayoutEffect.*getBoundingClientRect\\|offsetWidth"
    - from: "app/components/ui/index.js"
      to: "app/components/ui/Tabs.js"
      via: "barrel export"
      pattern: "export.*Tabs"
---

<objective>
Create the Tabs component using Radix UI primitive with sliding underline indicator, keyboard navigation, and Ember Noir styling.

Purpose: Provide a tabbed interface pattern for organizing content. This component will be immediately applied to the thermostat page (Schedule/Manual/History) in Plan 03.

Output: Production-ready Tabs component with horizontal/vertical orientation, icon support, overflow scrolling, and accessible keyboard navigation.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-foundation-components/30-CONTEXT.md
@.planning/phases/30-foundation-components/30-RESEARCH.md
@app/components/ui/Modal.js
@app/components/ui/Button.js
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tabs component with sliding indicator</name>
  <files>app/components/ui/Tabs.js</files>
  <action>
Create Tabs component following established patterns:

1. **Imports and setup:**
   ```javascript
   'use client';

   import { forwardRef, useLayoutEffect, useRef, useState, createContext, useContext } from 'react';
   import * as TabsPrimitive from '@radix-ui/react-tabs';
   import { cva } from 'class-variance-authority';
   import { cn } from '@/lib/utils/cn';
   ```

2. **Context for value tracking (needed for indicator):**
   ```javascript
   const TabsContext = createContext({ value: undefined });
   ```

3. **CVA variants for TabsList:**
   ```javascript
   const listVariants = cva(
     [
       'relative flex gap-1',
       'border-b border-white/[0.06]',
       '[html:not(.dark)_&]:border-black/[0.06]',
     ],
     {
       variants: {
         orientation: {
           horizontal: 'flex-row',
           vertical: 'flex-col border-b-0 border-r',
         },
         overflow: {
           scroll: 'overflow-x-auto scrollbar-hide',
           wrap: 'flex-wrap',
         },
       },
       defaultVariants: {
         orientation: 'horizontal',
         overflow: 'scroll',
       },
     }
   );
   ```

4. **CVA variants for TabsTrigger:**
   ```javascript
   const triggerVariants = cva(
     [
       'px-4 py-2.5 min-h-[44px]',
       'font-display font-medium text-sm',
       'text-slate-400 hover:text-slate-200',
       '[html:not(.dark)_&]:text-slate-600 [html:not(.dark)_&]:hover:text-slate-900',
       'transition-colors duration-200',
       // Focus ring
       'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ember-500/50 focus-visible:ring-inset',
       // Active state
       'data-[state=active]:text-slate-100',
       '[html:not(.dark)_&]:data-[state=active]:text-slate-900',
     ],
     {
       variants: {
         size: {
           sm: 'px-3 py-2 text-xs min-h-[36px]',
           md: 'px-4 py-2.5 text-sm min-h-[44px]',
           lg: 'px-5 py-3 text-base min-h-[48px]',
         },
       },
       defaultVariants: { size: 'md' },
     }
   );
   ```

5. **Sliding indicator implementation in TabsList:**
   - Use useLayoutEffect to measure active tab position
   - Store {width, left} in state
   - Render absolutely positioned span with CSS transition
   - Use `data-state="active"` selector to find active tab
   - Add initial opacity:0 until first measurement to prevent flicker

   ```javascript
   const TabsList = forwardRef(function TabsList(
     { children, className, orientation = 'horizontal', overflow, ...props },
     ref
   ) {
     const { value } = useContext(TabsContext);
     const [indicatorStyle, setIndicatorStyle] = useState({ width: 0, left: 0, opacity: 0 });
     const listRef = useRef(null);

     useLayoutEffect(() => {
       const activeTab = listRef.current?.querySelector('[data-state="active"]');
       if (activeTab) {
         setIndicatorStyle({
           width: activeTab.offsetWidth,
           left: activeTab.offsetLeft,
           opacity: 1,
         });
       }
     }, [value]);

     return (
       <TabsPrimitive.List
         ref={(node) => {
           listRef.current = node;
           if (typeof ref === 'function') ref(node);
           else if (ref) ref.current = node;
         }}
         className={cn(listVariants({ orientation, overflow }), className)}
         {...props}
       >
         {children}
         {/* Sliding indicator */}
         <span
           className={cn(
             'absolute h-0.5 bg-ember-500',
             '[html:not(.dark)_&]:bg-ember-700',
             'transition-all duration-300',
             // Use ease-out-expo for smooth deceleration
             '[transition-timing-function:cubic-bezier(0.16,1,0.3,1)]',
             'motion-reduce:transition-none',
             orientation === 'horizontal' ? 'bottom-0' : 'right-0 w-0.5 h-auto',
           )}
           style={orientation === 'horizontal'
             ? indicatorStyle
             : { height: indicatorStyle.width, top: indicatorStyle.left, opacity: indicatorStyle.opacity }
           }
           aria-hidden="true"
         />
       </TabsPrimitive.List>
     );
   });
   ```

6. **TabsTrigger with icon support:**
   ```javascript
   const TabsTrigger = forwardRef(function TabsTrigger(
     { children, className, size, icon, ...props },
     ref
   ) {
     return (
       <TabsPrimitive.Trigger
         ref={ref}
         className={cn(triggerVariants({ size }), className)}
         {...props}
       >
         <span className="flex items-center gap-2">
           {icon && <span className="text-lg shrink-0" aria-hidden="true">{icon}</span>}
           {children}
         </span>
       </TabsPrimitive.Trigger>
     );
   });
   ```

7. **TabsContent with fade transition:**
   ```javascript
   const TabsContent = forwardRef(function TabsContent(
     { children, className, ...props },
     ref
   ) {
     return (
       <TabsPrimitive.Content
         ref={ref}
         className={cn(
           'focus-visible:outline-none',
           // Fade transition between panels
           'data-[state=active]:animate-fade-in',
           'motion-reduce:animate-none',
           className
         )}
         {...props}
       >
         {children}
       </TabsPrimitive.Content>
     );
   });
   ```

8. **Root component with context provider:**
   ```javascript
   function Tabs({ children, value, defaultValue, onValueChange, orientation, ...props }) {
     const [internalValue, setInternalValue] = useState(defaultValue);
     const currentValue = value ?? internalValue;

     const handleValueChange = (newValue) => {
       setInternalValue(newValue);
       onValueChange?.(newValue);
     };

     return (
       <TabsContext.Provider value={{ value: currentValue }}>
         <TabsPrimitive.Root
           value={value}
           defaultValue={defaultValue}
           onValueChange={handleValueChange}
           orientation={orientation}
           {...props}
         >
           {children}
         </TabsPrimitive.Root>
       </TabsContext.Provider>
     );
   }
   ```

9. **Namespace pattern:**
   ```javascript
   Tabs.List = TabsList;
   Tabs.Trigger = TabsTrigger;
   Tabs.Content = TabsContent;

   export { Tabs, TabsList, TabsTrigger, TabsContent };
   export default Tabs;
   ```
  </action>
  <verify>File exists at app/components/ui/Tabs.js with ~180-220 lines, exports Tabs with namespace components</verify>
  <done>Tabs component with sliding underline indicator, horizontal/vertical orientation, icon support, and CVA size variants</done>
</task>

<task type="auto">
  <name>Task 2: Add Tabs tests and barrel export</name>
  <files>app/components/ui/__tests__/Tabs.test.js, app/components/ui/index.js</files>
  <action>
1. **Create test file** at `app/components/ui/__tests__/Tabs.test.js`:

Test cases to cover:
- Renders tabs with correct initial active state
- Click changes active tab
- Arrow keys navigate between tabs (Radix handles, verify works)
- Vertical orientation uses up/down arrows
- Icon renders with trigger text
- Size variants apply correct classes
- Indicator has correct position (check style attribute)
- Content panels show/hide correctly
- Accessibility: tabs have role="tab", panels have role="tabpanel"
- Controlled mode works (value prop)
- Uncontrolled mode works (defaultValue prop)

Example test structure:
```javascript
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { Tabs } from '../Tabs';
import { Calendar } from 'lucide-react';

describe('Tabs', () => {
  const renderTabs = (props = {}) => render(
    <Tabs defaultValue="tab1" {...props}>
      <Tabs.List>
        <Tabs.Trigger value="tab1">Tab 1</Tabs.Trigger>
        <Tabs.Trigger value="tab2">Tab 2</Tabs.Trigger>
        <Tabs.Trigger value="tab3" icon={<Calendar />}>Tab 3</Tabs.Trigger>
      </Tabs.List>
      <Tabs.Content value="tab1">Content 1</Tabs.Content>
      <Tabs.Content value="tab2">Content 2</Tabs.Content>
      <Tabs.Content value="tab3">Content 3</Tabs.Content>
    </Tabs>
  );

  it('renders with default active tab', () => {
    renderTabs();
    expect(screen.getByRole('tab', { name: 'Tab 1' })).toHaveAttribute('data-state', 'active');
    expect(screen.getByText('Content 1')).toBeVisible();
  });

  it('changes tab on click', async () => {
    const user = userEvent.setup();
    renderTabs();

    await user.click(screen.getByRole('tab', { name: 'Tab 2' }));

    expect(screen.getByRole('tab', { name: 'Tab 2' })).toHaveAttribute('data-state', 'active');
    expect(screen.getByText('Content 2')).toBeVisible();
  });

  it('navigates with arrow keys', async () => {
    const user = userEvent.setup();
    renderTabs();

    // Focus first tab
    screen.getByRole('tab', { name: 'Tab 1' }).focus();
    // Press right arrow
    await user.keyboard('{ArrowRight}');

    expect(screen.getByRole('tab', { name: 'Tab 2' })).toHaveFocus();
  });

  it('renders icon with trigger', () => {
    renderTabs();
    const tab3 = screen.getByRole('tab', { name: /Tab 3/i });
    expect(tab3.querySelector('svg')).toBeInTheDocument();
  });

  // ... more tests for size, orientation, controlled mode
});
```

2. **Update barrel export** in `app/components/ui/index.js`:

Add after Popover exports (or alphabetically):
```javascript
// Tabs (v4.0+)
export { default as Tabs, TabsList, TabsTrigger, TabsContent } from './Tabs';
```
  </action>
  <verify>`npm test -- Tabs` passes all tests; Tabs is exported from index.js</verify>
  <done>Tabs has 10+ unit tests covering click, keyboard nav, icons, orientation, accessibility; component is exported from barrel</done>
</task>

</tasks>

<verification>
1. **Component renders:** Import Tabs from `@/app/components/ui` and render basic example
2. **Click navigation:** Clicking tab triggers change, shows corresponding content
3. **Keyboard navigation:** Arrow keys move focus, activation follows focus (automatic mode)
4. **Sliding indicator:** Underline smoothly animates from old tab to new tab
5. **Vertical orientation:** With `orientation="vertical"`, indicator is on right side, up/down arrows navigate
6. **Icons:** `icon={<Calendar />}` renders icon left of text
7. **Sizes:** `size="sm"` applies smaller padding/text
8. **Tests pass:** `npm test -- Tabs` shows all green
9. **Export works:** `import { Tabs } from '@/app/components/ui'` resolves correctly
</verification>

<success_criteria>
- Tabs component exists with sliding underline indicator
- Supports horizontal and vertical orientations
- Supports icon + text labels
- Arrow key navigation works (Radix WAI-ARIA Tabs pattern)
- All 5 TABS requirements satisfied
- Unit tests pass
- Exported from barrel file
</success_criteria>

<output>
After completion, create `.planning/phases/30-foundation-components/30-02-SUMMARY.md`
</output>
