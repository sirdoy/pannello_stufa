---
phase: 30-foundation-components
plan: 03
type: execute
wave: 2
depends_on: ["30-02"]
files_modified:
  - app/thermostat/page.js
  - app/thermostat/schedule/page.js
  - app/thermostat/components/ThermostatTabs.js
autonomous: true

must_haves:
  truths:
    - "Thermostat page displays three tabs: Schedule, Manual, History"
    - "Tabs are positioned at bottom on mobile (thumb-friendly) and below header on desktop"
    - "Each tab has an icon (Calendar, Sliders, Clock)"
    - "Default selection is Schedule tab"
    - "Tab content shows appropriate sections (existing schedule UI, manual controls, history)"
  artifacts:
    - path: "app/thermostat/components/ThermostatTabs.js"
      provides: "Thermostat-specific tabs wrapper with responsive positioning"
      exports: ["ThermostatTabs"]
    - path: "app/thermostat/page.js"
      provides: "Updated thermostat page with tabs layout"
      contains: "ThermostatTabs"
  key_links:
    - from: "app/thermostat/components/ThermostatTabs.js"
      to: "app/components/ui/Tabs.js"
      via: "import Tabs component"
      pattern: "import.*Tabs.*from.*components/ui"
    - from: "app/thermostat/page.js"
      to: "app/thermostat/components/ThermostatTabs.js"
      via: "import and render"
      pattern: "ThermostatTabs"
---

<objective>
Apply the Tabs component to the thermostat page, creating a tabbed interface for Schedule, Manual controls, and History views.

Purpose: Demonstrate the Tabs component in a real application context. The tabs provide organized access to thermostat functionality with mobile-optimized positioning (bottom tabs on mobile for thumb accessibility).

Output: Thermostat page restructured with tabbed navigation, responsive positioning, and proper content organization.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-foundation-components/30-CONTEXT.md
@.planning/phases/30-foundation-components/30-02-SUMMARY.md
@app/thermostat/page.js
@app/thermostat/schedule/page.js
@app/components/ui/Tabs.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThermostatTabs wrapper component</name>
  <files>app/thermostat/components/ThermostatTabs.js</files>
  <action>
Create a thermostat-specific tabs wrapper with responsive positioning:

1. **Create directory if needed:** `app/thermostat/components/`

2. **Create ThermostatTabs.js:**

```javascript
'use client';

import { Tabs } from '@/app/components/ui';
import { Calendar, SlidersHorizontal, Clock } from 'lucide-react';
import { cn } from '@/lib/utils/cn';

/**
 * ThermostatTabs - Tabbed interface for thermostat page
 *
 * Features:
 * - Three tabs: Schedule, Manual, History
 * - Icons for each tab (Calendar, Sliders, Clock)
 * - Responsive positioning:
 *   - Mobile: fixed to bottom of screen (thumb-friendly)
 *   - Desktop: static position below header
 * - Default tab: Schedule
 *
 * @param {Object} props
 * @param {string} props.defaultValue - Initial selected tab (default: 'schedule')
 * @param {Function} props.onTabChange - Callback when tab changes
 * @param {ReactNode} props.scheduleContent - Content for Schedule tab
 * @param {ReactNode} props.manualContent - Content for Manual tab
 * @param {ReactNode} props.historyContent - Content for History tab
 * @param {string} props.className - Additional classes for root
 */
export function ThermostatTabs({
  defaultValue = 'schedule',
  onTabChange,
  scheduleContent,
  manualContent,
  historyContent,
  className,
}) {
  return (
    <Tabs
      defaultValue={defaultValue}
      onValueChange={onTabChange}
      className={cn('flex flex-col', className)}
    >
      {/* Tab list - responsive positioning */}
      <div
        className={cn(
          // Mobile: fixed bottom (thumb zone)
          'max-md:fixed max-md:bottom-0 max-md:left-0 max-md:right-0 max-md:z-40',
          'max-md:bg-slate-900/95 [html:not(.dark)_&]:max-md:bg-white/95',
          'max-md:backdrop-blur-xl',
          'max-md:border-t max-md:border-white/[0.06]',
          '[html:not(.dark)_&]:max-md:border-black/[0.06]',
          'max-md:pb-[env(safe-area-inset-bottom)]',
          // Desktop: normal flow
          'md:static md:bg-transparent md:border-0 md:pb-0',
        )}
      >
        <Tabs.List className="max-md:justify-around md:justify-start">
          <Tabs.Trigger
            value="schedule"
            icon={<Calendar className="w-5 h-5" />}
          >
            Schedule
          </Tabs.Trigger>
          <Tabs.Trigger
            value="manual"
            icon={<SlidersHorizontal className="w-5 h-5" />}
          >
            Manual
          </Tabs.Trigger>
          <Tabs.Trigger
            value="history"
            icon={<Clock className="w-5 h-5" />}
          >
            History
          </Tabs.Trigger>
        </Tabs.List>
      </div>

      {/* Content panels - add bottom padding on mobile for fixed tabs */}
      <div className="max-md:pb-20 md:pb-0">
        <Tabs.Content value="schedule" className="pt-4">
          {scheduleContent}
        </Tabs.Content>
        <Tabs.Content value="manual" className="pt-4">
          {manualContent}
        </Tabs.Content>
        <Tabs.Content value="history" className="pt-4">
          {historyContent}
        </Tabs.Content>
      </div>
    </Tabs>
  );
}

export default ThermostatTabs;
```

Key decisions from CONTEXT.md:
- Icons: Calendar (Schedule), SlidersHorizontal (Manual), Clock (History)
- Mobile: fixed bottom with safe-area-inset for iOS
- Desktop: static position below header
- Default: Schedule tab
  </action>
  <verify>File exists at app/thermostat/components/ThermostatTabs.js with responsive positioning logic</verify>
  <done>ThermostatTabs wrapper with mobile bottom positioning, desktop top positioning, and three tab triggers with icons</done>
</task>

<task type="auto">
  <name>Task 2: Update thermostat page to use tabs</name>
  <files>app/thermostat/page.js</files>
  <action>
Refactor the thermostat page to use ThermostatTabs:

1. **Import ThermostatTabs:**
   ```javascript
   import ThermostatTabs from './components/ThermostatTabs';
   ```

2. **Restructure content into tab panels:**

The current page has these main sections:
- Mode Control card (schedule/away/hg/off buttons)
- Schedule Management Link card (links to /thermostat/schedule)
- Stove-Thermostat Sync Configuration
- Topology Info card (Casa/Stanze/Moduli)
- Rooms Grid

Reorganize into tabs:

**Schedule Tab Content:**
- Mode Control card (keep as-is)
- Schedule Management Link card (keep as-is, links to /thermostat/schedule for detailed view)
- Active schedule preview (optional enhancement)

**Manual Tab Content:**
- Stove-Thermostat Sync Configuration (StoveSyncPanel)
- Rooms Grid with temperature controls (RoomCard components)

**History Tab Content:**
- Placeholder for now: "History feature coming in Phase 34"
- Or link to existing monitoring pages if applicable

3. **Update NetatmoContent function:**

```javascript
return (
  <PageLayout
    maxWidth="7xl"
    header={
      <PageLayout.Header
        title="Controllo Netatmo"
        description="Gestisci temperature e riscaldamento di tutte le stanze"
      />
    }
  >
    {/* Error Alert - above tabs */}
    {error && (
      <div className="mb-6">
        <ErrorAlert message={error} />
      </div>
    )}

    {/* Battery Warning Banner - above tabs */}
    {(status?.hasLowBattery || status?.hasCriticalBattery) && (
      <div className="mb-6">
        <BatteryWarning
          lowBatteryModules={status?.lowBatteryModules || []}
          hasCriticalBattery={status?.hasCriticalBattery || false}
        />
      </div>
    )}

    <ThermostatTabs
      defaultValue="schedule"
      scheduleContent={
        <>
          {/* Mode Control */}
          <Card variant="glass" className="p-5 sm:p-6 mb-6">
            {/* ... existing mode control JSX ... */}
          </Card>

          {/* Schedule Management Link */}
          <Card variant="glass" className="p-5 sm:p-6 mb-6">
            {/* ... existing schedule link JSX ... */}
          </Card>

          {/* Topology Info */}
          <Card variant="glass" className="p-5 sm:p-6">
            {/* ... existing topology info JSX ... */}
          </Card>
        </>
      }
      manualContent={
        <>
          {/* Stove Sync Panel */}
          <div className="mb-6">
            <StoveSyncPanel onSyncComplete={fetchStatus} />
          </div>

          {/* Rooms Grid */}
          <Grid cols={3} gap="md">
            {sortedRooms.map(room => (
              <RoomCard
                key={room.id}
                room={room}
                onRefresh={fetchStatus}
              />
            ))}
          </Grid>

          {/* Empty State */}
          {rooms.length === 0 && (
            <Card variant="default" className="p-12 text-center">
              <Text variant="tertiary">
                Nessuna stanza configurata.
              </Text>
            </Card>
          )}
        </>
      }
      historyContent={
        <Card variant="glass" className="p-8 text-center">
          <div className="flex flex-col items-center gap-4">
            <Clock className="w-12 h-12 text-slate-400" />
            <Heading level={3} size="lg">
              Storico Temperatura
            </Heading>
            <Text variant="secondary">
              Lo storico delle temperature sar√† disponibile in un prossimo aggiornamento.
            </Text>
          </div>
        </Card>
      }
    />
  </PageLayout>
);
```

4. **Add Clock import:**
   ```javascript
   import { Calendar, Clock } from 'lucide-react';
   ```

5. **Keep all existing logic intact:**
   - Connection checking
   - Topology fetching
   - Status polling
   - Mode change handling
   - Refresh handling
  </action>
  <verify>Thermostat page renders with three tabs, content displays correctly in each tab, mobile shows bottom tabs</verify>
  <done>Thermostat page uses ThermostatTabs with Schedule/Manual/History organization, responsive positioning works on mobile/desktop</done>
</task>

<task type="auto">
  <name>Task 3: Update schedule page navigation</name>
  <files>app/thermostat/schedule/page.js</files>
  <action>
The schedule page at /thermostat/schedule should now link back to the main thermostat page which uses tabs. No major changes needed, but verify:

1. **Back button works correctly:**
   The existing back button uses `router.push('/thermostat')` which is correct.

2. **Consider adding tab state preservation (optional):**
   If user navigates from Schedule tab to /thermostat/schedule and back, they should return to Schedule tab. The defaultValue="schedule" handles this.

3. **Minor enhancement - update description:**
   Change the description text to clarify this is the detailed schedule view:
   ```javascript
   <Text variant="secondary" className="mt-1">
     Vista dettagliata delle programmazioni settimanali
   </Text>
   ```

4. **No structural changes needed** - the schedule page is a separate detailed view that complements the Schedule tab. The tab shows quick access to mode control and schedule link, this page shows full timeline and override management.

This task is minimal - just verify the integration works and the navigation flow is correct.
  </action>
  <verify>Back button on schedule page returns to thermostat page, schedule tab is selected by default</verify>
  <done>Schedule page integrates correctly with new tabbed thermostat page, navigation flow works</done>
</task>

</tasks>

<verification>
1. **Tabs render:** Thermostat page shows three tabs (Schedule, Manual, History)
2. **Default selection:** Schedule tab is active on initial load
3. **Tab switching:** Clicking tabs shows correct content
4. **Icons visible:** Each tab has its icon (Calendar, Sliders, Clock)
5. **Mobile positioning:** On mobile viewport (< 768px), tabs are fixed to bottom
6. **Desktop positioning:** On desktop, tabs are below header in normal flow
7. **Content preserved:** All existing functionality (mode control, room cards, etc.) works
8. **Keyboard navigation:** Arrow keys cycle through tabs
9. **Schedule link:** "Programmazione" card links to /thermostat/schedule
10. **Back navigation:** /thermostat/schedule back button returns to main page
</verification>

<success_criteria>
- ThermostatTabs component exists with responsive positioning
- Thermostat page restructured with three tabs
- Schedule tab shows mode control and schedule link
- Manual tab shows room controls and sync panel
- History tab shows placeholder message
- Mobile: tabs fixed to bottom with safe area inset
- Desktop: tabs below header in normal flow
- All existing functionality preserved
- APPL-01 requirement satisfied (Tabs used on thermostat page)
</success_criteria>

<output>
After completion, create `.planning/phases/30-foundation-components/30-03-SUMMARY.md`
</output>
