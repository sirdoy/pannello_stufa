---
phase: 31-expandable-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - app/components/ui/Accordion.js
  - app/components/ui/__tests__/Accordion.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User can expand/collapse Accordion sections with click"
    - "User can toggle Accordion with Enter/Space keys"
    - "Accordion supports single-open mode (type='single')"
    - "Accordion supports multiple-open mode (type='multiple')"
    - "Expand/collapse has smooth height animation"
    - "Screen reader announces expanded/collapsed state via aria-expanded"
  artifacts:
    - path: "app/components/ui/Accordion.js"
      provides: "Accordion component with namespace pattern"
      min_lines: 150
      exports: ["Accordion", "AccordionItem", "AccordionTrigger", "AccordionContent"]
    - path: "app/components/ui/__tests__/Accordion.test.js"
      provides: "Test coverage for Accordion"
      min_lines: 200
    - path: "app/globals.css"
      provides: "Accordion animation keyframes"
      contains: "accordion-down"
  key_links:
    - from: "app/components/ui/Accordion.js"
      to: "@radix-ui/react-accordion"
      via: "import * as AccordionPrimitive"
      pattern: "AccordionPrimitive\\.Root"
    - from: "app/globals.css"
      to: "Accordion.js"
      via: "animate-accordion-down/up classes"
      pattern: "data-\\[state=open\\]:animate-accordion-down"
---

<objective>
Create Accordion component with Radix UI primitives, CVA variants, smooth height animation, and full accessibility support.

Purpose: Provide collapsible content sections for FAQ, help text, and device details following Ember Noir design patterns.
Output: Accordion.js component with tests and barrel export.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/31-expandable-components/31-RESEARCH.md
@.planning/phases/31-expandable-components/31-CONTEXT.md
@app/components/ui/Modal.js
@app/components/ui/Tabs.js
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Radix Accordion and add CSS keyframes</name>
  <files>app/globals.css, package.json</files>
  <action>
1. Install @radix-ui/react-accordion:
   ```bash
   npm install @radix-ui/react-accordion
   ```

2. Add accordion animation keyframes to globals.css in the @layer components section (after existing keyframes around line 900):
   ```css
   @keyframes accordion-down {
     from {
       height: 0;
       opacity: 0;
     }
     to {
       height: var(--radix-accordion-content-height);
       opacity: 1;
     }
   }

   @keyframes accordion-up {
     from {
       height: var(--radix-accordion-content-height);
       opacity: 1;
     }
     to {
       height: 0;
       opacity: 0;
     }
   }

   .animate-accordion-down {
     animation: accordion-down 0.3s var(--ease-out-expo) forwards;
   }

   .animate-accordion-up {
     animation: accordion-up 0.2s ease-in;
   }
   ```

   Note: Do NOT use `forwards` on accordion-up to avoid React 18 flicker issue.

3. Add prefers-reduced-motion handling for accordion animations (add to existing @media query if present, otherwise create):
   ```css
   @media (prefers-reduced-motion: reduce) {
     .animate-accordion-down,
     .animate-accordion-up {
       animation: none !important;
       transition: none !important;
     }
   }
   ```
  </action>
  <verify>
- `npm ls @radix-ui/react-accordion` shows installed version
- `grep -n "accordion-down" app/globals.css` shows keyframes added
- `grep -n "prefers-reduced-motion" app/globals.css` confirms motion preference handling
  </verify>
  <done>
- @radix-ui/react-accordion installed
- Accordion keyframes added to globals.css with height animation using Radix CSS variables
- prefers-reduced-motion respected
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Accordion component with CVA variants</name>
  <files>app/components/ui/Accordion.js</files>
  <action>
Create Accordion.js following the Modal.js/Tabs.js pattern:

1. **Imports:**
   - `@radix-ui/react-accordion` as AccordionPrimitive
   - `forwardRef` from React
   - `cva` from class-variance-authority
   - `cn` from @/lib/utils/cn
   - `ChevronDown` from lucide-react (rotating indicator)

2. **CVA Variants:**
   - `itemVariants`: border-b styling, last:border-b-0
   - `triggerVariants`:
     - min-h-[48px] for touch targets (CONTEXT.md requirement)
     - flex layout with justify-between
     - Ember Noir text colors (slate-200 dark, slate-900 light)
     - Hover state with ember-400/700
     - Focus ring with ember-500/50
     - Group class for chevron animation
   - `contentVariants`:
     - overflow-hidden
     - data-[state=open]:animate-accordion-down
     - data-[state=closed]:animate-accordion-up
     - Text colors (slate-400 dark, slate-600 light)

3. **Components:**
   - `AccordionItem`: Wraps AccordionPrimitive.Item with itemVariants
   - `AccordionTrigger`:
     - Wraps AccordionPrimitive.Header + Trigger
     - Children + ChevronDown icon
     - Chevron rotates 180deg on open (group-data-[state=open]:rotate-180)
     - Duration-300 transition for smooth rotation
   - `AccordionContent`:
     - Wraps AccordionPrimitive.Content
     - Inner div with pb-4 padding (avoid margin for animation)
   - `Accordion`: Root wrapper passing type, collapsible, defaultValue, etc.

4. **Namespace Pattern:**
   ```javascript
   Accordion.Item = AccordionItem;
   Accordion.Trigger = AccordionTrigger;
   Accordion.Content = AccordionContent;
   ```

5. **Exports:**
   - Named exports: Accordion, AccordionItem, AccordionTrigger, AccordionContent
   - Default export: Accordion

6. **Props to support:**
   - `type`: "single" | "multiple" (from CONTEXT.md)
   - `collapsible`: boolean (allow closing all in single mode)
   - `defaultValue`: string | string[] (initial open items)
   - `value`/`onValueChange`: controlled mode
   - `className`: override support on all components

Use the exact patterns from 31-RESEARCH.md Pattern 1 and Pattern 4.
  </action>
  <verify>
- File exists at app/components/ui/Accordion.js
- `grep -n "AccordionPrimitive" app/components/ui/Accordion.js` confirms Radix usage
- `grep -n "animate-accordion" app/components/ui/Accordion.js` confirms animation classes
- `grep -n "min-h-\[48px\]" app/components/ui/Accordion.js` confirms touch target
  </verify>
  <done>
- Accordion.js created with full CVA variants
- Namespace pattern (Accordion.Item, Accordion.Trigger, Accordion.Content)
- Supports type="single" and type="multiple"
- 48px min touch target on triggers
- Rotating chevron indicator
- Ember Noir styling
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Accordion tests and barrel export</name>
  <files>app/components/ui/__tests__/Accordion.test.js, app/components/ui/index.js</files>
  <action>
1. **Create test file** at app/components/ui/__tests__/Accordion.test.js:

Test categories (follow Tabs.test.js pattern):

**Rendering:**
- Renders with default props
- Renders multiple items
- Renders with defaultValue (initially open)

**Single Mode:**
- Opens item on click
- Closes current when opening another (single mode)
- Allows closing all when collapsible=true

**Multiple Mode:**
- Opens multiple items simultaneously
- Maintains open state independently

**Keyboard Navigation:**
- Enter/Space toggles item
- Arrow keys navigate between triggers
- Home/End go to first/last item

**Accessibility:**
- aria-expanded changes on toggle
- aria-controls links trigger to content
- role="region" on content
- Passes axe accessibility audit

**Animation:**
- Content has animate-accordion-down when open
- Content has animate-accordion-up when closed

**Styling:**
- Trigger has min-h-[48px]
- Chevron rotates on open (group-data-[state=open]:rotate-180)

**Controlled Mode:**
- Works with value/onValueChange props
- Updates when controlled value changes

**Named Exports:**
- All exports available (Accordion, AccordionItem, AccordionTrigger, AccordionContent)
- Namespace components attached

2. **Update barrel export** at app/components/ui/index.js:

Add after Tabs exports (around line 59):
```javascript
// Accordion (v4.0+)
export { default as Accordion, AccordionItem, AccordionTrigger, AccordionContent } from './Accordion';
```
  </action>
  <verify>
- `npm test -- --testPathPattern="Accordion" --passWithNoTests` passes
- `grep -n "Accordion" app/components/ui/index.js` shows barrel export
- Test file has at least 25 test cases covering all categories
  </verify>
  <done>
- Accordion.test.js created with comprehensive coverage
- Barrel export added to index.js
- All tests pass
- Accessibility verified with axe
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Unit tests pass:**
   ```bash
   npm test -- --testPathPattern="Accordion"
   ```

2. **Import works from barrel:**
   ```javascript
   import { Accordion } from '@/app/components/ui';
   ```

3. **Manual smoke test (dev server):**
   - Create test page with Accordion
   - Click triggers - content expands/collapses smoothly
   - Keyboard navigation works (Tab, Enter, Arrow keys)
   - Single mode closes others when opening new
   - Multiple mode keeps all open independently
</verification>

<success_criteria>
- [ ] @radix-ui/react-accordion installed
- [ ] Accordion keyframes added to globals.css
- [ ] Accordion.js created with namespace pattern
- [ ] type="single" and type="multiple" modes work
- [ ] 48px touch targets on triggers
- [ ] Smooth height animation on expand/collapse
- [ ] Rotating chevron indicator
- [ ] Keyboard navigation (Enter/Space, arrows)
- [ ] aria-expanded announces state
- [ ] All tests pass (25+ test cases)
- [ ] Barrel export working
</success_criteria>

<output>
After completion, create `.planning/phases/31-expandable-components/31-01-SUMMARY.md`
</output>
