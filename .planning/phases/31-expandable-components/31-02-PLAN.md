---
phase: 31-expandable-components
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/Sheet.js
  - app/components/ui/__tests__/Sheet.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "Sheet slides in from configured edge (bottom/right/left/top)"
    - "Backdrop appears and click closes sheet"
    - "Escape closes sheet"
    - "Focus is trapped within sheet"
    - "Focus returns to trigger on close"
  artifacts:
    - path: "app/components/ui/Sheet.js"
      provides: "Sheet component extending Dialog"
      min_lines: 150
      exports: ["Sheet", "SheetContent", "SheetTrigger", "SheetTitle", "SheetDescription", "SheetClose"]
    - path: "app/components/ui/__tests__/Sheet.test.js"
      provides: "Test coverage for Sheet"
      min_lines: 200
  key_links:
    - from: "app/components/ui/Sheet.js"
      to: "@radix-ui/react-dialog"
      via: "import * as DialogPrimitive"
      pattern: "DialogPrimitive\\.Root"
    - from: "app/components/ui/Sheet.js"
      to: "globals.css"
      via: "slide-in-from-* animation classes"
      pattern: "slide-in-from-bottom|slide-in-from-right"
---

<objective>
Create Sheet component as a Dialog variant with side positioning for mobile-friendly sliding panels.

Purpose: Provide slide-in panels for forms, settings, and detail views that work well on mobile (bottom sheet) and desktop (side panel).
Output: Sheet.js component with tests and barrel export.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/31-expandable-components/31-RESEARCH.md
@.planning/phases/31-expandable-components/31-CONTEXT.md
@app/components/ui/Modal.js
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Sheet component with side variants</name>
  <files>app/components/ui/Sheet.js</files>
  <action>
Create Sheet.js following the Modal.js pattern but with side-based positioning:

1. **Imports:**
   - `@radix-ui/react-dialog` as DialogPrimitive (already installed v1.1.14)
   - `forwardRef` from React
   - `cva` from class-variance-authority
   - `cn` from @/lib/utils/cn
   - `X` from lucide-react (close button)

2. **CVA Variants:**

   **overlayVariants** (copy from Modal.js):
   ```javascript
   const overlayVariants = cva([
     'fixed inset-0 z-50',
     'bg-slate-950/70 [html:not(.dark)_&]:bg-slate-900/40',
     'backdrop-blur-md',
     'data-[state=open]:animate-fade-in',
     'data-[state=closed]:animate-fade-out',
   ]);
   ```

   **contentVariants** with side compound variant:
   ```javascript
   const contentVariants = cva(
     [
       'fixed z-50 p-6',
       'bg-slate-900/95 [html:not(.dark)_&]:bg-white/95',
       'backdrop-blur-3xl',
       'border border-slate-700/50 [html:not(.dark)_&]:border-slate-200',
       'shadow-card-elevated',
       'focus:outline-none',
       'overflow-y-auto',
     ],
     {
       variants: {
         side: {
           top: [
             'inset-x-0 top-0',
             'rounded-b-3xl',
             'max-h-[85vh]',
             'data-[state=open]:animate-slide-down',
             'data-[state=closed]:animate-slide-up',
           ],
           bottom: [
             'inset-x-0 bottom-0',
             'rounded-t-3xl',
             'max-h-[85vh]',
             'pb-safe', // iOS safe area
             'data-[state=open]:animate-slide-in-from-bottom',
             'data-[state=closed]:animate-slide-up',
           ],
           left: [
             'inset-y-0 left-0',
             'h-full rounded-r-3xl',
             'w-3/4',
             'data-[state=open]:animate-fade-in-up',
             'data-[state=closed]:animate-fade-out',
           ],
           right: [
             'inset-y-0 right-0',
             'h-full rounded-l-3xl',
             'w-3/4',
             'data-[state=open]:animate-fade-in-up',
             'data-[state=closed]:animate-fade-out',
           ],
         },
         size: {
           sm: '', // Applied via compound variants
           md: '',
           lg: '',
           auto: 'w-auto',
         },
       },
       compoundVariants: [
         // Left/right side size variants
         { side: 'left', size: 'sm', class: 'max-w-sm' },
         { side: 'left', size: 'md', class: 'max-w-md' },
         { side: 'left', size: 'lg', class: 'max-w-lg' },
         { side: 'right', size: 'sm', class: 'max-w-sm' },
         { side: 'right', size: 'md', class: 'max-w-md' },
         { side: 'right', size: 'lg', class: 'max-w-lg' },
         // Top/bottom use full width, size controls height
         { side: 'top', size: 'sm', class: 'max-h-[30vh]' },
         { side: 'top', size: 'md', class: 'max-h-[50vh]' },
         { side: 'top', size: 'lg', class: 'max-h-[70vh]' },
         { side: 'bottom', size: 'sm', class: 'max-h-[30vh]' },
         { side: 'bottom', size: 'md', class: 'max-h-[50vh]' },
         { side: 'bottom', size: 'lg', class: 'max-h-[70vh]' },
       ],
       defaultVariants: {
         side: 'bottom',
         size: 'md',
       },
     }
   );
   ```

3. **Components:**

   **SheetOverlay:**
   - forwardRef wrapper around DialogPrimitive.Overlay
   - Uses overlayVariants

   **SheetContent:**
   - forwardRef wrapper around DialogPrimitive.Content
   - Props: side, size, showCloseButton (default true), className, children
   - Close button in top-right corner (same style as Modal.Close)
   - sr-only "Close" label for accessibility

   **SheetHeader:** (optional helper)
   - Flex container for title area
   - className: 'flex flex-col space-y-2 mb-4'

   **SheetFooter:** (optional helper)
   - Flex container for actions
   - className: 'flex items-center justify-end gap-3 mt-6'

   **SheetTitle:**
   - DialogPrimitive.Title with Ember Noir styling
   - text-xl font-display font-semibold

   **SheetDescription:**
   - DialogPrimitive.Description
   - text-sm text-slate-400

   **Sheet (main component):**
   - Wraps DialogPrimitive.Root
   - Props: open, onOpenChange, children
   - Renders Portal > Overlay > {children} structure
   - IMPORTANT: SheetContent must be passed as children, NOT auto-rendered
     (allows flexibility in content placement)

4. **Namespace Pattern:**
   ```javascript
   Sheet.Trigger = DialogPrimitive.Trigger;
   Sheet.Content = SheetContent;
   Sheet.Header = SheetHeader;
   Sheet.Footer = SheetFooter;
   Sheet.Title = SheetTitle;
   Sheet.Description = SheetDescription;
   Sheet.Close = DialogPrimitive.Close;
   ```

5. **Exports:**
   - Named: Sheet, SheetContent, SheetHeader, SheetFooter, SheetTitle, SheetDescription, SheetTrigger, SheetClose
   - Default: Sheet

6. **API Design Pattern:**
   ```jsx
   <Sheet open={open} onOpenChange={setOpen}>
     <Sheet.Trigger asChild>
       <Button>Open</Button>
     </Sheet.Trigger>
     <Sheet.Content side="bottom" size="md">
       <Sheet.Header>
         <Sheet.Title>Title</Sheet.Title>
         <Sheet.Description>Description</Sheet.Description>
       </Sheet.Header>
       {/* Content */}
       <Sheet.Footer>
         <Button onClick={() => setOpen(false)}>Close</Button>
       </Sheet.Footer>
     </Sheet.Content>
   </Sheet>
   ```

Note: Unlike Modal.js which has isOpen/onClose API, Sheet uses Radix's open/onOpenChange for flexibility. This allows uncontrolled mode with just Trigger.
  </action>
  <verify>
- File exists at app/components/ui/Sheet.js
- `grep -n "DialogPrimitive" app/components/ui/Sheet.js` confirms Radix usage
- `grep -n "side:" app/components/ui/Sheet.js` confirms side variants
- `grep -n "pb-safe" app/components/ui/Sheet.js` confirms iOS safe area
  </verify>
  <done>
- Sheet.js created extending Dialog with side variants
- All four sides supported (top, bottom, left, right)
- Size variants (sm, md, lg, auto)
- iOS safe area padding for bottom sheet
- Close button with accessibility
- Namespace pattern matching Modal.js
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Sheet tests and barrel export</name>
  <files>app/components/ui/__tests__/Sheet.test.js, app/components/ui/index.js</files>
  <action>
1. **Create test file** at app/components/ui/__tests__/Sheet.test.js:

Test categories (follow Modal.js test patterns):

**Rendering:**
- Renders closed by default (content not in DOM)
- Renders open when open=true
- Renders trigger element

**Open/Close Behavior:**
- Opens when trigger clicked
- Closes when backdrop clicked
- Closes when Escape pressed
- Closes when close button clicked
- Calls onOpenChange with false when closing

**Side Variants:**
- Renders with side="bottom" (default)
- Renders with side="right"
- Renders with side="left"
- Renders with side="top"
- Correct positioning classes applied for each side

**Size Variants:**
- Applies correct max-width for left/right sm/md/lg
- Applies correct max-height for top/bottom sm/md/lg
- Supports size="auto"

**Focus Management:**
- Focus moves to content when opened
- Focus trapped within sheet
- Focus returns to trigger on close

**Accessibility:**
- Has role="dialog"
- Has aria-modal="true"
- Title connected via aria-labelledby
- Description connected via aria-describedby
- Passes axe accessibility audit

**Close Button:**
- Renders by default
- Can be hidden with showCloseButton={false}
- Has accessible label (sr-only "Close")

**Compound Variants:**
- bottom + sm = max-h-[30vh]
- right + lg = max-w-lg

**Named Exports:**
- All exports available
- Namespace components attached

2. **Update barrel export** at app/components/ui/index.js:

Add after Accordion exports:
```javascript
// Sheet (v4.0+)
export { default as Sheet, SheetContent, SheetHeader, SheetFooter, SheetTitle, SheetDescription, SheetTrigger, SheetClose } from './Sheet';
```
  </action>
  <verify>
- `npm test -- --testPathPattern="Sheet" --passWithNoTests` passes
- `grep -n "Sheet" app/components/ui/index.js` shows barrel export
- Test file has at least 25 test cases covering all categories
  </verify>
  <done>
- Sheet.test.js created with comprehensive coverage
- Barrel export added to index.js
- All tests pass
- All four sides tested
- Focus management verified
- Accessibility verified with axe
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Unit tests pass:**
   ```bash
   npm test -- --testPathPattern="Sheet"
   ```

2. **Import works from barrel:**
   ```javascript
   import { Sheet } from '@/app/components/ui';
   ```

3. **Manual smoke test (dev server):**
   - Create test page with Sheet
   - Open with trigger click
   - Close via backdrop, Escape, close button
   - Test all four sides
   - Verify focus trap works
   - Check iOS safe area on bottom sheet (mobile view)
</verification>

<success_criteria>
- [ ] Sheet.js created with Dialog foundation
- [ ] All four sides work (top, bottom, left, right)
- [ ] Size variants (sm, md, lg, auto)
- [ ] Backdrop click closes
- [ ] Escape closes
- [ ] Focus trapped within sheet
- [ ] Focus returns to trigger on close
- [ ] Close button visible by default
- [ ] iOS safe area padding on bottom sheet
- [ ] All tests pass (25+ test cases)
- [ ] Barrel export working
</success_criteria>

<output>
After completion, create `.planning/phases/31-expandable-components/31-02-SUMMARY.md`
</output>
