---
phase: 33-dialog-patterns
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/ConfirmationDialog.js
  - app/components/ui/__tests__/ConfirmationDialog.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "Confirmation Dialog opens with title and description visible"
    - "Cancel button is focused by default for destructive variant"
    - "Confirm button is focused by default for non-destructive variant"
    - "Clicking Cancel closes dialog and calls onCancel"
    - "Clicking Confirm calls onConfirm and shows loading state"
    - "Dialog cannot be closed while loading (ESC and backdrop click blocked)"
    - "Destructive variant shows red outline button (not solid red)"
  artifacts:
    - path: "app/components/ui/ConfirmationDialog.js"
      provides: "ConfirmationDialog component with danger variant"
      exports: ["ConfirmationDialog"]
    - path: "app/components/ui/__tests__/ConfirmationDialog.test.js"
      provides: "Unit tests for ConfirmationDialog"
      contains: "describe('ConfirmationDialog'"
  key_links:
    - from: "app/components/ui/ConfirmationDialog.js"
      to: "app/components/ui/Modal.js"
      via: "import Modal"
      pattern: "import.*Modal.*from"
    - from: "app/components/ui/ConfirmationDialog.js"
      to: "app/components/ui/Button.js"
      via: "import Button"
      pattern: "import.*Button.*from"
---

<objective>
Create ConfirmationDialog component extending Modal with standardized confirmation patterns.

Purpose: Replace legacy ConfirmDialog with accessible Radix-based component following CONTEXT.md decisions.
Output: ConfirmationDialog.js with danger variant, proper focus management, loading states, and tests.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-dialog-patterns/33-CONTEXT.md
@.planning/phases/33-dialog-patterns/33-RESEARCH.md
@app/components/ui/Modal.js
@app/components/ui/Button.js
@app/components/ui/ConfirmDialog.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConfirmationDialog component</name>
  <files>app/components/ui/ConfirmationDialog.js</files>
  <action>
Replace the existing ConfirmDialog.js with enhanced ConfirmationDialog.js that:

1. Extends Modal foundation (Radix Dialog) instead of custom implementation
2. Uses namespace pattern: ConfirmationDialog (not ConfirmDialog to differentiate)
3. API props:
   - isOpen, onClose (standard Modal API)
   - onConfirm: async function - called when confirm clicked
   - onCancel: function - called when cancel clicked (defaults to onClose)
   - title: string (required)
   - description: string (required)
   - confirmLabel: string (default: "Confirm")
   - cancelLabel: string (default: "Cancel")
   - variant: "default" | "danger" (default: "default")
   - loading: boolean (default: false)
   - icon: ReactNode (optional - AlertTriangle from lucide-react for danger)

4. Focus management (CONTEXT.md locked decision):
   - variant="danger": autoFocus on Cancel button (safe default)
   - variant="default": autoFocus on Confirm button

5. Button styling (CONTEXT.md locked decision):
   - Cancel: Button variant="subtle" (always)
   - Confirm default: Button variant="ember"
   - Confirm danger: Create new "danger-outline" style (red outline/ghost, NOT solid red)
     Use CVA compound variant or inline classes: border-2 border-danger-500/40 text-danger-400 hover:bg-danger-500/10

6. Button order: Cancel | Confirm (Cancel left, Confirm right per research)

7. Loading state (CONTEXT.md locked decision):
   - Pass loading to confirm Button (shows spinner)
   - Disable both buttons when loading
   - Prevent ESC close: onEscapeKeyDown={(e) => loading && e.preventDefault()}
   - Prevent backdrop close: onPointerDownOutside={(e) => loading && e.preventDefault()}

8. Icon display:
   - If variant="danger" and no icon provided, default to AlertTriangle from lucide-react
   - Place icon in Modal.Header before title
   - Icon color: text-danger-500 for danger variant

9. Use Modal.Title, Modal.Description for accessibility
10. Size: "sm" for compact dialog

Example usage:
```jsx
<ConfirmationDialog
  isOpen={showDelete}
  onClose={() => setShowDelete(false)}
  onConfirm={handleDelete}
  title="Delete device?"
  description="This will permanently remove 'Living Room Thermostat'."
  confirmLabel="Delete Device"
  variant="danger"
  loading={isDeleting}
/>
```
  </action>
  <verify>File exists and exports ConfirmationDialog component with all required props</verify>
  <done>ConfirmationDialog component created with danger variant, focus management per CONTEXT.md decisions, loading state protection, and Radix Dialog foundation</done>
</task>

<task type="auto">
  <name>Task 2: Create unit tests for ConfirmationDialog</name>
  <files>app/components/ui/__tests__/ConfirmationDialog.test.js</files>
  <action>
Create comprehensive tests for ConfirmationDialog:

1. Basic rendering:
   - Renders title and description when open
   - Does not render when isOpen=false
   - Renders Cancel and Confirm buttons

2. Focus management:
   - variant="danger": Cancel button has focus (test document.activeElement)
   - variant="default": Confirm button has focus

3. Button interactions:
   - Clicking Cancel calls onCancel and onClose
   - Clicking Confirm calls onConfirm
   - Enter key on focused button triggers its action

4. Loading state:
   - Buttons disabled when loading=true
   - Confirm button shows loading spinner
   - ESC key does not close when loading (fireEvent.keyDown)
   - Click outside does not close when loading

5. Danger variant styling:
   - Confirm button has danger outline styling (check for border-danger class)
   - AlertTriangle icon present for danger variant

6. Accessibility:
   - Has role="dialog"
   - Has aria-modal="true"
   - Title and description are accessible

Use @testing-library/react patterns consistent with codebase.
Mock Modal if needed, but prefer integration tests with actual Modal.
  </action>
  <verify>npm test -- --testPathPattern=ConfirmationDialog --watchAll=false</verify>
  <done>All ConfirmationDialog tests pass covering focus management, loading states, and danger variant</done>
</task>

<task type="auto">
  <name>Task 3: Export from barrel and update legacy usage</name>
  <files>app/components/ui/index.js</files>
  <action>
1. Update barrel export - replace ConfirmDialog with new ConfirmationDialog:
   - Remove: export { default as ConfirmDialog } from './ConfirmDialog';
   - Add: export { default as ConfirmationDialog } from './ConfirmationDialog';

Note: Keep old ConfirmDialog.js file for now (will be removed in 33-03 after migration).
The new component has different name (ConfirmationDialog) so existing imports of ConfirmDialog won't break yet.
  </action>
  <verify>grep -n "ConfirmationDialog" app/components/ui/index.js shows export line</verify>
  <done>ConfirmationDialog exported from barrel file, ready for application-wide use</done>
</task>

</tasks>

<verification>
1. Component file exists: app/components/ui/ConfirmationDialog.js
2. Tests pass: npm test -- --testPathPattern=ConfirmationDialog
3. Export exists: grep ConfirmationDialog app/components/ui/index.js
4. Manual check: Import and use in browser to verify focus behavior
</verification>

<success_criteria>
- ConfirmationDialog renders with Radix Dialog foundation
- Focus correctly placed based on variant (Cancel for danger, Confirm for default)
- Loading state blocks close and disables buttons
- Danger variant uses outline styling (not solid red)
- All tests pass
- Exported from barrel
</success_criteria>

<output>
After completion, create `.planning/phases/33-dialog-patterns/33-01-SUMMARY.md`
</output>
