---
phase: 33-dialog-patterns
plan: 03
type: execute
wave: 2
depends_on: ["33-01", "33-02"]
files_modified:
  - app/debug/design-system/page.js
  - app/components/ui/ConfirmDialog.js
autonomous: false

must_haves:
  truths:
    - "Design system page shows ConfirmationDialog demo with both variants"
    - "Design system page shows FormModal demo with validation"
    - "Interactive demos work correctly (open, close, submit)"
    - "Legacy ConfirmDialog.js removed or deprecated"
  artifacts:
    - path: "app/debug/design-system/page.js"
      provides: "Dialog Patterns section with demos"
      contains: "Dialog Patterns"
  key_links:
    - from: "app/debug/design-system/page.js"
      to: "app/components/ui/ConfirmationDialog.js"
      via: "import ConfirmationDialog"
      pattern: "import.*ConfirmationDialog"
    - from: "app/debug/design-system/page.js"
      to: "app/components/ui/FormModal.js"
      via: "import FormModal"
      pattern: "import.*FormModal"
---

<objective>
Add Dialog Patterns demos to design system page and clean up legacy ConfirmDialog.

Purpose: Document new dialog components in design system showcase for developer reference.
Output: Design system page with ConfirmationDialog and FormModal interactive demos.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-dialog-patterns/33-01-SUMMARY.md
@.planning/phases/33-dialog-patterns/33-02-SUMMARY.md
@app/debug/design-system/page.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dialog Patterns section to design system page</name>
  <files>app/debug/design-system/page.js</files>
  <action>
Add a "Dialog Patterns" section to the design system page following existing section patterns:

1. Import new components:
   ```jsx
   import { ConfirmationDialog, FormModal } from '@/app/components/ui';
   import { z } from 'zod';
   import { Controller } from 'react-hook-form';
   ```

2. Add state for dialog demos:
   ```jsx
   const [showConfirmDefault, setShowConfirmDefault] = useState(false);
   const [showConfirmDanger, setShowConfirmDanger] = useState(false);
   const [showFormModal, setShowFormModal] = useState(false);
   const [isConfirming, setIsConfirming] = useState(false);
   const [isSubmitting, setIsSubmitting] = useState(false);
   ```

3. Create demo schema for FormModal:
   ```jsx
   const demoFormSchema = z.object({
     name: z.string().min(1, 'Name is required').max(50, 'Name too long'),
     email: z.string().email('Invalid email address'),
   });
   ```

4. Add Dialog Patterns section with:

   a) Section header:
   ```jsx
   <Section id="dialog-patterns" title="Dialog Patterns" icon="ðŸ’¬">
   ```

   b) ConfirmationDialog subsection:
   - Description: "Standardized confirmation pattern with danger variant for destructive actions"
   - Two demo buttons: "Default Confirmation" and "Danger Confirmation"
   - Both dialogs with async onConfirm showing loading state

   c) FormModal subsection:
   - Description: "Form-in-modal with React Hook Form validation"
   - Demo button: "Open Form Modal"
   - FormModal with name and email fields
   - Show validation errors on blur
   - Success message on submit

5. ConfirmationDialog demo handlers:
   ```jsx
   const handleConfirmDefault = async () => {
     setIsConfirming(true);
     await new Promise(r => setTimeout(r, 1500)); // Simulate async
     setIsConfirming(false);
     setShowConfirmDefault(false);
   };

   const handleConfirmDanger = async () => {
     setIsConfirming(true);
     await new Promise(r => setTimeout(r, 1500));
     setIsConfirming(false);
     setShowConfirmDanger(false);
   };
   ```

6. FormModal demo handler:
   ```jsx
   const handleFormSubmit = async (data) => {
     await new Promise(r => setTimeout(r, 1500)); // Simulate API call
     console.log('Form submitted:', data);
   };
   ```

7. Dialog components at end of section:
   ```jsx
   <ConfirmationDialog
     isOpen={showConfirmDefault}
     onClose={() => setShowConfirmDefault(false)}
     onConfirm={handleConfirmDefault}
     title="Confirm Action"
     description="Are you sure you want to proceed with this action?"
     confirmLabel="Proceed"
     loading={isConfirming}
   />

   <ConfirmationDialog
     isOpen={showConfirmDanger}
     onClose={() => setShowConfirmDanger(false)}
     onConfirm={handleConfirmDanger}
     title="Delete Item?"
     description="This action cannot be undone. The item will be permanently removed."
     confirmLabel="Delete"
     variant="danger"
     loading={isConfirming}
   />

   <FormModal
     isOpen={showFormModal}
     onClose={() => setShowFormModal(false)}
     onSubmit={handleFormSubmit}
     title="Add New Item"
     description="Fill in the details below"
     validationSchema={demoFormSchema}
     defaultValues={{ name: '', email: '' }}
     successMessage="Item added successfully!"
   >
     {({ control, formState }) => (
       <div className="space-y-4">
         <Controller
           name="name"
           control={control}
           render={({ field, fieldState }) => (
             <Input
               label="Name"
               placeholder="Enter name"
               {...field}
               error={fieldState.error?.message}
             />
           )}
         />
         <Controller
           name="email"
           control={control}
           render={({ field, fieldState }) => (
             <Input
               label="Email"
               type="email"
               placeholder="user@example.com"
               {...field}
               error={fieldState.error?.message}
             />
           )}
         />
       </div>
     )}
   </FormModal>
   ```

8. Add navigation item for Dialog Patterns in the sidebar/navigation if it exists.
  </action>
  <verify>grep -n "Dialog Patterns" app/debug/design-system/page.js shows section exists</verify>
  <done>Design system page has Dialog Patterns section with interactive ConfirmationDialog and FormModal demos</done>
</task>

<task type="auto">
  <name>Task 2: Deprecate legacy ConfirmDialog</name>
  <files>app/components/ui/ConfirmDialog.js</files>
  <action>
Add deprecation notice to legacy ConfirmDialog:

1. Add JSDoc deprecation comment at top of file:
   ```jsx
   /**
    * @deprecated Use ConfirmationDialog instead.
    * This component will be removed in a future version.
    * Migration: Replace ConfirmDialog with ConfirmationDialog from '@/app/components/ui'
    *
    * Old API: <ConfirmDialog isOpen onConfirm onCancel title message />
    * New API: <ConfirmationDialog isOpen onClose onConfirm title description />
    */
   ```

2. Add console.warn in development:
   ```jsx
   if (process.env.NODE_ENV === 'development') {
     console.warn(
       '[DEPRECATED] ConfirmDialog is deprecated. Use ConfirmationDialog instead. ' +
       'See: /debug/design-system#dialog-patterns'
     );
   }
   ```

3. Keep the component functional for backwards compatibility.
   It will be fully removed after all usages are migrated in future phases.

Note: Do NOT remove the file yet - existing usages still import ConfirmDialog.
The deprecation warning will help identify and track usages for migration.
  </action>
  <verify>grep -n "@deprecated" app/components/ui/ConfirmDialog.js shows deprecation comment</verify>
  <done>Legacy ConfirmDialog marked as deprecated with migration instructions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dialog Patterns design system section with ConfirmationDialog and FormModal demos</what-built>
  <how-to-verify>
1. Navigate to http://localhost:3000/debug/design-system
2. Find "Dialog Patterns" section
3. Test ConfirmationDialog demos:
   - Click "Default Confirmation" - verify Confirm button is focused
   - Click "Danger Confirmation" - verify Cancel button is focused, red outline on confirm
   - Test loading state (button shows spinner, ESC doesn't close)
4. Test FormModal demo:
   - Click "Open Form Modal"
   - Try submitting empty form - errors appear at top and inline
   - Type invalid email, blur - error appears
   - Fill valid data and submit - success checkmark shows, then closes
5. Check console for no errors
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. Design system page loads without errors
2. Dialog Patterns section visible and interactive
3. ConfirmationDialog demos work correctly
4. FormModal validation and success states work
5. Legacy ConfirmDialog shows deprecation warning in console
</verification>

<success_criteria>
- Design system shows Dialog Patterns with both component demos
- ConfirmationDialog default variant focuses Confirm button
- ConfirmationDialog danger variant focuses Cancel button
- FormModal shows validation errors on blur and submit
- FormModal shows success state before closing
- Legacy ConfirmDialog marked deprecated
- User verifies all demos work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/33-dialog-patterns/33-03-SUMMARY.md`
</output>
