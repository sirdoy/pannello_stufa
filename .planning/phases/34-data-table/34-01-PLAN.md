---
phase: 34-data-table
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/DataTable.js
  - app/components/ui/__tests__/DataTable.test.js
  - app/components/ui/index.js
autonomous: true

must_haves:
  truths:
    - "User can see table data rendered in rows and columns"
    - "User can click column header to sort ascending/descending"
    - "Screen reader announces sort direction via aria-sort"
    - "Visual sort indicators (arrows) show current sort state"
  artifacts:
    - path: "app/components/ui/DataTable.js"
      provides: "DataTable component with TanStack Table integration"
      exports: ["DataTable", "dataTableVariants"]
      min_lines: 150
    - path: "app/components/ui/__tests__/DataTable.test.js"
      provides: "Unit tests for DataTable base functionality"
      min_lines: 80
  key_links:
    - from: "app/components/ui/DataTable.js"
      to: "@tanstack/react-table"
      via: "useReactTable hook"
      pattern: "useReactTable"
    - from: "app/components/ui/DataTable.js"
      to: "class-variance-authority"
      via: "CVA variants for density/striped/stickyHeader"
      pattern: "cva\\("
---

<objective>
Build the DataTable base component with TanStack Table v8 integration and sortable columns.

Purpose: Establish the foundation for the full-featured data table component with proper accessibility (ARIA) and visual styling following Ember Noir design system.

Output: DataTable.js component with sorting, CVA variants for visual density, and comprehensive tests.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/34-data-table/34-CONTEXT.md
@.planning/phases/34-data-table/34-RESEARCH.md

# Existing patterns to follow
@app/components/ui/Badge.js
@app/components/ui/Checkbox.js
@app/components/ui/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install TanStack Table and create DataTable base component</name>
  <files>
    app/components/ui/DataTable.js
  </files>
  <action>
1. Install @tanstack/react-table (npm install handled by executor if needed, or assume already available)

2. Create DataTable.js with:

**CVA Variants (per CONTEXT.md decisions):**
```javascript
const dataTableVariants = cva(
  'w-full border-collapse',
  {
    variants: {
      density: {
        compact: '[&_td]:py-2 [&_th]:py-2',    // 32px rows
        default: '[&_td]:py-3 [&_th]:py-3',    // 44px rows
        relaxed: '[&_td]:py-4 [&_th]:py-4',    // 52px rows
      },
      striped: {
        true: '[&_tbody_tr:nth-child(even)]:bg-white/[0.02]',
        false: '',
      },
      stickyHeader: {
        true: '[&_thead]:sticky [&_thead]:top-0 [&_thead]:bg-slate-900 [&_thead]:z-10',
        false: '',
      },
    },
    defaultVariants: {
      density: 'default',
      striped: false,
      stickyHeader: false,
    },
  }
);
```

**Component structure:**
- Props: data, columns, density, striped, stickyHeader, className, onRowClick, getRowId
- CRITICAL: Use useMemo for data and columns to prevent infinite re-renders
- Use useReactTable with getCoreRowModel and getSortedRowModel
- State: sorting (useState)

**Sortable column header:**
- aria-sort attribute: 'ascending' | 'descending' | 'none'
- Visual indicators: ChevronUp/ChevronDown from lucide-react
- Button inside th for click handling
- aria-label describing sort action

**Table structure:**
- Wrapper div with overflow-x-auto and rounded-2xl border
- role="table" (implicit on table element)
- role="columnheader" on th
- role="row" on tr
- role="cell" on td

**Ember Noir styling:**
- Header: bg-slate-800/50, text-slate-300, border-b border-white/[0.06]
- Rows: hover:bg-white/[0.02], text-slate-200
- Borders: border-white/[0.06]
  </action>
  <verify>
File exists and exports DataTable and dataTableVariants. Component uses useReactTable hook.
  </verify>
  <done>
DataTable component renders data with sortable columns and CVA variants for density/striped/stickyHeader.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DataTable unit tests</name>
  <files>
    app/components/ui/__tests__/DataTable.test.js
  </files>
  <action>
Create comprehensive unit tests following project testing patterns:

**Test cases:**
1. Renders table with data and columns
2. Displays column headers correctly
3. Renders all rows from data array
4. Click column header toggles sort (asc -> desc -> none cycle)
5. aria-sort attribute updates on sort change
6. Visual sort indicator appears on sorted column
7. Density variants apply correct padding classes
8. Striped variant adds alternating background
9. StickyHeader variant adds sticky positioning
10. Custom className is applied
11. getRowId prop uses custom ID function
12. Empty data shows empty tbody

**Test setup:**
```javascript
const mockData = [
  { id: '1', name: 'Alpha', status: 'active' },
  { id: '2', name: 'Beta', status: 'pending' },
  { id: '3', name: 'Gamma', status: 'inactive' },
];

const mockColumns = [
  { accessorKey: 'name', header: 'Name' },
  { accessorKey: 'status', header: 'Status' },
];
```

Use @testing-library/react for rendering and user interactions.
Use jest-axe for accessibility checks on aria-sort.
  </action>
  <verify>
`npm test -- --testPathPattern="DataTable" --watchAll=false` passes all tests.
  </verify>
  <done>
DataTable has comprehensive unit tests covering rendering, sorting, variants, and accessibility.
  </done>
</task>

<task type="auto">
  <name>Task 3: Export DataTable from barrel file</name>
  <files>
    app/components/ui/index.js
  </files>
  <action>
Add DataTable export to the barrel file, following the existing pattern:

After the existing exports (around line 89), add:

```javascript
// DataTable (v4.0+)
export { default as DataTable, dataTableVariants } from './DataTable';
```

Place it logically near other complex components (after Badge/SmartHomeCard section or create new section).
  </action>
  <verify>
`import { DataTable, dataTableVariants } from '@/app/components/ui'` works without errors.
  </verify>
  <done>
DataTable is exported from the UI barrel file and importable by other components.
  </done>
</task>

</tasks>

<verification>
1. DataTable.js exists with TanStack Table integration
2. CVA variants for density, striped, stickyHeader work correctly
3. Sorting toggles on header click with aria-sort updates
4. Visual sort indicators (chevrons) appear on sorted column
5. All unit tests pass
6. No TypeScript/lint errors
7. DataTable exportable from barrel file
</verification>

<success_criteria>
- DataTable renders tabular data with column headers
- Clicking header sorts column (ascending -> descending -> none)
- aria-sort attribute reflects current sort state
- Visual indicators (up/down chevrons) show sort direction
- density prop changes row height (compact 32px, default 44px, relaxed 52px)
- striped prop adds alternating row backgrounds
- stickyHeader prop makes header sticky on scroll
- All tests pass with jest-axe accessibility checks
</success_criteria>

<output>
After completion, create `.planning/phases/34-data-table/34-01-SUMMARY.md`
</output>
