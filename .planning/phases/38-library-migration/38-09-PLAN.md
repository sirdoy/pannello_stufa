---
phase: 38-library-migration
plan: 09
type: execute
wave: 5
depends_on: ["38-07", "38-08"]
files_modified:
  - lib/hooks/useBackgroundSync.ts
  - lib/hooks/useGeofencing.ts
  - lib/hooks/useOnlineStatus.ts
  - lib/hooks/usePeriodicSync.ts
  - lib/hooks/usePWAInstall.ts
  - lib/hooks/useRoomStatus.ts
  - lib/hooks/useScheduleData.ts
  - lib/hooks/useWakeLock.ts
  - app/hooks/index.ts
  - app/hooks/useContextMenuLongPress.ts
  - app/hooks/useDebounce.ts
  - app/hooks/useHaptic.ts
  - app/hooks/useLongPress.ts
  - app/hooks/useReducedMotion.ts
  - app/hooks/useToast.ts
  - app/hooks/useVersionCheck.ts
autonomous: true

must_haves:
  truths:
    - "All 16 hook files have .ts extension (8 in lib/hooks, 7+1 barrel in app/hooks)"
    - "Generic hooks use proper TypeScript generics (useDebounce<T>)"
    - "Hook return types are explicit (not inferred as complex union)"
    - "React hooks use proper React types (useState<T>, useEffect, useRef<T>)"
  artifacts:
    - path: "app/hooks/useDebounce.ts"
      provides: "Generic debounce hook"
      contains: "useDebounce<T>"
    - path: "app/hooks/useToast.ts"
      provides: "Toast notification hook"
    - path: "lib/hooks/useScheduleData.ts"
      provides: "Schedule data fetching hook"
    - path: "lib/hooks/useOnlineStatus.ts"
      provides: "Online/offline detection hook"
    - path: "app/hooks/index.ts"
      provides: "Barrel export for app hooks"
  key_links:
    - from: "app/hooks/useDebounce.ts"
      to: "react"
      via: "useState, useEffect"
      pattern: "useState|useEffect"
    - from: "lib/hooks/useScheduleData.ts"
      to: "lib/schedulesApiClient"
      via: "schedule data fetching"
      pattern: "schedulesApiClient|fetchSchedule"
    - from: "lib/hooks/useOnlineStatus.ts"
      to: "navigator.onLine"
      via: "online/offline events"
      pattern: "navigator\\.onLine|online|offline"
---

<objective>
Migrate all React hook files from JavaScript to TypeScript, completing LIB-02.

Purpose: The 16 hook files (8 in lib/hooks/, 7+1 barrel in app/hooks/) are the final layer of the library migration. They depend on services and utilities already converted in earlier waves. Hooks benefit significantly from TypeScript — generic return types prevent consumers from needing manual type assertions.
Output: 16 .ts files with typed React hooks. Phase 38 fully complete (all 4 requirements satisfied).
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/37-typescript-foundation/37-03-SUMMARY.md
@.planning/phases/38-library-migration/38-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate lib/hooks/ (8 PWA-related hooks)</name>
  <files>
    lib/hooks/useBackgroundSync.js -> lib/hooks/useBackgroundSync.ts
    lib/hooks/useGeofencing.js -> lib/hooks/useGeofencing.ts
    lib/hooks/useOnlineStatus.js -> lib/hooks/useOnlineStatus.ts
    lib/hooks/usePeriodicSync.js -> lib/hooks/usePeriodicSync.ts
    lib/hooks/usePWAInstall.js -> lib/hooks/usePWAInstall.ts
    lib/hooks/useRoomStatus.js -> lib/hooks/useRoomStatus.ts
    lib/hooks/useScheduleData.js -> lib/hooks/useScheduleData.ts
    lib/hooks/useWakeLock.js -> lib/hooks/useWakeLock.ts
  </files>
  <action>
    For each file: `git mv old.js new.ts`, then add TypeScript annotations.

    **Pattern from research — React Hook Migration:**
    ```typescript
    'use client';
    import { useState, useEffect, useCallback } from 'react';

    interface UseOnlineStatusReturn {
      isOnline: boolean;
      lastChanged: Date | null;
    }

    export function useOnlineStatus(): UseOnlineStatusReturn {
      const [isOnline, setIsOnline] = useState<boolean>(navigator.onLine);
      // ...
    }
    ```

    **Specific guidance:**
    - useBackgroundSync.ts: Type sync registration and status. Return `{ register: (tag: string) => Promise<void>; isSupported: boolean; }`.
    - useGeofencing.ts: Type geofence regions and enter/exit callbacks. Use `GeolocationPosition` from DOM types.
    - useOnlineStatus.ts: Return `{ isOnline: boolean; }`. Use `useState<boolean>`, event listeners typed via `addEventListener('online', handler)`.
    - usePeriodicSync.ts: Type periodic sync registration. Return `{ register: (tag: string, minInterval: number) => Promise<void>; isSupported: boolean; }`.
    - usePWAInstall.ts: Type BeforeInstallPromptEvent (not in standard DOM types — declare locally): `interface BeforeInstallPromptEvent extends Event { prompt(): Promise<void>; userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>; }`. Return `{ canInstall: boolean; install: () => Promise<void>; }`.
    - useRoomStatus.ts: Type room data. Return typed room status.
    - useScheduleData.ts: Type schedule data shape. Return `{ data: ScheduleData | null; isLoading: boolean; error: Error | null; refetch: () => void; }`.
    - useWakeLock.ts: Use `WakeLockSentinel` type. Return `{ isActive: boolean; request: () => Promise<void>; release: () => void; }`.

    **Rules:**
    - `git mv` for history
    - Keep `'use client'` directive at top of each file
    - Create return type interfaces (e.g., `UseXxxReturn`) for hooks with multiple return values
    - Use React types: `useState<T>`, `useRef<T>`, `useCallback<...>`
    - No behavior changes
  </action>
  <verify>
    Run `npx tsc --noEmit` — no new errors from lib/hooks/ files.
    Verify: `find lib/hooks -name "*.js" -not -path "*__tests__*"` returns empty.
  </verify>
  <done>8 lib/hooks/ files converted with typed return interfaces.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate app/hooks/ (7 hooks + barrel) and final verification</name>
  <files>
    app/hooks/index.js -> app/hooks/index.ts
    app/hooks/useContextMenuLongPress.js -> app/hooks/useContextMenuLongPress.ts
    app/hooks/useDebounce.js -> app/hooks/useDebounce.ts
    app/hooks/useHaptic.js -> app/hooks/useHaptic.ts
    app/hooks/useLongPress.js -> app/hooks/useLongPress.ts
    app/hooks/useReducedMotion.js -> app/hooks/useReducedMotion.ts
    app/hooks/useToast.js -> app/hooks/useToast.ts
    app/hooks/useVersionCheck.js -> app/hooks/useVersionCheck.ts
  </files>
  <action>
    For each file: `git mv old.js new.ts`, then add TypeScript annotations.

    **Specific guidance:**
    - useDebounce.ts: Generic hook pattern (from research):
      ```typescript
      export function useDebounce<T>(value: T, delay: number): T {
        const [debouncedValue, setDebouncedValue] = useState<T>(value);
        useEffect(() => {
          const handler = setTimeout(() => setDebouncedValue(value), delay);
          return () => clearTimeout(handler);
        }, [value, delay]);
        return debouncedValue;
      }
      ```
    - useContextMenuLongPress.ts: Type event handlers. Use `React.MouseEvent`, `React.TouchEvent`, `React.PointerEvent`. Return `{ onContextMenu: (e: React.MouseEvent) => void; onTouchStart: (e: React.TouchEvent) => void; ... }`. Import from `react` for types.
    - useHaptic.ts: Type vibration patterns. Return `{ vibrate: (pattern?: number | number[]) => void; isSupported: boolean; }`.
    - useLongPress.ts: Type long press config. Create `interface LongPressConfig { threshold?: number; onLongPress: () => void; onPress?: () => void; }`. Return event handler props.
    - useReducedMotion.ts: Return `boolean`. Use `matchMedia('(prefers-reduced-motion: reduce)')`.
    - useToast.ts: Type toast options. Create `interface ToastOptions { title: string; description?: string; variant?: 'default' | 'success' | 'error'; duration?: number; }`. Return `{ toast: (options: ToastOptions) => void; }`.
    - useVersionCheck.ts: Type version comparison. Return `{ hasUpdate: boolean; currentVersion: string; latestVersion: string | null; }`.
    - index.ts: Barrel export — re-export all hooks.

    **Final phase verification after this task:**
    ```bash
    # LIB-01: All lib/ files converted
    find lib -name "*.js" -not -path "*__tests__*" | wc -l  # expect 0

    # LIB-02: All hooks converted
    find lib/hooks app/hooks -name "*.js" -not -path "*__tests__*" | wc -l  # expect 0

    # LIB-03 + LIB-04: Verified by tsc
    npx tsc --noEmit  # expect pass
    ```

    **Rules:**
    - `git mv` for history
    - Keep `'use client'` directive
    - Generic hooks (useDebounce) MUST use TypeScript generics
    - No behavior changes
  </action>
  <verify>
    Run `npx tsc --noEmit` — no new errors.
    **CRITICAL PHASE VERIFICATION:**
    - `find lib -name "*.js" -not -path "*__tests__*" | wc -l` returns 0 (LIB-01)
    - `find lib/hooks app/hooks -name "*.js" -not -path "*__tests__*" | wc -l` returns 0 (LIB-02)
    - `npx tsc --noEmit` passes (LIB-03, LIB-04)
    - `npm run dev` starts without errors
  </verify>
  <done>8 app/hooks/ files converted. ALL hooks now TypeScript. Phase 38 requirements LIB-01, LIB-02, LIB-03, LIB-04 fully satisfied. Zero .js source files remain in lib/ or app/hooks/.</done>
</task>

</tasks>

<verification>
**Phase 38 completion checks:**
- LIB-01: `find lib -name "*.js" -not -path "*__tests__*" | wc -l` returns 0
- LIB-02: `find lib/hooks app/hooks -name "*.js" -not -path "*__tests__*" | wc -l` returns 0
- LIB-03: All utility/helper functions have typed parameters and return types (verified by tsc)
- LIB-04: All services/repositories have typed parameters and return types (verified by tsc)
- `npx tsc --noEmit` passes with no errors on lib/ directory
- `npm run dev` starts without errors
</verification>

<success_criteria>
All 16 hook files converted to TypeScript with generic hooks, typed return values, and React type imports. Phase 38 is fully complete — all 132 source files (116 lib/ + 16 hooks) converted from JavaScript to TypeScript. All 4 requirements (LIB-01 through LIB-04) satisfied.
</success_criteria>

<output>
After completion, create `.planning/phases/38-library-migration/38-09-SUMMARY.md`
</output>
