---
phase: 39-ui-components-migration
plan: 04
type: execute
wave: 2
depends_on: ["39-01", "39-02"]
files_modified:
  - app/components/ui/SmartHomeCard.js
  - app/components/ui/ConnectionStatus.js
  - app/components/ui/HealthIndicator.js
  - app/components/ui/StatusCard.js
  - app/components/ui/DeviceCard.js
  - app/components/ui/DashboardLayout.js
  - app/components/ui/CommandPalette.js
  - app/components/ui/BottomSheet.js
  - app/components/ui/ConfirmationDialog.js
  - app/components/ui/FormModal.js
  - app/components/ui/DataTable.js
  - app/components/ui/DataTableRow.js
  - app/components/ui/DataTableToolbar.js
  - app/components/ui/Skeleton.js
autonomous: true

must_haves:
  truths:
    - "All 14 complex/domain UI components have .tsx extension"
    - "SmartHomeCard namespace preserved (Header, Status, Controls)"
    - "DashboardLayout namespace preserved with useSidebar hook typed"
    - "DataTable components properly typed with TanStack Table generics"
    - "tsc --noEmit passes with zero errors"
  artifacts:
    - path: "app/components/ui/SmartHomeCard.tsx"
      provides: "SmartHomeCard with namespace (Header, Status, Controls) + CVA"
    - path: "app/components/ui/DeviceCard.tsx"
      provides: "DeviceCard with contextMenuItems typed"
    - path: "app/components/ui/DataTable.tsx"
      provides: "DataTable with TanStack Table types"
    - path: "app/components/ui/Skeleton.tsx"
      provides: "Skeleton with all variant subcomponents"
    - path: "app/components/ui/DashboardLayout.tsx"
      provides: "DashboardLayout with useSidebar hook + CVA"
  key_links:
    - from: "app/components/ui/SmartHomeCard.tsx"
      to: "class-variance-authority"
      via: "VariantProps<typeof smartHomeCardVariants>"
      pattern: "VariantProps<typeof smartHomeCardVariants>"
    - from: "app/components/ui/DataTable.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable, ColumnDef generics"
      pattern: "useReactTable|ColumnDef"
    - from: "app/components/ui/DeviceCard.tsx"
      to: "types/components/common"
      via: "ContextMenuItem type"
      pattern: "ContextMenuItem"
---

<objective>
Migrate 14 complex and domain-specific design system components from .js to .tsx with typed props.

Purpose: These are the largest, most complex UI components — SmartHomeCard (namespace), DeviceCard (contextMenu integration), DataTable (TanStack Table), DashboardLayout (namespace + hook), Skeleton (many subvariants), and dialog/modal components. They depend on foundation and form components migrated in Plans 01-02.

Output: 14 .tsx files with exported Props interfaces, typed hooks, TanStack Table generics, and preserved namespace patterns.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-ui-components-migration/39-CONTEXT.md
@.planning/phases/39-ui-components-migration/39-RESEARCH.md
@types/components/common.ts
@app/components/ui/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate domain-specific and namespace components (7 files)</name>
  <files>
    app/components/ui/SmartHomeCard.js -> SmartHomeCard.tsx
    app/components/ui/ConnectionStatus.js -> ConnectionStatus.tsx
    app/components/ui/HealthIndicator.js -> HealthIndicator.tsx
    app/components/ui/StatusCard.js -> StatusCard.tsx
    app/components/ui/DeviceCard.js -> DeviceCard.tsx
    app/components/ui/DashboardLayout.js -> DashboardLayout.tsx
    app/components/ui/CommandPalette.js -> CommandPalette.tsx
  </files>
  <action>
For each file:
1. `git mv ComponentName.js ComponentName.tsx` to preserve git history
2. Add Props interface, extending HTML attributes where appropriate
3. For CVA components: use VariantProps
4. For forwardRef components: add explicit generics
5. For namespace components: type each subcomponent
6. For hooks (useSidebar): type return value interface
7. Preserve existing component API exactly

Specific notes:
- **SmartHomeCard** (237 lines, CVA, 3 namespace: Header, Status, Controls): Main card component for IoT devices. Type colorTheme, icon, title props. Each subcomponent needs its own Props interface.
- **ConnectionStatus** (127 lines, CVA + forwardRef): Type status variants (online/offline/error). Use VariantProps for dot and container variants.
- **HealthIndicator** (133 lines, CVA + forwardRef): Type health level, label, color props via VariantProps.
- **StatusCard** (120 lines, forwardRef): Type title, value, icon, trend props.
- **DeviceCard** (326 lines, forwardRef): Complex — type title, icon, status, actions, contextMenuItems. Import ContextMenuItem from `@/types/components` (defined in Phase 37).
- **DashboardLayout** (415 lines, CVA, 7 namespace): Sidebar, Main, Header subcomponents. Type useSidebar hook return: `{ isOpen, toggle, close }`. Export `useSidebar` with return type interface. Export sidebarVariants and mainContentVariants.
- **CommandPalette** (221 lines): Uses cmdk library. Type command groups, items, onSelect callbacks. May need to check cmdk types.

Run `npx tsc --noEmit` after completing all 7 to verify zero errors.
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | grep -c "error TS"` — must be 0. Check files: `ls app/components/ui/{SmartHomeCard,ConnectionStatus,HealthIndicator,StatusCard,DeviceCard,DashboardLayout,CommandPalette}.tsx`</verify>
  <done>7 domain/namespace components converted to .tsx with typed props, namespace patterns preserved, hooks typed, zero tsc errors</done>
</task>

<task type="auto">
  <name>Task 2: Migrate dialog, table, and skeleton components (7 files)</name>
  <files>
    app/components/ui/BottomSheet.js -> BottomSheet.tsx
    app/components/ui/ConfirmationDialog.js -> ConfirmationDialog.tsx
    app/components/ui/FormModal.js -> FormModal.tsx
    app/components/ui/DataTable.js -> DataTable.tsx
    app/components/ui/DataTableRow.js -> DataTableRow.tsx
    app/components/ui/DataTableToolbar.js -> DataTableToolbar.tsx
    app/components/ui/Skeleton.js -> Skeleton.tsx
  </files>
  <action>
For each file:
1. `git mv ComponentName.js ComponentName.tsx` to preserve git history
2. Add Props interface
3. For Radix-based: extend ComponentPropsWithoutRef
4. For CVA-based: use VariantProps
5. For forwardRef: add explicit generics
6. For TanStack Table: use proper generics

Specific notes:
- **BottomSheet** (155 lines): Drawer/sheet props — open, onClose, title, children. May wrap Radix Dialog.
- **ConfirmationDialog** (265 lines, Radix): Complex dialog with variant-based styling. Type onConfirm, onCancel, title, description, confirmText, variant (danger/warning/info).
- **FormModal** (346 lines, Radix): Form-in-modal pattern. Type onSubmit, initialValues, fields. Has ErrorSummary and SuccessOverlay subcomponents — type both.
- **DataTable** (691 lines, CVA + TanStack + forwardRef): The largest component. Uses `useReactTable` from @tanstack/react-table. Type with generic: `DataTableProps<TData>` where TData is the row data type. Type columns as `ColumnDef<TData>[]`. Type sorting, filtering, pagination state. Export dataTableVariants.
- **DataTableRow** (148 lines, forwardRef): Single row component. Type with `DataTableRowProps<TData>` generic matching parent.
- **DataTableToolbar** (299 lines): Toolbar with search, filters, actions. Type filter config, search handler, action buttons.
- **Skeleton** (772 lines): The largest file. Has many named skeleton variants (Skeleton.WeatherCard, Skeleton.DeviceCard, etc.). Type each variant as a simple functional component with optional className. Use namespace pattern for all variants.

For DataTable generic typing: Use a pragmatic approach — if generic typing with TanStack becomes overly complex, use `any` for the row data type parameter per user's pragmatic typing decision. Prefer typing the external API (columns, data, onRowClick) over internal TanStack wiring.

Run `npx tsc --noEmit` after completing all 7 to verify zero errors.
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | grep -c "error TS"` — must be 0. Check files: `ls app/components/ui/{BottomSheet,ConfirmationDialog,FormModal,DataTable,DataTableRow,DataTableToolbar,Skeleton}.tsx`</verify>
  <done>7 dialog/table/skeleton components converted to .tsx with typed props, DataTable generics handled, zero tsc errors across entire project</done>
</task>

</tasks>

<verification>
After both tasks:
1. `ls app/components/ui/*.js | wc -l` should show 1 (only index.js remaining)
2. `ls app/components/ui/*.tsx | wc -l` should show 63
3. `npx tsc --noEmit 2>&1 | grep -c "error TS"` returns 0
4. SmartHomeCard.Header/Status/Controls namespace works
5. DashboardLayout.Sidebar namespace works
6. DataTable accepts typed columns and data
</verification>

<success_criteria>
- All 14 complex/domain components have .tsx extension
- SmartHomeCard and DashboardLayout namespaces preserved
- DataTable typed with TanStack Table generics (or pragmatic any)
- Skeleton subvariants all typed
- All dialog/modal props typed (onConfirm, onCancel, etc.)
- useSidebar hook return typed with interface
- Zero tsc errors
</success_criteria>

<output>
After completion, create `.planning/phases/39-ui-components-migration/39-04-SUMMARY.md`
</output>
