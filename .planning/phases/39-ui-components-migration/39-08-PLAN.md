---
phase: 39-ui-components-migration
plan: 08
type: execute
wave: 4
depends_on: ["39-05"]
files_modified:
  - app/components/netatmo/NetatmoAuthCard.js
  - app/components/netatmo/NetatmoTemperatureReport.js
  - app/components/netatmo/PidAutomationPanel.js
  - app/components/netatmo/RoomCard.js
  - app/components/netatmo/StoveSyncPanel.js
  - app/components/lights/CreateSceneModal.js
  - app/components/lights/EditSceneModal.js
autonomous: true

must_haves:
  truths:
    - "All 7 Netatmo and Lights components have .tsx extension"
    - "Netatmo data types properly used from @/types"
    - "PID automation types properly defined"
    - "tsc --noEmit passes with zero errors"
  artifacts:
    - path: "app/components/netatmo/PidAutomationPanel.tsx"
      provides: "PID automation panel typed"
    - path: "app/components/netatmo/RoomCard.tsx"
      provides: "Room card with typed Netatmo room data"
    - path: "app/components/netatmo/StoveSyncPanel.tsx"
      provides: "Stove sync panel typed"
    - path: "app/components/lights/CreateSceneModal.tsx"
      provides: "Hue scene creation modal typed"
  key_links:
    - from: "app/components/netatmo/*.tsx"
      to: "types/firebase/netatmo.ts"
      via: "Netatmo data types"
      pattern: "from.*@/types"
    - from: "app/components/netatmo/*.tsx"
      to: "lib/netatmo/ services"
      via: "Netatmo API services"
      pattern: "from.*@/lib/"
---

<objective>
Migrate 7 Netatmo thermostat and Philips Hue lights components from .js to .tsx with typed props.

Purpose: These are domain-specific feature components that depend heavily on typed services from Phase 38 (Netatmo API client, Hue API client). With the design system and lib/ fully typed, these components can now leverage those types for props and state.

Output: 7 .tsx files with exported Props interfaces, using Netatmo and Hue data types from @/types and @/lib/.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-ui-components-migration/39-CONTEXT.md
@.planning/phases/39-ui-components-migration/39-RESEARCH.md
@types/components/common.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Netatmo components (5 files)</name>
  <files>
    app/components/netatmo/NetatmoAuthCard.js -> NetatmoAuthCard.tsx
    app/components/netatmo/NetatmoTemperatureReport.js -> NetatmoTemperatureReport.tsx
    app/components/netatmo/PidAutomationPanel.js -> PidAutomationPanel.tsx
    app/components/netatmo/RoomCard.js -> RoomCard.tsx
    app/components/netatmo/StoveSyncPanel.js -> StoveSyncPanel.tsx
  </files>
  <action>
For each file:
1. `git mv ComponentName.js ComponentName.tsx` to preserve git history
2. Add Props interface
3. Import and use existing Netatmo types from `@/types` (NetatmoRoom, NetatmoSchedule, etc.)
4. Import typed services from `@/lib/netatmo/` (migrated in Phase 38)
5. Type internal state, event handlers, API response processing
6. Preserve existing component API exactly

Specific notes:
- **PidAutomationPanel** (710 lines): Largest component — PID controller settings, temperature charts, automation state. Type PID configuration (Kp, Ki, Kd, setpoint, output), chart data, toggle handlers. Be pragmatic with chart/graph data types — use array of `{ time: number, value: number }` or similar.
- **StoveSyncPanel** (564 lines): Stove-thermostat synchronization — type sync state, stove/thermostat status, mode selection.
- **RoomCard** (431 lines): Netatmo room display — type room data (temperature, humidity, heating state), valve controls. Use NetatmoRoom type if available.
- **NetatmoTemperatureReport** (280 lines): Temperature history/report — type temperature data, date range, chart data.
- **NetatmoAuthCard**: OAuth flow UI — type auth state (authenticated, expired, error), token refresh handler.

For the largest components (PidAutomationPanel, StoveSyncPanel, RoomCard): Focus on typing external API (props) and critical state. Allow pragmatic `any` for deeply nested internal transformations per user decision.

Run `npx tsc --noEmit` after completing all 5 to verify zero errors.
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | grep -c "error TS"` — must be 0. Check files: `ls app/components/netatmo/{NetatmoAuthCard,NetatmoTemperatureReport,PidAutomationPanel,RoomCard,StoveSyncPanel}.tsx`</verify>
  <done>5 Netatmo components converted to .tsx with typed Netatmo data and services, zero tsc errors</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Lights components (2 files)</name>
  <files>
    app/components/lights/CreateSceneModal.js -> CreateSceneModal.tsx
    app/components/lights/EditSceneModal.js -> EditSceneModal.tsx
  </files>
  <action>
For each file:
1. `git mv ComponentName.js ComponentName.tsx` to preserve git history
2. Add Props interface
3. Import and use Hue types from `@/types` and `@/lib/hue/` (migrated in Phase 38)
4. Type scene data (name, lights, colors, brightness)
5. Type modal props (open, onClose, onSave/onCreate)
6. Type form state and validation

Specific notes:
- **CreateSceneModal** (396 lines): Scene creation form — type scene name, selected lights (array of light IDs), color/brightness per light, group selection. Props: open, onClose, onCreated callback.
- **EditSceneModal** (379 lines): Scene editing form — similar to Create but with existing scene data. Props: open, onClose, sceneId or scene object, onUpdated callback.

Both modals likely share similar form state types — define a SceneFormData interface locally or import if it exists in lib/hue types.

Run `npx tsc --noEmit` after completing both to verify zero errors.
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | grep -c "error TS"` — must be 0. Check files: `ls app/components/lights/{CreateSceneModal,EditSceneModal}.tsx`</verify>
  <done>2 Lights components converted to .tsx with typed Hue scene data, zero tsc errors across entire project</done>
</task>

</tasks>

<verification>
After both tasks:
1. `find app/components/netatmo -name "*.js" -o -name "*.jsx" | wc -l` = 0
2. `find app/components/lights -name "*.js" -o -name "*.jsx" | wc -l` = 0
3. `npx tsc --noEmit 2>&1 | grep -c "error TS"` = 0
</verification>

<success_criteria>
- All 7 Netatmo and Lights components have .tsx extension
- Netatmo types imported from @/types and @/lib/netatmo/
- Hue types imported from @/types and @/lib/hue/
- PID automation types properly defined
- Scene form data typed
- Zero tsc errors
</success_criteria>

<output>
After completion, create `.planning/phases/39-ui-components-migration/39-08-SUMMARY.md`
</output>
