---
phase: 39-ui-components-migration
plan: 09
type: execute
wave: 4
depends_on: ["39-05"]
files_modified:
  - app/components/weather/CurrentConditions.jsx
  - app/components/weather/ForecastDayCard.jsx
  - app/components/weather/ForecastDaySheet.jsx
  - app/components/weather/ForecastRow.jsx
  - app/components/weather/HourlyForecast.jsx
  - app/components/weather/WeatherCard.jsx
  - app/components/weather/WeatherIcon.jsx
  - app/components/weather/weatherHelpers.js
  - app/components/weather/index.js
  - app/components/log/LogEntry.js
  - app/components/log/index.js
  - app/components/navigation/DropdownComponents.js
  - app/components/navigation/index.js
  - app/components/sandbox/SandboxPanel.js
  - app/components/sandbox/SandboxToggle.js
  - app/components/layout/CommandPaletteProvider.js
autonomous: true

must_haves:
  truths:
    - "All 16 remaining application components have .tsx/.ts extension"
    - "Weather data types properly defined for all weather components"
    - "All barrel exports updated to .ts"
    - "tsc --noEmit passes with zero errors"
    - "Zero .js/.jsx files remain in app/components/ (excluding __tests__/)"
  artifacts:
    - path: "app/components/weather/WeatherCard.tsx"
      provides: "Weather card with typed weather data"
    - path: "app/components/weather/weatherHelpers.ts"
      provides: "Weather helper functions typed"
    - path: "app/components/sandbox/SandboxPanel.tsx"
      provides: "Sandbox testing panel typed"
    - path: "app/components/layout/CommandPaletteProvider.tsx"
      provides: "Command palette provider typed"
  key_links:
    - from: "app/components/weather/*.tsx"
      to: "lib/weather/ services"
      via: "Weather data types"
      pattern: "from.*@/lib/"
    - from: "app/components/weather/weatherHelpers.ts"
      to: "app/components/weather/*.tsx"
      via: "Helper function imports"
      pattern: "from.*weatherHelpers"
---

<objective>
Migrate 16 remaining application components (weather, log, navigation, sandbox, layout) from .js/.jsx to .tsx/.ts with typed props.

Purpose: These are the final application components. Completing them means ALL components in the entire app/components/ directory are TypeScript, satisfying requirements COMP-02 and COMP-03. Weather components are .jsx (the only ones using that extension).

Output: 16 .tsx/.ts files completing the full component migration. Zero .js/.jsx files remaining in app/components/ (excluding __tests__/).
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/39-ui-components-migration/39-CONTEXT.md
@.planning/phases/39-ui-components-migration/39-RESEARCH.md
@types/components/common.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate weather components (9 files)</name>
  <files>
    app/components/weather/weatherHelpers.js -> weatherHelpers.ts
    app/components/weather/WeatherIcon.jsx -> WeatherIcon.tsx
    app/components/weather/CurrentConditions.jsx -> CurrentConditions.tsx
    app/components/weather/ForecastRow.jsx -> ForecastRow.tsx
    app/components/weather/ForecastDayCard.jsx -> ForecastDayCard.tsx
    app/components/weather/ForecastDaySheet.jsx -> ForecastDaySheet.tsx
    app/components/weather/HourlyForecast.jsx -> HourlyForecast.tsx
    app/components/weather/WeatherCard.jsx -> WeatherCard.tsx
    app/components/weather/index.js -> index.ts
  </files>
  <action>
Migrate in dependency order — helpers first, then components, then barrel:

1. **weatherHelpers.js -> .ts** (246 lines): This is a utility file, not a component. Type all functions with explicit parameter types and return types. Type weather condition mapping, icon selection, temperature formatting, wind direction helpers. This must be migrated FIRST since other weather components import from it.

2. **WeatherIcon.jsx -> .tsx**: Type icon props — condition code, size, animated flag.

3. **CurrentConditions.jsx -> .tsx** (306 lines): Type weather data props — current temperature, condition, humidity, pressure, wind. Import types from weatherHelpers and @/lib/weather/.

4. **ForecastRow.jsx -> .tsx**: Type forecast entry — date, high/low temp, condition, precipitation chance.

5. **ForecastDayCard.jsx -> .tsx**: Type day forecast card — day name, weather data, onClick handler.

6. **ForecastDaySheet.jsx -> .tsx** (224 lines): Type detailed day view — hourly data, sunrise/sunset, UV index.

7. **HourlyForecast.jsx -> .tsx**: Type hourly data array — temperature, condition, time.

8. **WeatherCard.jsx -> .tsx**: Main weather display — type weather data, location, refresh handlers, loading/error state. See research example for WeatherCardProps interface.

9. **index.js -> index.ts**: Barrel export — export all weather components.

For ALL weather components: Use `git mv` to preserve history. Note these are .jsx files (not .js) — the git mv command handles this the same way.

Define a shared weather data interface locally in weatherHelpers.ts (or import from @/types if exists):
```typescript
interface WeatherData {
  current: { temperature: number; condition: string; humidity?: number; pressure?: number; wind?: { speed: number; direction: number } };
  forecast: Array<{ date: string; tempMin: number; tempMax: number; condition: string; precipitation?: number }>;
  hourly?: Array<{ time: string; temperature: number; condition: string }>;
  cachedAt?: string;
  stale?: boolean;
}
```

Run `npx tsc --noEmit` after completing all 9 to verify zero errors.
  </action>
  <verify>Run `npx tsc --noEmit 2>&1 | grep -c "error TS"` — must be 0. Check files: `ls app/components/weather/{weatherHelpers.ts,WeatherIcon.tsx,CurrentConditions.tsx,ForecastRow.tsx,ForecastDayCard.tsx,ForecastDaySheet.tsx,HourlyForecast.tsx,WeatherCard.tsx,index.ts}`</verify>
  <done>9 weather files converted to .tsx/.ts with typed weather data, zero tsc errors</done>
</task>

<task type="auto">
  <name>Task 2: Migrate log, navigation, sandbox, and layout components (7 files)</name>
  <files>
    app/components/log/LogEntry.js -> LogEntry.tsx
    app/components/log/index.js -> index.ts
    app/components/navigation/DropdownComponents.js -> DropdownComponents.tsx
    app/components/navigation/index.js -> index.ts
    app/components/sandbox/SandboxPanel.js -> SandboxPanel.tsx
    app/components/sandbox/SandboxToggle.js -> SandboxToggle.tsx
    app/components/layout/CommandPaletteProvider.js -> CommandPaletteProvider.tsx
  </files>
  <action>
For each file:
1. `git mv ComponentName.js ComponentName.tsx` (or .ts for barrels)
2. Add Props interface where applicable
3. Type internal state and event handlers
4. Preserve existing component API exactly

Specific notes:
- **LogEntry**: Type log entry data — timestamp, level, message, source, metadata. Props: entry object + formatting options.
- **log/index.ts**: Barrel export for log components.
- **DropdownComponents**: Navigation dropdown items — type menu items, active state, onClick handlers. May import from design system components.
- **navigation/index.ts**: Barrel export for navigation components.
- **SandboxPanel** (686 lines): Large sandbox testing panel — type sandbox configuration, test scenarios, results display. Import sandbox types from @/lib/ if available. Be pragmatic with deeply nested sandbox config types.
- **SandboxToggle**: Simple toggle for sandbox mode — type enabled state, onToggle callback.
- **CommandPaletteProvider**: Context provider for command palette — type context value interface (open, close, register command, commands list). Use `createContext<CommandPaletteContextValue | null>(null)`.

Run `npx tsc --noEmit` after completing all 7 to verify zero errors.

FINAL VERIFICATION — this is the last application component plan. After this:
- `find app/components -name "*.js" -o -name "*.jsx" | grep -v __tests__` should return EMPTY
- All COMP-01, COMP-02, COMP-03 requirements should be satisfied
  </action>
  <verify>
1. `npx tsc --noEmit 2>&1 | grep -c "error TS"` — must be 0
2. `find app/components -name "*.js" -o -name "*.jsx" | grep -v __tests__ | wc -l` — must be 0
3. `find app/components \( -name "*.tsx" -o -name "*.ts" \) | grep -v __tests__ | wc -l` — should show ~119 total component files
  </verify>
  <done>7 remaining application components converted to .tsx/.ts. Zero .js/.jsx files remain in app/components/ (excluding __tests__/). All three requirements (COMP-01, COMP-02, COMP-03) satisfied. Zero tsc errors across entire project.</done>
</task>

</tasks>

<verification>
Final phase verification after all tasks:
1. `find app/components -name "*.js" -o -name "*.jsx" | grep -v __tests__ | wc -l` = 0
2. `find app/components \( -name "*.tsx" -o -name "*.ts" \) | grep -v __tests__ | wc -l` >= 119
3. `npx tsc --noEmit 2>&1 | grep -c "error TS"` = 0
4. `npm test -- --passWithNoTests 2>&1 | tail -5` passes
5. COMP-01: All 64 design system components in components/ui/ have .tsx extension
6. COMP-02: All ~55 application components have .tsx extension
7. COMP-03: Every component exports a Props interface or type
</verification>

<success_criteria>
- All 16 remaining application components have .tsx/.ts extension
- Weather data types defined and shared across weather components
- All barrel exports (weather, log, navigation) updated to .ts
- SandboxPanel and CommandPaletteProvider properly typed
- Zero .js/.jsx files remain in app/components/ (excluding __tests__/)
- Zero tsc errors across entire project
- Phase 39 fully complete: COMP-01, COMP-02, COMP-03 all satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/39-ui-components-migration/39-09-SUMMARY.md`
</output>
