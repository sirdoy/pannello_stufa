---
phase: 42-test-migration
plan: 06
type: execute
wave: 2
depends_on: ["42-01"]
files_modified:
  - app/components/__tests__/Navbar.test.tsx
  - app/components/navigation/__tests__/DropdownComponents.test.tsx
  - app/components/netatmo/__tests__/PidPowerPreview.test.tsx
  - app/components/scheduler/__tests__/DuplicateDayModal.test.tsx
  - app/hooks/__tests__/useHaptic.test.ts
  - app/hooks/__tests__/useLongPress.test.ts
  - app/hooks/__tests__/useReducedMotion.test.ts
  - app/hooks/__tests__/useVersionCheck.test.ts
  - app/context/__tests__/VersionContext.test.tsx
  - app/api/hue/discover/__tests__/route.test.ts
  - app/api/netatmo/setroomthermpoint/__tests__/route.test.ts
  - app/api/netatmo/setthermmode/__tests__/route.test.ts
  - app/thermostat/page.test.tsx
  - __tests__/components/StoveCard.externalSync.test.tsx
  - __tests__/components/StoveSyncPanel.test.tsx
  - __tests__/components/monitoring/StatusCards.test.tsx
  - __tests__/components/devices/thermostat/ThermostatCard.schedule.test.tsx
  - __tests__/app/(pages)/camera/CameraDashboard.test.tsx
autonomous: true

must_haves:
  truths:
    - "All 18 app/ test files (hooks, context, api, components, thermostat) have .ts/.tsx extension"
    - "3 known broken API route test imports are fixed during migration"
    - "All __tests__/components/ and __tests__/app/ files migrated"
    - "Zero .test.js files remain in entire project (excluding node_modules)"
  artifacts:
    - path: "app/api/hue/discover/__tests__/route.test.ts"
      provides: "Fixed Hue discover route test (broken import)"
    - path: "app/api/netatmo/setroomthermpoint/__tests__/route.test.ts"
      provides: "Fixed setroomthermpoint route test (broken import)"
    - path: "app/api/netatmo/setthermmode/__tests__/route.test.ts"
      provides: "Fixed setthermmode route test (broken import)"
    - path: "app/hooks/__tests__/*.test.ts"
      provides: "Migrated app hook tests"
  key_links:
    - from: "app/api/hue/discover/__tests__/route.test.ts"
      to: "app/api/hue/discover/route.ts"
      via: "import"
      pattern: "import.*from.*\\.\\./route"
    - from: "app/api/netatmo/setroomthermpoint/__tests__/route.test.ts"
      to: "app/api/netatmo/setroomthermpoint/route.ts"
      via: "import"
      pattern: "import.*from.*\\.\\./route"
---

<objective>
Migrate the remaining 18 test files across app/ subdirectories (hooks, context, API routes, non-UI components, thermostat page) and root __tests__/components/ and __tests__/app/ directories. Includes fixing 3 known broken API route imports.

Purpose: Completes all remaining test file migrations. After this plan, zero .test.js files remain in the entire project (excluding node_modules).
Output: 18 .test.ts/.test.tsx files.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-test-migration/42-CONTEXT.md
@.planning/phases/42-test-migration/42-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate app/ hooks, context, API route tests + fix broken imports (12 files)</name>
  <files>
    app/hooks/__tests__/useHaptic.test.ts
    app/hooks/__tests__/useLongPress.test.ts
    app/hooks/__tests__/useReducedMotion.test.ts
    app/hooks/__tests__/useVersionCheck.test.ts
    app/context/__tests__/VersionContext.test.tsx
    app/api/hue/discover/__tests__/route.test.ts
    app/api/netatmo/setroomthermpoint/__tests__/route.test.ts
    app/api/netatmo/setthermmode/__tests__/route.test.ts
    app/thermostat/page.test.tsx
    app/components/__tests__/Navbar.test.tsx
    app/components/navigation/__tests__/DropdownComponents.test.tsx
    app/components/netatmo/__tests__/PidPowerPreview.test.tsx
  </files>
  <action>
**Hook tests (4 files) -> .test.ts:**
1. `git mv app/hooks/__tests__/useHaptic.test.js app/hooks/__tests__/useHaptic.test.ts`
2. `git mv app/hooks/__tests__/useLongPress.test.js app/hooks/__tests__/useLongPress.test.ts`
3. `git mv app/hooks/__tests__/useReducedMotion.test.js app/hooks/__tests__/useReducedMotion.test.ts`
4. `git mv app/hooks/__tests__/useVersionCheck.test.js app/hooks/__tests__/useVersionCheck.test.ts`
- Use .ts (not .tsx) since hook tests typically don't contain JSX directly (renderHook wraps it). If any file does contain JSX, use .tsx instead.
- Type renderHook result generics if accessed
- Type mock navigator/window APIs with `as any`

**Context test (1 file) -> .test.tsx:**
5. `git mv app/context/__tests__/VersionContext.test.js app/context/__tests__/VersionContext.test.tsx`
- Uses JSX to render provider -> .tsx extension
- Type context value if used directly

**API route tests (3 files) -> .test.ts — FIX BROKEN IMPORTS (locked decision):**
6. `git mv app/api/hue/discover/__tests__/route.test.js app/api/hue/discover/__tests__/route.test.ts`
7. `git mv app/api/netatmo/setroomthermpoint/__tests__/route.test.js app/api/netatmo/setroomthermpoint/__tests__/route.test.ts`
8. `git mv app/api/netatmo/setthermmode/__tests__/route.test.js app/api/netatmo/setthermmode/__tests__/route.test.ts`
- **CRITICAL**: Fix the 3 known broken imports documented in STATE.md blockers:
  - Change `import { POST } from '../route.js'` (or `'../route'`) to `import { POST } from '../route'` (extensionless)
  - The source files were renamed from route.js to route.ts in Phase 40
  - These tests have been failing since Phase 40 — fixing import makes them work again
- Type Request mock objects pragmatically: `new Request(url, { method: 'POST', body: JSON.stringify(data) })`
- Type mock session/auth with `as any` (pragmatic typing for external auth)

**Page test (1 file) -> .test.tsx:**
9. `git mv app/thermostat/page.test.js app/thermostat/page.test.tsx`
- Uses JSX -> .tsx extension

**Non-UI component tests (3 files) -> .test.tsx:**
10. `git mv app/components/__tests__/Navbar.test.js app/components/__tests__/Navbar.test.tsx`
11. `git mv app/components/navigation/__tests__/DropdownComponents.test.js app/components/navigation/__tests__/DropdownComponents.test.tsx`
12. `git mv app/components/netatmo/__tests__/PidPowerPreview.test.js app/components/netatmo/__tests__/PidPowerPreview.test.tsx`
- All use JSX -> .tsx extension
- Type component props pragmatically

Apply standard pragmatic typing to all files. Run tests:
`npx jest --testPathPattern="app/(hooks|context|api|thermostat|components/(__|navigation|netatmo)).*test" --no-coverage 2>&1 | tail -20`
  </action>
  <verify>
`find app/hooks/__tests__ app/context/__tests__ app/api -name "*.test.js" | wc -l` returns 0
`find app/hooks/__tests__ -name "*.test.ts" | wc -l` returns 4
`find app/api -name "*.test.ts" | wc -l` returns 3
API route tests pass (verifies broken imports are fixed).
  </verify>
  <done>12 app/ tests migrated. 3 broken API route imports fixed (locked decision). Hook, context, API, page, and non-UI component tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate __tests__/components/ and __tests__/app/ test files (6 files)</name>
  <files>
    __tests__/components/StoveCard.externalSync.test.tsx
    __tests__/components/StoveSyncPanel.test.tsx
    __tests__/components/monitoring/StatusCards.test.tsx
    __tests__/components/devices/thermostat/ThermostatCard.schedule.test.tsx
    __tests__/app/(pages)/camera/CameraDashboard.test.tsx
    app/components/scheduler/__tests__/DuplicateDayModal.test.tsx
  </files>
  <action>
For each of the 6 files:

1. `git mv {path}.test.js {path}.test.tsx`
   - All use JSX (component rendering) -> .tsx extension
2. Apply pragmatic typing:
   - **StoveCard.externalSync.test**: Stove state mock data — type with `as any` or inline interface
   - **StoveSyncPanel.test**: Sync panel props — type pragmatically
   - **StatusCards.test**: Monitoring/health status mock data — type with inline interfaces or `as any`
   - **ThermostatCard.schedule.test**: Schedule data types — import from @/types if available
   - **CameraDashboard.test**: Camera data mocks — `as any` for Netatmo camera API types
   - **DuplicateDayModal.test**: Modal props — type isOpen, onConfirm, onCancel callbacks
3. Convert `require()` to `import` where straightforward

Run tests:
`npx jest --testPathPattern="__tests__/(components|app)|DuplicateDayModal" --no-coverage 2>&1 | tail -20`
  </action>
  <verify>
`find __tests__/components __tests__/app -name "*.test.js" | wc -l` returns 0
`find __tests__/components __tests__/app -name "*.test.tsx" | wc -l` returns 5
`find app/components/scheduler/__tests__ -name "*.test.tsx" | wc -l` returns 1
Tests pass.
  </verify>
  <done>6 component/app test files migrated. Zero .test.js in __tests__/components/ and __tests__/app/.</done>
</task>

</tasks>

<verification>
1. **Zero .test.js in entire project (excluding node_modules):**
   `find . -not -path "*/node_modules/*" -name "*.test.js" | wc -l` returns 0
2. All 18 files have .ts or .tsx extension
3. API route tests pass (confirms broken imports fixed)
4. `npx jest --testPathPattern="app/(hooks|context|api|thermostat)|__tests__/(components|app)|DuplicateDayModal|Navbar|Dropdown|PidPower" --no-coverage` — all pass
</verification>

<success_criteria>
- All 18 test files migrated to .ts/.tsx
- 3 known broken API route imports fixed
- Zero .test.js files in entire project (excluding node_modules)
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/42-test-migration/42-06-SUMMARY.md`
</output>
