---
phase: 43-verification
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/debug/design-system/page.tsx
  - app/lights/page.tsx
  - app/stove/scheduler/page.tsx
  - app/thermostat/schedule/page.tsx
  - app/thermostat/schedule/components/WeeklyTimeline.tsx
  - app/thermostat/schedule/components/ScheduleSelector.tsx
  - app/thermostat/schedule/components/ActiveOverrideBadge.tsx
  - app/thermostat/schedule/components/ManualOverrideSheet.tsx
  - app/thermostat/page.tsx
  - app/offline/page.tsx
  - app/settings/page.tsx
  - app/settings/notifications/page.tsx
  - app/settings/notifications/NotificationSettingsForm.tsx
  - app/settings/notifications/devices/page.tsx
  - app/settings/location/page.tsx
  - app/settings/devices/page.tsx
  - app/debug/notifications/page.tsx
  - app/debug/notifications/test/page.tsx
  - app/debug/page.tsx
  - app/debug/stove/page.tsx
  - app/debug/transitions/page.tsx
  - app/debug/weather-test/page.tsx
  - app/debug/logs/page.tsx
  - app/stove/page.tsx
  - app/stove/maintenance/page.tsx
  - app/monitoring/page.tsx
  - app/log/page.tsx
  - app/lights/scenes/page.tsx
  - jest.setup.ts
autonomous: true

must_haves:
  truths:
    - "All non-test source files pass tsc --noEmit with zero errors"
    - "Design system page variant usages match actual CVA definitions"
    - "External API property accesses are properly typed"
    - "jest.setup.ts compiles without errors"
  artifacts:
    - path: "app/debug/design-system/page.tsx"
      provides: "Design system showcase page with correct variant types"
      min_lines: 2000
    - path: "app/lights/page.tsx"
      provides: "Lights page with properly typed Hue API data"
      min_lines: 500
    - path: "jest.setup.ts"
      provides: "Jest setup with proper type declarations"
      min_lines: 10
  key_links:
    - from: "app/debug/design-system/page.tsx"
      to: "app/components/ui/*.tsx"
      via: "component variant props"
      pattern: "variant="
    - from: "app/lights/page.tsx"
      to: "types/external-apis"
      via: "Hue API type definitions"
      pattern: "HueLight|HueScene"
---

<objective>
Fix all 170 TypeScript errors in 29 non-test source files. These are production code errors in pages, components, and jest.setup.ts.

Purpose: Non-test source files have real type errors that affect build correctness. These include design system variant mismatches (42 errors in design-system page), external API property access issues (28 in lights page, 16 in scheduler), and type narrowing issues across settings/debug pages. Fixing these first ensures the source code is clean before tackling test files.

Output: All 29 non-test files compile with zero tsc errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/43-verification/43-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix design-system page and debug page type errors</name>
  <files>
    app/debug/design-system/page.tsx
    app/debug/notifications/page.tsx
    app/debug/notifications/test/page.tsx
    app/debug/page.tsx
    app/debug/stove/page.tsx
    app/debug/transitions/page.tsx
    app/debug/weather-test/page.tsx
    app/debug/logs/page.tsx
  </files>
  <action>
Fix all tsc errors in debug pages. Run `npx tsc --noEmit 2>&1 | grep "error TS" | grep "app/debug"` to get the exact error list.

**design-system/page.tsx (42 errors):**
- Fix variant string literals: `"subtle"` is not valid for some components. Check each component's CVA definition to find valid variants. Replace with correct variant names (e.g., `"neutral"`, `"ghost"`, or remove the prop if default is fine).
- Fix `Dispatch<SetStateAction<boolean>>` not matching event handler type — wrap in proper callback: `(checked: boolean) => setToggleState(checked)` or use explicit handler function.
- Fix missing `label` prop on weather icon components — add `label` property to all weather icon objects.
- Fix `AccessibilitySectionProps` and `PropTableProps` type mismatches — check component prop definitions and pass correct props.
- Do NOT change the actual UI behavior — only fix type annotations to match existing component APIs.

**notifications/page.tsx (5 errors):**
- Fix Date arithmetic: use `.getTime()` for date subtraction.
- Fix `string` not assignable to variant types: use type assertion `as const` or define typed variables for variant strings.

**notifications/test/page.tsx (4 errors):**
- Fix `string` not assignable to union types (TargetMode, TemplateKey, Priority): cast select values to proper union types with `as TargetMode` etc.

**debug/page.tsx (4 errors):**
- Fix `string` not assignable to LogCategory and variant types: use proper union type casting.

**debug/logs/page.tsx (1 error):**
- Fix Card radius variant: `"4xl"` is not valid — use `"2xl"` or `"xl"`.

**Remaining debug pages (stove, transitions, weather-test):**
- Run tsc for each and fix any errors. These should have 0-2 errors each.
  </action>
  <verify>
`npx tsc --noEmit 2>&1 | grep "error TS" | grep "app/debug" | wc -l` returns 0.
  </verify>
  <done>All debug pages (8 files) compile with zero TypeScript errors. Design system page uses correct component variant types.</done>
</task>

<task type="auto">
  <name>Task 2: Fix remaining page/component type errors</name>
  <files>
    app/lights/page.tsx
    app/lights/scenes/page.tsx
    app/stove/scheduler/page.tsx
    app/stove/page.tsx
    app/stove/maintenance/page.tsx
    app/thermostat/page.tsx
    app/thermostat/schedule/page.tsx
    app/thermostat/schedule/components/WeeklyTimeline.tsx
    app/thermostat/schedule/components/ScheduleSelector.tsx
    app/thermostat/schedule/components/ActiveOverrideBadge.tsx
    app/thermostat/schedule/components/ManualOverrideSheet.tsx
    app/offline/page.tsx
    app/settings/page.tsx
    app/settings/notifications/page.tsx
    app/settings/notifications/NotificationSettingsForm.tsx
    app/settings/notifications/devices/page.tsx
    app/settings/location/page.tsx
    app/settings/devices/page.tsx
    app/monitoring/page.tsx
    app/log/page.tsx
    jest.setup.ts
  </files>
  <action>
Fix all tsc errors in the remaining 21 non-test files. Run `npx tsc --noEmit 2>&1 | grep "error TS" | grep -v "__tests__" | grep -v "\.test\." | grep -v "app/debug"` to get the exact error list.

**lights/page.tsx (28 errors) and lights/scenes/page.tsx (3 errors):**
- These likely have Hue API property access errors (TS2339). If Plan 43-01 has already created proper Hue types in `types/external-apis/`, import and use them. If not yet available, create inline interfaces matching the actual data structure accessed in the code.
- Fix any component variant mismatches or missing props.

**stove/scheduler/page.tsx (16 errors):**
- Fix type narrowing issues, likely discriminated union access and component prop types.
- Check for string-to-union type casting needs.

**thermostat/ files (7+3+3+3 = ~16 errors across 5 files):**
- Fix schedule component prop types (ScheduleSelector, WeeklyTimeline, ActiveOverrideBadge, ManualOverrideSheet).
- Fix Netatmo data property access — ensure types match actual API data structure.

**settings/ files (~13 errors across 5 files):**
- Fix string-to-union type casting for variant props.
- Fix form handler type mismatches.
- Fix notification settings type issues.

**Other pages (offline, monitoring, log, stove/page, stove/maintenance):**
- Fix remaining 1-4 errors per file. Likely variant mismatches and type narrowing.

**jest.setup.ts (1 error):**
- Fix the type declaration or import error. Check what tsc reports and fix accordingly.

IMPORTANT: For external API data (Hue/Netatmo/Camera), if `types/external-apis/` directory exists from Plan 43-01, import those types. If it doesn't exist yet (parallel execution), create inline interfaces in the files that need them. The interfaces will be reconciled later.

Do NOT change functional behavior. Only fix type annotations to match existing code logic.
  </action>
  <verify>
`npx tsc --noEmit 2>&1 | grep "error TS" | grep -v "__tests__" | grep -v "\.test\." | wc -l` returns 0.
  </verify>
  <done>All 29 non-test source files compile with zero TypeScript errors. `npx tsc --noEmit` reports only test file errors (if any remain).</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit 2>&1 | grep "error TS" | grep -v "__tests__" | grep -v "\.test\." | wc -l` returns 0
- No functional changes to UI or behavior — only type annotations fixed
- All component variant usages match actual CVA definitions
</verification>

<success_criteria>
- Zero tsc errors in non-test source files (currently 170 errors across 29 files)
- jest.setup.ts compiles without errors
- All pages maintain existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/43-verification/43-02-SUMMARY.md`
</output>
