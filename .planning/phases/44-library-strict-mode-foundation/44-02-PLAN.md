---
phase: 44-library-strict-mode-foundation
plan: 02
type: execute
wave: 2
depends_on: ["44-01"]
files_modified:
  - lib/notificationTriggers.ts
  - lib/notificationTriggersServer.ts
  - lib/notificationFilter.ts
autonomous: true

must_haves:
  truths:
    - "notificationTriggers.ts has zero tsc errors under strict mode"
    - "notificationTriggersServer.ts has zero tsc errors under strict mode"
    - "notificationFilter.ts has zero tsc errors under strict mode"
  artifacts:
    - path: "lib/notificationTriggers.ts"
      provides: "Strictly typed notification trigger functions"
    - path: "lib/notificationTriggersServer.ts"
      provides: "Strictly typed server-side notification triggers"
    - path: "lib/notificationFilter.ts"
      provides: "Strictly typed notification filtering"
  key_links:
    - from: "lib/notificationTriggers.ts"
      to: "lib/notificationService.ts"
      via: "function calls to send notifications"
      pattern: "import.*notificationService"
---

<objective>
Fix all strict-mode tsc errors in notification trigger and filter files (82 errors across 3 files).

Purpose: These are the highest-error-count files in the notification subsystem. notificationTriggers.ts alone has 36 errors, mostly TS7006 (implicit any on `data` parameters). Fixing these 3 files eliminates ~23% of all lib/ source errors.

Output: 3 notification files with zero tsc strict-mode errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/notificationTriggers.ts
@lib/notificationTriggersServer.ts
@lib/notificationFilter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix strict-mode errors in notificationTriggers.ts</name>
  <files>lib/notificationTriggers.ts</files>
  <action>
Fix all 36 strict-mode errors in notificationTriggers.ts (539 lines).

**Primary error pattern — TS7006 on `data` parameters:**
Nearly all 36 errors are `Parameter 'data' implicitly has an 'any' type` on trigger handler functions. These functions receive Firebase data snapshots or event payloads.

For each trigger function:
1. Examine what properties are accessed on `data` inside the function body
2. Define an inline interface or use an existing type from `types/` if one matches
3. Type the `data` parameter explicitly

Example pattern:
```typescript
// Before
function handleStoveData(data) {
  const temp = data.temperature;
  const status = data.status;
}

// After
interface StoveEventData {
  temperature: number;
  status: string;
}
function handleStoveData(data: StoveEventData) {
  const temp = data.temperature;
  const status = data.status;
}
```

If many trigger functions share the same shape, define a shared interface at the top of the file.
If the data comes from Firebase realtime database (`snapshot.val()`), the type is inherently `unknown` — use a type guard or assertion after null check.

Also fix any TS18046 (unknown catch), TS18048 (possibly undefined), TS7053 (index) errors present.

Do NOT change function behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep "^lib/notificationTriggers.ts" | wc -l` — must be 0.
  </verify>
  <done>notificationTriggers.ts has zero tsc errors under strict mode.</done>
</task>

<task type="auto">
  <name>Task 2: Fix strict-mode errors in notificationTriggersServer.ts and notificationFilter.ts</name>
  <files>
    lib/notificationTriggersServer.ts
    lib/notificationFilter.ts
  </files>
  <action>
Fix all strict-mode errors in these 2 files (46 errors total: 25 + 21).

**notificationTriggersServer.ts (25 errors, 388 lines):**
Same pattern as notificationTriggers.ts — mostly TS7006 on `data` parameters for server-side trigger handlers. Apply the same approach: examine data usage, define interfaces, type parameters explicitly.

**notificationFilter.ts (21 errors, 274 lines):**
Likely a mix of TS7006 (parameter types) and TS18046/TS18048 (null/undefined handling) on filter predicates. Filter functions typically receive notification objects and return boolean — type both the input parameter and ensure null-safe property access.

For both files:
1. Run `npx tsc --noEmit 2>&1 | grep "^{filename}"` to see exact errors
2. Read the file to understand the data shapes
3. Add explicit parameter types — prefer interfaces over inline types for readability
4. Add null checks where strictNullChecks flags possibly-undefined access
5. Handle unknown catch blocks with `error instanceof Error` guards

Use types from `types/` directory where applicable (check `types/firebase/`, `types/api/`).
Do NOT change function behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep "^lib/notificationTriggersServer.ts" | wc -l` — must be 0.
Run: `npx tsc --noEmit 2>&1 | grep "^lib/notificationFilter.ts" | wc -l` — must be 0.
  </verify>
  <done>Both notificationTriggersServer.ts and notificationFilter.ts have zero tsc errors under strict mode.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -E "^lib/notification(Triggers|TriggersServer|Filter)" | wc -l` — must be 0
2. `npm test -- --testPathPattern="notification" --passWithNoTests 2>&1 | tail -5` — related tests still pass
</verification>

<success_criteria>
- notificationTriggers.ts: 0 tsc errors (was 36)
- notificationTriggersServer.ts: 0 tsc errors (was 25)
- notificationFilter.ts: 0 tsc errors (was 21)
- No behavioral changes to any function
</success_criteria>

<output>
After completion, create `.planning/phases/44-library-strict-mode-foundation/44-02-SUMMARY.md`
</output>
