---
phase: 44-library-strict-mode-foundation
plan: 03
type: execute
wave: 2
depends_on: ["44-01"]
files_modified:
  - lib/notificationService.ts
  - lib/notificationPreferencesService.ts
  - lib/notificationLogger.ts
  - lib/notificationHistoryService.ts
  - lib/notificationValidation.ts
autonomous: true

must_haves:
  truths:
    - "notificationService.ts has zero tsc errors under strict mode"
    - "notificationPreferencesService.ts has zero tsc errors under strict mode"
    - "All remaining notification lib files (logger, history, validation) have zero tsc errors"
  artifacts:
    - path: "lib/notificationService.ts"
      provides: "Strictly typed notification service"
    - path: "lib/notificationPreferencesService.ts"
      provides: "Strictly typed notification preferences"
    - path: "lib/notificationLogger.ts"
      provides: "Strictly typed notification logger"
  key_links:
    - from: "lib/notificationService.ts"
      to: "lib/firebaseAdmin.ts"
      via: "FCM messaging calls"
      pattern: "import.*firebaseAdmin"
---

<objective>
Fix all strict-mode tsc errors in notification service files (50 errors across 5 files).

Purpose: Complete the notification subsystem strict-mode compliance. These files handle the core notification delivery, preference management, logging, history, and validation — all must be type-safe.

Output: 5 notification service files with zero tsc strict-mode errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/notificationService.ts
@lib/notificationPreferencesService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix strict-mode errors in notificationService.ts and notificationPreferencesService.ts</name>
  <files>
    lib/notificationService.ts
    lib/notificationPreferencesService.ts
  </files>
  <action>
Fix all strict-mode errors in these 2 files (35 errors total: 21 + 14).

**notificationService.ts (21 errors, 620 lines):**
Core notification delivery service. Likely errors:
- TS7006: Parameter types on send/schedule functions
- TS18046: Unknown error in catch blocks
- TS18048/TS2532: Possibly undefined on Firebase response objects
- TS2345: Argument type mismatches when calling Firebase Admin SDK

For Firebase Admin messaging calls, the response type comes from `firebase-admin/messaging`. Import and use the proper types:
```typescript
import { Message, MulticastMessage, BatchResponse } from 'firebase-admin/messaging';
```

For each function:
1. Check what parameters lack types
2. Look at the function signature's usage context and define appropriate types
3. For Firebase data that comes as `snapshot.val()`, use proper null checks: `const data = snapshot.val(); if (!data) return;`
4. For catch blocks: `catch (error: unknown) { const msg = error instanceof Error ? error.message : String(error); }`

**notificationPreferencesService.ts (14 errors, 405 lines):**
Preference CRUD operations. Likely TS7006 on preference object parameters and TS18048 on possibly-undefined reads from Firebase.

For preference objects, define interfaces matching the Firebase data structure, e.g.:
```typescript
interface NotificationPreferences {
  enabled: boolean;
  channels: Record<string, boolean>;
  quietHours?: { start: string; end: string };
}
```

Do NOT change function behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep "^lib/notificationService.ts" | wc -l` — must be 0.
Run: `npx tsc --noEmit 2>&1 | grep "^lib/notificationPreferencesService.ts" | wc -l` — must be 0.
  </verify>
  <done>notificationService.ts (0 errors) and notificationPreferencesService.ts (0 errors) under strict mode.</done>
</task>

<task type="auto">
  <name>Task 2: Fix strict-mode errors in notificationLogger, notificationHistoryService, notificationValidation</name>
  <files>
    lib/notificationLogger.ts
    lib/notificationHistoryService.ts
    lib/notificationValidation.ts
  </files>
  <action>
Fix all strict-mode errors in these 3 files (15 errors total: 9 + 4 + 2).

**notificationLogger.ts (9 errors, 319 lines):**
Logging service for notifications. Fix TS7006 on log entry parameters and any TS18046 unknown-error-in-catch patterns. Define a `NotificationLogEntry` interface if one doesn't exist in `types/`.

**notificationHistoryService.ts (4 errors, 162 lines):**
History tracking. Small file with few errors — likely parameter types and possibly-undefined returns from Firebase reads.

**notificationValidation.ts (2 errors, 30 lines):**
Very small validation utility. Only 2 errors — likely missing parameter types on validation functions.

For all files:
1. Run `npx tsc --noEmit 2>&1 | grep "^{filename}"` to see exact errors
2. Add explicit parameter types
3. Add null guards for strictNullChecks errors
4. Handle unknown catch errors

Do NOT change function behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep -E "^lib/notification(Logger|HistoryService|Validation)" | wc -l` — must be 0.
  </verify>
  <done>All 3 files (notificationLogger, notificationHistoryService, notificationValidation) have zero tsc errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -E "^lib/notification(Service|PreferencesService|Logger|HistoryService|Validation)" | wc -l` — must be 0
2. `npm test -- --testPathPattern="notification" --passWithNoTests 2>&1 | tail -5` — related tests still pass
</verification>

<success_criteria>
- notificationService.ts: 0 tsc errors (was 21)
- notificationPreferencesService.ts: 0 tsc errors (was 14)
- notificationLogger.ts: 0 tsc errors (was 9)
- notificationHistoryService.ts: 0 tsc errors (was 4)
- notificationValidation.ts: 0 tsc errors (was 2)
- No behavioral changes to any function
</success_criteria>

<output>
After completion, create `.planning/phases/44-library-strict-mode-foundation/44-03-SUMMARY.md`
</output>
