---
phase: 44-library-strict-mode-foundation
plan: 05
type: execute
wave: 2
depends_on: ["44-01"]
files_modified:
  - lib/netatmoStoveSync.ts
  - lib/netatmoService.ts
  - lib/coordinationOrchestrator.ts
  - lib/schedulerStats.ts
  - lib/schedulerService.ts
  - lib/coordinationUserIntent.ts
  - lib/stoveStateService.ts
  - lib/coordinationPreferences.ts
autonomous: true

must_haves:
  truths:
    - "netatmoStoveSync.ts and netatmoService.ts have zero tsc errors under strict mode"
    - "coordinationOrchestrator.ts has zero tsc errors under strict mode"
    - "All scheduler and coordination files have zero tsc errors under strict mode"
  artifacts:
    - path: "lib/netatmoStoveSync.ts"
      provides: "Strictly typed Netatmo-stove synchronization"
    - path: "lib/coordinationOrchestrator.ts"
      provides: "Strictly typed coordination orchestrator"
    - path: "lib/schedulerService.ts"
      provides: "Strictly typed scheduler service"
  key_links:
    - from: "lib/netatmoStoveSync.ts"
      to: "lib/netatmoService.ts"
      via: "Netatmo API calls"
      pattern: "import.*netatmoService"
    - from: "lib/coordinationOrchestrator.ts"
      to: "lib/schedulerService.ts"
      via: "Schedule coordination"
      pattern: "import.*scheduler"
---

<objective>
Fix all strict-mode tsc errors in Netatmo sync, coordination, and scheduler files (84 errors across 8 files).

Purpose: These files manage the core Netatmo-stove synchronization, device coordination orchestration, and scheduling — critical business logic that benefits most from strict type safety.

Output: 8 files with zero tsc strict-mode errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/netatmoStoveSync.ts
@lib/coordinationOrchestrator.ts
@lib/schedulerService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix strict-mode errors in netatmoStoveSync.ts and netatmoService.ts</name>
  <files>
    lib/netatmoStoveSync.ts
    lib/netatmoService.ts
  </files>
  <action>
Fix all strict-mode errors in these 2 files (43 errors total: 28 + 15).

**netatmoStoveSync.ts (28 errors, 739 lines):**
This is a large file coordinating Netatmo thermostat with Thermorossi stove. Error patterns:
- TS7006: Parameters on sync functions receiving Netatmo API response data and stove state
- TS18046: Unknown catch errors in API call wrappers
- TS18048/TS2532: Possibly undefined on Netatmo API response fields
- TS2345: Type mismatches between Netatmo response types and expected parameters

For Netatmo API types, check `types/external-apis/netatmo.d.ts` (created in phase 43). Use those types for API response data. For Netatmo-specific data that doesn't match existing types, extend or add interfaces.

Use pragmatic `as any` for Netatmo API responses that are truly untyped — per project convention.

**netatmoService.ts (15 errors, 293 lines):**
Netatmo API wrapper. Similar patterns — parameter types and null checks on API responses.

For both files:
1. Run `npx tsc --noEmit 2>&1 | grep "^{filename}"` to see exact errors
2. Use existing types from `types/external-apis/netatmo.d.ts`
3. Add parameter types and null checks
4. Handle unknown catch blocks

Do NOT change function behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep -E "^lib/netatmo(StoveSync|Service)" | wc -l` — must be 0.
  </verify>
  <done>netatmoStoveSync.ts (0 errors) and netatmoService.ts (0 errors) under strict mode.</done>
</task>

<task type="auto">
  <name>Task 2: Fix strict-mode errors in coordination and scheduler files</name>
  <files>
    lib/coordinationOrchestrator.ts
    lib/schedulerStats.ts
    lib/schedulerService.ts
    lib/coordinationUserIntent.ts
    lib/stoveStateService.ts
    lib/coordinationPreferences.ts
  </files>
  <action>
Fix all strict-mode errors in these 6 files (41 errors total: 18 + 9 + 9 + 3 + 1 + 1).

**coordinationOrchestrator.ts (18 errors, 545 lines):**
Main orchestration logic. Fix TS7006 on orchestration parameters, TS18046/TS18048 on nullable state, and any TS7053 index access errors. Orchestration state objects should have proper interfaces.

**schedulerStats.ts (9 errors, 190 lines):**
Statistics tracking. Fix parameter types on stats aggregation functions and ensure numeric computations have proper types.

**schedulerService.ts (9 errors, 403 lines):**
Schedule management. Fix parameter types for schedule objects — check `types/` for existing schedule interfaces. Add null guards on Firebase reads.

**coordinationUserIntent.ts (3 errors, 168 lines):**
User intent parsing. Small number of parameter type fixes.

**stoveStateService.ts (1 error, 87 lines):**
Single error — likely one parameter type or catch block.

**coordinationPreferences.ts (1 error, 76 lines):**
Single error — likely one parameter type or catch block.

For all files:
1. Run `npx tsc --noEmit 2>&1 | grep "^{filename}"` to see exact errors
2. Use existing types from `types/` where available
3. Add parameter types, null guards, unknown-error handling
4. For small files (1-3 errors), fixes should be trivial

Do NOT change function behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep -E "^lib/(coordinationOrchestrator|schedulerStats|schedulerService|coordinationUserIntent|stoveStateService|coordinationPreferences)" | wc -l` — must be 0.
  </verify>
  <done>All 6 coordination/scheduler files have zero tsc errors under strict mode.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -E "^lib/(netatmo|coordination|scheduler|stoveState)" | wc -l` — must be 0
2. `npm test -- --testPathPattern="(netatmo|coordination|scheduler|stoveState)" --passWithNoTests 2>&1 | tail -5` — related tests still pass
</verification>

<success_criteria>
- netatmoStoveSync.ts: 0 tsc errors (was 28)
- netatmoService.ts: 0 tsc errors (was 15)
- coordinationOrchestrator.ts: 0 tsc errors (was 18)
- schedulerStats.ts: 0 tsc errors (was 9)
- schedulerService.ts: 0 tsc errors (was 9)
- coordinationUserIntent.ts: 0 tsc errors (was 3)
- stoveStateService.ts: 0 tsc errors (was 1)
- coordinationPreferences.ts: 0 tsc errors (was 1)
- No behavioral changes to any function
</success_criteria>

<output>
After completion, create `.planning/phases/44-library-strict-mode-foundation/44-05-SUMMARY.md`
</output>
