---
phase: 44-library-strict-mode-foundation
plan: 06
type: execute
wave: 2
depends_on: ["44-01"]
files_modified:
  - lib/hooks/useGeofencing.ts
  - lib/hooks/useOnlineStatus.ts
  - lib/hooks/usePWAInstall.ts
  - lib/hooks/useBackgroundSync.ts
  - lib/hooks/usePeriodicSync.ts
  - lib/hooks/useScheduleData.ts
  - lib/hooks/useRoomStatus.ts
  - lib/pwa/geofencing.ts
autonomous: true

must_haves:
  truths:
    - "All lib/hooks/ files have zero tsc errors under strict mode"
    - "lib/pwa/geofencing.ts has zero tsc errors under strict mode"
    - "All hooks maintain their existing behavior and React hook contract"
  artifacts:
    - path: "lib/hooks/useGeofencing.ts"
      provides: "Strictly typed geofencing hook"
    - path: "lib/hooks/useOnlineStatus.ts"
      provides: "Strictly typed online status hook"
    - path: "lib/hooks/useBackgroundSync.ts"
      provides: "Strictly typed background sync hook"
  key_links:
    - from: "lib/hooks/useGeofencing.ts"
      to: "lib/pwa/geofencing.ts"
      via: "Geofencing API calls"
      pattern: "import.*geofencing"
---

<objective>
Fix all strict-mode tsc errors in React hooks and PWA utility files (39 errors across 8 files).

Purpose: These custom React hooks provide PWA capabilities (geofencing, online status, background sync, periodic sync, install prompt) and data fetching (schedule data, room status). Type-safe hooks prevent runtime errors in component consumption.

Output: 8 hook/PWA files with zero tsc strict-mode errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@lib/hooks/useGeofencing.ts
@lib/hooks/useOnlineStatus.ts
@lib/hooks/useBackgroundSync.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix strict-mode errors in useGeofencing.ts and pwa/geofencing.ts</name>
  <files>
    lib/hooks/useGeofencing.ts
    lib/pwa/geofencing.ts
  </files>
  <action>
Fix all strict-mode errors in these 2 files (18 errors total: 17 + 1).

**useGeofencing.ts (17 errors, 241 lines):**
Geofencing hook with the most errors in the hooks group. Error patterns:
- TS7006: Parameters on geofence callback handlers, event listeners, position objects
- TS18048/TS2532: Possibly undefined on navigator.geolocation, permission state
- TS2345: Type mismatches on Geolocation API parameters

For Geolocation API types, TypeScript's DOM lib already provides `GeolocationPosition`, `GeolocationPositionError`, `PositionOptions`. Use these built-in types.

For geofence-specific state, define interfaces:
```typescript
interface GeofenceRegion {
  latitude: number;
  longitude: number;
  radius: number;
  id: string;
}
```

For event handlers with `useEffect`, type the cleanup function properly.

**pwa/geofencing.ts (1 error, 291 lines):**
Single error — likely one parameter type or null check.

Do NOT change hook behavior or return types — only add internal types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep -E "^lib/(hooks/useGeofencing|pwa/geofencing)" | wc -l` — must be 0.
  </verify>
  <done>useGeofencing.ts (0 errors) and pwa/geofencing.ts (0 errors) under strict mode.</done>
</task>

<task type="auto">
  <name>Task 2: Fix strict-mode errors in remaining hooks</name>
  <files>
    lib/hooks/useOnlineStatus.ts
    lib/hooks/usePWAInstall.ts
    lib/hooks/useBackgroundSync.ts
    lib/hooks/usePeriodicSync.ts
    lib/hooks/useScheduleData.ts
    lib/hooks/useRoomStatus.ts
  </files>
  <action>
Fix all strict-mode errors in these 6 files (21 errors total: 6 + 4 + 4 + 3 + 2 + 2).

**useOnlineStatus.ts (6 errors, 147 lines):**
Online/offline detection hook. Fix parameter types on event listeners and possibly-undefined on navigator properties. Use `Event` type for event handler parameters.

**usePWAInstall.ts (4 errors, 196 lines):**
PWA install prompt hook. The `beforeinstallprompt` event is a non-standard DOM event — use the `BeforeInstallPromptEvent` interface if defined in the project, or define one:
```typescript
interface BeforeInstallPromptEvent extends Event {
  prompt(): Promise<void>;
  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;
}
```

**useBackgroundSync.ts (4 errors, 230 lines):**
Service worker background sync. Fix parameter types — `ServiceWorkerRegistration` and `SyncManager` types from DOM lib. For navigator.serviceWorker, add null check.

**usePeriodicSync.ts (3 errors, 132 lines):**
Periodic background sync. Similar to useBackgroundSync — fix parameter types and null checks.

**useScheduleData.ts (2 errors, 94 lines):**
Schedule data fetching hook. Likely 2 parameter type fixes on fetch response handling.

**useRoomStatus.ts (2 errors, 57 lines):**
Room status hook. Small file, 2 simple fixes.

For all files:
1. Run `npx tsc --noEmit 2>&1 | grep "^{filename}"` to see exact errors
2. Use TypeScript DOM lib types where applicable (Event, Navigator, ServiceWorkerRegistration)
3. Add null checks for browser API availability (navigator.serviceWorker, etc.)
4. Handle unknown catch blocks

Do NOT change hook behavior — only add types.
  </action>
  <verify>
Run: `npx tsc --noEmit 2>&1 | grep -E "^lib/hooks/(useOnlineStatus|usePWAInstall|useBackgroundSync|usePeriodicSync|useScheduleData|useRoomStatus)" | wc -l` — must be 0.
  </verify>
  <done>All 6 remaining hook files have zero tsc errors under strict mode.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -E "^lib/(hooks/|pwa/)" | wc -l` — must be 0
2. Hooks don't have dedicated tests typically, but run: `npm test -- --testPathPattern="(geofencing|online|pwa|sync|schedule|room)" --passWithNoTests 2>&1 | tail -5` — any related tests still pass
</verification>

<success_criteria>
- useGeofencing.ts: 0 tsc errors (was 17)
- pwa/geofencing.ts: 0 tsc errors (was 1)
- useOnlineStatus.ts: 0 tsc errors (was 6)
- usePWAInstall.ts: 0 tsc errors (was 4)
- useBackgroundSync.ts: 0 tsc errors (was 4)
- usePeriodicSync.ts: 0 tsc errors (was 3)
- useScheduleData.ts: 0 tsc errors (was 2)
- useRoomStatus.ts: 0 tsc errors (was 2)
- No behavioral changes to any hook
</success_criteria>

<output>
After completion, create `.planning/phases/44-library-strict-mode-foundation/44-06-SUMMARY.md`
</output>
