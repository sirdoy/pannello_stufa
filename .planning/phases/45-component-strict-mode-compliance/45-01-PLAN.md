---
phase: 45-component-strict-mode-compliance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/devices/lights/LightsCard.tsx
  - app/components/devices/thermostat/ThermostatCard.tsx
autonomous: true

must_haves:
  truths:
    - "LightsCard.tsx has zero tsc errors under strict mode"
    - "ThermostatCard.tsx has zero tsc errors under strict mode"
    - "No behavioral changes to LightsCard or ThermostatCard"
  artifacts:
    - path: "app/components/devices/lights/LightsCard.tsx"
      provides: "Strict-mode compliant Hue lights control component"
    - path: "app/components/devices/thermostat/ThermostatCard.tsx"
      provides: "Strict-mode compliant Netatmo thermostat control component"
  key_links:
    - from: "app/components/devices/lights/LightsCard.tsx"
      to: "lib/hue/colorUtils"
      via: "import"
      pattern: "import.*colorUtils"
    - from: "app/components/devices/thermostat/ThermostatCard.tsx"
      to: "lib/netatmo"
      via: "import"
      pattern: "import.*netatmo"
---

<objective>
Fix all 89 strict-mode TypeScript errors in the two largest device card components: LightsCard.tsx (52 errors) and ThermostatCard.tsx (37 errors).

Purpose: These two files alone account for 21% of all component strict-mode errors. Fixing them first removes the biggest error concentrations.
Output: Two fully strict-mode compliant device card files with zero tsc errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-library-strict-mode-foundation/44-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix 52 strict-mode errors in LightsCard.tsx</name>
  <files>app/components/devices/lights/LightsCard.tsx</files>
  <action>
Fix all 52 tsc strict-mode errors in LightsCard.tsx. The errors break down as:
- TS7006 (noImplicitAny) ~26: Add parameter types to all event handlers, callback functions, .then()/.catch() handlers, .map()/.filter()/.find() callbacks, and API response handlers. Use specific types where the shape is known (e.g., `{ id: string; name: string; on: { on: boolean }; dimming?: { brightness: number } }` for light objects). Use `any` only for genuinely untyped Hue API responses where the shape is unpredictable.
- TS18046 (unknown error) ~9: All catch blocks — use `error instanceof Error ? error.message : String(error)` pattern (established in phase 44).
- TS2322 (type mismatch) ~8: Fix type mismatches in props, state assignments, and JSX attributes. Common: `string | null` vs `string` — add null checks or default values.
- TS7053 (implicit index) ~1: Add explicit Record type for room/light lookup objects.
- TS2769 (no overload) ~1: Fix component prop type to match expected overload.
- TS2345 (argument type) ~2: Fix argument types passed to functions.
- Other ~5: Variable types, null checks as needed.

Key patterns:
- For API fetch responses: `const data = await res.json() as { rooms?: any[]; lights?: any[]; scenes?: any[] }`
- For event handlers: `(e: React.ChangeEvent<HTMLInputElement>)` or `(value: number[])` for Slider
- For Hue light objects: Type or inline type the shape based on usage
- For catch blocks: `catch (err: unknown) { const msg = err instanceof Error ? err.message : String(err); }`

Do NOT change any runtime behavior, only add type annotations and null checks.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep "app/components/devices/lights/LightsCard.tsx" | wc -l returns 0</verify>
  <done>LightsCard.tsx compiles with zero tsc strict-mode errors. All existing functionality preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Fix 37 strict-mode errors in ThermostatCard.tsx</name>
  <files>app/components/devices/thermostat/ThermostatCard.tsx</files>
  <action>
Fix all 37 tsc strict-mode errors in ThermostatCard.tsx. The errors break down as:
- TS7006 (noImplicitAny) ~19: Add parameter types to all event handlers, API response callbacks, .map()/.filter() callbacks, and helper function parameters. The thermostat data shape includes: `{ temperature: number; setpoint: number; battery: number; mode: string; heating: boolean }` etc.
- TS18046 (unknown error) ~9: All catch blocks — use `error instanceof Error ? error.message : String(error)` pattern.
- TS2352 (conversion mistake) ~2: Fix type assertion issues, likely `as` casts that need intermediate steps.
- TS2322 (type mismatch) ~3: Fix prop type mismatches and state assignments.
- TS7053 (implicit index) ~1: Add explicit Record type for dynamic property access.
- Other ~3: Variable types, null safety.

Key patterns:
- For Netatmo API responses: Type the response shape based on actual usage in the component
- For temperature setpoint handlers: `(value: number)` or `(e: React.ChangeEvent<HTMLInputElement>)`
- For mode switching: Use union type `'schedule' | 'manual' | 'away' | 'hg'` for thermostat modes
- For battery level display: Ensure null check before using battery percentage
- For catch blocks: Same `error instanceof Error` pattern as Task 1

Do NOT change any runtime behavior, only add type annotations and null checks.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep "app/components/devices/thermostat/ThermostatCard.tsx" | wc -l returns 0</verify>
  <done>ThermostatCard.tsx compiles with zero tsc strict-mode errors. All existing functionality preserved.</done>
</task>

</tasks>

<verification>
```bash
# Both files must have zero errors
npx tsc --noEmit 2>&1 | grep -E "app/components/devices/(lights/LightsCard|thermostat/ThermostatCard)\.tsx" | wc -l
# Expected: 0

# No behavioral changes — existing tests still pass
npx jest --testPathPattern="devices/(lights|thermostat)" --passWithNoTests 2>&1 | tail -5
```
</verification>

<success_criteria>
- Zero tsc strict-mode errors in LightsCard.tsx (was 52)
- Zero tsc strict-mode errors in ThermostatCard.tsx (was 37)
- No runtime behavioral changes
- Any existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/45-component-strict-mode-compliance/45-01-SUMMARY.md`
</output>
