---
phase: 45-component-strict-mode-compliance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/devices/stove/StoveCard.tsx
  - app/components/devices/stove/GlassEffect.tsx
  - app/components/devices/camera/CameraCard.tsx
  - app/components/devices/camera/HlsPlayer.tsx
  - app/components/devices/camera/EventPreviewModal.tsx
  - app/components/devices/thermostat/BatteryWarning.tsx
autonomous: true

must_haves:
  truths:
    - "All 6 device component files have zero tsc errors under strict mode"
    - "StoveCard glass effect animation still renders correctly"
    - "Camera HLS player and event preview still function"
  artifacts:
    - path: "app/components/devices/stove/StoveCard.tsx"
      provides: "Strict-mode compliant stove control component"
    - path: "app/components/devices/stove/GlassEffect.tsx"
      provides: "Strict-mode compliant WebGL glass effect"
    - path: "app/components/devices/camera/CameraCard.tsx"
      provides: "Strict-mode compliant Netatmo camera component"
    - path: "app/components/devices/camera/HlsPlayer.tsx"
      provides: "Strict-mode compliant HLS video player"
  key_links:
    - from: "app/components/devices/stove/GlassEffect.tsx"
      to: "WebGL context"
      via: "canvas.getContext('webgl')"
      pattern: "getContext.*webgl"
---

<objective>
Fix all 50 strict-mode TypeScript errors in the remaining device card components: StoveCard (25), GlassEffect (15), CameraCard (5), HlsPlayer (3), EventPreviewModal (1), BatteryWarning (1).

Purpose: Complete strict-mode compliance for the entire devices/ subdirectory.
Output: All 6 device component files with zero tsc errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-library-strict-mode-foundation/44-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix strict-mode errors in StoveCard.tsx and GlassEffect.tsx</name>
  <files>app/components/devices/stove/StoveCard.tsx, app/components/devices/stove/GlassEffect.tsx</files>
  <action>
**StoveCard.tsx (25 errors):**
- TS7034/TS7005 (implicit any variable): Declare state and local variables with explicit types. For polling timers: `let timer: NodeJS.Timeout | null = null`. For API response data: type the shape based on usage.
- TS7006 (noImplicitAny): Add parameter types to all callbacks, event handlers, .map()/.then()/.catch() handlers. Stove data shape includes: `{ stato_stufa: number; temp_fumi: number; temp_ambiente: number; ventilazione: number; potenza: number }` etc.
- TS7053 (implicit index): Add Record types for dynamic property access on stove state objects.
- TS18047 (possibly null): Add null checks before accessing properties on potentially null refs or state.

**GlassEffect.tsx (15 errors — all TS18047 'gl' is possibly null):**
- All 15 errors are about WebGL context `gl` being possibly null after `canvas.getContext('webgl')`.
- Fix: Add an early return guard after getting the context: `const gl = canvasRef.current?.getContext('webgl'); if (!gl) return;`
- This single guard eliminates all 15 errors. Apply to each function that uses `gl`.
- Alternative: Use non-null assertion `gl!` after an initial null check at the top of the effect.

Do NOT change any rendering behavior or WebGL shader logic.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -E "app/components/devices/stove/(StoveCard|GlassEffect)\.tsx" | wc -l returns 0</verify>
  <done>StoveCard.tsx (0 errors, was 25) and GlassEffect.tsx (0 errors, was 15) compile cleanly under strict mode.</done>
</task>

<task type="auto">
  <name>Task 2: Fix strict-mode errors in camera components and BatteryWarning</name>
  <files>app/components/devices/camera/CameraCard.tsx, app/components/devices/camera/HlsPlayer.tsx, app/components/devices/camera/EventPreviewModal.tsx, app/components/devices/thermostat/BatteryWarning.tsx</files>
  <action>
**CameraCard.tsx (5 errors):**
- TS18046 (unknown error) x2: catch blocks — use `error instanceof Error ? error.message : String(error)`.
- TS2345 (argument type) x1: `string | null` passed where `string` expected — add null check or default `''`.
- TS2322 (type mismatch) x2: `string | null` assigned to `string` or `string | undefined` — add nullish coalescing `?? ''` or `?? undefined`.

**HlsPlayer.tsx (3 errors):**
- TS7034 (implicit any variable) x1: `let hls` needs explicit type. Import Hls type from `hls.js` and declare: `let hls: Hls | null = null;`
- TS7005 (implicit any) x2: Same `hls` variable used later without type — fixed by the declaration above.

**EventPreviewModal.tsx (1 error):**
- TS2322 x1: `string | null` assigned to `string | undefined` — use `value ?? undefined` or add null check.

**BatteryWarning.tsx (1 error):**
- TS2345 x1: Argument type mismatch — likely a numeric/string conversion or null safety issue. Add appropriate type guard.

Do NOT change any camera streaming behavior or battery warning display logic.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -E "app/components/devices/camera/|app/components/devices/thermostat/BatteryWarning" | wc -l returns 0</verify>
  <done>CameraCard.tsx, HlsPlayer.tsx, EventPreviewModal.tsx, BatteryWarning.tsx all compile with zero tsc errors.</done>
</task>

</tasks>

<verification>
```bash
# All device component files must have zero errors
npx tsc --noEmit 2>&1 | grep "app/components/devices/" | wc -l
# Expected: 0

# Existing tests still pass
npx jest --testPathPattern="devices/" --passWithNoTests 2>&1 | tail -5
```
</verification>

<success_criteria>
- Zero tsc errors across all 6 files (was 50 total)
- Complete devices/ subdirectory strict-mode compliance
- No behavioral changes
- Any existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/45-component-strict-mode-compliance/45-02-SUMMARY.md`
</output>
