---
phase: 45-component-strict-mode-compliance
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/ui/__tests__/Toast.test.tsx
  - app/components/ui/__tests__/FormModal.test.tsx
autonomous: true

must_haves:
  truths:
    - "Toast.test.tsx has zero tsc errors under strict mode"
    - "FormModal.test.tsx has zero tsc errors under strict mode"
    - "All Toast tests still pass green"
    - "All FormModal tests still pass green (except known onClose issue from phase 47)"
  artifacts:
    - path: "app/components/ui/__tests__/Toast.test.tsx"
      provides: "Strict-mode compliant Toast test file"
    - path: "app/components/ui/__tests__/FormModal.test.tsx"
      provides: "Strict-mode compliant FormModal test file"
  key_links:
    - from: "app/components/ui/__tests__/Toast.test.tsx"
      to: "app/components/ui/ToastProvider"
      via: "import"
      pattern: "import.*ToastProvider"
    - from: "app/components/ui/__tests__/FormModal.test.tsx"
      to: "app/components/ui/FormModal"
      via: "import"
      pattern: "import.*FormModal"
---

<objective>
Fix all 74 strict-mode TypeScript errors in the two largest UI test files: Toast.test.tsx (48 errors) and FormModal.test.tsx (26 errors).

Purpose: These two test files alone account for 67% of all UI test errors. They require careful handling because test files have specific patterns (mock data, intentional null passing, hook testing).
Output: Both test files with zero tsc errors and all tests still passing.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-library-strict-mode-foundation/44-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix 48 strict-mode errors in Toast.test.tsx</name>
  <files>app/components/ui/__tests__/Toast.test.tsx</files>
  <action>
Fix all 48 tsc errors in Toast.test.tsx. The errors break down as:

- TS7031 (binding element implicitly any) x2: Add types to destructured parameters in test helpers. For the `onMount` callback: `(onMount: (api: ReturnType<typeof useToast>) => void)` or define a ToastApi type.
- TS7006 (noImplicitAny) x11: Add parameter types to all test helper functions, mock callbacks, and render wrappers. The test uses `TestConsumer` with `onMount` prop and `renderWithProvider` helper — type these properly.
- TS7034 (variable implicitly any in some locations) x8: Declare test variables with explicit types. Pattern: `let toastApi: ReturnType<typeof useToast>` or use the specific toast context type. These are likely variables captured via `onMount` callback.
- TS7005 (variable implicitly any) x17: Same variables used after declaration without type — fixing TS7034 declarations resolves these downstream.
- TS2345 (argument type) ~10: Fix argument types in test assertions or mock function calls.

Key approach:
1. First, type the `TestConsumer` component props: `{ onMount?: (api: { addToast: (...) => void; removeToast: (...) => void; toasts: ... }) => void }`
2. Type the `renderWithProvider` helper parameter
3. Type all captured toast API variables: `let toastApi: ReturnType<typeof useToast>;` (or the specific type from ToastContext)
4. For test-specific mock data, use `as any` only for intentional edge case tests (e.g., passing invalid types to test error handling)

Follow phase 44-07 patterns:
- Non-null assertions (!) for data known to exist in test context
- Pragmatic `as any` for intentional null/undefined test cases
- Explicit types on all test helper function signatures

Do NOT change any test logic or assertions. Only add type annotations.
  </action>
  <verify>
npx tsc --noEmit 2>&1 | grep "Toast.test.tsx" | wc -l returns 0
npx jest app/components/ui/__tests__/Toast.test.tsx --passWithNoTests 2>&1 | tail -3
  </verify>
  <done>Toast.test.tsx compiles with zero tsc errors (was 48). All Toast tests pass green.</done>
</task>

<task type="auto">
  <name>Task 2: Fix 26 strict-mode errors in FormModal.test.tsx</name>
  <files>app/components/ui/__tests__/FormModal.test.tsx</files>
  <action>
Fix all 26 tsc errors in FormModal.test.tsx. The errors break down as:

- TS7031 (binding element implicitly any) x20: Most errors are destructured parameters in test helpers and render functions. The test likely has helper functions that create form modal configurations — type all destructured parameters with proper FormModal prop types.
- TS7034 (variable implicitly any in some locations) x2: Declare variables with explicit types for captured refs or form state.
- TS7005 (variable implicitly any) x2: Downstream of TS7034 — fixed by typing declarations.
- TS2345 (argument type) ~2: Fix argument type mismatches in render calls or mock setups.

Key approach:
1. Import or define the FormModal props type (from FormModal.tsx or inline)
2. Type all helper function parameters that create/render FormModals
3. Type destructured `{ fields, onSubmit, onClose }` etc. in test helpers
4. For form field configs: `{ name: string; label: string; type: string; defaultValue?: string; required?: boolean }[]`

Note: Phase 47 has a known issue with FormModal cancel behavior (onClose called twice). Do NOT attempt to fix that behavioral bug — only fix type errors.

Do NOT change any test logic or assertions. Only add type annotations.
  </action>
  <verify>
npx tsc --noEmit 2>&1 | grep "FormModal.test.tsx" | wc -l returns 0
npx jest app/components/ui/__tests__/FormModal.test.tsx --passWithNoTests 2>&1 | tail -3
  </verify>
  <done>FormModal.test.tsx compiles with zero tsc errors (was 26). Tests pass (known onClose issue is behavioral, not type-related).</done>
</task>

</tasks>

<verification>
```bash
# Both test files must have zero errors
npx tsc --noEmit 2>&1 | grep -E "(Toast|FormModal)\.test\.tsx" | wc -l
# Expected: 0

# Tests still pass
npx jest app/components/ui/__tests__/Toast.test.tsx app/components/ui/__tests__/FormModal.test.tsx --passWithNoTests 2>&1 | tail -5
```
</verification>

<success_criteria>
- Zero tsc errors in Toast.test.tsx (was 48)
- Zero tsc errors in FormModal.test.tsx (was 26)
- All test assertions unchanged
- Tests pass green
</success_criteria>

<output>
After completion, create `.planning/phases/45-component-strict-mode-compliance/45-06-SUMMARY.md`
</output>
