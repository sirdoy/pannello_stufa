---
phase: 46-api-page-strict-mode-compliance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/lights/page.tsx
  - app/stove/page.tsx
autonomous: true

must_haves:
  truths:
    - "Lights page compiles with zero tsc strict-mode errors"
    - "Stove page compiles with zero tsc strict-mode errors"
    - "All catch blocks use error instanceof Error pattern"
    - "All possibly-null state values have proper guards"
  artifacts:
    - path: "app/lights/page.tsx"
      provides: "Strict-mode compliant lights page"
    - path: "app/stove/page.tsx"
      provides: "Strict-mode compliant stove page"
  key_links:
    - from: "app/lights/page.tsx"
      to: "lib/types"
      via: "HueLight, HueRoom types"
      pattern: "HueLight|HueRoom"
---

<objective>
Fix all 41 strict-mode TypeScript errors in the lights page (24 errors) and stove page (17 errors).

Purpose: These two large device-control pages share similar error patterns (catch blocks, null state, implicit any parameters).
Output: Both pages with zero tsc strict-mode errors.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/lights/page.tsx
@app/stove/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix 24 strict-mode errors in lights page</name>
  <files>app/lights/page.tsx</files>
  <action>
Fix 24 tsc errors in app/lights/page.tsx:

**TS18046 (unknown catch errors) - 12 errors:**
- Lines 163, 188, 208, 230, 252, 279, 301, 333, 386, 437, 492, 554: `err` is unknown
- Fix: `err instanceof Error ? err.message : String(err)` in each catch block

**TS7006 (implicit any parameters) - 7 errors:**
- Line 153: `a`, `b` in sort callback — type as `(a: HueRoom, b: HueRoom)` (or whatever the array element type is; check the array being sorted)
- Line 340: `room` param — type based on the array context (likely HueRoom)
- Line 342: `s` param — type based on array context
- Line 349: `room` param — type as HueRoom
- Line 352: `c` param — type based on context
- Line 360: `room` param — type as HueRoom

**TS2345 (argument type mismatch) - 4 errors:**
- Line 1041: Slider onChange returns `number | FormEvent<HTMLDivElement> | number[]` but expects `number` — cast: `value as number` (Slider always returns number for single value)
- Line 1072: HueLight type mismatch — check if HueLight interface differences cause this; may need assertion
- Line 1132: Same Slider pattern as 1041
- Line 1179: `string | undefined` passed where `string` expected — add fallback: `value ?? ''` or `value!`

**TS2769 (no overload matches) - 1 error:**
- Line 452: Check which function call has overload issue — likely related to Slider or event handler; fix to match expected signature
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep "app/lights/page.tsx" | wc -l should return 0</verify>
  <done>Zero tsc errors in app/lights/page.tsx. All 24 errors fixed.</done>
</task>

<task type="auto">
  <name>Task 2: Fix 17 strict-mode errors in stove page</name>
  <files>app/stove/page.tsx</files>
  <action>
Fix 17 tsc errors in app/stove/page.tsx:

**TS7034/TS7005 (variable implicit any) - 6 errors:**
- Lines 310-312: `unsubscribeState`, `unsubscribeMaintenance`, `unsubscribeError` — type as `let unsubscribeState: (() => void) | null = null` (same pattern for all three)
- Lines 349-351: These reference the same variables

**TS7053 (implicit any index access) - 2 errors:**
- Line 221: index into command map with `any` expression — use `as keyof typeof commandMap` pattern
- Line 533: index into theme/color map with string — use `as keyof typeof colorMap` pattern

**TS18047 (possibly null) - 8 errors:**
- Line 600: `maintenanceStatus` possibly null — add null guard or use `maintenanceStatus?.property`
- Lines 857, 870 (x2 each): `fanLevel` possibly null — add `if (fanLevel !== null)` guard before the conditional block, or use `fanLevel ?? 0`
- Lines 889, 902 (x2 each): `powerLevel` possibly null — same pattern as fanLevel

**TS7034 (variable implicit any) - 1 error:**
- Already covered in first group above

**Established patterns:**
- Firebase unsubscribe: `let unsub: (() => void) | null = null`
- Null guards: `value !== null` before usage, or `value ?? defaultValue`
- Index access: `key as keyof typeof objectLiteral`
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep "app/stove/page.tsx" | wc -l should return 0</verify>
  <done>Zero tsc errors in app/stove/page.tsx. All 17 errors fixed.</done>
</task>

</tasks>

<verification>
```bash
# Zero errors in both pages
npx tsc --noEmit 2>&1 | grep -E "app/(lights|stove)/page.tsx" | wc -l
# Expected: 0
```
</verification>

<success_criteria>
- app/lights/page.tsx compiles with zero tsc strict-mode errors (24 fixed)
- app/stove/page.tsx compiles with zero tsc strict-mode errors (17 fixed)
- No behavioral changes to either page
</success_criteria>

<output>
After completion, create `.planning/phases/46-api-page-strict-mode-compliance/46-02-SUMMARY.md`
</output>
