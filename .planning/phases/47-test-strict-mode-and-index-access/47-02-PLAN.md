---
phase: 47-test-strict-mode-and-index-access
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - __tests__/lib/netatmoStoveSync.test.ts
  - __tests__/lib/coordinationPauseCalculator.test.ts
  - app/thermostat/page.test.tsx
autonomous: true

must_haves:
  truths:
    - "netatmoStoveSync.test.ts has zero tsc errors with strict: true"
    - "coordinationPauseCalculator.test.ts has zero tsc errors with strict: true"
    - "page.test.tsx (thermostat) has zero tsc errors with strict: true"
  artifacts:
    - path: "__tests__/lib/netatmoStoveSync.test.ts"
      provides: "Strict-mode compliant Netatmo stove sync tests"
    - path: "__tests__/lib/coordinationPauseCalculator.test.ts"
      provides: "Strict-mode compliant coordination pause calculator tests"
    - path: "app/thermostat/page.test.tsx"
      provides: "Strict-mode compliant thermostat page tests"
  key_links:
    - from: "app/thermostat/page.test.tsx"
      to: "app/thermostat/page.tsx"
      via: "import and render"
      pattern: "render.*ThermostatPage"
---

<objective>
Fix 74 strict-mode tsc errors across 3 mid-error test files: netatmoStoveSync (25 errors), coordinationPauseCalculator (22 errors), thermostat page.test (27 errors).

Purpose: These three files account for ~26% of remaining tsc errors. Combined with Plan 01, this addresses ~64% of all test file errors.
Output: Three test files with zero tsc errors under strict: true.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@__tests__/lib/netatmoStoveSync.test.ts
@__tests__/lib/coordinationPauseCalculator.test.ts
@app/thermostat/page.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix netatmoStoveSync.test.ts (25 errors) and coordinationPauseCalculator.test.ts (22 errors)</name>
  <files>__tests__/lib/netatmoStoveSync.test.ts, __tests__/lib/coordinationPauseCalculator.test.ts</files>
  <action>
Fix 47 tsc errors across these two files. Error patterns:
- TS7005/TS7034: Mock variables (`let mockGet`, `let mockUpdate`, etc.) need explicit `jest.Mock` type annotations
- TS18047: Possibly null — add non-null assertions for test data known to exist
- TS7053: Element implicitly has 'any' — use Record types or type assertions for dynamic mock access
- TS7031: Binding element implicitly has 'any' — type destructured params in mock callbacks
- TS2345: Type mismatch — add explicit types to mock return values

Patterns to apply:
1. `let mockGet: jest.Mock;` (not bare `let mockGet;`)
2. `jest.mocked(moduleName).mockReturnValue(...)` for auto-mocked modules
3. Non-null assertions `!` for mock call args: `mockFn.mock.calls[0]![0]!`
4. `as any` for intentional partial mock data (testing edge cases)

Run tsc to verify zero errors in both files.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "netatmoStoveSync.test\|coordinationPauseCalculator.test" outputs 0</verify>
  <done>Both files compile with zero tsc errors. All tests still pass.</done>
</task>

<task type="auto">
  <name>Task 2: Fix app/thermostat/page.test.tsx (27 errors)</name>
  <files>app/thermostat/page.test.tsx</files>
  <action>
Fix 27 tsc errors in thermostat page.test.tsx. This is a page-level test with unique patterns:
- TS7005: `mockRouter` variable implicitly has 'any' (appears 5+ times) — declare with proper Next.js router type or jest.Mock
- TS18047/TS18048: Component render results possibly null — add null guards or non-null assertions
- TS7031: Binding element 'children' implicitly has 'any' in mock component wrappers — type as React.PropsWithChildren or { children: React.ReactNode }
- TS7053: Dynamic property access on mock objects — use Record<string, jest.Mock> or explicit interfaces

For mockRouter specifically:
```typescript
const mockRouter = {
  push: jest.fn(),
  replace: jest.fn(),
  back: jest.fn(),
  prefetch: jest.fn(),
  // ... other router methods
} as unknown as ReturnType<typeof useRouter>;
```

Or simpler: `let mockRouter: Record<string, jest.Mock>;`

Run tsc and jest to verify.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "thermostat/page.test" outputs 0 AND npx jest thermostat/page passes</verify>
  <done>thermostat/page.test.tsx compiles with zero tsc errors. All thermostat page tests pass.</done>
</task>

</tasks>

<verification>
```bash
# Verify zero errors in these 3 files
npx tsc --noEmit 2>&1 | grep "netatmoStoveSync.test\|coordinationPauseCalculator.test\|thermostat/page.test" | wc -l
# Expected: 0

# Verify tests still pass
npx jest netatmoStoveSync coordinationPauseCalculator thermostat/page
# Expected: all pass
```
</verification>

<success_criteria>
- 0 tsc errors in netatmoStoveSync.test.ts (was 25)
- 0 tsc errors in coordinationPauseCalculator.test.ts (was 22)
- 0 tsc errors in app/thermostat/page.test.tsx (was 27)
- All tests in these files still pass
</success_criteria>

<output>
After completion, create `.planning/phases/47-test-strict-mode-and-index-access/47-02-SUMMARY.md`
</output>
