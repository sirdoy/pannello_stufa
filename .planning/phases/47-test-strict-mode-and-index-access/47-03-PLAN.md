---
phase: 47-test-strict-mode-and-index-access
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - __tests__/lib/healthMonitoring.test.ts
  - __tests__/lib/coordinationDebounce.test.ts
  - __tests__/lib/healthNotifications.test.ts
  - __tests__/lib/netatmoApi.test.ts
  - __tests__/lib/netatmoCameraApi.test.ts
  - __tests__/lib/netatmoTokenHelper.test.ts
  - __tests__/lib/coordinationUserIntent.test.ts
  - __tests__/lib/coordinationPreferences.test.ts
  - __tests__/lib/coordinationNotificationThrottle.test.ts
  - __tests__/lib/coordinationOrchestrator.test.ts
  - __tests__/semiAutoMode.test.ts
  - __tests__/components/StoveSyncPanel.test.tsx
  - __tests__/api/geocoding/geocoding.test.ts
  - __tests__/app/
  - app/api/hue/discover/__tests__/route.test.ts
  - app/api/netatmo/setroomthermpoint/__tests__/route.test.ts
  - app/api/netatmo/setthermmode/__tests__/route.test.ts
  - app/context/__tests__/VersionContext.test.tsx
  - app/hooks/__tests__/useReducedMotion.test.ts
  - app/hooks/__tests__/useVersionCheck.test.ts
autonomous: true

must_haves:
  truths:
    - "All 20 remaining test files have zero tsc errors with strict: true"
    - "npx tsc --noEmit reports zero errors across entire codebase"
  artifacts:
    - path: "__tests__/lib/healthMonitoring.test.ts"
      provides: "Strict-mode compliant health monitoring tests"
    - path: "__tests__/lib/netatmoApi.test.ts"
      provides: "Strict-mode compliant Netatmo API tests"
    - path: "app/hooks/__tests__/useReducedMotion.test.ts"
      provides: "Strict-mode compliant useReducedMotion tests"
  key_links:
    - from: "all test files"
      to: "their respective source modules"
      via: "import and jest.mock"
      pattern: "jest\\.mock\\("
---

<objective>
Fix ~100 strict-mode tsc errors across the remaining 20 test files (each with 1-14 errors).

Purpose: After Plans 01 and 02 fix the 6 highest-error files (182 errors), this plan finishes the remaining ~100 errors to achieve zero tsc errors under strict: true (before noUncheckedIndexedAccess).
Output: All test files compile cleanly with strict: true.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix 10 mid-error test files (healthMonitoring 14, coordinationDebounce 11, healthNotifications 10, netatmoApi 9, netatmoCameraApi 8, useReducedMotion 7, app/ 7, hue/discover 6)</name>
  <files>
    __tests__/lib/healthMonitoring.test.ts,
    __tests__/lib/coordinationDebounce.test.ts,
    __tests__/lib/healthNotifications.test.ts,
    __tests__/lib/netatmoApi.test.ts,
    __tests__/lib/netatmoCameraApi.test.ts,
    app/hooks/__tests__/useReducedMotion.test.ts,
    __tests__/app/,
    app/api/hue/discover/__tests__/route.test.ts
  </files>
  <action>
Fix ~72 tsc errors across 8 test files. Same patterns as Plans 01-02:

1. **TS7034/TS7005 (mock variables):** Add `jest.Mock` type to all `let mock*` declarations
2. **TS18047/TS18048 (possibly null):** Non-null assertions for known test data
3. **TS7031 (binding elements):** Type destructured parameters in callbacks
4. **TS7053 (element has any):** Use Record types for dynamic property access
5. **TS2345 (type mismatch):** Explicit type annotations on mock return values

For useReducedMotion.test.ts, the errors are likely about the MediaQueryList mock. Type it explicitly:
```typescript
const mockMediaQueryList: Partial<MediaQueryList> = {
  matches: false,
  addEventListener: jest.fn(),
  removeEventListener: jest.fn(),
};
```

For hue/discover route test, the errors are likely about Next.js Request/Response mocks. Use `as unknown as NextRequest` pattern.

Run `npx tsc --noEmit 2>&1 | grep "error TS" | grep "test\.\|__tests__" | wc -l` after to verify remaining count.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "healthMonitoring.test\|coordinationDebounce.test\|healthNotifications.test\|netatmoApi.test\|netatmoCameraApi.test\|useReducedMotion.test\|__tests__/app\|hue/discover.*test" outputs 0</verify>
  <done>All 8 files have zero tsc errors under strict: true.</done>
</task>

<task type="auto">
  <name>Task 2: Fix 12 low-error test files (1-4 errors each) and verify zero total tsc errors</name>
  <files>
    __tests__/lib/netatmoTokenHelper.test.ts,
    __tests__/lib/coordinationUserIntent.test.ts,
    __tests__/lib/coordinationPreferences.test.ts,
    __tests__/lib/coordinationNotificationThrottle.test.ts,
    __tests__/lib/coordinationOrchestrator.test.ts,
    __tests__/semiAutoMode.test.ts,
    __tests__/components/StoveSyncPanel.test.tsx,
    __tests__/api/geocoding/geocoding.test.ts,
    app/api/netatmo/setroomthermpoint/__tests__/route.test.ts,
    app/api/netatmo/setthermmode/__tests__/route.test.ts,
    app/context/__tests__/VersionContext.test.tsx,
    app/hooks/__tests__/useVersionCheck.test.ts
  </files>
  <action>
Fix ~28 tsc errors across 12 test files (1-4 errors each). These are quick fixes:

- netatmoTokenHelper (3 errors): Mock variable typing
- coordinationUserIntent (3 errors): Mock variable typing
- coordinationPreferences (3 errors): Mock variable typing
- coordinationNotificationThrottle (2 errors): Mock variable typing
- coordinationOrchestrator (1 error): Mock variable typing
- semiAutoMode (2 errors): Mock variable typing
- StoveSyncPanel (2 errors): Component prop typing
- geocoding (4 errors): Mock request/response typing
- setroomthermpoint (1 error): Mock typing
- setthermmode (1 error): Mock typing
- VersionContext (4 errors): Context provider mock typing
- useVersionCheck (2 errors): Hook mock typing

After all fixes, run full `npx tsc --noEmit` to verify ZERO total errors.
This confirms the codebase is fully strict-mode compliant (before enabling noUncheckedIndexedAccess).
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "error TS" outputs 0</verify>
  <done>All test files compile cleanly. Total tsc errors = 0 with strict: true. Milestone: STRICT-02 complete for test files.</done>
</task>

</tasks>

<verification>
```bash
# Verify zero total tsc errors
npx tsc --noEmit 2>&1 | grep -c "error TS"
# Expected: 0

# Verify all tests still pass
npx jest 2>&1 | tail -5
# Expected: Tests pass (known FormModal/DataTable failures still expected here, addressed in Plan 08)
```
</verification>

<success_criteria>
- 0 tsc errors across ALL test files with strict: true
- 0 tsc errors total in the entire codebase (npx tsc --noEmit)
- All previously passing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/47-test-strict-mode-and-index-access/47-03-SUMMARY.md`
</output>
