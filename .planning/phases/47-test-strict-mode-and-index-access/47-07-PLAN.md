---
phase: 47-test-strict-mode-and-index-access
plan: 07
type: execute
wave: 2
depends_on: [47-01, 47-02, 47-03]
files_modified:
  - app/components/devices/lights/LightsCard.tsx
  - app/changelog/page.tsx
  - app/components/WhatsNewModal.tsx
  - app/components/NotificationPreferencesPanel.tsx
  - jest.setup.ts
  - app/settings/page.tsx
  - app/settings/dashboard/page.tsx
  - app/hooks/useVersionCheck.ts
  - app/thermostat/schedule/components/WeeklyTimeline.tsx
  - app/thermostat/schedule/components/ManualOverrideSheet.tsx
  - app/components/lights/EditSceneModal.tsx
  - app/components/lights/CreateSceneModal.tsx
  - components/notifications/NotificationItem.tsx
  - app/settings/notifications/NotificationSettingsForm.tsx
  - app/components/ui/HealthIndicator.tsx
  - app/components/sandbox/SandboxPanel.tsx
  - components/notifications/DeviceListItem.tsx
  - app/components/weather/HourlyForecast.tsx
  - app/components/ui/Slider.tsx
  - app/components/netatmo/RoomCard.tsx
  - app/components/devices/thermostat/ThermostatCard.tsx
  - app/components/devices/camera/CameraCard.tsx
autonomous: true

must_haves:
  truths:
    - "All app/ component files have zero tsc errors with noUncheckedIndexedAccess"
    - "All page files have zero tsc errors with noUncheckedIndexedAccess"
    - "jest.setup.ts has zero tsc errors with noUncheckedIndexedAccess"
  artifacts:
    - path: "app/components/devices/lights/LightsCard.tsx"
      provides: "Index-access-safe lights card component"
    - path: "app/changelog/page.tsx"
      provides: "Index-access-safe changelog page"
    - path: "jest.setup.ts"
      provides: "Index-access-safe jest setup"
  key_links:
    - from: "app/components/devices/*.tsx"
      to: "lib/ services"
      via: "data access from service responses"
      pattern: "import.*from.*lib/"
---

<objective>
Fix ~74 noUncheckedIndexedAccess errors across 22 remaining source files: app components (14 files), pages (5 files), hooks (1 file), notifications components (2 files), and jest.setup.ts.

Purpose: This plan completes the source-file noUncheckedIndexedAccess fixes. Combined with Plans 04-06, all non-test source files will be clean.
Output: All remaining source files compile cleanly with noUncheckedIndexedAccess.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix high-error component files (LightsCard 7, WhatsNewModal 5, NotificationPreferencesPanel 5, changelog 6, settings pages 8, thermostat schedule 6, lights modals 6)</name>
  <files>
    app/components/devices/lights/LightsCard.tsx,
    app/components/WhatsNewModal.tsx,
    app/components/NotificationPreferencesPanel.tsx,
    app/changelog/page.tsx,
    app/settings/page.tsx,
    app/settings/dashboard/page.tsx,
    app/thermostat/schedule/components/WeeklyTimeline.tsx,
    app/thermostat/schedule/components/ManualOverrideSheet.tsx,
    app/components/lights/EditSceneModal.tsx,
    app/components/lights/CreateSceneModal.tsx,
    app/hooks/useVersionCheck.ts
  </files>
  <action>
Fix ~48 noUncheckedIndexedAccess errors across 11 files.

**LightsCard.tsx (7 errors):** Light array access (lights[0], scenes[selectedIndex]) — add optional chaining and nullish coalescing for light properties.

**WhatsNewModal.tsx (5 errors):** Changelog entries access — `entries[0]?.version` pattern.

**NotificationPreferencesPanel.tsx (5 errors):** Preference type arrays — add undefined checks for preference lookups.

**changelog/page.tsx (6 errors):** Changelog version entries — add guards for entry access.

**settings/page.tsx (4) + dashboard/page.tsx (4):** Settings data access — nullish coalescing for setting values.

**thermostat schedule components (6):** Schedule zone/interval access — same patterns as stove scheduler (Plan 05).

**lights modals (6):** Scene light arrays — add undefined checks for light selections.

**useVersionCheck.ts (4):** Version comparison array access — add undefined checks.

Apply patterns:
1. `arr[index]!` after bounds check (e.g., `if (index < arr.length)`)
2. `obj[key] ?? defaultValue` for optional properties
3. `arr.find(x => x.id === id)` already returns `T | undefined` — just handle it
4. Optional chaining: `data?.items?.[0]?.name`

Run tsc to verify these files are clean.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "LightsCard\|WhatsNewModal\|NotificationPreferencesPanel\|changelog/page\|settings/page\|settings/dashboard\|WeeklyTimeline\|ManualOverrideSheet\|EditSceneModal\|CreateSceneModal\|useVersionCheck" outputs 0</verify>
  <done>All 11 files compile cleanly with noUncheckedIndexedAccess.</done>
</task>

<task type="auto">
  <name>Task 2: Fix 11 low-error files (1-2 errors each) + jest.setup.ts + verify zero source errors</name>
  <files>
    jest.setup.ts,
    components/notifications/NotificationItem.tsx,
    app/settings/notifications/NotificationSettingsForm.tsx,
    app/components/ui/HealthIndicator.tsx,
    app/components/sandbox/SandboxPanel.tsx,
    components/notifications/DeviceListItem.tsx,
    app/components/weather/HourlyForecast.tsx,
    app/components/ui/Slider.tsx,
    app/components/netatmo/RoomCard.tsx,
    app/components/devices/thermostat/ThermostatCard.tsx,
    app/components/devices/camera/CameraCard.tsx
  </files>
  <action>
Fix ~26 noUncheckedIndexedAccess errors across 11 files (1-4 errors each).

**jest.setup.ts (4 errors):** Mock setup array access — add type assertions for mock data.

**NotificationItem.tsx (2), DeviceListItem.tsx (1):** Notification data access — nullish coalescing.

**NotificationSettingsForm.tsx (2):** Form field access — undefined checks.

**HealthIndicator.tsx (2), Slider.tsx (1):** Component prop data — optional chaining.

**SandboxPanel.tsx (2):** Sandbox data access — undefined checks.

**HourlyForecast.tsx (1):** Forecast array access — optional chaining.

**RoomCard.tsx (1), ThermostatCard.tsx (1), CameraCard.tsx (1):** Device data access — nullish coalescing.

After all fixes, run full tsc to verify ZERO errors across ALL source files:
```bash
npx tsc --noEmit 2>&1 | grep "error TS" | grep -v "test\.\|__tests__" | wc -l
```
Expected: 0
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep "error TS" | grep -v "test\.\|__tests__" | grep -c "error TS" outputs 0</verify>
  <done>All source files compile cleanly with strict: true + noUncheckedIndexedAccess. Only test file errors remain (addressed in Plan 08).</done>
</task>

</tasks>

<verification>
```bash
# Verify zero source-file errors
npx tsc --noEmit 2>&1 | grep "error TS" | grep -v "test\.\|__tests__" | wc -l
# Expected: 0

# Count remaining test-only errors
npx tsc --noEmit 2>&1 | grep "error TS" | grep "test\.\|__tests__" | wc -l
# Expected: some number (addressed in Plan 08)
```
</verification>

<success_criteria>
- 0 tsc errors in all non-test source files
- All 22 files fixed compile cleanly
- jest.setup.ts compiles cleanly
- No runtime regressions in tests
</success_criteria>

<output>
After completion, create `.planning/phases/47-test-strict-mode-and-index-access/47-07-SUMMARY.md`
</output>
