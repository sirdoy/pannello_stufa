---
phase: 47-test-strict-mode-and-index-access
plan: 08
type: execute
wave: 3
depends_on: [47-04, 47-05, 47-06, 47-07]
files_modified:
  - app/components/ui/__tests__/DataTable.test.tsx
  - __tests__/utils/scheduleHelpers.test.ts
  - lib/__tests__/errorMonitor.test.ts
  - lib/__tests__/version.test.ts
  - lib/__tests__/changelogService.test.ts
  - __tests__/maintenanceService.concurrency.test.ts
  - app/components/ui/__tests__/Slider.test.tsx
  - app/components/ui/__tests__/RightClickMenu.test.tsx
  - __tests__/lib/healthDeadManSwitch.test.ts
  - __tests__/lib/netatmoCameraApi.test.ts
  - __tests__/lib/netatmoApi.test.ts
  - __tests__/lib/coordinationEventLogger.test.ts
  - __tests__/lib/healthLogger.test.ts
  - __tests__/lib/notificationHistoryService.test.ts
  - __tests__/lib/netatmoStoveSync.test.ts
  - __tests__/lib/coordinationPauseCalculator.test.ts
  - app/thermostat/page.test.tsx
  - __tests__/lib/healthMonitoring.test.ts
  - __tests__/lib/coordinationDebounce.test.ts
  - __tests__/lib/healthNotifications.test.ts
  - app/hooks/__tests__/useReducedMotion.test.ts
  - __tests__/app/
  - app/api/hue/discover/__tests__/route.test.ts
  - app/context/__tests__/VersionContext.test.tsx
  - __tests__/api/geocoding/geocoding.test.ts
  - __tests__/lib/netatmoTokenHelper.test.ts
  - __tests__/lib/coordinationUserIntent.test.ts
  - __tests__/lib/coordinationPreferences.test.ts
  - app/hooks/__tests__/useVersionCheck.test.ts
  - __tests__/semiAutoMode.test.ts
  - __tests__/lib/coordinationNotificationThrottle.test.ts
  - __tests__/components/StoveSyncPanel.test.tsx
  - app/api/netatmo/setthermmode/__tests__/route.test.ts
  - app/api/netatmo/setroomthermpoint/__tests__/route.test.ts
  - __tests__/lib/coordinationOrchestrator.test.ts
autonomous: true

must_haves:
  truths:
    - "All test files have zero tsc errors with noUncheckedIndexedAccess enabled"
    - "npx tsc --noEmit reports zero total errors"
  artifacts:
    - path: "app/components/ui/__tests__/DataTable.test.tsx"
      provides: "Index-access-safe DataTable tests"
    - path: "__tests__/utils/scheduleHelpers.test.ts"
      provides: "Index-access-safe schedule helper tests"
    - path: "lib/__tests__/errorMonitor.test.ts"
      provides: "Index-access-safe error monitor tests"
  key_links:
    - from: "all test files"
      to: "tsconfig.json noUncheckedIndexedAccess"
      via: "compiler option"
      pattern: "noUncheckedIndexedAccess.*true"
---

<objective>
Fix all remaining noUncheckedIndexedAccess tsc errors in test files. After Plans 01-03 fix 282 strict-mode errors and Plans 04-07 enable noUncheckedIndexedAccess and fix source files, this plan addresses the ~104 additional noUncheckedIndexedAccess errors in test files.

Purpose: This is the final tsc error fix plan. After this, `npx tsc --noEmit` should report zero errors.
Output: Zero tsc errors across the entire codebase with strict: true + noUncheckedIndexedAccess: true.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix 9 newly-erroring test files (63 noUncheckedIndexedAccess errors not covered by Plans 01-03)</name>
  <files>
    app/components/ui/__tests__/DataTable.test.tsx,
    __tests__/utils/scheduleHelpers.test.ts,
    lib/__tests__/errorMonitor.test.ts,
    lib/__tests__/version.test.ts,
    lib/__tests__/changelogService.test.ts,
    __tests__/maintenanceService.concurrency.test.ts,
    app/components/ui/__tests__/Slider.test.tsx,
    app/components/ui/__tests__/RightClickMenu.test.tsx,
    __tests__/lib/healthDeadManSwitch.test.ts
  </files>
  <action>
Fix ~63 noUncheckedIndexedAccess errors in 9 test files that had zero strict-mode errors but gain errors from index access.

**DataTable.test.tsx (23 errors):** Heavy array access in table test assertions. Patterns:
- `rows[0]` → `rows[0]!` (after existence check or within expect where assertion catches undefined)
- `columns[1].header` → `columns[1]!.header`
- `mockData[0].name` → `mockData[0]!.name`
- In test assertions, non-null assertion is pragmatic since test data is known

**scheduleHelpers.test.ts (9 errors):** Schedule interval array access — non-null assertions for known test data.

**errorMonitor.test.ts (8 errors):** Error tracking data access — add type annotations to mock data.

**version.test.ts (7) + changelogService.test.ts (7):** Version/changelog data array access — non-null assertions.

**maintenanceService.concurrency.test.ts (4):** Concurrent operation results — non-null assertions.

**Slider.test.tsx (2), RightClickMenu.test.tsx (2), healthDeadManSwitch.test.ts (1):** Quick single-pattern fixes.

Run tsc to verify these 9 files are clean.
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "DataTable.test\|scheduleHelpers.test\|errorMonitor.test\|version.test\|changelogService.test\|maintenanceService.concurrency\|Slider.test\|RightClickMenu.test\|healthDeadManSwitch.test" outputs 0</verify>
  <done>All 9 newly-erroring test files compile cleanly with noUncheckedIndexedAccess.</done>
</task>

<task type="auto">
  <name>Task 2: Fix ~41 additional noUncheckedIndexedAccess errors in previously-fixed test files + verify zero total tsc errors</name>
  <files>
    All test files modified in Plans 01-03 that gain additional noUncheckedIndexedAccess errors
  </files>
  <action>
After Plans 01-03 fix the 282 strict-mode errors, enabling noUncheckedIndexedAccess adds ~41 more errors in those same test files. These are array/object index access patterns that need undefined handling.

Run `npx tsc --noEmit 2>&1 | grep "error TS" | grep "test\.\|__tests__"` to find remaining errors.

For each remaining error:
- `mockFn.mock.calls[0]` → `mockFn.mock.calls[0]!` (calls array index)
- `result.data[key]` → `result.data[key]!` (known key in test data)
- `arr[index]` in test assertions → `arr[index]!` (known test data)

After all fixes, run full tsc to verify ZERO TOTAL ERRORS:
```bash
npx tsc --noEmit 2>&1 | grep -c "error TS"
```
Expected: 0

This confirms STRICT-07 (noUncheckedIndexedAccess enabled) and STRICT-08 (zero total errors with strict + noUncheckedIndexedAccess).
  </action>
  <verify>npx tsc --noEmit 2>&1 | grep -c "error TS" outputs 0</verify>
  <done>Zero tsc errors across entire codebase. STRICT-07 and STRICT-08 satisfied.</done>
</task>

</tasks>

<verification>
```bash
# THE critical verification: zero total tsc errors
npx tsc --noEmit 2>&1 | grep -c "error TS"
# Expected: 0

# Verify strict options in tsconfig
grep -A1 "strict\|noUncheckedIndexedAccess" tsconfig.json
# Expected: "strict": true, "noUncheckedIndexedAccess": true
```
</verification>

<success_criteria>
- 0 tsc errors total with strict: true + noUncheckedIndexedAccess: true
- All test files compile cleanly
- STRICT-07 satisfied (noUncheckedIndexedAccess enabled)
- STRICT-08 satisfied (zero errors with all strict options)
</success_criteria>

<output>
After completion, create `.planning/phases/47-test-strict-mode-and-index-access/47-08-SUMMARY.md`
</output>
