---
phase: 48-dead-code-removal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/StovePanel.tsx
  - app/components/VersionNotifier.tsx
  - app/components/devices/stove/GlassEffect.tsx
  - app/components/netatmo/NetatmoTemperatureReport.tsx
  - app/components/scheduler/DayAccordionItem.tsx
  - app/components/scheduler/DayScheduleCard.tsx
  - app/components/scheduler/index.ts
  - app/components/log/index.ts
  - app/debug/design-system/components/ComponentDemo.tsx
  - app/hooks/index.ts
  - components/notifications/NotificationFilters.tsx
  - components/notifications/NotificationInbox.tsx
  - components/notifications/NotificationItem.tsx
  - lib/logger.ts
  - lib/netatmoService.ts
  - lib/schedulesService.ts
  - lib/services/dashboardPreferencesService.ts
  - lib/repositories/ScheduleRepository.ts
  - lib/repositories/index.ts
  - lib/devices/index.ts
  - lib/hooks/useGeofencing.ts
  - lib/hooks/usePeriodicSync.ts
  - lib/hooks/usePWAInstall.ts
  - lib/hooks/useWakeLock.ts
  - lib/pwa/periodicSync.ts
  - docs/rollback/globals.v3.css
  - docs/rollback/tailwind.config.v3.js
  - fix-mocks-proper.mjs
  - fix-test-mocks.mjs
  - fix-test-types.mjs
  - scripts/migrate-log-devices.js
  - scripts/test-firebase-operations.js
  - scripts/test-firebase-rules.js
  - types/components/common.ts
  - types/components/index.ts
  - types/config/constants.ts
  - types/config/index.ts
  - types/external-apis/index.ts
  - types/index.ts
autonomous: true

must_haves:
  truths:
    - "All files identified as unused by knip analysis are deleted (excluding false positives)"
    - "No remaining imports reference deleted files"
    - "TypeScript compilation passes after deletions"
    - "All tests still pass after deletions"
  artifacts:
    - path: "app/components/StovePanel.tsx"
      provides: "Deleted - deprecated component replaced by StoveCard"
    - path: "lib/logger.ts"
      provides: "Deleted - unused logger module"
  key_links:
    - from: "deleted files"
      to: "remaining codebase"
      via: "no broken imports"
      pattern: "npx tsc --noEmit"
---

<objective>
Remove all unused files from the codebase identified by knip dependency analysis.

Purpose: Eliminate dead code files that are never imported or referenced, reducing codebase size and maintenance burden. Addresses DEAD-02.
Output: ~35 fewer files in the codebase, clean knip --include files output.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete unused source files</name>
  <files>
    app/components/StovePanel.tsx
    app/components/VersionNotifier.tsx
    app/components/devices/stove/GlassEffect.tsx
    app/components/netatmo/NetatmoTemperatureReport.tsx
    app/components/scheduler/DayAccordionItem.tsx
    app/components/scheduler/DayScheduleCard.tsx
    app/components/scheduler/index.ts
    app/components/log/index.ts
    app/debug/design-system/components/ComponentDemo.tsx
    app/hooks/index.ts
    components/notifications/NotificationFilters.tsx
    components/notifications/NotificationInbox.tsx
    components/notifications/NotificationItem.tsx
    lib/logger.ts
    lib/netatmoService.ts
    lib/schedulesService.ts
    lib/services/dashboardPreferencesService.ts
    lib/repositories/ScheduleRepository.ts
    lib/repositories/index.ts
    lib/devices/index.ts
    lib/hooks/useGeofencing.ts
    lib/hooks/usePeriodicSync.ts
    lib/hooks/usePWAInstall.ts
    lib/hooks/useWakeLock.ts
    lib/pwa/periodicSync.ts
    types/components/common.ts
    types/components/index.ts
    types/config/constants.ts
    types/config/index.ts
    types/external-apis/index.ts
    types/index.ts
  </files>
  <action>
    Delete all files listed above using `git rm`. These are unused source files identified by knip analysis.

    **Categories of files being removed:**
    1. **Deprecated components:** StovePanel.tsx (replaced by StoveCard), VersionNotifier.tsx (self-referencing only)
    2. **Unused components:** GlassEffect.tsx, NetatmoTemperatureReport.tsx, DayAccordionItem.tsx, DayScheduleCard.tsx, ComponentDemo.tsx
    3. **Unused barrel exports:** scheduler/index.ts, log/index.ts, hooks/index.ts, devices/index.ts, repositories/index.ts
    4. **Legacy notification components:** components/notifications/ (3 files, replaced by app/ versions)
    5. **Unused services/hooks:** logger.ts, netatmoService.ts, schedulesService.ts, dashboardPreferencesService.ts, ScheduleRepository.ts
    6. **Unused PWA hooks:** useGeofencing.ts, usePeriodicSync.ts, usePWAInstall.ts, useWakeLock.ts, periodicSync.ts
    7. **Unused type barrels:** types/index.ts, types/components/{common,index}.ts, types/config/{constants,index}.ts, types/external-apis/index.ts

    **IMPORTANT - Do NOT delete these false positives:**
    - `app/sw.ts` — Referenced in next.config.ts as Serwist service worker source
    - `public/firebase-messaging-sw.js` — Loaded at runtime by PWA service worker registration

    After deletion, verify no remaining file imports any deleted file:
    ```bash
    npx tsc --noEmit 2>&1 | head -30
    ```

    If any tsc errors appear referencing deleted files, fix the imports (remove the unused import lines from the importing files).

    **Special handling for types/index.ts:** Files importing from `@/types` or `@/types/components` etc. need their imports updated to point directly to the specific type files they need. Check with:
    ```bash
    grep -r "from '@/types'" --include="*.ts" --include="*.tsx" | grep -v node_modules | grep -v .next
    grep -r "from '@/types/components'" --include="*.ts" --include="*.tsx" | grep -v node_modules | grep -v .next
    grep -r "from '@/types/config'" --include="*.ts" --include="*.tsx" | grep -v node_modules | grep -v .next
    grep -r "from '@/types/external-apis'" --include="*.ts" --include="*.tsx" | grep -v node_modules | grep -v .next
    ```
    For each importing file, redirect the import to the specific sub-module (e.g., `@/types/firebase`, `@/types/api/responses`, etc.).
  </action>
  <verify>
    ```bash
    # Verify deleted files no longer exist
    for f in app/components/StovePanel.tsx lib/logger.ts lib/netatmoService.ts types/index.ts; do
      [ ! -f "$f" ] && echo "DELETED: $f" || echo "STILL EXISTS: $f"
    done
    # Verify TypeScript still compiles
    npx tsc --noEmit 2>&1 | tail -5
    ```
  </verify>
  <done>All 31 unused source files deleted, no tsc errors from broken imports</done>
</task>

<task type="auto">
  <name>Task 2: Delete unused scripts, docs, and utility files</name>
  <files>
    docs/rollback/globals.v3.css
    docs/rollback/tailwind.config.v3.js
    fix-mocks-proper.mjs
    fix-test-mocks.mjs
    fix-test-types.mjs
    scripts/migrate-log-devices.js
    scripts/test-firebase-operations.js
    scripts/test-firebase-rules.js
  </files>
  <action>
    Delete leftover utility/script files that are no longer needed:

    1. **docs/rollback/**: Old CSS and Tailwind v3 config from pre-v4 era. Delete both files. If the docs/rollback/ directory becomes empty, remove it too.
    2. **fix-*.mjs**: One-time migration scripts from v5.0 TypeScript migration (fix-mocks-proper.mjs, fix-test-mocks.mjs, fix-test-types.mjs). No longer needed.
    3. **scripts/migrate-log-devices.js**: One-time log migration script, already executed.
    4. **scripts/test-firebase-*.js**: Test scripts for Firebase operations/rules, not part of test suite.

    Use `git rm` for all files. After deletion:
    ```bash
    npx knip --no-progress --include files 2>/dev/null
    ```
    The output should show only `app/sw.ts` and `public/firebase-messaging-sw.js` (known false positives).

    Run tests to verify nothing breaks:
    ```bash
    npm test -- --bail 2>&1 | tail -20
    ```
  </action>
  <verify>
    ```bash
    # Verify no fix-*.mjs files remain
    ls fix-*.mjs 2>/dev/null || echo "All fix scripts deleted"
    # Verify unused files count is minimal (only false positives)
    npx knip --no-progress --include files 2>/dev/null | wc -l
    # Run tests
    npm test -- --bail 2>&1 | tail -5
    ```
  </verify>
  <done>8 unused script/doc files deleted, knip reports only false positives for unused files, all tests pass</done>
</task>

</tasks>

<verification>
1. `npx knip --no-progress --include files` shows only app/sw.ts and public/firebase-messaging-sw.js (known false positives used at runtime)
2. `npx tsc --noEmit` passes with 0 errors
3. `npm test -- --bail` passes
4. No remaining imports reference deleted files
</verification>

<success_criteria>
- ~39 unused files deleted from codebase
- Zero tsc errors
- All tests passing
- knip --include files shows only known false positives
</success_criteria>

<output>
After completion, create `.planning/phases/48-dead-code-removal/48-01-SUMMARY.md`
</output>
