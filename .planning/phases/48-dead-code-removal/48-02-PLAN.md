---
phase: 48-dead-code-removal
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
autonomous: true

must_haves:
  truths:
    - "No unused production dependencies in package.json"
    - "No unused dev dependencies in package.json"
    - "Application still builds and runs correctly without removed packages"
    - "All tests still pass after dependency removal"
  artifacts:
    - path: "package.json"
      provides: "Clean dependency list with only actively used packages"
  key_links:
    - from: "package.json"
      to: "source code imports"
      via: "every dependency has at least one import"
      pattern: "npx knip --include dependencies"
---

<objective>
Remove unused dependencies from package.json identified by knip analysis.

Purpose: Clean up package.json to contain only actively used packages. Addresses DEAD-03.
Output: Leaner package.json with no orphaned dependencies.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused dependencies from package.json</name>
  <files>package.json</files>
  <action>
    Remove the following unused dependencies from package.json (identified by knip analysis):

    **Unused production dependencies (remove from "dependencies"):**
    1. `@radix-ui/react-dropdown-menu` — Not imported anywhere in source code. The project uses `@radix-ui/react-context-menu` instead for right-click menus.
    2. `@radix-ui/react-slot` — Not imported anywhere in source code. No asChild/Slot pattern usage found.

    **Unused dev dependencies (remove from "devDependencies"):**
    1. `baseline-browser-mapping` — Only referenced in lib/version.ts as a changelog entry string, not as an actual import/usage.
    2. `serwist` — The project uses `@serwist/next` (which is kept) and imports `serwist` only from `app/sw.ts`. However, knip flags this because `app/sw.ts` is the service worker entry point loaded by `@serwist/next` via next.config.ts, not a regular module import. **IMPORTANT: Before removing `serwist`, verify that `@serwist/next` includes `serwist` as a dependency.** Run: `ls node_modules/@serwist/next/node_modules/serwist 2>/dev/null || ls node_modules/serwist 2>/dev/null`. If `serwist` is a peer dependency of `@serwist/next` (not bundled), then **DO NOT remove it** — it's actually needed. Only remove if it's bundled into `@serwist/next`.

    **Edit package.json directly** — do NOT run `npm install` or `npm uninstall` (project rules forbid it). Simply remove the lines from the JSON.

    After editing, verify the JSON is valid:
    ```bash
    node -e "JSON.parse(require('fs').readFileSync('package.json','utf8')); console.log('Valid JSON')"
    ```

    **Verification approach (since we can't run npm install):**
    - `npx tsc --noEmit` should still pass (type checking doesn't need installed packages)
    - `npm test -- --bail` should still pass (packages are still in node_modules)
    - The actual verification happens when someone runs `npm ci` or `npm install` in a clean environment
  </action>
  <verify>
    ```bash
    # Verify JSON validity
    node -e "JSON.parse(require('fs').readFileSync('package.json','utf8')); console.log('Valid JSON')"
    # Verify removed deps are gone
    node -e "const pkg=JSON.parse(require('fs').readFileSync('package.json','utf8')); console.log('dropdown-menu:', pkg.dependencies?.['@radix-ui/react-dropdown-menu'] || 'REMOVED'); console.log('react-slot:', pkg.dependencies?.['@radix-ui/react-slot'] || 'REMOVED'); console.log('baseline:', pkg.devDependencies?.['baseline-browser-mapping'] || 'REMOVED')"
    # Verify tsc still passes
    npx tsc --noEmit 2>&1 | tail -5
    # Verify tests still pass
    npm test -- --bail 2>&1 | tail -5
    ```
  </verify>
  <done>Unused dependencies removed from package.json, JSON valid, tsc passes, tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Verify and document dependency audit results</name>
  <files>package.json</files>
  <action>
    Run knip dependency analysis after removals:
    ```bash
    npx knip --no-progress --include dependencies,unlisted 2>/dev/null
    ```

    **Expected results:**
    - "Unused dependencies" section should be empty (or show only `serwist` if it was kept as a peer dep)
    - "Unlisted dependencies" section may still show `jsdom` and `@jest/globals` — these are test-only dependencies provided by jest-environment-jsdom and jest respectively, so they are expected false positives

    **If `serwist` was NOT removed** (because it's a peer dep of `@serwist/next`), add a comment in package.json near the `serwist` entry explaining why it's kept:
    No — actually, do NOT add comments to JSON. Instead, just verify it's intentionally kept and note in the SUMMARY.

    **Also verify the 6 "unlisted" dependencies are acceptable:**
    - `jsdom` (4 files): Used in test files via jest-environment-jsdom — acceptable, no action needed
    - `@jest/globals` (2 files): Used in test files via jest — acceptable, no action needed

    These are not real issues — they're provided transitively by jest packages.
  </action>
  <verify>
    ```bash
    npx knip --no-progress --include dependencies,unlisted 2>/dev/null
    ```
  </verify>
  <done>knip dependency audit shows zero true unused dependencies, unlisted deps are all acceptable false positives</done>
</task>

</tasks>

<verification>
1. `npx knip --no-progress --include dependencies` shows no unused production or dev dependencies
2. package.json is valid JSON
3. `npx tsc --noEmit` passes with 0 errors
4. `npm test -- --bail` passes
</verification>

<success_criteria>
- 2-4 unused dependencies removed from package.json
- Zero remaining unused dependencies in knip output
- Valid JSON, tsc passes, tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/48-dead-code-removal/48-02-SUMMARY.md`
</output>
