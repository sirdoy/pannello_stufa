---
phase: 48-dead-code-removal
plan: 03
type: execute
wave: 2
depends_on: ["48-01"]
files_modified:
  - lib/auth0.ts
  - lib/changelogService.ts
  - lib/commands/deviceCommands.tsx
  - lib/coordinationEventLogger.ts
  - lib/coordinationOrchestrator.ts
  - lib/deviceFingerprint.ts
  - lib/devicePreferencesService.ts
  - lib/devices/deviceRegistry.ts
  - lib/devices/deviceTypes.ts
  - lib/environmentHelper.ts
  - lib/firebase.ts
  - lib/firebaseAdmin.ts
  - lib/geolocation.ts
  - lib/hlsDownloader.ts
  - lib/logService.ts
  - lib/migrateSchedules.ts
  - lib/routes.ts
  - lib/stoveStateService.ts
autonomous: true

must_haves:
  truths:
    - "All unused exports identified by knip in these lib/ files are removed"
    - "Functions still used internally within their files remain functional"
    - "TypeScript compilation passes after export removals"
    - "All tests still pass after export removals"
  artifacts:
    - path: "lib/devices/deviceRegistry.ts"
      provides: "Only actively used device registry exports remain"
    - path: "lib/firebase.ts"
      provides: "Only actively used Firebase exports remain"
  key_links:
    - from: "modified lib/ files"
      to: "importing files"
      via: "remaining exports still resolve"
      pattern: "npx tsc --noEmit"
---

<objective>
Remove unused exports from lib/ core service files (Group A: auth, devices, firebase, coordination, environment, etc.).

Purpose: Clean up unused public API surface from library modules. Addresses DEAD-01.
Output: ~18 files with leaner export surfaces.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/48-dead-code-removal/48-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused exports from lib/ core files (auth through geolocation)</name>
  <files>
    lib/auth0.ts
    lib/changelogService.ts
    lib/commands/deviceCommands.tsx
    lib/coordinationEventLogger.ts
    lib/coordinationOrchestrator.ts
    lib/deviceFingerprint.ts
    lib/devicePreferencesService.ts
    lib/devices/deviceRegistry.ts
    lib/devices/deviceTypes.ts
    lib/environmentHelper.ts
    lib/firebase.ts
    lib/firebaseAdmin.ts
    lib/geolocation.ts
  </files>
  <action>
    For each file, remove the unused exports identified by knip. The approach depends on the export type:

    **Strategy for each unused export:**
    1. If the function/variable is ONLY exported but never used within the same file, and has no importers: **delete the entire function/variable**
    2. If the function/variable IS used within the same file but just not exported: **remove the `export` keyword only**
    3. For `default` exports that are actually imported via named imports elsewhere: this is a false positive — **skip it**

    **IMPORTANT:** Before removing any export, verify it has no importers by searching:
    ```bash
    grep -r "functionName" --include="*.ts" --include="*.tsx" src/ lib/ app/ | grep -v "__tests__" | grep -v ".test."
    ```
    If the export IS used in test files but not in source files, consider whether tests should be updated too.

    **Specific removals per file:**

    **lib/auth0.ts:** Remove `export` from `withAuth` (or delete if unused internally)
    **lib/changelogService.ts:** Remove `default` export (check if named import exists elsewhere)
    **lib/commands/deviceCommands.tsx:** Remove exports: `getStoveCommands`, `getThermostatCommands`, `getLightsCommands`, `default`. These command builders may be used only through the command palette system — verify before removing.
    **lib/coordinationEventLogger.ts:** Remove `default` export
    **lib/coordinationOrchestrator.ts:** Remove `default` export
    **lib/deviceFingerprint.ts:** Remove exports: `parseUserAgent`, `isSameDevice`, `formatDeviceInfo`
    **lib/devicePreferencesService.ts:** Remove exports: `getDevicePreferences`, `toggleDevicePreference`, `getEnabledDevicesForUser`, `isDeviceEnabled`
    **lib/devices/deviceRegistry.ts:** Remove exports: `getEnabledDevices`, `getDeviceConfig`, `getDeviceColors`, `deviceHasFeature`, `getDeviceNavItems`, `getGlobalNavItems`, `getSettingsMenuItems`, `getNavigationStructure`, `isDeviceRoute`, `getActiveDevice`, `getDeviceBadge`, `DEVICE_TYPES`, `DEVICE_CONFIG`, `GLOBAL_SECTIONS`
    **lib/devices/deviceTypes.ts:** Remove export: `ALL_DASHBOARD_ITEMS`
    **lib/environmentHelper.ts:** Remove exports: `getEnvironmentPrefix`, `getEnvironmentName`, `logEnvironmentInfo`
    **lib/firebase.ts:** Remove exports: `app`, `firestore`
    **lib/firebaseAdmin.ts:** Remove export: `verifyFCMToken`
    **lib/geolocation.ts:** Remove exports: `GEOLOCATION_ERRORS`, `GEOLOCATION_ERROR_MESSAGES`

    After all removals, run:
    ```bash
    npx tsc --noEmit 2>&1 | head -30
    ```
    Fix any compilation errors (likely import errors from files that were importing removed exports — update those files to remove the unused imports).
  </action>
  <verify>
    ```bash
    npx tsc --noEmit 2>&1 | tail -5
    npm test -- --bail --testPathPattern="lib/" 2>&1 | tail -10
    ```
  </verify>
  <done>All unused exports removed from 13 lib/ files, tsc passes, lib/ tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Remove unused exports from lib/ utility files (hlsDownloader through stoveState)</name>
  <files>
    lib/hlsDownloader.ts
    lib/logService.ts
    lib/migrateSchedules.ts
    lib/routes.ts
    lib/stoveStateService.ts
  </files>
  <action>
    Continue removing unused exports from remaining lib/ core files:

    **lib/hlsDownloader.ts:** Remove export: `downloadHlsAsMP4`
    **lib/logService.ts:** Remove export: `logHueAction`
    **lib/migrateSchedules.ts:** Remove export: `runMigration`
    **lib/routes.ts:** Remove exports: `STOVE_UI_ROUTES`, `THERMOSTAT_UI_ROUTES`, `CAMERA_UI_ROUTES`, `GLOBAL_UI_ROUTES`, `SCHEDULER_ROUTES`, `USER_ROUTES`, `AUTH_ROUTES`, `API_ROUTES`, `default`
    **lib/stoveStateService.ts:** Remove exports: `getStoveState`, `initializeStoveState`

    Same strategy as Task 1:
    1. Verify each export has no importers in source code
    2. If used internally only, remove `export` keyword
    3. If completely unused, delete the function/variable entirely

    After removals, run full verification:
    ```bash
    npx tsc --noEmit 2>&1 | tail -5
    npm test -- --bail 2>&1 | tail -10
    ```
  </action>
  <verify>
    ```bash
    npx tsc --noEmit 2>&1 | tail -5
    npm test -- --bail 2>&1 | tail -10
    ```
  </verify>
  <done>All unused exports removed from 5 more lib/ files, tsc passes, all tests pass</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with 0 errors
2. `npm test -- --bail` passes
3. Removed exports no longer appear in `npx knip --include exports` output for these files
</verification>

<success_criteria>
- ~41 unused exports removed from 18 lib/ core files
- Zero tsc errors
- All tests passing
</success_criteria>

<output>
After completion, create `.planning/phases/48-dead-code-removal/48-03-SUMMARY.md`
</output>
