---
phase: 48-dead-code-removal
plan: 06
type: execute
wave: 3
depends_on: ["48-02", "48-03", "48-04", "48-05"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Zero unused files detected by knip (excluding known false positives)"
    - "Zero unused dependencies in package.json"
    - "Unused exports significantly reduced from baseline"
    - "Zero tsc errors with strict + noUncheckedIndexedAccess"
    - "All 3034+ tests passing"
    - "Dev server starts without errors"
  artifacts: []
  key_links:
    - from: "knip analysis"
      to: "codebase health"
      via: "zero dead code metrics"
      pattern: "npx knip --include files,dependencies"
---

<objective>
Final verification and gap sweep for Phase 48 — validate all dead code has been removed and codebase is clean.

Purpose: Ensure all DEAD-01, DEAD-02, DEAD-03 requirements are satisfied and no regressions introduced.
Output: Verified clean codebase, phase completion documentation.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/48-dead-code-removal/48-01-SUMMARY.md
@.planning/phases/48-dead-code-removal/48-02-SUMMARY.md
@.planning/phases/48-dead-code-removal/48-03-SUMMARY.md
@.planning/phases/48-dead-code-removal/48-04-SUMMARY.md
@.planning/phases/48-dead-code-removal/48-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run comprehensive verification suite</name>
  <files></files>
  <action>
    Run all verification checks to confirm Phase 48 success:

    **1. Unused files check (DEAD-02):**
    ```bash
    npx knip --no-progress --include files 2>/dev/null
    ```
    Expected: Only `app/sw.ts` and `public/firebase-messaging-sw.js` (known false positives — used at runtime by Serwist and FCM respectively).

    **2. Unused dependencies check (DEAD-03):**
    ```bash
    npx knip --no-progress --include dependencies 2>/dev/null
    ```
    Expected: Zero unused dependencies (or only `serwist` if kept as peer dependency of @serwist/next).

    **3. Unused exports check (DEAD-01):**
    ```bash
    npx knip --no-progress --include exports 2>/dev/null | wc -l
    ```
    Document the count. Many remaining will be UI barrel design-system exports (intentional public API). Report the delta from baseline (~382 before Phase 48).

    **4. TypeScript strict mode check:**
    ```bash
    npx tsc --noEmit 2>&1 | tail -5
    ```
    Expected: 0 errors

    **5. Full test suite:**
    ```bash
    npm test 2>&1 | tail -20
    ```
    Expected: 3034+ tests passing, 0 failures

    **6. Dev server startup (quick check):**
    ```bash
    timeout 15 npx next dev 2>&1 | tail -10 || true
    ```
    Expected: Server starts on localhost:3000 without errors

    **If any cascade errors found from plans 01-05:**
    Fix them inline — these are typically:
    - Import errors from files that imported deleted modules
    - Type errors from removed exports that were re-exported through barrels
    - Test imports that referenced deleted test helpers

    For each fix, document in the SUMMARY.
  </action>
  <verify>
    ```bash
    echo "=== DEAD-02: Unused Files ==="
    npx knip --no-progress --include files 2>/dev/null | wc -l
    echo "=== DEAD-03: Unused Dependencies ==="
    npx knip --no-progress --include dependencies 2>/dev/null
    echo "=== DEAD-01: Unused Exports ==="
    npx knip --no-progress --include exports 2>/dev/null | wc -l
    echo "=== TypeScript ==="
    npx tsc --noEmit 2>&1 | tail -3
    echo "=== Tests ==="
    npm test 2>&1 | grep -E "Tests:|Test Suites:"
    ```
  </verify>
  <done>All verification checks pass: zero unused files (excluding false positives), zero unused dependencies, unused exports significantly reduced, 0 tsc errors, 3034+ tests green</done>
</task>

<task type="auto">
  <name>Task 2: Document final state and update project tracking</name>
  <files></files>
  <action>
    Document the Phase 48 results:

    1. **Record metrics** in the SUMMARY:
       - Files deleted count
       - Dependencies removed count
       - Exports removed count
       - Before/after knip export count
       - Final tsc error count (should be 0)
       - Final test count (should be 3034+)

    2. **Note any intentional false positives** that remain:
       - `app/sw.ts` — Serwist service worker entry (loaded by next.config.ts)
       - `public/firebase-messaging-sw.js` — FCM service worker (loaded at runtime)
       - UI barrel exports — design system public API (intentionally exported for consumer discovery)
       - `_internals` test exports — intentional testing pattern

    3. **Verify v5.1 milestone completion:** Phase 48 is the final phase of v5.1. All 5 phases (44-48) should now be complete:
       - Phase 44: Library Strict Mode Foundation (complete)
       - Phase 45: Component Strict Mode Compliance (complete)
       - Phase 46: API and Page Strict Mode Compliance (complete)
       - Phase 47: Test Strict Mode and Index Access (complete)
       - Phase 48: Dead Code Removal and Final Verification (completing now)
  </action>
  <verify>
    Verify SUMMARY contains all metrics and phase completion status.
  </verify>
  <done>Phase 48 complete, v5.1 milestone documentation updated, all quality checks passing</done>
</task>

</tasks>

<verification>
1. All 5 success criteria from ROADMAP verified:
   - Zero unused exports detected (or only intentional design system barrel exports)
   - Zero unused files (excluding known false positives)
   - package.json contains only actively used dependencies
   - Dev server runs without errors with strict config
   - All tests passing
2. No cascade errors from plans 01-05
3. Phase 48 SUMMARY written with complete metrics
</verification>

<success_criteria>
- All DEAD-01, DEAD-02, DEAD-03 requirements satisfied
- Zero tsc errors
- 3034+ tests passing
- v5.1 milestone complete (phases 44-48)
</success_criteria>

<output>
After completion, create `.planning/phases/48-dead-code-removal/48-06-SUMMARY.md`
</output>
