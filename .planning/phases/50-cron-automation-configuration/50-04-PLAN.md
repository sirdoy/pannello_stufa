---
phase: 50-cron-automation-configuration
plan: 04
type: execute
wave: 3
depends_on: ["50-01", "50-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User has configured VERCEL_APP_URL and CRON_SECRET GitHub Actions secrets"
    - "Cron workflow runs successfully when triggered manually via workflow_dispatch"
    - "Monitoring dashboard shows cron health as active (non-stale)"
    - "Cron execution logs visible in monitoring dashboard"
  artifacts: []
  key_links:
    - from: ".github/workflows/cron-scheduler.yml"
      to: "Vercel production endpoints"
      via: "GitHub Actions secrets"
      pattern: "VERCEL_APP_URL.*CRON_SECRET"
---

<objective>
Verify the complete cron automation system works end-to-end by configuring GitHub Actions secrets and triggering the workflow manually.

Purpose: The cron workflow cannot function without GitHub Actions secrets. This checkpoint ensures the user configures them, triggers a test run, and verifies the monitoring dashboard reflects successful execution.

Output: Verified working cron automation system.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Workflow to verify:
@.github/workflows/cron-scheduler.yml
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Configure GitHub Actions secrets</name>
  <action>
The user must configure two GitHub Actions secrets in the repository settings. These secrets cannot be set via CLI without `gh` authentication.

**Required secrets:**
1. `VERCEL_APP_URL` - The production Vercel URL (e.g., `https://pannello-stufa.vercel.app`)
2. `CRON_SECRET` - Must match the `CRON_SECRET` environment variable in Vercel

If the user has `gh` CLI authenticated, they can run:
```bash
gh secret set VERCEL_APP_URL --body "https://your-app.vercel.app"
gh secret set CRON_SECRET --body "your-cron-secret-value"
```

Otherwise: GitHub repo -> Settings -> Secrets and variables -> Actions -> New repository secret
  </action>
  <resume-signal>Type "secrets configured" when both VERCEL_APP_URL and CRON_SECRET are set in GitHub Actions secrets</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify end-to-end cron automation</name>
  <action>
Verify the complete cron automation system works end-to-end.

What was built: GitHub Actions workflow triggering health monitoring and scheduler check endpoints every 5 minutes, with execution logging and monitoring dashboard visibility.

Steps to verify:
1. Trigger manual workflow run: GitHub repo -> Actions -> "Cron Scheduler" -> "Run workflow" (or `gh workflow run cron-scheduler.yml`). Wait 1-2 minutes.
2. Verify workflow succeeded: Check GitHub Actions tab for green checkmark (or `gh run list --workflow=cron-scheduler.yml --limit=1`). Both steps should show success.
3. Verify monitoring dashboard: Visit `/monitoring` page. Dead Man's Switch panel should show "Sistema attivo" (green) with recent timestamp. Monitoring timeline should show a recent health check entry.
4. Verify cron execution logs: Visit `{VERCEL_APP_URL}/api/health-monitoring/cron-executions` (requires auth). Should return JSON with recent execution entries including timestamp and duration.
5. Wait 10 minutes and verify: GitHub Actions shows at least 2 automatic runs. Dead Man's Switch panel stays green.
  </action>
  <verify>User confirms all 5 verification steps pass</verify>
  <done>Cron automation system fully operational with automatic 5-minute execution, successful endpoint calls, and dashboard visibility</done>
</task>

</tasks>

<verification>
1. GitHub Actions workflow "Cron Scheduler" exists and runs on schedule
2. Manual workflow_dispatch trigger succeeds
3. Dead Man's Switch panel shows active/healthy status
4. At least one cron execution log entry exists
</verification>

<success_criteria>
Cron automation system fully operational: GitHub Actions triggers endpoints every 5 minutes, endpoints execute successfully, monitoring dashboard reflects healthy cron status with execution logs visible.
</success_criteria>

<output>
After completion, create `.planning/phases/50-cron-automation-configuration/50-04-SUMMARY.md`
</output>
