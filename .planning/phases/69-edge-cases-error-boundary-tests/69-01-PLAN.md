---
phase: 69-edge-cases-error-boundary-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/utils/dashboardColumns.ts
  - app/page.tsx
  - app/components/ErrorBoundary/ErrorFallback.tsx
autonomous: true
requirements: [EDGE-01, EDGE-03]

must_haves:
  truths:
    - "With 1 visible card, the card renders full-width on desktop — no empty right column in the DOM"
    - "With 2+ cards, desktop layout renders two equal-width columns as before"
    - "Error boundary fallback has min-h-[160px] so the column never visually collapses"
    - "splitIntoColumns utility is extracted and imported by page.tsx — column logic is testable"
  artifacts:
    - path: "lib/utils/dashboardColumns.ts"
      provides: "Pure splitIntoColumns function"
      exports: ["splitIntoColumns"]
    - path: "app/page.tsx"
      provides: "Conditional right column render + utility import"
      contains: "splitIntoColumns"
    - path: "app/components/ErrorBoundary/ErrorFallback.tsx"
      provides: "ErrorFallback with min-h-[160px]"
      contains: "min-h-[160px]"
  key_links:
    - from: "app/page.tsx"
      to: "lib/utils/dashboardColumns.ts"
      via: "import { splitIntoColumns }"
      pattern: "import.*splitIntoColumns.*dashboardColumns"
---

<objective>
Fix the single-card layout defect (EDGE-01), add minimum height to ErrorFallback (EDGE-03), and extract the column-split logic to a testable utility.

Purpose: With 1 visible card the empty right column's `flex-1` claims half the width, making the card render at 50% instead of full width. The ErrorFallback needs a height floor to prevent column collapse when a card throws. Extracting `splitIntoColumns` to a utility enables the unit tests in plan 69-02.

Output: Three modified/created files — utility, page.tsx, ErrorFallback.tsx
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/69-edge-cases-error-boundary-tests/69-RESEARCH.md
@.planning/phases/68-core-masonry-layout/68-01-SUMMARY.md
@app/page.tsx
@app/components/ErrorBoundary/ErrorFallback.tsx
@lib/utils/dashboardColumns.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract splitIntoColumns utility and fix EDGE-01 in page.tsx</name>
  <files>lib/utils/dashboardColumns.ts, app/page.tsx</files>
  <action>
1. Create `lib/utils/dashboardColumns.ts` with a pure generic `splitIntoColumns` function:

```typescript
/**
 * Splits an array of cards into left/right columns by index parity.
 * Even-indexed items go left, odd-indexed items go right.
 * Each entry includes the original flatIndex for animation stagger delay.
 */
export function splitIntoColumns<T>(
  cards: T[]
): { left: Array<{ card: T; flatIndex: number }>; right: Array<{ card: T; flatIndex: number }> } {
  const left: Array<{ card: T; flatIndex: number }> = [];
  const right: Array<{ card: T; flatIndex: number }> = [];
  cards.forEach((card, i) => {
    if (i % 2 === 0) left.push({ card, flatIndex: i });
    else right.push({ card, flatIndex: i });
  });
  return { left, right };
}
```

2. In `app/page.tsx`:
   - Add import: `import { splitIntoColumns } from '@/lib/utils/dashboardColumns';`
   - Replace the inline `leftColumn`/`rightColumn` computation (lines 59-67) with:
     ```typescript
     const { left: leftColumn, right: rightColumn } = splitIntoColumns(visibleCards);
     ```
   - Fix the desktop layout block (lines 103-110) to conditionally render the right column:
     ```tsx
     {/* Desktop: two-column masonry (LAYOUT-01, LAYOUT-02, EDGE-01) */}
     <div className="hidden sm:flex sm:flex-row gap-8 lg:gap-10">
       <div className={`flex flex-col gap-8 lg:gap-10 min-w-0 ${rightColumn.length === 0 ? 'w-full' : 'flex-1'}`}>
         {leftColumn.map(({ card, flatIndex }) => renderCard(card, flatIndex))}
       </div>
       {rightColumn.length > 0 && (
         <div className="flex flex-col gap-8 lg:gap-10 flex-1 min-w-0">
           {rightColumn.map(({ card, flatIndex }) => renderCard(card, flatIndex))}
         </div>
       )}
     </div>
     ```
   - The left column gets `w-full` when right is empty (single card fills full width), or `flex-1` when right has cards (equal-width columns).
   - The right column div is removed from the DOM entirely when empty — no invisible `flex-1` space-grabber.

Do NOT change the mobile layout block (`sm:hidden`), the `renderCard` helper, or any other code.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors. Visually inspect that `app/page.tsx` imports `splitIntoColumns` from the new utility and the desktop block uses the conditional render pattern.
  </verify>
  <done>
`splitIntoColumns` utility exists at `lib/utils/dashboardColumns.ts` and is imported by `app/page.tsx`. Desktop layout conditionally hides the right column when it has no cards. Left column gets `w-full` for the 1-card case.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add min-height to ErrorFallback (EDGE-03)</name>
  <files>app/components/ErrorBoundary/ErrorFallback.tsx</files>
  <action>
In `app/components/ErrorBoundary/ErrorFallback.tsx`:

1. Add `min-h-[160px]` to the `<Card>` className — change from:
   ```tsx
   <Card variant="elevated" className="p-6">
   ```
   to:
   ```tsx
   <Card variant="elevated" className="p-6 min-h-[160px]">
   ```

2. Add `h-full` to the inner `<div>` so the centered content fills the imposed minimum height — change from:
   ```tsx
   <div className="flex flex-col items-center justify-center space-y-4 text-center">
   ```
   to:
   ```tsx
   <div className="flex flex-col items-center justify-center space-y-4 text-center h-full">
   ```

These are the only two changes. Do NOT modify any other props, imports, or logic.
  </action>
  <verify>
Run `npx tsc --noEmit` — no type errors. Visually confirm `ErrorFallback.tsx` has `min-h-[160px]` on Card and `h-full` on inner div.
  </verify>
  <done>
ErrorFallback Card has `min-h-[160px]` preventing column collapse. Inner content div has `h-full` for proper vertical centering within the minimum height.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `lib/utils/dashboardColumns.ts` exports `splitIntoColumns`
3. `app/page.tsx` imports from `@/lib/utils/dashboardColumns` and uses conditional right column render
4. `app/components/ErrorBoundary/ErrorFallback.tsx` has `min-h-[160px]` on Card
5. No changes to mobile layout, renderCard helper, or card registry
</verification>

<success_criteria>
- splitIntoColumns utility is a pure function with zero dependencies, exported and imported by page.tsx
- Desktop layout with 1 card renders left column as w-full with no right column div in DOM
- Desktop layout with 2+ cards renders two flex-1 columns as before
- ErrorFallback has 160px minimum height floor
- No regressions in existing functionality (type check passes)
</success_criteria>

<output>
After completion, create `.planning/phases/69-edge-cases-error-boundary-tests/69-01-SUMMARY.md`
</output>
