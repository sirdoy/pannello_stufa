---
phase: 69-edge-cases-error-boundary-tests
plan: 02
type: tdd
wave: 2
depends_on: [69-01]
files_modified:
  - lib/utils/__tests__/dashboardColumns.test.ts
autonomous: true
requirements: [EDGE-01, EDGE-02, EDGE-03]

must_haves:
  truths:
    - "Unit tests cover column assignment for 0, 1, 2, 3, 5, and 6 visible card counts — all green"
    - "For 1 card, test asserts right column is empty (EDGE-01 precondition)"
    - "For odd counts (3, 5), test asserts left has one more card than right (EDGE-02 shape)"
    - "For all counts, flatIndex values are explicitly asserted for animation stagger correctness"
  artifacts:
    - path: "lib/utils/__tests__/dashboardColumns.test.ts"
      provides: "Unit tests for splitIntoColumns"
      min_lines: 50
  key_links:
    - from: "lib/utils/__tests__/dashboardColumns.test.ts"
      to: "lib/utils/dashboardColumns.ts"
      via: "import { splitIntoColumns }"
      pattern: "import.*splitIntoColumns.*dashboardColumns"
---

<objective>
Write unit tests for the `splitIntoColumns` utility covering all required edge case card counts (0, 1, 2, 3, 5, 6).

Purpose: Success Criterion 4 requires unit tests that verify column assignment for all these counts. The tests guard against regressions in the parity-split logic that drives the masonry layout.

Output: Test file at `lib/utils/__tests__/dashboardColumns.test.ts` with all assertions green.
</objective>

<execution_context>
@/Users/federicomanfredi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/federicomanfredi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/69-edge-cases-error-boundary-tests/69-RESEARCH.md
@.planning/phases/69-edge-cases-error-boundary-tests/69-01-SUMMARY.md
@lib/utils/dashboardColumns.ts
@lib/utils/__tests__/dashboardColumns.test.ts
</context>

<feature>
  <name>Column Assignment Edge Case Tests</name>
  <files>lib/utils/__tests__/dashboardColumns.test.ts, lib/utils/dashboardColumns.ts</files>
  <behavior>
    splitIntoColumns splits an array by index parity (even→left, odd→right) and tracks flatIndex.

    Test cases (input → expected output):

    0 cards: [] → left=[], right=[]
    1 card: [{id:'a'}] → left=[{card:{id:'a'}, flatIndex:0}], right=[]
    2 cards: [{id:'a'},{id:'b'}] → left=[{flatIndex:0}], right=[{flatIndex:1}]
    3 cards: [{id:'a'},{id:'b'},{id:'c'}] → left=[{flatIndex:0},{flatIndex:2}], right=[{flatIndex:1}]
    5 cards: [0..4] → left=[{flatIndex:0},{flatIndex:2},{flatIndex:4}], right=[{flatIndex:1},{flatIndex:3}]
    6 cards: [0..5] → left=[{flatIndex:0},{flatIndex:2},{flatIndex:4}], right=[{flatIndex:1},{flatIndex:3},{flatIndex:5}]

    Additional assertions per test:
    - Column lengths are correct
    - flatIndex values match expected arrays exactly
    - For count=1: right.length === 0 (EDGE-01 precondition)
    - For odd counts: left.length === right.length + 1 (EDGE-02 shape)
    - For even counts: left.length === right.length
  </behavior>
  <implementation>
Create `lib/utils/__tests__/dashboardColumns.test.ts`:

```typescript
import { splitIntoColumns } from '../dashboardColumns';

describe('splitIntoColumns', () => {
  // Helper to create card array
  const makeCards = (n: number) =>
    Array.from({ length: n }, (_, i) => ({ id: `card-${i}` }));

  describe('0 cards', () => {
    it('returns both columns empty', () => {
      const { left, right } = splitIntoColumns([]);
      expect(left).toHaveLength(0);
      expect(right).toHaveLength(0);
    });
  });

  describe('1 card (EDGE-01 precondition)', () => {
    it('places the single card in left, right is empty', () => {
      const { left, right } = splitIntoColumns(makeCards(1));
      expect(left).toHaveLength(1);
      expect(right).toHaveLength(0);
      expect(left[0]!.flatIndex).toBe(0);
      expect(left[0]!.card).toEqual({ id: 'card-0' });
    });
  });

  describe('2 cards', () => {
    it('splits evenly: left=[0], right=[1]', () => {
      const { left, right } = splitIntoColumns(makeCards(2));
      expect(left).toHaveLength(1);
      expect(right).toHaveLength(1);
      expect(left[0]!.flatIndex).toBe(0);
      expect(right[0]!.flatIndex).toBe(1);
    });
  });

  describe('3 cards (EDGE-02 odd)', () => {
    it('left has one more than right: left=[0,2], right=[1]', () => {
      const { left, right } = splitIntoColumns(makeCards(3));
      expect(left).toHaveLength(2);
      expect(right).toHaveLength(1);
      expect(left.length).toBe(right.length + 1);
      expect(left.map(e => e.flatIndex)).toEqual([0, 2]);
      expect(right.map(e => e.flatIndex)).toEqual([1]);
    });
  });

  describe('5 cards (EDGE-02 odd)', () => {
    it('left=[0,2,4], right=[1,3]', () => {
      const { left, right } = splitIntoColumns(makeCards(5));
      expect(left).toHaveLength(3);
      expect(right).toHaveLength(2);
      expect(left.length).toBe(right.length + 1);
      expect(left.map(e => e.flatIndex)).toEqual([0, 2, 4]);
      expect(right.map(e => e.flatIndex)).toEqual([1, 3]);
    });
  });

  describe('6 cards (even)', () => {
    it('equal columns: left=[0,2,4], right=[1,3,5]', () => {
      const { left, right } = splitIntoColumns(makeCards(6));
      expect(left).toHaveLength(3);
      expect(right).toHaveLength(3);
      expect(left.length).toBe(right.length);
      expect(left.map(e => e.flatIndex)).toEqual([0, 2, 4]);
      expect(right.map(e => e.flatIndex)).toEqual([1, 3, 5]);
    });
  });

  describe('card content preservation', () => {
    it('preserves original card objects in entries', () => {
      const cards = [{ id: 'stove', extra: 42 }, { id: 'thermostat', extra: 99 }];
      const { left, right } = splitIntoColumns(cards);
      expect(left[0]!.card).toBe(cards[0]);
      expect(right[0]!.card).toBe(cards[1]);
    });
  });
});
```

TDD cycle:
- RED: Write the test file, run `npx jest lib/utils/__tests__/dashboardColumns.test.ts` — should PASS immediately since the utility was created in plan 69-01. (This is an unusual TDD case: the implementation already exists from plan 69-01. The test file validates the existing implementation.)
- GREEN: All tests pass on first run.
- REFACTOR: No refactoring needed — utility is already minimal (8 lines).

If any test fails, fix the utility or the test (not both) to achieve green.
  </implementation>
</feature>

<verification>
1. `npx jest lib/utils/__tests__/dashboardColumns.test.ts` — all tests pass (7 test cases)
2. Test file imports from `../dashboardColumns` (the actual utility, not a reimplementation)
3. Test covers all 6 required counts: 0, 1, 2, 3, 5, 6
4. Test asserts flatIndex values explicitly (not just column lengths)
5. Test asserts EDGE-01 precondition (right empty for 1 card)
6. Test asserts EDGE-02 shape (left.length === right.length + 1 for odd counts)
</verification>

<success_criteria>
- 7 test cases pass (0, 1, 2, 3, 5, 6 counts + card content preservation)
- Tests import and call the actual splitIntoColumns from lib/utils/dashboardColumns.ts
- flatIndex assertions verify animation stagger correctness
- No mocking required — pure function test
</success_criteria>

<output>
After completion, create `.planning/phases/69-edge-cases-error-boundary-tests/69-02-SUMMARY.md`
</output>
